<!DOCTYPE html>
<html lang=en>
<head>
    <!-- so meta -->
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="HandheldFriendly" content="True">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=5" />
    <meta name="description" content="ä¸‰å¶è‰å®éªŒå®¤â€œæœŸæœ«ä»»åŠ¡â€æ€»ç»“ï¼ˆç»­ï¼‰(ç¬¬å››è¯¾)ä»»åŠ¡ä¸€ï¼šå®ŒæˆåŠ å¯†åƒµå°¸çš„æ¸¸æˆ4.åƒµå°¸ä½œæˆ˜ç³»ç»Ÿâ‘ å¯æ”¯ä»˜æˆªè‡³ç›®å‰ï¼Œæˆ‘ä»¬åªæ¥è§¦åˆ°å¾ˆå°‘çš„ å‡½æ•°ä¿®é¥°ç¬¦ã€‚ è¦è®°ä½æ‰€æœ‰çš„ä¸œè¥¿å¾ˆéš¾ï¼Œæ‰€ä»¥æˆ‘ä»¬æ¥ä¸ªæ¦‚è§ˆï¼š  æˆ‘ä»¬æœ‰å†³å®šå‡½æ•°ä½•æ—¶å’Œè¢«è°è°ƒç”¨çš„å¯è§æ€§ä¿®é¥°ç¬¦: private æ„å‘³ç€å®ƒåªèƒ½è¢«åˆçº¦å†…éƒ¨è°ƒç”¨ï¼› internal å°±åƒ private ä½†æ˜¯ä¹Ÿèƒ½è¢«ç»§æ‰¿çš„åˆçº¦è°ƒç”¨ï¼› external åªèƒ½ä»åˆçº¦å¤–éƒ¨è°ƒç”¨ï¼›æœ€å public">
<meta property="og:type" content="article">
<meta property="og:title" content="åƒµå°¸æ¸¸æˆç¬¬å››è¯¾">
<meta property="og:url" content="https://formikasaever.github.io./post/8656b72d.html">
<meta property="og:site_name" content="ForMikasaEver&#39;s blog">
<meta property="og:description" content="ä¸‰å¶è‰å®éªŒå®¤â€œæœŸæœ«ä»»åŠ¡â€æ€»ç»“ï¼ˆç»­ï¼‰(ç¬¬å››è¯¾)ä»»åŠ¡ä¸€ï¼šå®ŒæˆåŠ å¯†åƒµå°¸çš„æ¸¸æˆ4.åƒµå°¸ä½œæˆ˜ç³»ç»Ÿâ‘ å¯æ”¯ä»˜æˆªè‡³ç›®å‰ï¼Œæˆ‘ä»¬åªæ¥è§¦åˆ°å¾ˆå°‘çš„ å‡½æ•°ä¿®é¥°ç¬¦ã€‚ è¦è®°ä½æ‰€æœ‰çš„ä¸œè¥¿å¾ˆéš¾ï¼Œæ‰€ä»¥æˆ‘ä»¬æ¥ä¸ªæ¦‚è§ˆï¼š  æˆ‘ä»¬æœ‰å†³å®šå‡½æ•°ä½•æ—¶å’Œè¢«è°è°ƒç”¨çš„å¯è§æ€§ä¿®é¥°ç¬¦: private æ„å‘³ç€å®ƒåªèƒ½è¢«åˆçº¦å†…éƒ¨è°ƒç”¨ï¼› internal å°±åƒ private ä½†æ˜¯ä¹Ÿèƒ½è¢«ç»§æ‰¿çš„åˆçº¦è°ƒç”¨ï¼› external åªèƒ½ä»åˆçº¦å¤–éƒ¨è°ƒç”¨ï¼›æœ€å public">
<meta property="og:locale" content="en_US">
<meta property="article:published_time" content="2023-03-27T10:41:09.000Z">
<meta property="article:modified_time" content="2023-03-27T10:42:57.720Z">
<meta property="article:author" content="ForMikasaEver">
<meta name="twitter:card" content="summary">
    
    
      
        
          <link rel="shortcut icon" href="/images/favicon.ico">
        
      
      
        
          <link rel="icon" type="image/png" href="/images/favicon-192x192.png" sizes="192x192">
        
      
      
        
          <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon.png">
        
      
    
    <!-- title -->
    <title>åƒµå°¸æ¸¸æˆç¬¬å››è¯¾</title>
    <!-- async scripts -->
    <!-- Google Analytics -->


    <!-- Umami Analytics -->


    <!-- styles -->
    
<link rel="stylesheet" href="/css/style.css">

    <!-- persian styles -->
    
    <!-- rss -->
    
    
	<!-- mathjax -->
	
<meta name="generator" content="Hexo 6.3.0"></head>

<body class="max-width mx-auto px3 ltr">
    
      <div id="header-post">
  <a id="menu-icon" href="#" aria-label="Menu"><i class="fa-solid fa-bars fa-lg"></i></a>
  <a id="menu-icon-tablet" href="#" aria-label="Menu"><i class="fa-solid fa-bars fa-lg"></i></a>
  <a id="top-icon-tablet" href="#" aria-label="Top" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');" style="display:none;"><i class="fa-solid fa-chevron-up fa-lg"></i></a>
  <span id="menu">
    <span id="nav">
      <ul>
        <!--
       --><li><a href="/">Home</a></li><!--
     --><!--
       --><li><a href="/about/">About</a></li><!--
     --><!--
       --><li><a href="/search/">Search</a></li><!--
     --><!--
       --><li><a href="/archives/">Writing</a></li><!--
     --><!--
       --><li><a target="_blank" rel="noopener" href="https://github.com/ForMikasaEver">Projects</a></li><!--
     -->
      </ul>
    </span>
    <br/>
    <span id="actions">
      <ul>
        
        <li><a class="icon" aria-label="Previous post" href="/post/e9c8726a.html"><i class="fa-solid fa-chevron-left" aria-hidden="true" onmouseover="$('#i-prev').toggle();" onmouseout="$('#i-prev').toggle();"></i></a></li>
        
        
        <li><a class="icon" aria-label="Next post" href="/post/d9a0b533.html"><i class="fa-solid fa-chevron-right" aria-hidden="true" onmouseover="$('#i-next').toggle();" onmouseout="$('#i-next').toggle();"></i></a></li>
        
        <li><a class="icon" aria-label="Back to top" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');"><i class="fa-solid fa-chevron-up" aria-hidden="true" onmouseover="$('#i-top').toggle();" onmouseout="$('#i-top').toggle();"></i></a></li>
        <li><a class="icon" aria-label="Share post" href="#"><i class="fa-solid fa-share-alt" aria-hidden="true" onmouseover="$('#i-share').toggle();" onmouseout="$('#i-share').toggle();" onclick="$('#share').toggle();return false;"></i></a></li>
      </ul>
      <span id="i-prev" class="info" style="display:none;">Previous post</span>
      <span id="i-next" class="info" style="display:none;">Next post</span>
      <span id="i-top" class="info" style="display:none;">Back to top</span>
      <span id="i-share" class="info" style="display:none;">Share post</span>
    </span>
    <br/>
    <div id="share" style="display: none">
      <ul>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.facebook.com/sharer.php?u=https://formikasaever.github.io./post/8656b72d.html"><i class="fab fa-facebook " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://twitter.com/share?url=https://formikasaever.github.io./post/8656b72d.html&text=åƒµå°¸æ¸¸æˆç¬¬å››è¯¾"><i class="fab fa-twitter " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.linkedin.com/shareArticle?url=https://formikasaever.github.io./post/8656b72d.html&title=åƒµå°¸æ¸¸æˆç¬¬å››è¯¾"><i class="fab fa-linkedin " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://pinterest.com/pin/create/bookmarklet/?url=https://formikasaever.github.io./post/8656b72d.html&is_video=false&description=åƒµå°¸æ¸¸æˆç¬¬å››è¯¾"><i class="fab fa-pinterest " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="mailto:?subject=åƒµå°¸æ¸¸æˆç¬¬å››è¯¾&body=Check out this article: https://formikasaever.github.io./post/8656b72d.html"><i class="fa-solid fa-envelope " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://getpocket.com/save?url=https://formikasaever.github.io./post/8656b72d.html&title=åƒµå°¸æ¸¸æˆç¬¬å››è¯¾"><i class="fab fa-get-pocket " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://reddit.com/submit?url=https://formikasaever.github.io./post/8656b72d.html&title=åƒµå°¸æ¸¸æˆç¬¬å››è¯¾"><i class="fab fa-reddit " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.stumbleupon.com/submit?url=https://formikasaever.github.io./post/8656b72d.html&title=åƒµå°¸æ¸¸æˆç¬¬å››è¯¾"><i class="fab fa-stumbleupon " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://digg.com/submit?url=https://formikasaever.github.io./post/8656b72d.html&title=åƒµå°¸æ¸¸æˆç¬¬å››è¯¾"><i class="fab fa-digg " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.tumblr.com/share/link?url=https://formikasaever.github.io./post/8656b72d.html&name=åƒµå°¸æ¸¸æˆç¬¬å››è¯¾&description="><i class="fab fa-tumblr " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://news.ycombinator.com/submitlink?u=https://formikasaever.github.io./post/8656b72d.html&t=åƒµå°¸æ¸¸æˆç¬¬å››è¯¾"><i class="fab fa-hacker-news " aria-hidden="true"></i></a></li>
</ul>

    </div>
    <div id="toc">
      <ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#%E4%B8%89%E5%8F%B6%E8%8D%89%E5%AE%9E%E9%AA%8C%E5%AE%A4%E2%80%9C%E6%9C%9F%E6%9C%AB%E4%BB%BB%E5%8A%A1%E2%80%9D%E6%80%BB%E7%BB%93%EF%BC%88%E7%BB%AD%EF%BC%89-%E7%AC%AC%E5%9B%9B%E8%AF%BE"><span class="toc-number">1.</span> <span class="toc-text">ä¸‰å¶è‰å®éªŒå®¤â€œæœŸæœ«ä»»åŠ¡â€æ€»ç»“ï¼ˆç»­ï¼‰(ç¬¬å››è¯¾)</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BB%BB%E5%8A%A1%E4%B8%80%EF%BC%9A%E5%AE%8C%E6%88%90%E5%8A%A0%E5%AF%86%E5%83%B5%E5%B0%B8%E7%9A%84%E6%B8%B8%E6%88%8F"><span class="toc-number">1.1.</span> <span class="toc-text">ä»»åŠ¡ä¸€ï¼šå®ŒæˆåŠ å¯†åƒµå°¸çš„æ¸¸æˆ</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#4-%E5%83%B5%E5%B0%B8%E4%BD%9C%E6%88%98%E7%B3%BB%E7%BB%9F"><span class="toc-number">1.1.1.</span> <span class="toc-text">4.åƒµå°¸ä½œæˆ˜ç³»ç»Ÿ</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E2%91%A0%E5%8F%AF%E6%94%AF%E4%BB%98"><span class="toc-number">1.1.1.1.</span> <span class="toc-text">â‘ å¯æ”¯ä»˜</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E2%91%A1%E6%8F%90%E7%8E%B0"><span class="toc-number">1.1.1.2.</span> <span class="toc-text">â‘¡æç°</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E2%91%A2%E5%83%B5%E5%B0%B8%E6%88%98%E6%96%97"><span class="toc-number">1.1.1.3.</span> <span class="toc-text">â‘¢åƒµå°¸æˆ˜æ–—</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E2%91%A3%E9%9A%8F%E6%9C%BA%E6%95%B0"><span class="toc-number">1.1.1.4.</span> <span class="toc-text">â‘£éšæœºæ•°</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E2%91%A4%E5%83%B5%E5%B0%B8%E5%AF%B9%E5%86%B3"><span class="toc-number">1.1.1.5.</span> <span class="toc-text">â‘¤åƒµå°¸å¯¹å†³</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E2%91%A5%E9%87%8D%E6%9E%84%E9%80%9A%E7%94%A8%E9%80%BB%E8%BE%91"><span class="toc-number">1.1.1.6.</span> <span class="toc-text">â‘¥é‡æ„é€šç”¨é€»è¾‘</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E2%91%A6%E6%9B%B4%E5%A4%9A%E9%87%8D%E6%9E%84"><span class="toc-number">1.1.1.7.</span> <span class="toc-text">â‘¦æ›´å¤šé‡æ„</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E2%91%A7%E5%9B%9E%E5%88%B0%E6%94%BB%E5%87%BB"><span class="toc-number">1.1.1.8.</span> <span class="toc-text">â‘§å›åˆ°æ”»å‡»</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E2%91%A8%E5%83%B5%E5%B0%B8%E7%9A%84%E8%BE%93%E8%B5%A2"><span class="toc-number">1.1.1.9.</span> <span class="toc-text">â‘¨åƒµå°¸çš„è¾“èµ¢</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E2%91%A9%E5%83%B5%E5%B0%B8%E8%83%9C%E5%88%A9%E4%BA%86%F0%9F%98%84"><span class="toc-number">1.1.1.10.</span> <span class="toc-text">â‘©åƒµå°¸èƒœåˆ©äº†ğŸ˜„</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E2%91%AA%E5%83%B5%E5%B0%B8%E5%A4%B1%E8%B4%A5%F0%9F%98%9E"><span class="toc-number">1.1.1.11.</span> <span class="toc-text">â‘ªåƒµå°¸å¤±è´¥ğŸ˜</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E2%91%AB%E6%94%BE%E5%9C%A8%E4%B8%80%E8%B5%B7"><span class="toc-number">1.1.1.12.</span> <span class="toc-text">â‘«æ”¾åœ¨ä¸€èµ·</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E2%91%ACLesson-4-Complete%EF%BC%81"><span class="toc-number">1.1.1.13.</span> <span class="toc-text">â‘¬Lesson 4 Completeï¼</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%BF%83%E5%BE%97"><span class="toc-number">1.1.2.</span> <span class="toc-text">å¿ƒå¾—</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E2%91%A0%E7%AC%AC%E5%9B%9B%E8%AF%BE-%E7%AC%AC%E2%91%A9%E8%8A%82"><span class="toc-number">1.1.2.1.</span> <span class="toc-text">â‘ ç¬¬å››è¯¾ ç¬¬â‘©èŠ‚</span></a></li></ol></li></ol></li></ol></li></ol>
    </div>
  </span>
</div>

    
    <div class="content index py4 ">
        
        <article class="post h-entry" itemscope itemtype="http://schema.org/BlogPosting">
  <header>
    
    <h1 class="posttitle p-name" itemprop="name headline">
        åƒµå°¸æ¸¸æˆç¬¬å››è¯¾
    </h1>



    <div class="meta">
      <span class="author p-author h-card" itemprop="author" itemscope itemtype="http://schema.org/Person">
        <span class="p-name" itemprop="name">ForMikasaEver</span>
      </span>
      
    <div class="postdate">
      
        <time datetime="2023-03-27T10:41:09.000Z" class="dt-published" itemprop="datePublished">2023-03-27</time>
        
      
    </div>


      

      

    </div>
  </header>
  

  <div class="content e-content" itemprop="articleBody">
    <h1 id="ä¸‰å¶è‰å®éªŒå®¤â€œæœŸæœ«ä»»åŠ¡â€æ€»ç»“ï¼ˆç»­ï¼‰-ç¬¬å››è¯¾"><a href="#ä¸‰å¶è‰å®éªŒå®¤â€œæœŸæœ«ä»»åŠ¡â€æ€»ç»“ï¼ˆç»­ï¼‰-ç¬¬å››è¯¾" class="headerlink" title="ä¸‰å¶è‰å®éªŒå®¤â€œæœŸæœ«ä»»åŠ¡â€æ€»ç»“ï¼ˆç»­ï¼‰(ç¬¬å››è¯¾)"></a>ä¸‰å¶è‰å®éªŒå®¤â€œæœŸæœ«ä»»åŠ¡â€æ€»ç»“ï¼ˆç»­ï¼‰(ç¬¬å››è¯¾)</h1><h2 id="ä»»åŠ¡ä¸€ï¼šå®ŒæˆåŠ å¯†åƒµå°¸çš„æ¸¸æˆ"><a href="#ä»»åŠ¡ä¸€ï¼šå®ŒæˆåŠ å¯†åƒµå°¸çš„æ¸¸æˆ" class="headerlink" title="ä»»åŠ¡ä¸€ï¼šå®ŒæˆåŠ å¯†åƒµå°¸çš„æ¸¸æˆ"></a>ä»»åŠ¡ä¸€ï¼šå®ŒæˆåŠ å¯†åƒµå°¸çš„æ¸¸æˆ</h2><h3 id="4-åƒµå°¸ä½œæˆ˜ç³»ç»Ÿ"><a href="#4-åƒµå°¸ä½œæˆ˜ç³»ç»Ÿ" class="headerlink" title="4.åƒµå°¸ä½œæˆ˜ç³»ç»Ÿ"></a>4.åƒµå°¸ä½œæˆ˜ç³»ç»Ÿ</h3><h4 id="â‘ å¯æ”¯ä»˜"><a href="#â‘ å¯æ”¯ä»˜" class="headerlink" title="â‘ å¯æ”¯ä»˜"></a>â‘ å¯æ”¯ä»˜</h4><p>æˆªè‡³ç›®å‰ï¼Œæˆ‘ä»¬åªæ¥è§¦åˆ°å¾ˆå°‘çš„ å‡½æ•°ä¿®é¥°ç¬¦ã€‚ è¦è®°ä½æ‰€æœ‰çš„ä¸œè¥¿å¾ˆéš¾ï¼Œæ‰€ä»¥æˆ‘ä»¬æ¥ä¸ªæ¦‚è§ˆï¼š</p>
<ol>
<li><p>æˆ‘ä»¬æœ‰å†³å®šå‡½æ•°ä½•æ—¶å’Œè¢«è°è°ƒç”¨çš„å¯è§æ€§ä¿®é¥°ç¬¦: private æ„å‘³ç€å®ƒåªèƒ½è¢«åˆçº¦å†…éƒ¨è°ƒç”¨ï¼› internal å°±åƒ private ä½†æ˜¯ä¹Ÿèƒ½è¢«ç»§æ‰¿çš„åˆçº¦è°ƒç”¨ï¼› external åªèƒ½ä»åˆçº¦å¤–éƒ¨è°ƒç”¨ï¼›æœ€å public å¯ä»¥åœ¨ä»»ä½•åœ°æ–¹è°ƒç”¨ï¼Œä¸ç®¡æ˜¯å†…éƒ¨è¿˜æ˜¯å¤–éƒ¨ã€‚</p>
</li>
<li><p>æˆ‘ä»¬ä¹Ÿæœ‰çŠ¶æ€ä¿®é¥°ç¬¦ï¼Œ å‘Šè¯‰æˆ‘ä»¬å‡½æ•°å¦‚ä½•å’ŒåŒºå—é“¾äº¤äº’: view å‘Šè¯‰æˆ‘ä»¬è¿è¡Œè¿™ä¸ªå‡½æ•°ä¸ä¼šæ›´æ”¹å’Œä¿å­˜ä»»ä½•æ•°æ®ï¼› pure å‘Šè¯‰æˆ‘ä»¬è¿™ä¸ªå‡½æ•°ä¸ä½†ä¸ä¼šå¾€åŒºå—é“¾å†™æ•°æ®ï¼Œå®ƒç”šè‡³ä¸ä»åŒºå—é“¾è¯»å–æ•°æ®ã€‚è¿™ä¸¤ç§åœ¨è¢«ä»åˆçº¦å¤–éƒ¨è°ƒç”¨çš„æ—¶å€™éƒ½ä¸èŠ±è´¹ä»»ä½•gasï¼ˆä½†æ˜¯å®ƒä»¬åœ¨è¢«å†…éƒ¨å…¶ä»–å‡½æ•°è°ƒç”¨çš„æ—¶å€™å°†ä¼šè€—è´¹gasï¼‰ã€‚</p>
</li>
<li><p>ç„¶åæˆ‘ä»¬æœ‰äº†è‡ªå®šä¹‰çš„ modifiersï¼Œä¾‹å¦‚åœ¨ç¬¬ä¸‰è¯¾å­¦ä¹ çš„: onlyOwner å’Œ aboveLevelã€‚ å¯¹äºè¿™äº›ä¿®é¥°ç¬¦æˆ‘ä»¬å¯ä»¥è‡ªå®šä¹‰å…¶å¯¹å‡½æ•°çš„çº¦æŸé€»è¾‘ã€‚</p>
</li>
</ol>
<p>è¿™äº›ä¿®é¥°ç¬¦å¯ä»¥åŒæ—¶ä½œç”¨äºä¸€ä¸ªå‡½æ•°å®šä¹‰ä¸Šï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">function test() external view onlyOwner anotherModifier &#123; /* ... */ &#125;</span><br></pre></td></tr></table></figure>
<p>åœ¨è¿™ä¸€ç« ï¼Œæˆ‘ä»¬æ¥å­¦ä¹ ä¸€ä¸ªæ–°çš„ä¿®é¥°ç¬¦ payable.</p>
<p><strong>payable ä¿®é¥°ç¬¦</strong></p>
<p>payable æ–¹æ³•æ˜¯è®© Solidity å’Œä»¥å¤ªåŠå˜å¾—å¦‚æ­¤é…·çš„ä¸€éƒ¨åˆ† â€”â€” å®ƒä»¬æ˜¯ä¸€ç§å¯ä»¥æ¥æ”¶ä»¥å¤ªçš„ç‰¹æ®Šå‡½æ•°ã€‚</p>
<p>å…ˆæ”¾ä¸€ä¸‹ã€‚å½“ä½ åœ¨è°ƒç”¨ä¸€ä¸ªæ™®é€šç½‘ç«™æœåŠ¡å™¨ä¸Šçš„APIå‡½æ•°çš„æ—¶å€™ï¼Œä½ æ— æ³•ç”¨ä½ çš„å‡½æ•°ä¼ é€ç¾å…ƒâ€”â€”ä½ ä¹Ÿä¸èƒ½ä¼ é€æ¯”ç‰¹å¸ã€‚</p>
<p>ä½†æ˜¯åœ¨ä»¥å¤ªåŠä¸­ï¼Œ å› ä¸ºé’± (<em>ä»¥å¤ª</em>), æ•°æ® (äº‹åŠ¡è´Ÿè½½)ï¼Œ ä»¥åŠåˆçº¦ä»£ç æœ¬èº«éƒ½å­˜åœ¨äºä»¥å¤ªåŠã€‚ä½ å¯ä»¥åœ¨åŒæ—¶è°ƒç”¨å‡½æ•° å¹¶ä»˜é’±ç»™å¦å¤–ä¸€ä¸ªåˆçº¦ã€‚</p>
<p>è¿™å°±å…è®¸å‡ºç°å¾ˆå¤šæœ‰è¶£çš„é€»è¾‘ï¼Œ æ¯”å¦‚å‘ä¸€ä¸ªåˆçº¦è¦æ±‚æ”¯ä»˜ä¸€å®šçš„é’±æ¥è¿è¡Œä¸€ä¸ªå‡½æ•°ã€‚</p>
<p><strong>æ¥çœ‹ä¸ªä¾‹å­</strong></p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">contract OnlineStore &#123;</span><br><span class="line">  function buySomething() external payable &#123;</span><br><span class="line">    // æ£€æŸ¥ä»¥ç¡®å®š0.001ä»¥å¤ªå‘é€å‡ºå»æ¥è¿è¡Œå‡½æ•°:</span><br><span class="line">    require(msg.value == 0.001 ether);</span><br><span class="line">    // å¦‚æœä¸ºçœŸï¼Œä¸€äº›ç”¨æ¥å‘å‡½æ•°è°ƒç”¨è€…å‘é€æ•°å­—å†…å®¹çš„é€»è¾‘</span><br><span class="line">    transferThing(msg.sender);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>åœ¨è¿™é‡Œï¼Œmsg.value æ˜¯ä¸€ç§å¯ä»¥æŸ¥çœ‹å‘åˆçº¦å‘é€äº†å¤šå°‘ä»¥å¤ªçš„æ–¹æ³•ï¼Œå¦å¤– ether æ˜¯ä¸€ä¸ªå…§å»ºå•å…ƒã€‚</p>
<p>è¿™é‡Œå‘ç”Ÿçš„äº‹æ˜¯ï¼Œä¸€äº›äººä¼šä» web3.js è°ƒç”¨è¿™ä¸ªå‡½æ•° (ä»DAppçš„å‰ç«¯)ï¼Œ åƒè¿™æ · :</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">// å‡è®¾ `OnlineStore` åœ¨ä»¥å¤ªåŠä¸ŠæŒ‡å‘ä½ çš„åˆçº¦:</span><br><span class="line">OnlineStore.buySomething().send(from: web3.eth.defaultAccount, value: web3.utils.toWei(0.001))</span><br></pre></td></tr></table></figure>
<p>æ³¨æ„è¿™ä¸ª value å­—æ®µï¼Œ JavaScript è°ƒç”¨æ¥æŒ‡å®šå‘é€å¤šå°‘(0.001)ä»¥å¤ªã€‚å¦‚æœæŠŠäº‹åŠ¡æƒ³è±¡æˆä¸€ä¸ªä¿¡å°ï¼Œä½ å‘é€åˆ°å‡½æ•°çš„å‚æ•°å°±æ˜¯ä¿¡çš„å†…å®¹ã€‚ æ·»åŠ ä¸€ä¸ª value å¾ˆåƒåœ¨ä¿¡å°é‡Œé¢æ”¾é’± â€”â€” ä¿¡ä»¶å†…å®¹å’Œé’±åŒæ—¶å‘é€ç»™äº†æ¥æ”¶è€…ã€‚</p>
<blockquote>
<p>æ³¨æ„ï¼š å¦‚æœä¸€ä¸ªå‡½æ•°æ²¡æ ‡è®°ä¸ºpayableï¼Œ è€Œä½ å°è¯•åˆ©ç”¨ä¸Šé¢çš„æ–¹æ³•å‘é€ä»¥å¤ªï¼Œå‡½æ•°å°†æ‹’ç»ä½ çš„äº‹åŠ¡ã€‚</p>
</blockquote>
<p>å®æˆ˜æ¼”ä¹ ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">uint levelUpFee = 0.001 ether;</span><br><span class="line"></span><br><span class="line">function levelUp(uint _zombieId) external payable &#123;</span><br><span class="line">    require(msg.value == levelUpFee);</span><br><span class="line">    zombies[_zombieId].level++;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="â‘¡æç°"><a href="#â‘¡æç°" class="headerlink" title="â‘¡æç°"></a>â‘¡æç°</h4><p>åœ¨ä½ å‘é€ä»¥å¤ªä¹‹åï¼Œå®ƒå°†è¢«å­˜å‚¨è¿›ä»¥åˆçº¦çš„ä»¥å¤ªåŠè´¦æˆ·ä¸­ï¼Œ å¹¶å†»ç»“åœ¨å“ªé‡Œ â€”â€” é™¤éä½ æ·»åŠ ä¸€ä¸ªå‡½æ•°æ¥ä»åˆçº¦ä¸­æŠŠä»¥å¤ªæç°ã€‚</p>
<p>ä½ å¯ä»¥å†™ä¸€ä¸ªå‡½æ•°æ¥ä»åˆçº¦ä¸­æç°ä»¥å¤ªï¼Œç±»ä¼¼è¿™æ ·ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">contract GetPaid is Ownable &#123;</span><br><span class="line">  function withdraw() external onlyOwner &#123;</span><br><span class="line">    owner.transfer(this.balance);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>æ³¨æ„æˆ‘ä»¬ä½¿ç”¨ Ownable åˆçº¦ä¸­çš„ owner å’Œ onlyOwnerï¼Œå‡å®šå®ƒå·²ç»è¢«å¼•å…¥äº†ã€‚</p>
<p>ä½ å¯ä»¥é€šè¿‡ transfer å‡½æ•°å‘ä¸€ä¸ªåœ°å€å‘é€ä»¥å¤ªï¼Œ ç„¶å this.balance å°†è¿”å›å½“å‰åˆçº¦å­˜å‚¨äº†å¤šå°‘ä»¥å¤ªã€‚ æ‰€ä»¥å¦‚æœ100ä¸ªç”¨æˆ·æ¯äººå‘æˆ‘ä»¬æ”¯ä»˜1ä»¥å¤ªï¼Œ this.balance å°†æ˜¯100ä»¥å¤ªã€‚</p>
<p>ä½ å¯ä»¥é€šè¿‡ transfer å‘ä»»ä½•ä»¥å¤ªåŠåœ°å€ä»˜é’±ã€‚ æ¯”å¦‚ï¼Œä½ å¯ä»¥æœ‰ä¸€ä¸ªå‡½æ•°åœ¨ msg.sender è¶…é¢ä»˜æ¬¾çš„æ—¶å€™ç»™ä»–ä»¬é€€é’±ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">uint itemFee = 0.001 ether;</span><br><span class="line">msg.sender.transfer(msg.value - itemFee);</span><br></pre></td></tr></table></figure>
<p>æˆ–è€…åœ¨ä¸€ä¸ªæœ‰å–å®¶å’Œå–å®¶çš„åˆçº¦ä¸­ï¼Œ ä½ å¯ä»¥æŠŠå–å®¶çš„åœ°å€å­˜å‚¨èµ·æ¥ï¼Œ å½“æœ‰äººä¹°äº†å®ƒçš„ä¸œè¥¿çš„æ—¶å€™ï¼ŒæŠŠä¹°å®¶æ”¯ä»˜çš„é’±å‘é€ç»™å®ƒ seller.transfer(msg.value)ã€‚</p>
<p>æœ‰å¾ˆå¤šä¾‹å­æ¥å±•ç¤ºä»€ä¹ˆè®©ä»¥å¤ªåŠç¼–ç¨‹å¦‚æ­¤ä¹‹é…· â€”â€” ä½ å¯ä»¥æ‹¥æœ‰ä¸€ä¸ªä¸è¢«ä»»ä½•äººæ§åˆ¶çš„å»ä¸­å¿ƒåŒ–å¸‚åœºã€‚</p>
<p>å®æˆ˜æ¼”ä¹ ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">function withdraw() external onlyOwner &#123;</span><br><span class="line">    owner.transfer(this.balance);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  function setLevelUpFee(uint _fee) external onlyOwner &#123;</span><br><span class="line">    levelUpFee = _fee;</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure>
<h4 id="â‘¢åƒµå°¸æˆ˜æ–—"><a href="#â‘¢åƒµå°¸æˆ˜æ–—" class="headerlink" title="â‘¢åƒµå°¸æˆ˜æ–—"></a>â‘¢åƒµå°¸æˆ˜æ–—</h4><p>åœ¨æˆ‘ä»¬å­¦ä¹ äº†å¯æ”¯ä»˜å‡½æ•°å’Œåˆçº¦ä½™é¢ä¹‹åï¼Œæ˜¯æ—¶å€™ä¸ºåƒµå°¸æˆ˜æ–—æ·»åŠ åŠŸèƒ½äº†ã€‚</p>
<p>éµå¾ªä¸Šä¸€ç« çš„æ ¼å¼ï¼Œæˆ‘ä»¬æ–°å»ºä¸€ä¸ªæ”»å‡»åŠŸèƒ½åˆçº¦ï¼Œå¹¶å°†ä»£ç æ”¾è¿›æ–°çš„æ–‡ä»¶ä¸­ï¼Œå¼•å…¥ä¸Šä¸€ä¸ªåˆçº¦ã€‚<br>å®æˆ˜æ¼”ä¹ ï¼š<br>zombieattack.sol:</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">pragma solidity ^0.4.19;</span><br><span class="line"></span><br><span class="line">import &quot;./zombiehelper.sol&quot;;</span><br><span class="line"></span><br><span class="line">contract ZombieBattle is ZombieHelper &#123;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="â‘£éšæœºæ•°"><a href="#â‘£éšæœºæ•°" class="headerlink" title="â‘£éšæœºæ•°"></a>â‘£éšæœºæ•°</h4><p><strong>ç”¨ keccak256 æ¥åˆ¶é€ éšæœºæ•°ã€‚</strong><br>Solidity ä¸­æœ€å¥½çš„éšæœºæ•°ç”Ÿæˆå™¨æ˜¯ keccak256 å“ˆå¸Œå‡½æ•°.</p>
<p>æˆ‘ä»¬å¯ä»¥è¿™æ ·æ¥ç”Ÿæˆä¸€äº›éšæœºæ•°</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">// ç”Ÿæˆä¸€ä¸ª0åˆ°100çš„éšæœºæ•°:</span><br><span class="line">uint randNonce = 0;</span><br><span class="line">uint random = uint(keccak256(now, msg.sender, randNonce)) % 100;</span><br><span class="line">randNonce++;</span><br><span class="line">uint random2 = uint(keccak256(now, msg.sender, randNonce)) % 100;</span><br></pre></td></tr></table></figure>
<p>è¿™ä¸ªæ–¹æ³•é¦–å…ˆæ‹¿åˆ° now çš„æ—¶é—´æˆ³ã€ msg.senderã€ ä»¥åŠä¸€ä¸ªè‡ªå¢æ•° nonce ï¼ˆä¸€ä¸ªä»…ä¼šè¢«ä½¿ç”¨ä¸€æ¬¡çš„æ•°ï¼Œè¿™æ ·æˆ‘ä»¬å°±ä¸ä¼šå¯¹ç›¸åŒçš„è¾“å…¥å€¼è°ƒç”¨ä¸€æ¬¡ä»¥ä¸Šå“ˆå¸Œå‡½æ•°äº†ï¼‰ã€‚</p>
<p>ç„¶ååˆ©ç”¨ keccak æŠŠè¾“å…¥çš„å€¼è½¬å˜ä¸ºä¸€ä¸ªå“ˆå¸Œå€¼, å†å°†å“ˆå¸Œå€¼è½¬æ¢ä¸º uint, ç„¶ååˆ©ç”¨ % 100 æ¥å–æœ€åä¸¤ä½, å°±ç”Ÿæˆäº†ä¸€ä¸ª0åˆ°100ä¹‹é—´éšæœºæ•°äº†ã€‚</p>
<p><strong>è¿™ä¸ªæ–¹æ³•å¾ˆå®¹æ˜“è¢«ä¸è¯šå®çš„èŠ‚ç‚¹æ”»å‡»</strong><br>åœ¨ä»¥å¤ªåŠä¸Š, å½“ä½ åœ¨å’Œä¸€ä¸ªåˆçº¦ä¸Šè°ƒç”¨å‡½æ•°çš„æ—¶å€™, ä½ ä¼šæŠŠå®ƒå¹¿æ’­ç»™ä¸€ä¸ªèŠ‚ç‚¹æˆ–è€…åœ¨ç½‘ç»œä¸Šçš„ transaction èŠ‚ç‚¹ä»¬ã€‚ ç½‘ç»œä¸Šçš„èŠ‚ç‚¹å°†æ”¶é›†å¾ˆå¤šäº‹åŠ¡, è¯•ç€æˆä¸ºç¬¬ä¸€ä¸ªè§£å†³è®¡ç®—å¯†é›†å‹æ•°å­¦é—®é¢˜çš„äººï¼Œä½œä¸ºâ€œå·¥ä½œè¯æ˜â€ï¼Œç„¶åå°†â€œå·¥ä½œè¯æ˜â€(Proof of Work, PoW)å’Œäº‹åŠ¡ä¸€èµ·ä½œä¸ºä¸€ä¸ª block å‘å¸ƒåœ¨ç½‘ç»œä¸Šã€‚</p>
<p>ä¸€æ—¦ä¸€ä¸ªèŠ‚ç‚¹è§£å†³äº†ä¸€ä¸ªPoW, å…¶ä»–èŠ‚ç‚¹å°±ä¼šåœæ­¢å°è¯•è§£å†³è¿™ä¸ª PoW, å¹¶éªŒè¯å…¶ä»–èŠ‚ç‚¹çš„äº‹åŠ¡åˆ—è¡¨æ˜¯æœ‰æ•ˆçš„ï¼Œç„¶åæ¥å—è¿™ä¸ªèŠ‚ç‚¹è½¬è€Œå°è¯•è§£å†³ä¸‹ä¸€ä¸ªèŠ‚ç‚¹ã€‚</p>
<p>è¿™å°±è®©æˆ‘ä»¬çš„éšæœºæ•°å‡½æ•°å˜å¾—å¯åˆ©ç”¨äº†</p>
<p>æˆ‘ä»¬å‡è®¾æˆ‘ä»¬æœ‰ä¸€ä¸ªç¡¬å¸ç¿»è½¬åˆçº¦â€”â€”æ­£é¢ä½ èµ¢åŒå€é’±ï¼Œåé¢ä½ è¾“æ‰æ‰€æœ‰çš„é’±ã€‚å‡å¦‚å®ƒä½¿ç”¨ä¸Šé¢çš„æ–¹æ³•æ¥å†³å®šæ˜¯æ­£é¢è¿˜æ˜¯åé¢ (random &gt;&#x3D; 50 ç®—æ­£é¢, random &lt; 50 ç®—åé¢)ã€‚</p>
<p>å¦‚æœæˆ‘æ­£è¿è¡Œä¸€ä¸ªèŠ‚ç‚¹ï¼Œæˆ‘å¯ä»¥ åªå¯¹æˆ‘è‡ªå·±çš„èŠ‚ç‚¹ å‘å¸ƒä¸€ä¸ªäº‹åŠ¡ï¼Œä¸”ä¸åˆ†äº«å®ƒã€‚ æˆ‘å¯ä»¥è¿è¡Œç¡¬å¸ç¿»è½¬æ–¹æ³•æ¥å·çª¥æˆ‘çš„è¾“èµ¢ â€” å¦‚æœæˆ‘è¾“äº†ï¼Œæˆ‘å°±ä¸æŠŠè¿™ä¸ªäº‹åŠ¡åŒ…å«è¿›æˆ‘è¦è§£å†³çš„ä¸‹ä¸€ä¸ªåŒºå—ä¸­å»ã€‚æˆ‘å¯ä»¥ä¸€ç›´è¿è¡Œè¿™ä¸ªæ–¹æ³•ï¼Œç›´åˆ°æˆ‘èµ¢å¾—äº†ç¡¬å¸ç¿»è½¬å¹¶è§£å†³äº†ä¸‹ä¸€ä¸ªåŒºå—ï¼Œç„¶åè·åˆ©ã€‚</p>
<p><strong>æ‰€ä»¥æˆ‘ä»¬è¯¥å¦‚ä½•åœ¨ä»¥å¤ªåŠä¸Šå®‰å…¨åœ°ç”Ÿæˆéšæœºæ•°å‘¢</strong><br>å› ä¸ºåŒºå—é“¾çš„å…¨éƒ¨å†…å®¹å¯¹æ‰€æœ‰å‚ä¸è€…æ¥è¯´æ˜¯é€æ˜çš„ï¼Œ è¿™å°±è®©è¿™ä¸ªé—®é¢˜å˜å¾—å¾ˆéš¾ï¼Œå®ƒçš„è§£å†³æ–¹æ³•ä¸åœ¨æœ¬è¯¾ç¨‹è®¨è®ºèŒƒå›´ï¼Œä½ å¯ä»¥é˜…è¯» è¿™ä¸ª StackOverflow ä¸Šçš„è®¨è®º æ¥è·å¾—ä¸€äº›ä¸»æ„ã€‚ ä¸€ä¸ªæ–¹æ³•æ˜¯åˆ©ç”¨ oracle æ¥è®¿é—®ä»¥å¤ªåŠåŒºå—é“¾ä¹‹å¤–çš„éšæœºæ•°å‡½æ•°ã€‚</p>
<p>å½“ç„¶ï¼Œ å› ä¸ºç½‘ç»œä¸Šæˆåƒä¸Šä¸‡çš„ä»¥å¤ªåŠèŠ‚ç‚¹éƒ½åœ¨ç«äº‰è§£å†³ä¸‹ä¸€ä¸ªåŒºå—ï¼Œæˆ‘èƒ½æˆåŠŸè§£å†³ä¸‹ä¸€ä¸ªåŒºå—çš„å‡ ç‡éå¸¸ä¹‹ä½ã€‚ è¿™å°†èŠ±è´¹æˆ‘ä»¬å·¨å¤§çš„è®¡ç®—èµ„æºæ¥å¼€å‘è¿™ä¸ªè·åˆ©æ–¹æ³• â€” ä½†æ˜¯å¦‚æœå¥–åŠ±å¼‚å¸¸åœ°é«˜(æ¯”å¦‚æˆ‘å¯ä»¥åœ¨ç¡¬å¸ç¿»è½¬å‡½æ•°ä¸­èµ¢å¾— 1ä¸ªäº¿)ï¼Œ é‚£å°±å¾ˆå€¼å¾—å»æ”»å‡»äº†ã€‚</p>
<p>æ‰€ä»¥å°½ç®¡è¿™ä¸ªæ–¹æ³•åœ¨ä»¥å¤ªåŠä¸Šä¸å®‰å…¨ï¼Œåœ¨å®é™…ä¸­ï¼Œé™¤éæˆ‘ä»¬çš„éšæœºå‡½æ•°æœ‰ä¸€å¤§ç¬”é’±åœ¨ä¸Šé¢ï¼Œä½ æ¸¸æˆçš„ç”¨æˆ·ä¸€èˆ¬æ˜¯æ²¡æœ‰è¶³å¤Ÿçš„èµ„æºå»æ”»å‡»çš„ã€‚</p>
<p>å› ä¸ºåœ¨è¿™ä¸ªæ•™ç¨‹ä¸­ï¼Œæˆ‘ä»¬åªæ˜¯åœ¨ç¼–å†™ä¸€ä¸ªç®€å•çš„æ¸¸æˆæ¥åšæ¼”ç¤ºï¼Œä¹Ÿæ²¡æœ‰çœŸæ­£çš„é’±åœ¨é‡Œé¢ï¼Œæ‰€ä»¥æˆ‘ä»¬å†³å®šæ¥å—è¿™ä¸ªä¸è¶³ä¹‹å¤„ï¼Œä½¿ç”¨è¿™ä¸ªç®€å•çš„éšæœºæ•°ç”Ÿæˆå‡½æ•°ã€‚ä½†æ˜¯è¦è°¨è®°å®ƒæ˜¯ä¸å®‰å…¨çš„ã€‚</p>
<p>å®æˆ˜æ¼”ä¹ ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">uint randNonce = 0;</span><br><span class="line"></span><br><span class="line">  function randMod(uint _modulus) internal returns(uint) &#123;</span><br><span class="line">    randNonce++;</span><br><span class="line">    return uint(keccak256(now, msg.sender, randNonce)) % _modulus;</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure>
<h4 id="â‘¤åƒµå°¸å¯¹å†³"><a href="#â‘¤åƒµå°¸å¯¹å†³" class="headerlink" title="â‘¤åƒµå°¸å¯¹å†³"></a>â‘¤åƒµå°¸å¯¹å†³</h4><p>æˆ‘ä»¬çš„åˆçº¦å·²ç»æœ‰äº†ä¸€äº›éšæœºæ€§çš„æ¥æºï¼Œå¯ä»¥ç”¨è¿›æˆ‘ä»¬çš„åƒµå°¸æˆ˜æ–—ä¸­å»è®¡ç®—ç»“æœã€‚</p>
<p>æˆ‘ä»¬çš„åƒµå°¸æˆ˜æ–—çœ‹èµ·æ¥å°†æ˜¯è¿™ä¸ªæµç¨‹ï¼š</p>
<ul>
<li>ä½ é€‰æ‹©ä¸€ä¸ªè‡ªå·±çš„åƒµå°¸ï¼Œç„¶åé€‰æ‹©ä¸€ä¸ªå¯¹æ‰‹çš„åƒµå°¸å»æ”»å‡»ã€‚</li>
<li>å¦‚æœä½ æ˜¯æ”»å‡»æ–¹ï¼Œä½ å°†æœ‰70%çš„å‡ ç‡è·èƒœï¼Œé˜²å®ˆæ–¹å°†æœ‰30%çš„å‡ ç‡è·èƒœã€‚</li>
<li>æ‰€æœ‰çš„åƒµå°¸ï¼ˆæ”»å®ˆåŒæ–¹ï¼‰éƒ½å°†æœ‰ä¸€ä¸ª winCount å’Œä¸€ä¸ª lossCountï¼Œè¿™ä¸¤ä¸ªå€¼éƒ½å°†æ ¹æ®æˆ˜æ–—ç»“æœå¢é•¿ã€‚</li>
<li>è‹¥æ”»å‡»æ–¹è·èƒœï¼Œè¿™ä¸ªåƒµå°¸å°†å‡çº§å¹¶äº§ç”Ÿä¸€ä¸ªæ–°åƒµå°¸ã€‚</li>
<li>å¦‚æœæ”»å‡»æ–¹å¤±è´¥ï¼Œé™¤äº†å¤±è´¥æ¬¡æ•°å°†åŠ ä¸€å¤–ï¼Œä»€ä¹ˆéƒ½ä¸ä¼šå‘ç”Ÿã€‚</li>
<li>æ— è®ºè¾“èµ¢ï¼Œå½“å‰åƒµå°¸çš„å†·å´æ—¶é—´éƒ½å°†è¢«æ¿€æ´»ã€‚</li>
</ul>
<p>è¿™æœ‰ä¸€å¤§å †çš„é€»è¾‘éœ€è¦å¤„ç†ï¼Œæˆ‘ä»¬å°†æŠŠè¿™äº›æ­¥éª¤åˆ†è§£åˆ°æ¥ä¸‹æ¥çš„è¯¾ç¨‹ä¸­å»ã€‚</p>
<p>å®æˆ˜æ¼”ä¹ ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">// åœ¨è¿™é‡Œåˆ›å»º attackVictoryProbability</span><br><span class="line">uint attackVictoryProbability = 70;</span><br><span class="line"></span><br><span class="line">// åœ¨è¿™é‡Œåˆ›å»ºæ–°å‡½æ•°</span><br><span class="line">function attack(uint _zombieId, uint _targetId) external &#123;</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure>
<h4 id="â‘¥é‡æ„é€šç”¨é€»è¾‘"><a href="#â‘¥é‡æ„é€šç”¨é€»è¾‘" class="headerlink" title="â‘¥é‡æ„é€šç”¨é€»è¾‘"></a>â‘¥é‡æ„é€šç”¨é€»è¾‘</h4><p>ä¸ç®¡è°è°ƒç”¨æˆ‘ä»¬çš„ attack å‡½æ•° â€”â€” æˆ‘ä»¬æƒ³ç¡®ä¿ç”¨æˆ·çš„ç¡®æ‹¥æœ‰ä»–ä»¬ç”¨æ¥æ”»å‡»çš„åƒµå°¸ã€‚å¦‚æœä½ èƒ½ç”¨å…¶ä»–äººçš„åƒµå°¸æ¥æ”»å‡»å°†æ˜¯ä¸€ä¸ªå¾ˆå¤§çš„å®‰å…¨é—®é¢˜ã€‚</p>
<p>ä½ èƒ½æƒ³ä¸€ä¸‹æˆ‘ä»¬å¦‚ä½•æ·»åŠ ä¸€ä¸ªæ£€æŸ¥æ­¥éª¤æ¥çœ‹çœ‹è°ƒç”¨è¿™ä¸ªå‡½æ•°çš„äººå°±æ˜¯ä»–ä»¬ä¼ å…¥çš„ _zombieId çš„æ‹¥æœ‰è€…ä¹ˆï¼Ÿ</p>
<p>æƒ³ä¸€æƒ³ï¼Œçœ‹çœ‹ä½ èƒ½ä¸èƒ½è‡ªå·±æ‰¾åˆ°ä¸€äº›ç­”æ¡ˆã€‚</p>
<p>èŠ±ç‚¹æ—¶é—´â€¦â€¦ å‚è€ƒæˆ‘ä»¬å‰é¢è¯¾ç¨‹çš„ä»£ç æ¥è·å¾—çµæ„Ÿã€‚</p>
<p><strong>ç­”æ¡ˆ</strong><br>æˆ‘ä»¬åœ¨å‰é¢çš„è¯¾ç¨‹é‡Œé¢å·²ç»åšè¿‡å¾ˆå¤šæ¬¡è¿™æ ·çš„æ£€æŸ¥äº†ã€‚ åœ¨ changeName(), changeDna(), å’Œ feedAndMultiply()é‡Œï¼Œæˆ‘ä»¬åšè¿‡è¿™æ ·çš„æ£€æŸ¥ï¼š</p>
<p>require(msg.sender &#x3D;&#x3D; zombieToOwner[_zombieId]);<br>è¿™å’Œæˆ‘ä»¬ attack å‡½æ•°å°†è¦ç”¨åˆ°çš„æ£€æŸ¥é€»è¾‘æ˜¯ç›¸åŒçš„ã€‚ æ­£å› æˆ‘ä»¬è¦å¤šæ¬¡è°ƒç”¨è¿™ä¸ªæ£€æŸ¥é€»è¾‘ï¼Œè®©æˆ‘ä»¬æŠŠå®ƒç§»åˆ°å®ƒè‡ªå·±çš„ modifier ä¸­æ¥æ¸…ç†ä»£ç å¹¶é¿å…é‡å¤ç¼–ç ã€‚</p>
<p>å®æˆ˜æ¼”ä¹ ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">// 1. åœ¨è¿™é‡Œåˆ›å»º modifier</span><br><span class="line">modifier ownerOf(uint _zombieId) &#123;</span><br><span class="line">    require(msg.sender == zombieToOwner[_zombieId]);</span><br><span class="line">    _;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">// 2. åœ¨å‡½æ•°å®šä¹‰æ—¶å¢åŠ  modifier :</span><br><span class="line">  function feedAndMultiply(uint _zombieId, uint _targetDna, string _species) internal ownerOf(_zombieId) &#123;</span><br><span class="line">    // 3. ç§»é™¤è¿™ä¸€è¡Œ</span><br><span class="line">    require(msg.sender == zombieToOwner[_zombieId]);</span><br></pre></td></tr></table></figure>
<h4 id="â‘¦æ›´å¤šé‡æ„"><a href="#â‘¦æ›´å¤šé‡æ„" class="headerlink" title="â‘¦æ›´å¤šé‡æ„"></a>â‘¦æ›´å¤šé‡æ„</h4><p>åœ¨ zombiehelper.solé‡Œæœ‰å‡ å¤„åœ°æ–¹ï¼Œéœ€è¦æˆ‘ä»¬å®ç°æˆ‘ä»¬æ–°çš„ modifierâ€”â€” ownerOfã€‚</p>
<p>å®æˆ˜æ¼”ä¹ ï¼š</p>
<ol>
<li><p>ä¿®æ”¹ changeName() ä½¿å…¶ä½¿ç”¨ ownerOf</p>
</li>
<li><p>ä¿®æ”¹ changeDna() ä½¿å…¶ä½¿ç”¨ ownerOf</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">åœ¨changeName()å‡½æ•°ä¸changeDna()å‡½æ•°çš„aboveLevelä¿®é¥°ç¬¦åé¢</span><br><span class="line">å†™ä¸ŠownerOf(_zombieId)</span><br><span class="line">å¹¶åˆ é™¤ä¸¤ä¸ªå‡½æ•°ä¸­çš„</span><br><span class="line">require(msg.sender == zombieToOwner[_zombieId]);</span><br><span class="line">è¿™ä¸€è¡Œä»£ç å³å¯</span><br></pre></td></tr></table></figure></li>
</ol>
<h4 id="â‘§å›åˆ°æ”»å‡»"><a href="#â‘§å›åˆ°æ”»å‡»" class="headerlink" title="â‘§å›åˆ°æ”»å‡»"></a>â‘§å›åˆ°æ”»å‡»</h4><p>é‡æ„å®Œæˆäº†ï¼Œå›åˆ° zombieattack.solã€‚</p>
<p>ç»§ç»­æ¥å®Œå–„æˆ‘ä»¬çš„ attack å‡½æ•°ï¼Œ ç°åœ¨æˆ‘ä»¬æœ‰äº† ownerOf ä¿®é¥°ç¬¦æ¥ç”¨äº†ã€‚</p>
<p>å®æˆ˜æ¼”ä¹ ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">function attack(uint _zombieId, uint _targetId) external ownerOf(_zombieId) &#123;</span><br><span class="line">    Zombie storage myZombie = zombies[_zombieId];</span><br><span class="line">    Zombie storage enemyZombie = zombies[_targetId];</span><br><span class="line">    uint rand = randMod(100);</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure>
<h4 id="â‘¨åƒµå°¸çš„è¾“èµ¢"><a href="#â‘¨åƒµå°¸çš„è¾“èµ¢" class="headerlink" title="â‘¨åƒµå°¸çš„è¾“èµ¢"></a>â‘¨åƒµå°¸çš„è¾“èµ¢</h4><p>å¯¹æˆ‘ä»¬çš„åƒµå°¸æ¸¸æˆæ¥è¯´ï¼Œæˆ‘ä»¬å°†è¦è¿½è¸ªæˆ‘ä»¬çš„åƒµå°¸è¾“èµ¢äº†å¤šå°‘åœºã€‚æœ‰äº†è¿™ä¸ªæˆ‘ä»¬å¯ä»¥åœ¨æ¸¸æˆé‡Œç»´æŠ¤ä¸€ä¸ª â€œåƒµå°¸æ’è¡Œæ¦œâ€ã€‚</p>
<p>æœ‰å¤šç§æ–¹æ³•åœ¨æˆ‘ä»¬çš„DAppé‡Œé¢ä¿å­˜ä¸€ä¸ªæ•°å€¼ â€” ä½œä¸ºä¸€ä¸ªå•ç‹¬çš„æ˜ å°„ï¼Œä½œä¸ºä¸€ä¸ªâ€œæ’è¡Œæ¦œâ€ç»“æ„ä½“ï¼Œæˆ–è€…ä¿å­˜åœ¨ Zombie ç»“æ„ä½“å†…ã€‚</p>
<p>æ¯ä¸ªæ–¹æ³•éƒ½æœ‰å…¶ä¼˜ç¼ºç‚¹ï¼Œå–å†³äºæˆ‘ä»¬æ‰“ç®—å¦‚ä½•å’Œè¿™äº›æ•°æ®æ‰“äº¤é“ã€‚åœ¨è¿™ä¸ªæ•™ç¨‹ä¸­ï¼Œç®€å•èµ·è§æˆ‘ä»¬å°†è¿™ä¸ªçŠ¶æ€ä¿å­˜åœ¨ Zombie ç»“æ„ä½“ä¸­ï¼Œå°†å…¶å‘½åä¸º winCount å’Œ lossCountã€‚</p>
<p>æˆ‘ä»¬è·³å› zombiefactory.sol, å°†è¿™äº›å±æ€§æ·»åŠ è¿› Zombie ç»“æ„ä½“.</p>
<p>å®æˆ˜æ¼”ä¹ ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">struct Zombie &#123;</span><br><span class="line">      string name;</span><br><span class="line">      uint dna;</span><br><span class="line">      uint32 level;</span><br><span class="line">      uint32 readyTime;</span><br><span class="line">      uint16 winCount;</span><br><span class="line">      uint16 lossCount;</span><br><span class="line">    &#125;</span><br><span class="line">// 2. åœ¨è¿™é‡Œä¿®æ”¹ä¿®æ”¹æ–°åƒµå°¸çš„åˆ›å»º:</span><br><span class="line">uint id = zombies.push(Zombie(_name, _dna, 1, uint32(now + cooldownTime), 0, 0)) - 1;</span><br></pre></td></tr></table></figure>
<h4 id="â‘©åƒµå°¸èƒœåˆ©äº†ğŸ˜„"><a href="#â‘©åƒµå°¸èƒœåˆ©äº†ğŸ˜„" class="headerlink" title="â‘©åƒµå°¸èƒœåˆ©äº†ğŸ˜„"></a>â‘©åƒµå°¸èƒœåˆ©äº†ğŸ˜„</h4><p>æœ‰äº† winCount å’Œ lossCountï¼Œæˆ‘ä»¬å¯ä»¥æ ¹æ®åƒµå°¸å“ªä¸ªåƒµå°¸èµ¢äº†æˆ˜æ–—æ¥æ›´æ–°å®ƒä»¬äº†ã€‚</p>
<p>åœ¨ç¬¬å…­ç« æˆ‘ä»¬è®¡ç®—å‡ºæ¥ä¸€ä¸ª0åˆ°100çš„éšæœºæ•°ã€‚ç°åœ¨è®©æˆ‘ä»¬ç”¨é‚£ä¸ªæ•°æ¥å†³å®šé‚£è°èµ¢äº†æˆ˜æ–—ï¼Œå¹¶ä»¥æ­¤æ›´æ–°æˆ‘ä»¬çš„çŠ¶æ€ã€‚</p>
<p>å®æˆ˜æ¼”ä¹ ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">if (rand &lt;= attackVictoryProbability) &#123;</span><br><span class="line">  myZombie.winCount++;</span><br><span class="line">  myZombie.level++;</span><br><span class="line">  enemyZombie.lossCount++;</span><br><span class="line">  feedAndMultiply(_zombieId, enemyZombie.dna, &quot;zombie&quot;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="â‘ªåƒµå°¸å¤±è´¥ğŸ˜"><a href="#â‘ªåƒµå°¸å¤±è´¥ğŸ˜" class="headerlink" title="â‘ªåƒµå°¸å¤±è´¥ğŸ˜"></a>â‘ªåƒµå°¸å¤±è´¥ğŸ˜</h4><p>æˆ‘ä»¬å·²ç»ç¼–å†™äº†ä½ çš„åƒµå°¸èµ¢äº†ä¹‹åä¼šå‘ç”Ÿä»€ä¹ˆï¼Œ è¯¥çœ‹çœ‹ è¾“äº† çš„æ—¶å€™è¦æ€ä¹ˆåšäº†ã€‚</p>
<p>åœ¨æˆ‘ä»¬çš„æ¸¸æˆä¸­ï¼Œåƒµå°¸è¾“äº†åå¹¶ä¸ä¼šé™çº§ â€”â€” åªæ˜¯ç®€å•åœ°ç»™ lossCount åŠ ä¸€ï¼Œå¹¶è§¦å‘å†·å´ï¼Œç­‰å¾…ä¸€å¤©åæ‰èƒ½å†æ¬¡å‚æˆ˜ã€‚</p>
<p>è¦å®ç°è¿™ä¸ªé€»è¾‘ï¼Œæˆ‘ä»¬éœ€è¦ä¸€ä¸ª else è¯­å¥ã€‚</p>
<p>else è¯­å¥å’Œ JavaScript ä»¥åŠå¾ˆå¤šå…¶ä»–è¯­è¨€çš„ else è¯­å¥ä¸€æ ·ã€‚</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">if (zombieCoins[msg.sender] &gt; 100000000) &#123;</span><br><span class="line">  // ä½ å¥½æœ‰é’±!!!</span><br><span class="line">&#125; else &#123;</span><br><span class="line">  // æˆ‘ä»¬éœ€è¦æ›´å¤šçš„åƒµå°¸å¸...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>å®æˆ˜æ¼”ä¹ ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">else&#123;</span><br><span class="line">  myZombie.lossCount++;</span><br><span class="line">  enemyZombie.winCount++;</span><br><span class="line">  _triggerCooldown(myZombie);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="â‘«æ”¾åœ¨ä¸€èµ·"><a href="#â‘«æ”¾åœ¨ä¸€èµ·" class="headerlink" title="â‘«æ”¾åœ¨ä¸€èµ·"></a>â‘«æ”¾åœ¨ä¸€èµ·</h4><p><strong>è®¤é¢†ä½ çš„æˆ˜åˆ©å“</strong><br>åœ¨èµ¢äº†æˆ˜æ–—ä¹‹åï¼š</p>
<ol>
<li><p>ä½ çš„åƒµå°¸å°†ä¼šå‡çº§</p>
</li>
<li><p>ä½ åƒµå°¸çš„ winCount å°†ä¼šå¢åŠ </p>
</li>
<li><p>ä½ å°†ä¸ºä½ çš„åƒµå°¸å¤§å†›è·å¾—ä¸€ä¸ªæ–°çš„åƒµå°¸</p>
</li>
</ol>
<h4 id="â‘¬Lesson-4-Completeï¼"><a href="#â‘¬Lesson-4-Completeï¼" class="headerlink" title="â‘¬Lesson 4 Completeï¼"></a>â‘¬Lesson 4 Completeï¼</h4><p>æˆªè‡³ç¬¬å››è¯¾å®Œæˆï¼Œæ‰€æœ‰ä»£ç å¦‚ä¸‹ï¼š<br><strong>zombieattack.sol:</strong></p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">pragma solidity ^0.4.19;</span><br><span class="line"></span><br><span class="line">import &quot;./zombiehelper.sol&quot;;</span><br><span class="line"></span><br><span class="line">contract ZombieBattle is ZombieHelper &#123;</span><br><span class="line">  uint randNonce = 0;</span><br><span class="line">  uint attackVictoryProbability = 70;</span><br><span class="line"></span><br><span class="line">  function randMod(uint _modulus) internal returns(uint) &#123;</span><br><span class="line">    randNonce++;</span><br><span class="line">    return uint(keccak256(now, msg.sender, randNonce)) % _modulus;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  function attack(uint _zombieId, uint _targetId) external ownerOf(_zombieId) &#123;</span><br><span class="line">    Zombie storage myZombie = zombies[_zombieId];</span><br><span class="line">    Zombie storage enemyZombie = zombies[_targetId];</span><br><span class="line">    uint rand = randMod(100);</span><br><span class="line">    if (rand &lt;= attackVictoryProbability) &#123;</span><br><span class="line">      myZombie.winCount++;</span><br><span class="line">      myZombie.level++;</span><br><span class="line">      enemyZombie.lossCount++;</span><br><span class="line">      feedAndMultiply(_zombieId, enemyZombie.dna, &quot;zombie&quot;);</span><br><span class="line">    &#125; else &#123;</span><br><span class="line">      myZombie.lossCount++;</span><br><span class="line">      enemyZombie.winCount++;</span><br><span class="line">      _triggerCooldown(myZombie);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><strong>zombiehelper.sol:</strong></p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">pragma solidity ^0.4.19;</span><br><span class="line"></span><br><span class="line">import &quot;./zombiefeeding.sol&quot;;</span><br><span class="line"></span><br><span class="line">contract ZombieHelper is ZombieFeeding &#123;</span><br><span class="line"></span><br><span class="line">  uint levelUpFee = 0.001 ether;</span><br><span class="line"></span><br><span class="line">  modifier aboveLevel(uint _level, uint _zombieId) &#123;</span><br><span class="line">    require(zombies[_zombieId].level &gt;= _level);</span><br><span class="line">    _;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  function withdraw() external onlyOwner &#123;</span><br><span class="line">    owner.transfer(this.balance);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  function setLevelUpFee(uint _fee) external onlyOwner &#123;</span><br><span class="line">    levelUpFee = _fee;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  function levelUp(uint _zombieId) external payable &#123;</span><br><span class="line">    require(msg.value == levelUpFee);</span><br><span class="line">    zombies[_zombieId].level++;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  function changeName(uint _zombieId, string _newName) external aboveLevel(2, _zombieId) ownerOf(_zombieId) &#123;</span><br><span class="line">    zombies[_zombieId].name = _newName;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  function changeDna(uint _zombieId, uint _newDna) external aboveLevel(20, _zombieId) ownerOf(_zombieId) &#123;</span><br><span class="line">    zombies[_zombieId].dna = _newDna;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  function getZombiesByOwner(address _owner) external view returns(uint[]) &#123;</span><br><span class="line">    uint[] memory result = new uint[](ownerZombieCount[_owner]);</span><br><span class="line">    uint counter = 0;</span><br><span class="line">    for (uint i = 0; i &lt; zombies.length; i++) &#123;</span><br><span class="line">      if (zombieToOwner[i] == _owner) &#123;</span><br><span class="line">        result[counter] = i;</span><br><span class="line">        counter++;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    return result;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><strong>zombiefeeding.sol:</strong></p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">pragma solidity ^0.4.19;</span><br><span class="line"></span><br><span class="line">import &quot;./zombiefactory.sol&quot;;</span><br><span class="line"></span><br><span class="line">contract KittyInterface &#123;</span><br><span class="line">  function getKitty(uint256 _id) external view returns (</span><br><span class="line">    bool isGestating,</span><br><span class="line">    bool isReady,</span><br><span class="line">    uint256 cooldownIndex,</span><br><span class="line">    uint256 nextActionAt,</span><br><span class="line">    uint256 siringWithId,</span><br><span class="line">    uint256 birthTime,</span><br><span class="line">    uint256 matronId,</span><br><span class="line">    uint256 sireId,</span><br><span class="line">    uint256 generation,</span><br><span class="line">    uint256 genes</span><br><span class="line">  );</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">contract ZombieFeeding is ZombieFactory &#123;</span><br><span class="line"></span><br><span class="line">  KittyInterface kittyContract;</span><br><span class="line"></span><br><span class="line">  modifier ownerOf(uint _zombieId) &#123;</span><br><span class="line">    require(msg.sender == zombieToOwner[_zombieId]);</span><br><span class="line">    _;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  function setKittyContractAddress(address _address) external onlyOwner &#123;</span><br><span class="line">    kittyContract = KittyInterface(_address);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  function _triggerCooldown(Zombie storage _zombie) internal &#123;</span><br><span class="line">    _zombie.readyTime = uint32(now + cooldownTime);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  function _isReady(Zombie storage _zombie) internal view returns (bool) &#123;</span><br><span class="line">      return (_zombie.readyTime &lt;= now);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  function feedAndMultiply(uint _zombieId, uint _targetDna, string _species) internal ownerOf(_zombieId) &#123;</span><br><span class="line">    Zombie storage myZombie = zombies[_zombieId];</span><br><span class="line">    require(_isReady(myZombie));</span><br><span class="line">    _targetDna = _targetDna % dnaModulus;</span><br><span class="line">    uint newDna = (myZombie.dna + _targetDna) / 2;</span><br><span class="line">    if (keccak256(_species) == keccak256(&quot;kitty&quot;)) &#123;</span><br><span class="line">      newDna = newDna - newDna % 100 + 99;</span><br><span class="line">    &#125;</span><br><span class="line">    _createZombie(&quot;NoName&quot;, newDna);</span><br><span class="line">    _triggerCooldown(myZombie);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  function feedOnKitty(uint _zombieId, uint _kittyId) public &#123;</span><br><span class="line">    uint kittyDna;</span><br><span class="line">    (,,,,,,,,,kittyDna) = kittyContract.getKitty(_kittyId);</span><br><span class="line">    feedAndMultiply(_zombieId, kittyDna, &quot;kitty&quot;);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><strong>zombiefactory.sol:</strong></p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">pragma solidity ^0.4.19;</span><br><span class="line"></span><br><span class="line">import &quot;./ownable.sol&quot;;</span><br><span class="line"></span><br><span class="line">contract ZombieFactory is Ownable &#123;</span><br><span class="line"></span><br><span class="line">    event NewZombie(uint zombieId, string name, uint dna);</span><br><span class="line"></span><br><span class="line">    uint dnaDigits = 16;</span><br><span class="line">    uint dnaModulus = 10 ** dnaDigits;</span><br><span class="line">    uint cooldownTime = 1 days;</span><br><span class="line"></span><br><span class="line">    struct Zombie &#123;</span><br><span class="line">      string name;</span><br><span class="line">      uint dna;</span><br><span class="line">      uint32 level;</span><br><span class="line">      uint32 readyTime;</span><br><span class="line">      uint16 winCount;</span><br><span class="line">      uint16 lossCount;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    Zombie[] public zombies;</span><br><span class="line"></span><br><span class="line">    mapping (uint =&gt; address) public zombieToOwner;</span><br><span class="line">    mapping (address =&gt; uint) ownerZombieCount;</span><br><span class="line"></span><br><span class="line">    function _createZombie(string _name, uint _dna) internal &#123;</span><br><span class="line">        uint id = zombies.push(Zombie(_name, _dna, 1, uint32(now + cooldownTime), 0, 0)) - 1;</span><br><span class="line">        zombieToOwner[id] = msg.sender;</span><br><span class="line">        ownerZombieCount[msg.sender]++;</span><br><span class="line">        NewZombie(id, _name, _dna);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    function _generateRandomDna(string _str) private view returns (uint) &#123;</span><br><span class="line">        uint rand = uint(keccak256(_str));</span><br><span class="line">        return rand % dnaModulus;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    function createRandomZombie(string _name) public &#123;</span><br><span class="line">        require(ownerZombieCount[msg.sender] == 0);</span><br><span class="line">        uint randDna = _generateRandomDna(_name);</span><br><span class="line">        randDna = randDna - randDna % 100;</span><br><span class="line">        _createZombie(_name, randDna);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><strong>ownable.sol:</strong></p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">pragma solidity ^0.4.19;</span><br><span class="line"></span><br><span class="line">/**</span><br><span class="line"> * @title Ownable</span><br><span class="line"> * @dev The Ownable contract has an owner address, and provides basic authorization control</span><br><span class="line"> * functions, this simplifies the implementation of &quot;user permissions&quot;.</span><br><span class="line"> */</span><br><span class="line">contract Ownable &#123;</span><br><span class="line">  address public owner;</span><br><span class="line"></span><br><span class="line">  event OwnershipTransferred(address indexed previousOwner, address indexed newOwner);</span><br><span class="line"></span><br><span class="line">  /**</span><br><span class="line">   * @dev The Ownable constructor sets the original `owner` of the contract to the sender</span><br><span class="line">   * account.</span><br><span class="line">   */</span><br><span class="line">  function Ownable() public &#123;</span><br><span class="line">    owner = msg.sender;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">  /**</span><br><span class="line">   * @dev Throws if called by any account other than the owner.</span><br><span class="line">   */</span><br><span class="line">  modifier onlyOwner() &#123;</span><br><span class="line">    require(msg.sender == owner);</span><br><span class="line">    _;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">  /**</span><br><span class="line">   * @dev Allows the current owner to transfer control of the contract to a newOwner.</span><br><span class="line">   * @param newOwner The address to transfer ownership to.</span><br><span class="line">   */</span><br><span class="line">  function transferOwnership(address newOwner) public onlyOwner &#123;</span><br><span class="line">    require(newOwner != address(0));</span><br><span class="line">    OwnershipTransferred(owner, newOwner);</span><br><span class="line">    owner = newOwner;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<hr>
<h3 id="å¿ƒå¾—"><a href="#å¿ƒå¾—" class="headerlink" title="å¿ƒå¾—"></a>å¿ƒå¾—</h3><h4 id="â‘ ç¬¬å››è¯¾-ç¬¬â‘©èŠ‚"><a href="#â‘ ç¬¬å››è¯¾-ç¬¬â‘©èŠ‚" class="headerlink" title="â‘ ç¬¬å››è¯¾ ç¬¬â‘©èŠ‚"></a>â‘ ç¬¬å››è¯¾ ç¬¬â‘©èŠ‚</h4><p>å®æˆ˜æ¼”ä¹ ä¸­ifè¯­å¥çš„æœ€åä¸€è¡Œ<br>feedAndMultiply(_zombieId, enemyZombie.dna, â€œzombieâ€);<br>ç¬¬äºŒä¸ªä¼ å…¥â€™feedAndMultiplyâ€™å‡½æ•°çš„å‚æ•°<br>ä¸ºä»€ä¹ˆæ˜¯enemyZombie.dna</p>

  </div>
</article>



        
          <div id="footer-post-container">
  <div id="footer-post">

    <div id="nav-footer" style="display: none">
      <ul>
        
          <li><a href="/">Home</a></li>
        
          <li><a href="/about/">About</a></li>
        
          <li><a href="/search/">Search</a></li>
        
          <li><a href="/archives/">Writing</a></li>
        
          <li><a target="_blank" rel="noopener" href="https://github.com/ForMikasaEver">Projects</a></li>
        
      </ul>
    </div>

    <div id="toc-footer" style="display: none">
      <ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#%E4%B8%89%E5%8F%B6%E8%8D%89%E5%AE%9E%E9%AA%8C%E5%AE%A4%E2%80%9C%E6%9C%9F%E6%9C%AB%E4%BB%BB%E5%8A%A1%E2%80%9D%E6%80%BB%E7%BB%93%EF%BC%88%E7%BB%AD%EF%BC%89-%E7%AC%AC%E5%9B%9B%E8%AF%BE"><span class="toc-number">1.</span> <span class="toc-text">ä¸‰å¶è‰å®éªŒå®¤â€œæœŸæœ«ä»»åŠ¡â€æ€»ç»“ï¼ˆç»­ï¼‰(ç¬¬å››è¯¾)</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BB%BB%E5%8A%A1%E4%B8%80%EF%BC%9A%E5%AE%8C%E6%88%90%E5%8A%A0%E5%AF%86%E5%83%B5%E5%B0%B8%E7%9A%84%E6%B8%B8%E6%88%8F"><span class="toc-number">1.1.</span> <span class="toc-text">ä»»åŠ¡ä¸€ï¼šå®ŒæˆåŠ å¯†åƒµå°¸çš„æ¸¸æˆ</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#4-%E5%83%B5%E5%B0%B8%E4%BD%9C%E6%88%98%E7%B3%BB%E7%BB%9F"><span class="toc-number">1.1.1.</span> <span class="toc-text">4.åƒµå°¸ä½œæˆ˜ç³»ç»Ÿ</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E2%91%A0%E5%8F%AF%E6%94%AF%E4%BB%98"><span class="toc-number">1.1.1.1.</span> <span class="toc-text">â‘ å¯æ”¯ä»˜</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E2%91%A1%E6%8F%90%E7%8E%B0"><span class="toc-number">1.1.1.2.</span> <span class="toc-text">â‘¡æç°</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E2%91%A2%E5%83%B5%E5%B0%B8%E6%88%98%E6%96%97"><span class="toc-number">1.1.1.3.</span> <span class="toc-text">â‘¢åƒµå°¸æˆ˜æ–—</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E2%91%A3%E9%9A%8F%E6%9C%BA%E6%95%B0"><span class="toc-number">1.1.1.4.</span> <span class="toc-text">â‘£éšæœºæ•°</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E2%91%A4%E5%83%B5%E5%B0%B8%E5%AF%B9%E5%86%B3"><span class="toc-number">1.1.1.5.</span> <span class="toc-text">â‘¤åƒµå°¸å¯¹å†³</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E2%91%A5%E9%87%8D%E6%9E%84%E9%80%9A%E7%94%A8%E9%80%BB%E8%BE%91"><span class="toc-number">1.1.1.6.</span> <span class="toc-text">â‘¥é‡æ„é€šç”¨é€»è¾‘</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E2%91%A6%E6%9B%B4%E5%A4%9A%E9%87%8D%E6%9E%84"><span class="toc-number">1.1.1.7.</span> <span class="toc-text">â‘¦æ›´å¤šé‡æ„</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E2%91%A7%E5%9B%9E%E5%88%B0%E6%94%BB%E5%87%BB"><span class="toc-number">1.1.1.8.</span> <span class="toc-text">â‘§å›åˆ°æ”»å‡»</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E2%91%A8%E5%83%B5%E5%B0%B8%E7%9A%84%E8%BE%93%E8%B5%A2"><span class="toc-number">1.1.1.9.</span> <span class="toc-text">â‘¨åƒµå°¸çš„è¾“èµ¢</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E2%91%A9%E5%83%B5%E5%B0%B8%E8%83%9C%E5%88%A9%E4%BA%86%F0%9F%98%84"><span class="toc-number">1.1.1.10.</span> <span class="toc-text">â‘©åƒµå°¸èƒœåˆ©äº†ğŸ˜„</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E2%91%AA%E5%83%B5%E5%B0%B8%E5%A4%B1%E8%B4%A5%F0%9F%98%9E"><span class="toc-number">1.1.1.11.</span> <span class="toc-text">â‘ªåƒµå°¸å¤±è´¥ğŸ˜</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E2%91%AB%E6%94%BE%E5%9C%A8%E4%B8%80%E8%B5%B7"><span class="toc-number">1.1.1.12.</span> <span class="toc-text">â‘«æ”¾åœ¨ä¸€èµ·</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E2%91%ACLesson-4-Complete%EF%BC%81"><span class="toc-number">1.1.1.13.</span> <span class="toc-text">â‘¬Lesson 4 Completeï¼</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%BF%83%E5%BE%97"><span class="toc-number">1.1.2.</span> <span class="toc-text">å¿ƒå¾—</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E2%91%A0%E7%AC%AC%E5%9B%9B%E8%AF%BE-%E7%AC%AC%E2%91%A9%E8%8A%82"><span class="toc-number">1.1.2.1.</span> <span class="toc-text">â‘ ç¬¬å››è¯¾ ç¬¬â‘©èŠ‚</span></a></li></ol></li></ol></li></ol></li></ol>
    </div>

    <div id="share-footer" style="display: none">
      <ul>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.facebook.com/sharer.php?u=https://formikasaever.github.io./post/8656b72d.html"><i class="fab fa-facebook fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://twitter.com/share?url=https://formikasaever.github.io./post/8656b72d.html&text=åƒµå°¸æ¸¸æˆç¬¬å››è¯¾"><i class="fab fa-twitter fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.linkedin.com/shareArticle?url=https://formikasaever.github.io./post/8656b72d.html&title=åƒµå°¸æ¸¸æˆç¬¬å››è¯¾"><i class="fab fa-linkedin fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://pinterest.com/pin/create/bookmarklet/?url=https://formikasaever.github.io./post/8656b72d.html&is_video=false&description=åƒµå°¸æ¸¸æˆç¬¬å››è¯¾"><i class="fab fa-pinterest fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="mailto:?subject=åƒµå°¸æ¸¸æˆç¬¬å››è¯¾&body=Check out this article: https://formikasaever.github.io./post/8656b72d.html"><i class="fa-solid fa-envelope fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://getpocket.com/save?url=https://formikasaever.github.io./post/8656b72d.html&title=åƒµå°¸æ¸¸æˆç¬¬å››è¯¾"><i class="fab fa-get-pocket fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://reddit.com/submit?url=https://formikasaever.github.io./post/8656b72d.html&title=åƒµå°¸æ¸¸æˆç¬¬å››è¯¾"><i class="fab fa-reddit fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.stumbleupon.com/submit?url=https://formikasaever.github.io./post/8656b72d.html&title=åƒµå°¸æ¸¸æˆç¬¬å››è¯¾"><i class="fab fa-stumbleupon fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://digg.com/submit?url=https://formikasaever.github.io./post/8656b72d.html&title=åƒµå°¸æ¸¸æˆç¬¬å››è¯¾"><i class="fab fa-digg fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.tumblr.com/share/link?url=https://formikasaever.github.io./post/8656b72d.html&name=åƒµå°¸æ¸¸æˆç¬¬å››è¯¾&description="><i class="fab fa-tumblr fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://news.ycombinator.com/submitlink?u=https://formikasaever.github.io./post/8656b72d.html&t=åƒµå°¸æ¸¸æˆç¬¬å››è¯¾"><i class="fab fa-hacker-news fa-lg" aria-hidden="true"></i></a></li>
</ul>

    </div>

    <div id="actions-footer">
        <a id="menu" class="icon" href="#" onclick="$('#nav-footer').toggle();return false;"><i class="fa-solid fa-bars fa-lg" aria-hidden="true"></i> Menu</a>
        <a id="toc" class="icon" href="#" onclick="$('#toc-footer').toggle();return false;"><i class="fa-solid fa-list fa-lg" aria-hidden="true"></i> TOC</a>
        <a id="share" class="icon" href="#" onclick="$('#share-footer').toggle();return false;"><i class="fa-solid fa-share-alt fa-lg" aria-hidden="true"></i> Share</a>
        <a id="top" style="display:none" class="icon" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');"><i class="fa-solid fa-chevron-up fa-lg" aria-hidden="true"></i> Top</a>
    </div>

  </div>
</div>

        
        <footer id="footer">
      <div class="footer-left">
        Copyright &copy;
        
        
        2023
        ForMikasaEver
      </div>
      <div class="footer-right">
        <nav>
          <ul>
            <!--
          --><li><a href="/">Home</a></li><!--
        --><!--
          --><li><a href="/about/">About</a></li><!--
        --><!--
          --><li><a href="/search/">Search</a></li><!--
        --><!--
          --><li><a href="/archives/">Writing</a></li><!--
        --><!--
          --><li><a target="_blank" rel="noopener" href="https://github.com/ForMikasaEver">Projects</a></li><!--
        -->
          </ul>
          <ul>
            
              <!-- ä¸è’œå­ç»Ÿè®¡ -->
              <span id="busuanzi_container_site_pv">
                  æœ¬ç«™æ€»è®¿é—®é‡<span id="busuanzi_value_site_pv"></span>æ¬¡
              </span>
              <span class="post-meta-divider">|</span>
              <span id="busuanzi_container_site_uv" style='display:none'>
                      æœ¬ç«™è®¿å®¢æ•°<span id="busuanzi_value_site_uv"></span>äºº
              </span>
            <script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
            
          </ul>
        </nav>
      </div>
      
</footer>


    </div>
    <!-- styles -->



  <link rel="preload" as="style" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" crossorigin="anonymous" onload="this.onload=null;this.rel='stylesheet'"/>


    <!-- jquery -->

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.0/jquery.min.js" crossorigin="anonymous"></script>




<!-- clipboard -->

  
    <script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.7/clipboard.min.js" crossorigin="anonymous"></script>
  
  <script type="text/javascript">
  $(function() {
    // copy-btn HTML
    var btn = "<span class=\"btn-copy tooltipped tooltipped-sw\" aria-label=\"Copy to clipboard!\">";
    btn += '<i class="fa-regular fa-clone"></i>';
    btn += '</span>';
    // mount it!
    $(".highlight table").before(btn);
    var clip = new ClipboardJS('.btn-copy', {
      text: function(trigger) {
        return Array.from(trigger.nextElementSibling.querySelectorAll('.code')).reduce((str,it)=>str+it.innerText+'\n','')
      }
    });
    clip.on('success', function(e) {
      e.trigger.setAttribute('aria-label', "Copied!");
      e.clearSelection();
    })
  })
  </script>


<script src="/js/main.js"></script>

<!-- search -->

<!-- Baidu Analytics -->

<!-- Cloudflare Analytics -->

<!-- Disqus Comments -->

<!-- utterances Comments -->


        <style>
            [bg-lazy] {
                background-image: none !important;
                background-color: #eee !important;
            }
        </style>
        <script>
            window.imageLazyLoadSetting = {
                isSPA: false,
                preloadRatio: 1,
                processImages: null,
            };
        </script><script>window.addEventListener("load",function(){var t=/\.(gif|jpg|jpeg|tiff|png)$/i,r=/^data:image\/[a-z]+;base64,/;Array.prototype.slice.call(document.querySelectorAll("img[data-original]")).forEach(function(a){var e=a.parentNode;"A"===e.tagName&&(e.href.match(t)||e.href.match(r))&&(e.href=a.dataset.original)})});</script><script>!function(r){r.imageLazyLoadSetting.processImages=t;var e=r.imageLazyLoadSetting.isSPA,n=r.imageLazyLoadSetting.preloadRatio||1,c=a();function a(){var t=Array.prototype.slice.call(document.querySelectorAll("img[data-original]")),e=Array.prototype.slice.call(document.querySelectorAll("[bg-lazy]"));return t.concat(e)}function t(){e&&(c=a());for(var t,o=0;o<c.length;o++)0<=(t=(t=c[o]).getBoundingClientRect()).bottom&&0<=t.left&&t.top<=(r.innerHeight*n||document.documentElement.clientHeight*n)&&function(){var t,e,n,a,i=c[o];e=function(){c=c.filter(function(t){return i!==t}),r.imageLazyLoadSetting.onImageLoaded&&r.imageLazyLoadSetting.onImageLoaded(i)},(t=i).hasAttribute("bg-lazy")?(t.removeAttribute("bg-lazy"),e&&e()):(n=new Image,a=t.getAttribute("data-original"),n.onload=function(){t.src=a,t.removeAttribute("data-original"),e&&e()},t.src!==a&&(n.src=a))}()}function i(){clearTimeout(t.tId),t.tId=setTimeout(t,500)}t(),document.addEventListener("scroll",i),r.addEventListener("resize",i),r.addEventListener("orientationchange",i)}(this);</script></body>
</html>

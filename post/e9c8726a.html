<!DOCTYPE html>
<html lang=en>
<head>
    <!-- so meta -->
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="HandheldFriendly" content="True">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=5" />
    <meta name="description" content="ä¸‰å¶è‰å®éªŒå®¤â€œæœŸæœ«ä»»åŠ¡â€æ€»ç»“ï¼ˆç»­ï¼‰(ç¬¬äº”è¯¾)ä»»åŠ¡ä¸€ï¼šå®ŒæˆåŠ å¯†åƒµå°¸çš„æ¸¸æˆ5.ERC721æ ‡å‡†å’ŒåŠ å¯†æ”¶è—å“â‘ ä»¥å¤ªåŠä¸Šçš„ä»£å¸è®©æˆ‘ä»¬æ¥èŠèŠ ä»£å¸. å¦‚æœä½ å¯¹ä»¥å¤ªåŠçš„ä¸–ç•Œæœ‰ä¸€äº›äº†è§£ï¼Œä½ å¾ˆå¯èƒ½å¬è¿‡äººä»¬èŠåˆ°ä»£å¸â€”â€”å°¤å…¶æ˜¯ ERC20 ä»£å¸. ä¸€ä¸ª ä»£å¸ åœ¨ä»¥å¤ªåŠåŸºæœ¬ä¸Šå°±æ˜¯ä¸€ä¸ªéµå¾ªä¸€äº›å…±åŒè§„åˆ™çš„æ™ºèƒ½åˆçº¦â€”â€”å³å®ƒå®ç°äº†æ‰€æœ‰å…¶ä»–ä»£å¸åˆçº¦å…±äº«çš„ä¸€ç»„æ ‡å‡†å‡½æ•°ï¼Œä¾‹å¦‚ transfer(address _to, uint25">
<meta property="og:type" content="article">
<meta property="og:title" content="åƒµå°¸æ¸¸æˆç¬¬äº”è¯¾">
<meta property="og:url" content="https://formikasaever.github.io./post/e9c8726a.html">
<meta property="og:site_name" content="ForMikasaEver&#39;s blog">
<meta property="og:description" content="ä¸‰å¶è‰å®éªŒå®¤â€œæœŸæœ«ä»»åŠ¡â€æ€»ç»“ï¼ˆç»­ï¼‰(ç¬¬äº”è¯¾)ä»»åŠ¡ä¸€ï¼šå®ŒæˆåŠ å¯†åƒµå°¸çš„æ¸¸æˆ5.ERC721æ ‡å‡†å’ŒåŠ å¯†æ”¶è—å“â‘ ä»¥å¤ªåŠä¸Šçš„ä»£å¸è®©æˆ‘ä»¬æ¥èŠèŠ ä»£å¸. å¦‚æœä½ å¯¹ä»¥å¤ªåŠçš„ä¸–ç•Œæœ‰ä¸€äº›äº†è§£ï¼Œä½ å¾ˆå¯èƒ½å¬è¿‡äººä»¬èŠåˆ°ä»£å¸â€”â€”å°¤å…¶æ˜¯ ERC20 ä»£å¸. ä¸€ä¸ª ä»£å¸ åœ¨ä»¥å¤ªåŠåŸºæœ¬ä¸Šå°±æ˜¯ä¸€ä¸ªéµå¾ªä¸€äº›å…±åŒè§„åˆ™çš„æ™ºèƒ½åˆçº¦â€”â€”å³å®ƒå®ç°äº†æ‰€æœ‰å…¶ä»–ä»£å¸åˆçº¦å…±äº«çš„ä¸€ç»„æ ‡å‡†å‡½æ•°ï¼Œä¾‹å¦‚ transfer(address _to, uint25">
<meta property="og:locale" content="en_US">
<meta property="article:published_time" content="2023-03-27T10:41:48.000Z">
<meta property="article:modified_time" content="2023-03-27T10:42:57.718Z">
<meta property="article:author" content="ForMikasaEver">
<meta name="twitter:card" content="summary">
    
    
      
        
          <link rel="shortcut icon" href="/images/favicon.ico">
        
      
      
        
          <link rel="icon" type="image/png" href="/images/favicon-192x192.png" sizes="192x192">
        
      
      
        
          <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon.png">
        
      
    
    <!-- title -->
    <title>åƒµå°¸æ¸¸æˆç¬¬äº”è¯¾</title>
    <!-- async scripts -->
    <!-- Google Analytics -->


    <!-- Umami Analytics -->


    <!-- styles -->
    
<link rel="stylesheet" href="/css/style.css">

    <!-- persian styles -->
    
    <!-- rss -->
    
    
	<!-- mathjax -->
	
<meta name="generator" content="Hexo 6.3.0"></head>

<body class="max-width mx-auto px3 ltr">
    
      <div id="header-post">
  <a id="menu-icon" href="#" aria-label="Menu"><i class="fa-solid fa-bars fa-lg"></i></a>
  <a id="menu-icon-tablet" href="#" aria-label="Menu"><i class="fa-solid fa-bars fa-lg"></i></a>
  <a id="top-icon-tablet" href="#" aria-label="Top" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');" style="display:none;"><i class="fa-solid fa-chevron-up fa-lg"></i></a>
  <span id="menu">
    <span id="nav">
      <ul>
        <!--
       --><li><a href="/">Home</a></li><!--
     --><!--
       --><li><a href="/about/">About</a></li><!--
     --><!--
       --><li><a href="/search/">Search</a></li><!--
     --><!--
       --><li><a href="/archives/">Writing</a></li><!--
     --><!--
       --><li><a target="_blank" rel="noopener" href="http://github.com/probberechts">Projects</a></li><!--
     -->
      </ul>
    </span>
    <br/>
    <span id="actions">
      <ul>
        
        <li><a class="icon" aria-label="Previous post" href="/post/8cc639b3.html"><i class="fa-solid fa-chevron-left" aria-hidden="true" onmouseover="$('#i-prev').toggle();" onmouseout="$('#i-prev').toggle();"></i></a></li>
        
        
        <li><a class="icon" aria-label="Next post" href="/post/8656b72d.html"><i class="fa-solid fa-chevron-right" aria-hidden="true" onmouseover="$('#i-next').toggle();" onmouseout="$('#i-next').toggle();"></i></a></li>
        
        <li><a class="icon" aria-label="Back to top" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');"><i class="fa-solid fa-chevron-up" aria-hidden="true" onmouseover="$('#i-top').toggle();" onmouseout="$('#i-top').toggle();"></i></a></li>
        <li><a class="icon" aria-label="Share post" href="#"><i class="fa-solid fa-share-alt" aria-hidden="true" onmouseover="$('#i-share').toggle();" onmouseout="$('#i-share').toggle();" onclick="$('#share').toggle();return false;"></i></a></li>
      </ul>
      <span id="i-prev" class="info" style="display:none;">Previous post</span>
      <span id="i-next" class="info" style="display:none;">Next post</span>
      <span id="i-top" class="info" style="display:none;">Back to top</span>
      <span id="i-share" class="info" style="display:none;">Share post</span>
    </span>
    <br/>
    <div id="share" style="display: none">
      <ul>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.facebook.com/sharer.php?u=https://formikasaever.github.io./post/e9c8726a.html"><i class="fab fa-facebook " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://twitter.com/share?url=https://formikasaever.github.io./post/e9c8726a.html&text=åƒµå°¸æ¸¸æˆç¬¬äº”è¯¾"><i class="fab fa-twitter " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.linkedin.com/shareArticle?url=https://formikasaever.github.io./post/e9c8726a.html&title=åƒµå°¸æ¸¸æˆç¬¬äº”è¯¾"><i class="fab fa-linkedin " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://pinterest.com/pin/create/bookmarklet/?url=https://formikasaever.github.io./post/e9c8726a.html&is_video=false&description=åƒµå°¸æ¸¸æˆç¬¬äº”è¯¾"><i class="fab fa-pinterest " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="mailto:?subject=åƒµå°¸æ¸¸æˆç¬¬äº”è¯¾&body=Check out this article: https://formikasaever.github.io./post/e9c8726a.html"><i class="fa-solid fa-envelope " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://getpocket.com/save?url=https://formikasaever.github.io./post/e9c8726a.html&title=åƒµå°¸æ¸¸æˆç¬¬äº”è¯¾"><i class="fab fa-get-pocket " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://reddit.com/submit?url=https://formikasaever.github.io./post/e9c8726a.html&title=åƒµå°¸æ¸¸æˆç¬¬äº”è¯¾"><i class="fab fa-reddit " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.stumbleupon.com/submit?url=https://formikasaever.github.io./post/e9c8726a.html&title=åƒµå°¸æ¸¸æˆç¬¬äº”è¯¾"><i class="fab fa-stumbleupon " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://digg.com/submit?url=https://formikasaever.github.io./post/e9c8726a.html&title=åƒµå°¸æ¸¸æˆç¬¬äº”è¯¾"><i class="fab fa-digg " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.tumblr.com/share/link?url=https://formikasaever.github.io./post/e9c8726a.html&name=åƒµå°¸æ¸¸æˆç¬¬äº”è¯¾&description="><i class="fab fa-tumblr " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://news.ycombinator.com/submitlink?u=https://formikasaever.github.io./post/e9c8726a.html&t=åƒµå°¸æ¸¸æˆç¬¬äº”è¯¾"><i class="fab fa-hacker-news " aria-hidden="true"></i></a></li>
</ul>

    </div>
    <div id="toc">
      <ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#%E4%B8%89%E5%8F%B6%E8%8D%89%E5%AE%9E%E9%AA%8C%E5%AE%A4%E2%80%9C%E6%9C%9F%E6%9C%AB%E4%BB%BB%E5%8A%A1%E2%80%9D%E6%80%BB%E7%BB%93%EF%BC%88%E7%BB%AD%EF%BC%89-%E7%AC%AC%E4%BA%94%E8%AF%BE"><span class="toc-number">1.</span> <span class="toc-text">ä¸‰å¶è‰å®éªŒå®¤â€œæœŸæœ«ä»»åŠ¡â€æ€»ç»“ï¼ˆç»­ï¼‰(ç¬¬äº”è¯¾)</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BB%BB%E5%8A%A1%E4%B8%80%EF%BC%9A%E5%AE%8C%E6%88%90%E5%8A%A0%E5%AF%86%E5%83%B5%E5%B0%B8%E7%9A%84%E6%B8%B8%E6%88%8F"><span class="toc-number">1.1.</span> <span class="toc-text">ä»»åŠ¡ä¸€ï¼šå®ŒæˆåŠ å¯†åƒµå°¸çš„æ¸¸æˆ</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#5-ERC721%E6%A0%87%E5%87%86%E5%92%8C%E5%8A%A0%E5%AF%86%E6%94%B6%E8%97%8F%E5%93%81"><span class="toc-number">1.1.1.</span> <span class="toc-text">5.ERC721æ ‡å‡†å’ŒåŠ å¯†æ”¶è—å“</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E2%91%A0%E4%BB%A5%E5%A4%AA%E5%9D%8A%E4%B8%8A%E7%9A%84%E4%BB%A3%E5%B8%81"><span class="toc-number">1.1.1.1.</span> <span class="toc-text">â‘ ä»¥å¤ªåŠä¸Šçš„ä»£å¸</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E2%91%A1ERC721-%E6%A0%87%E5%87%86-%E5%A4%9A%E9%87%8D%E7%BB%A7%E6%89%BF"><span class="toc-number">1.1.1.2.</span> <span class="toc-text">â‘¡ERC721 æ ‡å‡†, å¤šé‡ç»§æ‰¿</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E2%91%A2balanceOf-%E5%92%8C-ownerOf"><span class="toc-number">1.1.1.3.</span> <span class="toc-text">â‘¢balanceOf å’Œ ownerOf</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E2%91%A3%E9%87%8D%E6%9E%84"><span class="toc-number">1.1.1.4.</span> <span class="toc-text">â‘£é‡æ„</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E2%91%A4ERC721-%E8%BD%AC%E7%A7%BB%E6%A0%87%E5%87%86"><span class="toc-number">1.1.1.5.</span> <span class="toc-text">â‘¤ERC721: è½¬ç§»æ ‡å‡†</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E2%91%A5ERC721-%E8%BD%AC%E7%A7%BB-%E7%BB%AD"><span class="toc-number">1.1.1.6.</span> <span class="toc-text">â‘¥ERC721: è½¬ç§»-ç»­</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E2%91%A6ERC721-%E6%89%B9%E5%87%86"><span class="toc-number">1.1.1.7.</span> <span class="toc-text">â‘¦ERC721: æ‰¹å‡†</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E2%91%A7ERC721-takeOwnership"><span class="toc-number">1.1.1.8.</span> <span class="toc-text">â‘§ERC721: takeOwnership</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E2%91%A8%E9%A2%84%E9%98%B2%E6%BA%A2%E5%87%BA"><span class="toc-number">1.1.1.9.</span> <span class="toc-text">â‘¨é¢„é˜²æº¢å‡º</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E2%91%A9SafeMath%E7%AC%AC%E4%BA%8C%E9%83%A8%E5%88%86"><span class="toc-number">1.1.1.10.</span> <span class="toc-text">â‘©SafeMathç¬¬äºŒéƒ¨åˆ†</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E2%91%AASafeMath-%E7%AC%AC%E4%B8%89%E9%83%A8%E5%88%86"><span class="toc-number">1.1.1.11.</span> <span class="toc-text">â‘ªSafeMath ç¬¬ä¸‰éƒ¨åˆ†</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E2%91%ABSafeMath-%E7%AC%AC4%E9%83%A8%E5%88%86"><span class="toc-number">1.1.1.12.</span> <span class="toc-text">â‘«SafeMath ç¬¬4éƒ¨åˆ†</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E2%91%AC%E6%B3%A8%E9%87%8A"><span class="toc-number">1.1.1.13.</span> <span class="toc-text">â‘¬æ³¨é‡Š</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E2%91%AD%E6%94%BE%E5%9C%A8%E4%B8%80%E8%B5%B7"><span class="toc-number">1.1.1.14.</span> <span class="toc-text">â‘­æ”¾åœ¨ä¸€èµ·</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E2%91%AE%E7%AC%AC%E4%BA%94%E8%AF%BE%E5%AE%8C%E6%88%90"><span class="toc-number">1.1.1.15.</span> <span class="toc-text">â‘®ç¬¬äº”è¯¾å®Œæˆ</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%BF%83%E5%BE%97"><span class="toc-number">1.1.2.</span> <span class="toc-text">å¿ƒå¾—</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E2%91%A0"><span class="toc-number">1.1.2.1.</span> <span class="toc-text">â‘ </span></a></li></ol></li></ol></li></ol></li></ol>
    </div>
  </span>
</div>

    
    <div class="content index py4 ">
        
        <article class="post h-entry" itemscope itemtype="http://schema.org/BlogPosting">
  <header>
    
    <h1 class="posttitle p-name" itemprop="name headline">
        åƒµå°¸æ¸¸æˆç¬¬äº”è¯¾
    </h1>



    <div class="meta">
      <span class="author p-author h-card" itemprop="author" itemscope itemtype="http://schema.org/Person">
        <span class="p-name" itemprop="name">ForMikasaEver</span>
      </span>
      
    <div class="postdate">
      
        <time datetime="2023-03-27T10:41:48.000Z" class="dt-published" itemprop="datePublished">2023-03-27</time>
        
      
    </div>


      

      

    </div>
  </header>
  

  <div class="content e-content" itemprop="articleBody">
    <h1 id="ä¸‰å¶è‰å®éªŒå®¤â€œæœŸæœ«ä»»åŠ¡â€æ€»ç»“ï¼ˆç»­ï¼‰-ç¬¬äº”è¯¾"><a href="#ä¸‰å¶è‰å®éªŒå®¤â€œæœŸæœ«ä»»åŠ¡â€æ€»ç»“ï¼ˆç»­ï¼‰-ç¬¬äº”è¯¾" class="headerlink" title="ä¸‰å¶è‰å®éªŒå®¤â€œæœŸæœ«ä»»åŠ¡â€æ€»ç»“ï¼ˆç»­ï¼‰(ç¬¬äº”è¯¾)"></a>ä¸‰å¶è‰å®éªŒå®¤â€œæœŸæœ«ä»»åŠ¡â€æ€»ç»“ï¼ˆç»­ï¼‰(ç¬¬äº”è¯¾)</h1><h2 id="ä»»åŠ¡ä¸€ï¼šå®ŒæˆåŠ å¯†åƒµå°¸çš„æ¸¸æˆ"><a href="#ä»»åŠ¡ä¸€ï¼šå®ŒæˆåŠ å¯†åƒµå°¸çš„æ¸¸æˆ" class="headerlink" title="ä»»åŠ¡ä¸€ï¼šå®ŒæˆåŠ å¯†åƒµå°¸çš„æ¸¸æˆ"></a>ä»»åŠ¡ä¸€ï¼šå®ŒæˆåŠ å¯†åƒµå°¸çš„æ¸¸æˆ</h2><h3 id="5-ERC721æ ‡å‡†å’ŒåŠ å¯†æ”¶è—å“"><a href="#5-ERC721æ ‡å‡†å’ŒåŠ å¯†æ”¶è—å“" class="headerlink" title="5.ERC721æ ‡å‡†å’ŒåŠ å¯†æ”¶è—å“"></a>5.ERC721æ ‡å‡†å’ŒåŠ å¯†æ”¶è—å“</h3><h4 id="â‘ ä»¥å¤ªåŠä¸Šçš„ä»£å¸"><a href="#â‘ ä»¥å¤ªåŠä¸Šçš„ä»£å¸" class="headerlink" title="â‘ ä»¥å¤ªåŠä¸Šçš„ä»£å¸"></a>â‘ ä»¥å¤ªåŠä¸Šçš„ä»£å¸</h4><p>è®©æˆ‘ä»¬æ¥èŠèŠ <em>ä»£å¸</em>.</p>
<p>å¦‚æœä½ å¯¹ä»¥å¤ªåŠçš„ä¸–ç•Œæœ‰ä¸€äº›äº†è§£ï¼Œä½ å¾ˆå¯èƒ½å¬è¿‡äººä»¬èŠåˆ°ä»£å¸â€”â€”å°¤å…¶æ˜¯ ERC20 ä»£å¸.</p>
<p>ä¸€ä¸ª <em>ä»£å¸</em> åœ¨ä»¥å¤ªåŠåŸºæœ¬ä¸Šå°±æ˜¯ä¸€ä¸ªéµå¾ªä¸€äº›å…±åŒè§„åˆ™çš„æ™ºèƒ½åˆçº¦â€”â€”å³å®ƒå®ç°äº†æ‰€æœ‰å…¶ä»–ä»£å¸åˆçº¦å…±äº«çš„ä¸€ç»„æ ‡å‡†å‡½æ•°ï¼Œä¾‹å¦‚ <code>transfer(address _to, uint256 _value)</code> å’Œ <code>balanceOf(address _owner)</code>.</p>
<p>åœ¨æ™ºèƒ½åˆçº¦å†…éƒ¨ï¼Œé€šå¸¸æœ‰ä¸€ä¸ªæ˜ å°„ï¼Œ<code>mapping(address =&gt; uint256) balances</code>ï¼Œç”¨äºè¿½è¸ªæ¯ä¸ªåœ°å€è¿˜æœ‰å¤šå°‘ä½™é¢ã€‚</p>
<p>æ‰€ä»¥åŸºæœ¬ä¸Šä¸€ä¸ªä»£å¸åªæ˜¯ä¸€ä¸ªè¿½è¸ªè°æ‹¥æœ‰å¤šå°‘è¯¥ä»£å¸çš„åˆçº¦ï¼Œå’Œä¸€äº›å¯ä»¥è®©é‚£äº›ç”¨æˆ·å°†ä»–ä»¬çš„ä»£å¸è½¬ç§»åˆ°å…¶ä»–åœ°å€çš„å‡½æ•°ã€‚</p>
<p><strong>å®ƒä¸ºä»€ä¹ˆé‡è¦å‘¢ï¼Ÿ</strong><br>ç”±äºæ‰€æœ‰ ERC20 ä»£å¸å…±äº«å…·æœ‰ç›¸åŒåç§°çš„åŒä¸€ç»„å‡½æ•°ï¼Œå®ƒä»¬éƒ½å¯ä»¥ä»¥ç›¸åŒçš„æ–¹å¼è¿›è¡Œäº¤äº’ã€‚</p>
<p>è¿™æ„å‘³ç€å¦‚æœä½ æ„å»ºçš„åº”ç”¨ç¨‹åºèƒ½å¤Ÿä¸ä¸€ä¸ª ERC20 ä»£å¸è¿›è¡Œäº¤äº’ï¼Œé‚£ä¹ˆå®ƒå°±ä¹Ÿèƒ½å¤Ÿä¸ä»»ä½• ERC20 ä»£å¸è¿›è¡Œäº¤äº’ã€‚ è¿™æ ·ä¸€æ¥ï¼Œå°†æ¥ä½ å°±å¯ä»¥è½»æ¾åœ°å°†æ›´å¤šçš„ä»£å¸æ·»åŠ åˆ°ä½ çš„åº”ç”¨ä¸­ï¼Œè€Œæ— éœ€è¿›è¡Œè‡ªå®šä¹‰ç¼–ç ã€‚ ä½ å¯ä»¥ç®€å•åœ°æ’å…¥æ–°çš„ä»£å¸åˆçº¦åœ°å€ï¼Œç„¶åå“—å•¦ï¼Œä½ çš„åº”ç”¨ç¨‹åºæœ‰å¦ä¸€ä¸ªå®ƒå¯ä»¥ä½¿ç”¨çš„ä»£å¸äº†ã€‚</p>
<p>å…¶ä¸­ä¸€ä¸ªä¾‹å­å°±æ˜¯äº¤æ˜“æ‰€ã€‚ å½“äº¤æ˜“æ‰€æ·»åŠ ä¸€ä¸ªæ–°çš„ ERC20 ä»£å¸æ—¶ï¼Œå®é™…ä¸Šå®ƒåªéœ€è¦æ·»åŠ ä¸ä¹‹å¯¹è¯çš„å¦ä¸€ä¸ªæ™ºèƒ½åˆçº¦ã€‚ ç”¨æˆ·å¯ä»¥è®©é‚£ä¸ªåˆçº¦å°†ä»£å¸å‘é€åˆ°äº¤æ˜“æ‰€çš„é’±åŒ…åœ°å€ï¼Œç„¶åäº¤æ˜“æ‰€å¯ä»¥è®©åˆçº¦åœ¨ç”¨æˆ·è¦æ±‚å–æ¬¾æ—¶å°†ä»£å¸å‘é€å›ç»™ä»–ä»¬ã€‚</p>
<p>äº¤æ˜“æ‰€åªéœ€è¦å®ç°è¿™ç§è½¬ç§»é€»è¾‘ä¸€æ¬¡ï¼Œç„¶åå½“å®ƒæƒ³è¦æ·»åŠ ä¸€ä¸ªæ–°çš„ ERC20 ä»£å¸æ—¶ï¼Œåªéœ€å°†æ–°çš„åˆçº¦åœ°å€æ·»åŠ åˆ°å®ƒçš„æ•°æ®åº“å³å¯ã€‚</p>
<p><strong>å…¶ä»–ä»£å¸æ ‡å‡†</strong><br>å¯¹äºåƒè´§å¸ä¸€æ ·çš„ä»£å¸æ¥è¯´ï¼ŒERC20 ä»£å¸éå¸¸é…·ã€‚ ä½†æ˜¯è¦åœ¨æˆ‘ä»¬åƒµå°¸æ¸¸æˆä¸­ä»£è¡¨åƒµå°¸å°±å¹¶ä¸æ˜¯ç‰¹åˆ«æœ‰ç”¨ã€‚</p>
<p>é¦–å…ˆï¼Œåƒµå°¸ä¸åƒè´§å¸å¯ä»¥åˆ†å‰² â€”â€” æˆ‘å¯ä»¥å‘ç»™ä½  0.237 ä»¥å¤ªï¼Œä½†æ˜¯è½¬ç§»ç»™ä½  0.237 çš„åƒµå°¸å¬èµ·æ¥å°±æœ‰äº›æç¬‘ã€‚</p>
<p>å…¶æ¬¡ï¼Œå¹¶ä¸æ˜¯æ‰€æœ‰åƒµå°¸éƒ½æ˜¯å¹³ç­‰çš„ã€‚ ä½ çš„2çº§åƒµå°¸â€Steveâ€å®Œå…¨ä¸èƒ½ç­‰åŒäºæˆ‘732çº§çš„åƒµå°¸â€H4XF13LD MORRIS ğŸ’¯ğŸ’¯ğŸ˜ğŸ’¯ğŸ’¯â€ã€‚ï¼ˆä½ å·®å¾—è¿œå‘¢ï¼ŒSteveï¼‰ã€‚</p>
<p>æœ‰å¦ä¸€ä¸ªä»£å¸æ ‡å‡†æ›´é€‚åˆå¦‚ CryptoZombies è¿™æ ·çš„åŠ å¯†æ”¶è—å“â€”â€”å®ƒä»¬è¢«ç§°ä¸ºERC721 ä»£å¸.</p>
<p>ERC721 ä»£å¸æ˜¯ä¸èƒ½äº’æ¢çš„ï¼Œå› ä¸ºæ¯ä¸ªä»£å¸éƒ½è¢«è®¤ä¸ºæ˜¯å”¯ä¸€ä¸”ä¸å¯åˆ†å‰²çš„ã€‚ ä½ åªèƒ½ä»¥æ•´ä¸ªå•ä½äº¤æ˜“å®ƒä»¬ï¼Œå¹¶ä¸”æ¯ä¸ªå•ä½éƒ½æœ‰å”¯ä¸€çš„ IDã€‚ è¿™äº›ç‰¹æ€§æ­£å¥½è®©æˆ‘ä»¬çš„åƒµå°¸å¯ä»¥ç”¨æ¥äº¤æ˜“ã€‚</p>
<blockquote>
<p>è¯·æ³¨æ„ï¼Œä½¿ç”¨åƒ ERC721 è¿™æ ·çš„æ ‡å‡†çš„ä¼˜åŠ¿å°±æ˜¯ï¼Œæˆ‘ä»¬ä¸å¿…åœ¨æˆ‘ä»¬çš„åˆçº¦ä¸­å®ç°æ‹å–æˆ–æ‰˜ç®¡é€»è¾‘ï¼Œè¿™å†³å®šäº†ç©å®¶èƒ½å¤Ÿå¦‚ä½•äº¤æ˜“ï¼å‡ºå”®æˆ‘ä»¬çš„åƒµå°¸ã€‚ å¦‚æœæˆ‘ä»¬ç¬¦åˆè§„èŒƒï¼Œå…¶ä»–äººå¯ä»¥ä¸ºåŠ å¯†å¯äº¤æ˜“çš„ ERC721 èµ„äº§æ­å»ºä¸€ä¸ªäº¤æ˜“æ‰€å¹³å°ï¼Œæˆ‘ä»¬çš„ ERC721 åƒµå°¸å°†å¯ä»¥åœ¨è¯¥å¹³å°ä¸Šä½¿ç”¨ã€‚ æ‰€ä»¥ä½¿ç”¨ä»£å¸æ ‡å‡†ç›¸è¾ƒäºä½¿ç”¨ä½ è‡ªå·±çš„äº¤æ˜“é€»è¾‘æœ‰æ˜æ˜¾çš„å¥½å¤„ã€‚</p>
</blockquote>
<p>å®æˆ˜æ¼”ä¹ :<br>zombieownership.sol:</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">pragma solidity ^0.4.19;</span><br><span class="line"></span><br><span class="line">import &quot;./zombieattack.sol&quot;;</span><br><span class="line"></span><br><span class="line">contract ZombieOwnership is ZombieAttack &#123;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="â‘¡ERC721-æ ‡å‡†-å¤šé‡ç»§æ‰¿"><a href="#â‘¡ERC721-æ ‡å‡†-å¤šé‡ç»§æ‰¿" class="headerlink" title="â‘¡ERC721 æ ‡å‡†, å¤šé‡ç»§æ‰¿"></a>â‘¡ERC721 æ ‡å‡†, å¤šé‡ç»§æ‰¿</h4><p>è®©æˆ‘ä»¬æ¥çœ‹ä¸€çœ‹ ERC721 æ ‡å‡†ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">contract ERC721 &#123;</span><br><span class="line">  event Transfer(address indexed _from, address indexed _to, uint256 _tokenId);</span><br><span class="line">  event Approval(address indexed _owner, address indexed _approved, uint256 _tokenId);</span><br><span class="line"></span><br><span class="line">  function balanceOf(address _owner) public view returns (uint256 _balance);</span><br><span class="line">  function ownerOf(uint256 _tokenId) public view returns (address _owner);</span><br><span class="line">  function transfer(address _to, uint256 _tokenId) public;</span><br><span class="line">  function approve(address _to, uint256 _tokenId) public;</span><br><span class="line">  function takeOwnership(uint256 _tokenId) public;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>è¿™æ˜¯æˆ‘ä»¬éœ€è¦å®ç°çš„æ–¹æ³•åˆ—è¡¨ï¼Œæˆ‘ä»¬å°†åœ¨æ¥ä¸‹æ¥çš„ç« èŠ‚ä¸­é€ä¸ªå­¦ä¹ ã€‚</p>
<p>è™½ç„¶çœ‹èµ·æ¥å¾ˆå¤šï¼Œä½†ä¸è¦è¢«å“åˆ°äº†ï¼æˆ‘ä»¬åœ¨è¿™é‡Œå°±æ˜¯å‡†å¤‡å¸¦ç€ä½ ä¸€æ­¥ä¸€æ­¥äº†è§£å®ƒä»¬çš„ã€‚</p>
<blockquote>
<p>æ³¨æ„ï¼š ERC721ç›®å‰æ˜¯ä¸€ä¸ª è‰ç¨¿ï¼Œè¿˜æ²¡æœ‰æ­£å¼å•†å®šçš„å®ç°ã€‚åœ¨æœ¬æ•™ç¨‹ä¸­ï¼Œæˆ‘ä»¬ä½¿ç”¨çš„æ˜¯ OpenZeppelin åº“ä¸­çš„å½“å‰ç‰ˆæœ¬ï¼Œä½†åœ¨æœªæ¥æ­£å¼å‘å¸ƒä¹‹å‰å®ƒå¯èƒ½ä¼šæœ‰æ›´æ”¹ã€‚ æ‰€ä»¥æŠŠè¿™ ä¸€ä¸ª å¯èƒ½çš„å®ç°å½“ä½œè€ƒè™‘ï¼Œä½†ä¸è¦æŠŠå®ƒä½œä¸º ERC721 ä»£å¸çš„å®˜æ–¹æ ‡å‡†ã€‚</p>
</blockquote>
<p><strong>å®ç°ä¸€ä¸ªä»£å¸åˆçº¦</strong><br>åœ¨å®ç°ä¸€ä¸ªä»£å¸åˆçº¦çš„æ—¶å€™ï¼Œæˆ‘ä»¬é¦–å…ˆè¦åšçš„æ˜¯å°†æ¥å£å¤åˆ¶åˆ°å®ƒè‡ªå·±çš„ Solidity æ–‡ä»¶å¹¶å¯¼å…¥å®ƒï¼Œ<code>import &quot;./erc721.sol&quot;;</code>ã€‚ æ¥ç€ï¼Œè®©æˆ‘ä»¬çš„åˆçº¦ç»§æ‰¿å®ƒï¼Œç„¶åæˆ‘ä»¬ç”¨ä¸€ä¸ªå‡½æ•°å®šä¹‰æ¥é‡å†™æ¯ä¸ªæ–¹æ³•ã€‚</p>
<p>ä½†ç­‰ä¸€ä¸‹â€”â€” <code>ZombieOwnership</code>å·²ç»ç»§æ‰¿è‡ª <code>ZombieAttack</code>äº† â€”â€” å®ƒå¦‚ä½•èƒ½å¤Ÿä¹Ÿç»§æ‰¿äº <code>ERC721</code>å‘¢ï¼Ÿ</p>
<p>å¹¸è¿çš„æ˜¯åœ¨Solidityï¼Œä½ çš„åˆçº¦å¯ä»¥ç»§æ‰¿è‡ªå¤šä¸ªåˆçº¦ï¼Œå‚è€ƒå¦‚ä¸‹ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">contract SatoshiNakamoto is NickSzabo, HalFinney &#123;</span><br><span class="line">  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>æ­£å¦‚ä½ æ‰€è§ï¼Œå½“ä½¿ç”¨å¤šé‡ç»§æ‰¿çš„æ—¶å€™ï¼Œä½ åªéœ€è¦ç”¨é€—å· , æ¥éš”å¼€å‡ ä¸ªä½ æƒ³è¦ç»§æ‰¿çš„åˆçº¦ã€‚åœ¨ä¸Šé¢çš„ä¾‹å­ä¸­ï¼Œæˆ‘ä»¬çš„åˆçº¦ç»§æ‰¿è‡ª <code>NickSzabo</code> å’Œ <code>HalFinney</code>ã€‚</p>
<p>å®æˆ˜æ¼”ä¹ ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">pragma solidity ^0.4.19;</span><br><span class="line"></span><br><span class="line">import &quot;./zombieattack.sol&quot;;</span><br><span class="line">import &quot;./erc721.sol&quot;;</span><br><span class="line"></span><br><span class="line">contract ZombieOwnership is ZombieAttack, ERC721 &#123;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="â‘¢balanceOf-å’Œ-ownerOf"><a href="#â‘¢balanceOf-å’Œ-ownerOf" class="headerlink" title="â‘¢balanceOf å’Œ ownerOf"></a>â‘¢balanceOf å’Œ ownerOf</h4><p>åœ¨æœ¬ç« èŠ‚ï¼Œæˆ‘ä»¬å°†å®ç°å¤´ä¸¤ä¸ªæ–¹æ³•ï¼š balanceOf å’Œ ownerOfã€‚</p>
<p><strong>balanceOf</strong><br><code>function balanceOf(address _owner) public view returns (uint256 _balance);</code><br>è¿™ä¸ªå‡½æ•°åªéœ€è¦ä¸€ä¸ªä¼ å…¥ address å‚æ•°ï¼Œç„¶åè¿”å›è¿™ä¸ª address æ‹¥æœ‰å¤šå°‘ä»£å¸ã€‚</p>
<p>åœ¨æˆ‘ä»¬çš„ä¾‹å­ä¸­ï¼Œæˆ‘ä»¬çš„â€œä»£å¸â€æ˜¯åƒµå°¸ã€‚ä½ è¿˜è®°å¾—åœ¨æˆ‘ä»¬ DApp çš„å“ªé‡Œå­˜å‚¨äº†ä¸€ä¸ªä¸»äººæ‹¥æœ‰å¤šå°‘åªåƒµå°¸å—ï¼Ÿ</p>
<p><strong>ownerOf</strong></p>
<p><code>function ownerOf(uint256 _tokenId) public view returns (address _owner);</code><br>è¿™ä¸ªå‡½æ•°éœ€è¦ä¼ å…¥ä¸€ä¸ªä»£å¸ ID ä½œä¸ºå‚æ•° (æˆ‘ä»¬çš„æƒ…å†µå°±æ˜¯ä¸€ä¸ªåƒµå°¸ ID)ï¼Œç„¶åè¿”å›è¯¥ä»£å¸æ‹¥æœ‰è€…çš„ addressã€‚</p>
<p>åŒæ ·çš„ï¼Œå› ä¸ºåœ¨æˆ‘ä»¬çš„ DApp é‡Œå·²ç»æœ‰ä¸€ä¸ª mapping (æ˜ å°„) å­˜å‚¨äº†è¿™ä¸ªä¿¡æ¯ï¼Œæ‰€ä»¥å¯¹æˆ‘ä»¬æ¥è¯´è¿™ä¸ªå®ç°éå¸¸ç›´æ¥æ¸…æ™°ã€‚æˆ‘ä»¬å¯ä»¥åªç”¨ä¸€è¡Œ return è¯­å¥æ¥å®ç°è¿™ä¸ªå‡½æ•°ã€‚</p>
<blockquote>
<p>æ³¨æ„ï¼šè¦è®°å¾—ï¼Œ uint256 ç­‰åŒäºuintã€‚æˆ‘ä»¬ä»è¯¾ç¨‹çš„å¼€å§‹ä¸€ç›´åœ¨ä»£ç ä¸­ä½¿ç”¨ uintï¼Œä½†ä»ç°åœ¨å¼€å§‹æˆ‘ä»¬å°†åœ¨è¿™é‡Œç”¨ uint256ï¼Œå› ä¸ºæˆ‘ä»¬ç›´æ¥ä»è§„èŒƒä¸­å¤åˆ¶ç²˜è´´ã€‚</p>
</blockquote>
<p>å®æˆ˜æ¼”ä¹ ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">function balanceOf(address _owner) public view returns (uint256 _balance) &#123;</span><br><span class="line">  return ownerZombieCount[_owner];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">function ownerOf(uint256 _tokenId) public view returns (address _owner) &#123;</span><br><span class="line">  return zombieToOwner[_tokenId];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="â‘£é‡æ„"><a href="#â‘£é‡æ„" class="headerlink" title="â‘£é‡æ„"></a>â‘£é‡æ„</h4><p>æˆ‘ä»¬åˆšåˆšçš„ä»£ç ä¸­å…¶å®æœ‰ä¸ªé”™è¯¯ï¼Œä»¥è‡³äºå…¶æ ¹æœ¬æ— æ³•é€šè¿‡ç¼–è¯‘ï¼Œä½ å‘ç°äº†æ²¡ï¼Ÿ</p>
<p>åœ¨å‰ä¸€ä¸ªç« èŠ‚æˆ‘ä»¬å®šä¹‰äº†ä¸€ä¸ªå« ownerOf çš„å‡½æ•°ã€‚ä½†å¦‚æœä½ è¿˜è®°å¾—ç¬¬4è¯¾çš„å†…å®¹ï¼Œæˆ‘ä»¬åŒæ ·åœ¨zombiefeeding.sol é‡Œä»¥ ownerOf å‘½ååˆ›å»ºäº†ä¸€ä¸ª modifierï¼ˆä¿®é¥°ç¬¦ï¼‰ã€‚</p>
<p>å¦‚æœä½ å°è¯•ç¼–è¯‘è¿™æ®µä»£ç ï¼Œç¼–è¯‘å™¨ä¼šç»™ä½ ä¸€ä¸ªé”™è¯¯è¯´ä½ ä¸èƒ½æœ‰ç›¸åŒåç§°çš„ä¿®é¥°ç¬¦å’Œå‡½æ•°ã€‚</p>
<p>æ‰€ä»¥æˆ‘ä»¬åº”è¯¥æŠŠåœ¨ ZombieOwnership é‡Œçš„å‡½æ•°åç§°æ”¹æˆåˆ«çš„å—ï¼Ÿ</p>
<p>ä¸ï¼Œæˆ‘ä»¬ä¸èƒ½é‚£æ ·åšï¼ï¼ï¼è¦è®°å¾—ï¼Œæˆ‘ä»¬æ­£åœ¨ç”¨ ERC721 ä»£å¸æ ‡å‡†ï¼Œæ„å‘³ç€å…¶ä»–åˆçº¦å°†æœŸæœ›æˆ‘ä»¬çš„åˆçº¦ä»¥è¿™äº›ç¡®åˆ‡çš„åç§°æ¥å®šä¹‰å‡½æ•°ã€‚è¿™å°±æ˜¯è¿™äº›æ ‡å‡†å®ç”¨çš„åŸå› â€”â€”å¦‚æœå¦ä¸€ä¸ªåˆçº¦çŸ¥é“æˆ‘ä»¬çš„åˆçº¦ç¬¦åˆ ERC721 æ ‡å‡†ï¼Œå®ƒå¯ä»¥ç›´æ¥ä¸æˆ‘ä»¬äº¤äº’ï¼Œè€Œæ— éœ€äº†è§£ä»»ä½•å…³äºæˆ‘ä»¬å†…éƒ¨å¦‚ä½•å®ç°çš„ç»†èŠ‚ã€‚</p>
<p>æ‰€ä»¥ï¼Œé‚£æ„å‘³ç€æˆ‘ä»¬å°†å¿…é¡»é‡æ„æˆ‘ä»¬ç¬¬4è¯¾ä¸­çš„ä»£ç ï¼Œå°† modifier çš„åç§°æ¢æˆåˆ«çš„ã€‚</p>
<p>å®æˆ˜æ¼”ä¹ ï¼š<br>æˆ‘ä»¬å›åˆ°äº† zombiefeeding.sol ã€‚æˆ‘ä»¬å°†æŠŠ modifier çš„åç§°ä» ownerOf æ”¹æˆ onlyOwnerOfã€‚</p>
<ol>
<li><p>æŠŠä¿®é¥°ç¬¦å®šä¹‰ä¸­çš„åç§°æ”¹æˆ onlyOwnerOf</p>
</li>
<li><p>å¾€ä¸‹æ»‘åˆ°ä½¿ç”¨æ­¤ä¿®é¥°ç¬¦çš„å‡½æ•° feedAndMultiply ã€‚æˆ‘ä»¬ä¹Ÿéœ€è¦æ”¹è¿™é‡Œçš„åç§°ã€‚</p>
</li>
</ol>
<blockquote>
<p>æ³¨æ„ï¼šæˆ‘ä»¬åœ¨ zombiehelper.sol å’Œ zombieattack.sol é‡Œä¹Ÿä½¿ç”¨äº†è¿™ä¸ªä¿®é¥°ç¬¦ï¼Œä½†ä¸ºäº†ä¸åœ¨è¿™èŠ‚è¯¾çš„é‡æ„é‡ŒèŠ±å¤ªå¤šæ—¶é—´ï¼Œæˆ‘ä»¬å·²ç»å°†é‚£äº›æ–‡ä»¶é‡Œçš„ä¿®é¥°ç¬¦åç§°ä¸ºä½ æ”¹å¥½äº†ã€‚</p>
</blockquote>
<h4 id="â‘¤ERC721-è½¬ç§»æ ‡å‡†"><a href="#â‘¤ERC721-è½¬ç§»æ ‡å‡†" class="headerlink" title="â‘¤ERC721: è½¬ç§»æ ‡å‡†"></a>â‘¤ERC721: è½¬ç§»æ ‡å‡†</h4><p>ç°åœ¨æˆ‘ä»¬å°†é€šè¿‡å­¦ä¹ æŠŠæ‰€æœ‰æƒä»ä¸€ä¸ªäººè½¬ç§»ç»™å¦ä¸€ä¸ªäººæ¥ç»§ç»­æˆ‘ä»¬çš„ ERC721 è§„èŒƒçš„å®ç°ã€‚</p>
<p>æ³¨æ„ ERC721 è§„èŒƒæœ‰ä¸¤ç§ä¸åŒçš„æ–¹æ³•æ¥è½¬ç§»ä»£å¸ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">function transfer(address _to, uint256 _tokenId) public;</span><br><span class="line"></span><br><span class="line">function approve(address _to, uint256 _tokenId) public;</span><br><span class="line">function takeOwnership(uint256 _tokenId) public;</span><br></pre></td></tr></table></figure>
<ol>
<li><p>ç¬¬ä¸€ç§æ–¹æ³•æ˜¯ä»£å¸çš„æ‹¥æœ‰è€…è°ƒç”¨transfer æ–¹æ³•ï¼Œä¼ å…¥ä»–æƒ³è½¬ç§»åˆ°çš„ address å’Œä»–æƒ³è½¬ç§»çš„ä»£å¸çš„ _tokenIdã€‚</p>
</li>
<li><p>ç¬¬äºŒç§æ–¹æ³•æ˜¯ä»£å¸æ‹¥æœ‰è€…é¦–å…ˆè°ƒç”¨ approveï¼Œç„¶åä¼ å…¥ä¸ä»¥ä¸Šç›¸åŒçš„å‚æ•°ã€‚æ¥ç€ï¼Œè¯¥åˆçº¦ä¼šå­˜å‚¨è°è¢«å…è®¸æå–ä»£å¸ï¼Œé€šå¸¸å­˜å‚¨åˆ°ä¸€ä¸ª mapping (uint256 &#x3D;&gt; address) é‡Œã€‚ç„¶åï¼Œå½“æœ‰äººè°ƒç”¨ takeOwnership æ—¶ï¼Œåˆçº¦ä¼šæ£€æŸ¥ msg.sender æ˜¯å¦å¾—åˆ°æ‹¥æœ‰è€…çš„æ‰¹å‡†æ¥æå–ä»£å¸ï¼Œå¦‚æœæ˜¯ï¼Œåˆ™å°†ä»£å¸è½¬ç§»ç»™ä»–ã€‚</p>
</li>
</ol>
<p>ä½ æ³¨æ„åˆ°äº†å—ï¼Œtransfer å’Œ takeOwnership éƒ½å°†åŒ…å«ç›¸åŒçš„è½¬ç§»é€»è¾‘ï¼Œåªæ˜¯ä»¥ç›¸åçš„é¡ºåºã€‚ ï¼ˆä¸€ç§æƒ…å†µæ˜¯ä»£å¸çš„å‘é€è€…è°ƒç”¨å‡½æ•°ï¼›å¦ä¸€ç§æƒ…å†µæ˜¯ä»£å¸çš„æ¥æ”¶è€…è°ƒç”¨å®ƒï¼‰ã€‚</p>
<p>æ‰€ä»¥æˆ‘ä»¬æŠŠè¿™ä¸ªé€»è¾‘æŠ½è±¡æˆå®ƒè‡ªå·±çš„ç§æœ‰å‡½æ•° _transferï¼Œç„¶åç”±è¿™ä¸¤ä¸ªå‡½æ•°æ¥è°ƒç”¨å®ƒã€‚ è¿™æ ·æˆ‘ä»¬å°±ä¸ç”¨å†™é‡å¤çš„ä»£ç äº†ã€‚</p>
<p>å®æˆ˜æ¼”ä¹ :</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">function _transfer(address _from, address _to, uint256 _tokenId) private &#123;</span><br><span class="line">    ownerZombieCount[_to]++;</span><br><span class="line">    ownerZombieCount[_from]--;</span><br><span class="line">    zombieToOwner[_tokenId] = _to;</span><br><span class="line">    Transfer(_from, _to, _tokenId);</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure>
<h4 id="â‘¥ERC721-è½¬ç§»-ç»­"><a href="#â‘¥ERC721-è½¬ç§»-ç»­" class="headerlink" title="â‘¥ERC721: è½¬ç§»-ç»­"></a>â‘¥ERC721: è½¬ç§»-ç»­</h4><p>å®æˆ˜æ¼”ä¹ ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">function transfer(address _to, uint256 _tokenId) public onlyOwnerOf(_tokenId) &#123;</span><br><span class="line">    _transfer(msg.sender, _to, _tokenId);</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure>
<h4 id="â‘¦ERC721-æ‰¹å‡†"><a href="#â‘¦ERC721-æ‰¹å‡†" class="headerlink" title="â‘¦ERC721: æ‰¹å‡†"></a>â‘¦ERC721: æ‰¹å‡†</h4><p>ç°åœ¨ï¼Œè®©æˆ‘ä»¬æ¥å®ç° approveã€‚</p>
<p>è®°ä½ï¼Œä½¿ç”¨ approve æˆ–è€… takeOwnership çš„æ—¶å€™ï¼Œè½¬ç§»æœ‰2ä¸ªæ­¥éª¤ï¼š</p>
<ol>
<li><p>ä½ ï¼Œä½œä¸ºæ‰€æœ‰è€…ï¼Œç”¨æ–°ä¸»äººçš„ address å’Œä½ å¸Œæœ›ä»–è·å–çš„ _tokenId æ¥è°ƒç”¨ approve</p>
</li>
<li><p>æ–°ä¸»äººç”¨ _tokenId æ¥è°ƒç”¨ takeOwnershipï¼Œåˆçº¦ä¼šæ£€æŸ¥ç¡®ä¿ä»–è·å¾—äº†æ‰¹å‡†ï¼Œç„¶åæŠŠä»£å¸è½¬ç§»ç»™ä»–ã€‚</p>
</li>
</ol>
<p>å› ä¸ºè¿™å‘ç”Ÿåœ¨2ä¸ªå‡½æ•°çš„è°ƒç”¨ä¸­ï¼Œæ‰€ä»¥åœ¨å‡½æ•°è°ƒç”¨ä¹‹é—´ï¼Œæˆ‘ä»¬éœ€è¦ä¸€ä¸ªæ•°æ®ç»“æ„æ¥å­˜å‚¨ä»€ä¹ˆäººè¢«æ‰¹å‡†è·å–ä»€ä¹ˆã€‚</p>
<p>å®æˆ˜æ¼”ä¹ ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">mapping (uint =&gt; address) zombieApprovals;</span><br><span class="line"></span><br><span class="line">function approve(address _to, uint256 _tokenId) public onlyOwnerOf(_tokenId) &#123;</span><br><span class="line">    zombieApprovals[_tokenId] = _to;</span><br><span class="line">    Approval(msg.sender, _to, _tokenId);</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure>
<h4 id="â‘§ERC721-takeOwnership"><a href="#â‘§ERC721-takeOwnership" class="headerlink" title="â‘§ERC721: takeOwnership"></a>â‘§ERC721: takeOwnership</h4><p>æœ€åä¸€ä¸ªå‡½æ•° takeOwnershipï¼Œ åº”è¯¥åªæ˜¯ç®€å•åœ°æ£€æŸ¥ä»¥ç¡®ä¿ msg.sender å·²ç»è¢«æ‰¹å‡†æ¥æå–è¿™ä¸ªä»£å¸æˆ–è€…åƒµå°¸ã€‚è‹¥ç¡®è®¤ï¼Œå°±è°ƒç”¨ _transferï¼›</p>
<p>å®æˆ˜æ¼”ä¹ ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">function takeOwnership(uint256 _tokenId) public &#123;</span><br><span class="line">    require(zombieApprovals[_tokenId] == msg.sender);</span><br><span class="line">    address owner = ownerOf(_tokenId);</span><br><span class="line">    _transfer(owner, msg.sender, _tokenId);</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure>
<h4 id="â‘¨é¢„é˜²æº¢å‡º"><a href="#â‘¨é¢„é˜²æº¢å‡º" class="headerlink" title="â‘¨é¢„é˜²æº¢å‡º"></a>â‘¨é¢„é˜²æº¢å‡º</h4><p>æˆ‘ä»¬å®Œæˆäº† ERC721 çš„å®ç°ã€‚</p>
<p>ä¸è¿‡è¦è®°ä½é‚£åªæ˜¯æœ€ç®€å•çš„å®ç°ã€‚è¿˜æœ‰å¾ˆå¤šçš„ç‰¹æ€§æˆ‘ä»¬ä¹Ÿè®¸æƒ³åŠ å…¥åˆ°æˆ‘ä»¬çš„å®ç°ä¸­æ¥ï¼Œæ¯”å¦‚ä¸€äº›é¢å¤–çš„æ£€æŸ¥ï¼Œæ¥ç¡®ä¿ç”¨æˆ·ä¸ä¼šä¸å°å¿ƒæŠŠä»–ä»¬çš„åƒµå°¸è½¬ç§»ç»™0 åœ°å€ï¼ˆè¿™è¢«ç§°ä½œ â€œçƒ§å¸â€, åŸºæœ¬ä¸Šå°±æ˜¯æŠŠä»£å¸è½¬ç§»åˆ°ä¸€ä¸ªè°ä¹Ÿæ²¡æœ‰ç§é’¥çš„åœ°å€ï¼Œè®©è¿™ä¸ªä»£å¸æ°¸è¿œä¹Ÿæ— æ³•æ¢å¤ï¼‰ã€‚ æˆ–è€…åœ¨ DApp ä¸­åŠ å…¥ä¸€äº›åŸºæœ¬çš„æ‹å–é€»è¾‘ã€‚ï¼ˆä½ èƒ½æƒ³å‡ºä¸€äº›å®ç°çš„æ–¹æ³•ä¹ˆï¼Ÿï¼‰</p>
<p>ä½†æ˜¯ä¸ºäº†è®©æˆ‘ä»¬çš„è¯¾ç¨‹ä¸è‡³äºç¦»é¢˜å¤ªè¿œï¼Œæ‰€ä»¥æˆ‘ä»¬åªä¸“æ³¨äºä¸€äº›åŸºç¡€å®ç°ã€‚å¦‚æœä½ æƒ³å­¦ä¹ ä¸€äº›æ›´æ·±å±‚æ¬¡çš„å®ç°ï¼Œå¯ä»¥åœ¨è¿™ä¸ªæ•™ç¨‹ç»“æŸåï¼Œå»çœ‹çœ‹ OpenZeppelin çš„ ERC721 åˆçº¦ã€‚</p>
<p><strong>åˆçº¦å®‰å…¨å¢å¼º: æº¢å‡ºå’Œä¸‹æº¢</strong><br>æˆ‘ä»¬å°†æ¥å­¦ä¹ ä½ åœ¨ç¼–å†™æ™ºèƒ½åˆçº¦çš„æ—¶å€™éœ€è¦æ³¨æ„çš„ä¸€ä¸ªä¸»è¦çš„å®‰å…¨ç‰¹æ€§ï¼šé˜²æ­¢æº¢å‡ºå’Œä¸‹æº¢ã€‚</p>
<p>ä»€ä¹ˆæ˜¯ <em>æº¢å‡º</em> (overflow)?</p>
<p>å‡è®¾æˆ‘ä»¬æœ‰ä¸€ä¸ª uint8, åªèƒ½å­˜å‚¨8 bitæ•°æ®ã€‚è¿™æ„å‘³ç€æˆ‘ä»¬èƒ½å­˜å‚¨çš„æœ€å¤§æ•°å­—å°±æ˜¯äºŒè¿›åˆ¶ 11111111 (æˆ–è€…è¯´åè¿›åˆ¶çš„ 2^8 - 1 &#x3D; 255).</p>
<p>æ¥çœ‹çœ‹ä¸‹é¢çš„ä»£ç ã€‚æœ€å number å°†ä¼šæ˜¯ä»€ä¹ˆå€¼ï¼Ÿ</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">uint8 number = 255;</span><br><span class="line">number++;</span><br></pre></td></tr></table></figure>
<p>åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œæˆ‘ä»¬å¯¼è‡´äº†æº¢å‡º â€” è™½ç„¶æˆ‘ä»¬åŠ äº†1ï¼Œ ä½†æ˜¯ number å‡ºä¹æ„æ–™åœ°ç­‰äº 0äº†ã€‚ (å¦‚æœä½ ç»™äºŒè¿›åˆ¶ 11111111 åŠ 1, å®ƒå°†è¢«é‡ç½®ä¸º 00000000ï¼Œå°±åƒé’Ÿè¡¨ä» 23:59 èµ°å‘ 00:00)ã€‚</p>
<p>ä¸‹æº¢(underflow)ä¹Ÿç±»ä¼¼ï¼Œå¦‚æœä½ ä»ä¸€ä¸ªç­‰äº 0 çš„ uint8 å‡å» 1, å®ƒå°†å˜æˆ 255 (å› ä¸º uint æ˜¯æ— ç¬¦å·çš„ï¼Œå…¶ä¸èƒ½ç­‰äºè´Ÿæ•°)ã€‚</p>
<p>è™½ç„¶æˆ‘ä»¬åœ¨è¿™é‡Œä¸ä½¿ç”¨ uint8ï¼Œè€Œä¸”æ¯æ¬¡ç»™ä¸€ä¸ª uint256 åŠ  1 ä¹Ÿä¸å¤ªå¯èƒ½æº¢å‡º (2^256 çœŸçš„æ˜¯ä¸€ä¸ªå¾ˆå¤§çš„æ•°äº†)ï¼Œåœ¨æˆ‘ä»¬çš„åˆçº¦ä¸­æ·»åŠ ä¸€äº›ä¿æŠ¤æœºåˆ¶ä¾ç„¶æ˜¯éå¸¸æœ‰å¿…è¦çš„ï¼Œä»¥é˜²æˆ‘ä»¬çš„ DApp ä»¥åå‡ºç°ä»€ä¹ˆå¼‚å¸¸æƒ…å†µã€‚</p>
<p><strong>ä½¿ç”¨ SafeMath</strong><br>ä¸ºäº†é˜²æ­¢è¿™äº›æƒ…å†µï¼ŒOpenZeppelin å»ºç«‹äº†ä¸€ä¸ªå«åš SafeMath çš„ <em>åº“</em>(library)ï¼Œé»˜è®¤æƒ…å†µä¸‹å¯ä»¥é˜²æ­¢è¿™äº›é—®é¢˜ã€‚</p>
<p>ä¸è¿‡åœ¨æˆ‘ä»¬ä½¿ç”¨ä¹‹å‰â€¦â€¦ ä»€ä¹ˆå«åšåº“?</p>
<p>ä¸€ä¸ª_åº“_ æ˜¯ Solidity ä¸­ä¸€ç§ç‰¹æ®Šçš„åˆçº¦ã€‚å…¶ä¸­ä¸€ä¸ªæœ‰ç”¨çš„åŠŸèƒ½æ˜¯ç»™åŸå§‹æ•°æ®ç±»å‹å¢åŠ ä¸€äº›æ–¹æ³•ã€‚</p>
<p>æ¯”å¦‚ï¼Œä½¿ç”¨ SafeMath åº“çš„æ—¶å€™ï¼Œæˆ‘ä»¬å°†ä½¿ç”¨ using SafeMath for uint256 è¿™æ ·çš„è¯­æ³•ã€‚ SafeMath åº“æœ‰å››ä¸ªæ–¹æ³• â€” addï¼Œ subï¼Œ mulï¼Œ ä»¥åŠ divã€‚ç°åœ¨æˆ‘ä»¬å¯ä»¥è¿™æ ·æ¥è®© uint256 è°ƒç”¨è¿™äº›æ–¹æ³•ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">using SafeMath for uint256;</span><br><span class="line"></span><br><span class="line">uint256 a = 5;</span><br><span class="line">uint256 b = a.add(3); // 5 + 3 = 8</span><br><span class="line">uint256 c = a.mul(2); // 5 * 2 = 10</span><br></pre></td></tr></table></figure>
<p>æˆ‘ä»¬å°†åœ¨ä¸‹ä¸€ç« æ¥å­¦ä¹ è¿™äº›æ–¹æ³•ï¼Œä¸è¿‡ç°åœ¨æˆ‘ä»¬å…ˆå°† SafeMath åº“æ·»åŠ è¿›æˆ‘ä»¬çš„åˆçº¦ã€‚</p>
<p>å®æˆ˜æ¼”ä¹ ï¼š</p>
<ol>
<li>å°† safemath.sol å¼•å…¥åˆ° zombiefactory.sol.</li>
<li>æ·»åŠ å®šä¹‰ï¼š using SafeMath for uint256;.</li>
</ol>
<h4 id="â‘©SafeMathç¬¬äºŒéƒ¨åˆ†"><a href="#â‘©SafeMathç¬¬äºŒéƒ¨åˆ†" class="headerlink" title="â‘©SafeMathç¬¬äºŒéƒ¨åˆ†"></a>â‘©SafeMathç¬¬äºŒéƒ¨åˆ†</h4><p>æ¥çœ‹çœ‹ SafeMath çš„éƒ¨åˆ†ä»£ç :</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">library SafeMath &#123;</span><br><span class="line"></span><br><span class="line">  function mul(uint256 a, uint256 b) internal pure returns (uint256) &#123;</span><br><span class="line">    if (a == 0) &#123;</span><br><span class="line">      return 0;</span><br><span class="line">    &#125;</span><br><span class="line">    uint256 c = a * b;</span><br><span class="line">    assert(c / a == b);</span><br><span class="line">    return c;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  function div(uint256 a, uint256 b) internal pure returns (uint256) &#123;</span><br><span class="line">    // assert(b &gt; 0); // Solidity automatically throws when dividing by 0</span><br><span class="line">    uint256 c = a / b;</span><br><span class="line">    // assert(a == b * c + a % b); // There is no case in which this doesn&#x27;t hold</span><br><span class="line">    return c;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  function sub(uint256 a, uint256 b) internal pure returns (uint256) &#123;</span><br><span class="line">    assert(b &lt;= a);</span><br><span class="line">    return a - b;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  function add(uint256 a, uint256 b) internal pure returns (uint256) &#123;</span><br><span class="line">    uint256 c = a + b;</span><br><span class="line">    assert(c &gt;= a);</span><br><span class="line">    return c;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>é¦–å…ˆæˆ‘ä»¬æœ‰äº† library å…³é”®å­— â€” åº“å’Œ åˆçº¦å¾ˆç›¸ä¼¼ï¼Œä½†æ˜¯åˆæœ‰ä¸€äº›ä¸åŒã€‚ å°±æˆ‘ä»¬çš„ç›®çš„è€Œè¨€ï¼Œåº“å…è®¸æˆ‘ä»¬ä½¿ç”¨ using å…³é”®å­—ï¼Œå®ƒå¯ä»¥è‡ªåŠ¨æŠŠåº“çš„æ‰€æœ‰æ–¹æ³•æ·»åŠ ç»™ä¸€ä¸ªæ•°æ®ç±»å‹ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">using SafeMath for uint;</span><br><span class="line">// è¿™ä¸‹æˆ‘ä»¬å¯ä»¥ä¸ºä»»ä½• uint è°ƒç”¨è¿™äº›æ–¹æ³•äº†</span><br><span class="line">uint test = 2;</span><br><span class="line">test = test.mul(3); // test ç­‰äº 6 äº†</span><br><span class="line">test = test.add(5); // test ç­‰äº 11 äº†</span><br></pre></td></tr></table></figure>
<p>æ³¨æ„ mul å’Œ add å…¶å®éƒ½éœ€è¦ä¸¤ä¸ªå‚æ•°ã€‚ åœ¨æˆ‘ä»¬å£°æ˜äº† using SafeMath for uint åï¼Œæˆ‘ä»¬ç”¨æ¥è°ƒç”¨è¿™äº›æ–¹æ³•çš„ uint å°±è‡ªåŠ¨è¢«ä½œä¸ºç¬¬ä¸€ä¸ªå‚æ•°ä¼ é€’è¿›å»äº†(åœ¨æ­¤ä¾‹ä¸­å°±æ˜¯ test)</p>
<p>æˆ‘ä»¬æ¥çœ‹çœ‹ add çš„æºä»£ç çœ‹ SafeMath åšäº†ä»€ä¹ˆ:</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">function add(uint256 a, uint256 b) internal pure returns (uint256) &#123;</span><br><span class="line">  uint256 c = a + b;</span><br><span class="line">  assert(c &gt;= a);</span><br><span class="line">  return c;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>åŸºæœ¬ä¸Š add åªæ˜¯åƒ + ä¸€æ ·å¯¹ä¸¤ä¸ª uint ç›¸åŠ ï¼Œ ä½†æ˜¯å®ƒç”¨ä¸€ä¸ª assert è¯­å¥æ¥ç¡®ä¿ç»“æœå¤§äº aã€‚è¿™æ ·å°±é˜²æ­¢äº†æº¢å‡ºã€‚</p>
<p>assert å’Œ require ç›¸ä¼¼ï¼Œè‹¥ç»“æœä¸ºå¦å®ƒå°±ä¼šæŠ›å‡ºé”™è¯¯ã€‚ assert å’Œ require åŒºåˆ«åœ¨äºï¼Œrequire è‹¥å¤±è´¥åˆ™ä¼šè¿”è¿˜ç»™ç”¨æˆ·å‰©ä¸‹çš„ gasï¼Œ assert åˆ™ä¸ä¼šã€‚æ‰€ä»¥å¤§éƒ¨åˆ†æƒ…å†µä¸‹ï¼Œä½ å†™ä»£ç çš„æ—¶å€™ä¼šæ¯”è¾ƒå–œæ¬¢ requireï¼Œassert åªåœ¨ä»£ç å¯èƒ½å‡ºç°ä¸¥é‡é”™è¯¯çš„æ—¶å€™ä½¿ç”¨ï¼Œæ¯”å¦‚ uint æº¢å‡ºã€‚</p>
<p>æ‰€ä»¥ç®€è€Œè¨€ä¹‹ï¼Œ SafeMath çš„ addï¼Œ subï¼Œ mulï¼Œ å’Œ div æ–¹æ³•åªåšç®€å•çš„å››åˆ™è¿ç®—ï¼Œç„¶ååœ¨å‘ç”Ÿæº¢å‡ºæˆ–ä¸‹æº¢çš„æ—¶å€™æŠ›å‡ºé”™è¯¯ã€‚</p>
<p><strong>åœ¨æˆ‘ä»¬çš„ä»£ç é‡Œä½¿ç”¨ SafeMathã€‚</strong><br>ä¸ºäº†é˜²æ­¢æº¢å‡ºå’Œä¸‹æº¢ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨æˆ‘ä»¬çš„ä»£ç é‡Œæ‰¾ +ï¼Œ -ï¼Œ *ï¼Œ æˆ– &#x2F;ï¼Œç„¶åæ›¿æ¢ä¸º add, sub, mul, div.</p>
<p>æ¯”å¦‚ï¼Œä¸å…¶è¿™æ ·åš:<code>myUint++;</code><br>æˆ‘ä»¬è¿™æ ·åš:<code>myUint = myUint.add(1);</code></p>
<p>å®æˆ˜æ¼”ä¹ ï¼š<br>    &#x2F;&#x2F; 1. æ›¿æ¢æˆ SafeMath çš„ <code>add</code><br>    ownerZombieCount[_to]++;<br>    &#x2F;&#x2F; 2. æ›¿æ¢æˆ SafeMath çš„ <code>sub</code><br>    ownerZombieCount[_from]â€“;</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">ownerZombieCount[_to] = ownerZombieCount[_to].add(1);</span><br><span class="line">ownerZombieCount[msg.sender] = ownerZombieCount[msg.sender].sub(1);</span><br></pre></td></tr></table></figure>
<h4 id="â‘ªSafeMath-ç¬¬ä¸‰éƒ¨åˆ†"><a href="#â‘ªSafeMath-ç¬¬ä¸‰éƒ¨åˆ†" class="headerlink" title="â‘ªSafeMath ç¬¬ä¸‰éƒ¨åˆ†"></a>â‘ªSafeMath ç¬¬ä¸‰éƒ¨åˆ†</h4><p>å¤ªå¥½äº†ï¼Œè¿™ä¸‹æˆ‘ä»¬çš„ ERC721 å®ç°ä¸ä¼šæœ‰æº¢å‡ºæˆ–è€…ä¸‹æº¢äº†ã€‚</p>
<p>å›å¤´çœ‹çœ‹æˆ‘ä»¬åœ¨ä¹‹å‰è¯¾ç¨‹å†™çš„ä»£ç ï¼Œè¿˜æœ‰å…¶ä»–å‡ ä¸ªåœ°æ–¹ä¹Ÿæœ‰å¯èƒ½å¯¼è‡´æº¢å‡ºæˆ–ä¸‹æº¢ã€‚</p>
<p>æ¯”å¦‚ï¼Œ åœ¨ ZombieAttack é‡Œé¢æˆ‘ä»¬æœ‰ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">myZombie.winCount++;</span><br><span class="line">myZombie.level++;</span><br><span class="line">enemyZombie.lossCount++;</span><br></pre></td></tr></table></figure>
<p>æˆ‘ä»¬åŒæ ·åº”è¯¥åœ¨è¿™äº›åœ°æ–¹é˜²æ­¢æº¢å‡ºã€‚ï¼ˆé€šå¸¸æƒ…å†µä¸‹ï¼Œæ€»æ˜¯ä½¿ç”¨ SafeMath è€Œä¸æ˜¯æ™®é€šæ•°å­¦è¿ç®—æ˜¯ä¸ªå¥½ä¸»æ„ï¼Œä¹Ÿè®¸åœ¨ä»¥å Solidity çš„æ–°ç‰ˆæœ¬é‡Œè¿™ç‚¹ä¼šè¢«é»˜è®¤å®ç°ï¼Œä½†æ˜¯ç°åœ¨æˆ‘ä»¬å¾—è‡ªå·±åœ¨ä»£ç é‡Œå®ç°è¿™äº›é¢å¤–çš„å®‰å…¨æªæ–½ï¼‰ã€‚</p>
<p>ä¸è¿‡æˆ‘ä»¬é‡åˆ°ä¸ªå°é—®é¢˜ â€” winCount å’Œ lossCount æ˜¯ uint16ï¼Œ è€Œ level æ˜¯ uint32ã€‚ æ‰€ä»¥å¦‚æœæˆ‘ä»¬ç”¨è¿™äº›ä½œä¸ºå‚æ•°ä¼ å…¥ SafeMath çš„ add æ–¹æ³•ã€‚ å®ƒå®é™…ä¸Šå¹¶ä¸ä¼šé˜²æ­¢æº¢å‡ºï¼Œå› ä¸ºå®ƒä¼šæŠŠè¿™äº›å˜é‡éƒ½è½¬æ¢æˆ uint256:</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">function add(uint256 a, uint256 b) internal pure returns (uint256) &#123;</span><br><span class="line">  uint256 c = a + b;</span><br><span class="line">  assert(c &gt;= a);</span><br><span class="line">  return c;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// å¦‚æœæˆ‘ä»¬åœ¨`uint8` ä¸Šè°ƒç”¨ `.add`ã€‚å®ƒå°†ä¼šè¢«è½¬æ¢æˆ `uint256`.</span><br><span class="line">// æ‰€ä»¥å®ƒä¸ä¼šåœ¨ 2^8 æ—¶æº¢å‡ºï¼Œå› ä¸º 256 æ˜¯ä¸€ä¸ªæœ‰æ•ˆçš„ `uint256`.</span><br></pre></td></tr></table></figure>
<p>è¿™å°±æ„å‘³ç€ï¼Œæˆ‘ä»¬éœ€è¦å†å®ç°ä¸¤ä¸ªåº“æ¥é˜²æ­¢ uint16 å’Œ uint32 æº¢å‡ºæˆ–ä¸‹æº¢ã€‚æˆ‘ä»¬å¯ä»¥å°†å…¶å‘½åä¸º SafeMath16 å’Œ SafeMath32ã€‚</p>
<p>ä»£ç å°†å’Œ SafeMath å®Œå…¨ç›¸åŒï¼Œé™¤äº†æ‰€æœ‰çš„ uint256 å®ä¾‹éƒ½å°†è¢«æ›¿æ¢æˆ uint32 æˆ– uint16ã€‚</p>
<p>æˆ‘ä»¬å·²ç»å°†è¿™äº›ä»£ç å¸®ä½ å†™å¥½äº†ï¼Œæ‰“å¼€ safemath.sol åˆçº¦çœ‹çœ‹ä»£ç å§ã€‚</p>
<p>ç°åœ¨æˆ‘ä»¬éœ€è¦åœ¨ ZombieFactory é‡Œä½¿ç”¨å®ƒä»¬ã€‚</p>
<p>å®æˆ˜æ¼”ä¹ ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">using SafeMath for uint256;</span><br><span class="line">using SafeMath32 for uint32;</span><br><span class="line">using SafeMath16 for uint16;</span><br></pre></td></tr></table></figure>
<h4 id="â‘«SafeMath-ç¬¬4éƒ¨åˆ†"><a href="#â‘«SafeMath-ç¬¬4éƒ¨åˆ†" class="headerlink" title="â‘«SafeMath ç¬¬4éƒ¨åˆ†"></a>â‘«SafeMath ç¬¬4éƒ¨åˆ†</h4><p>çœŸæ£’ï¼Œç°åœ¨æˆ‘ä»¬å·²ç»ä¸ºæˆ‘ä»¬çš„ DApp é‡Œé¢ç”¨åˆ°çš„ uint æ•°æ®ç±»å‹éƒ½å®ç°äº† SafeMath äº†ã€‚</p>
<p>è®©æˆ‘ä»¬æŠŠ ZombieAttack é‡Œæ‰€æœ‰æ½œåœ¨çš„é—®é¢˜éƒ½ä¿®å¤äº†å§ã€‚ ï¼ˆå…¶å®åœ¨ ZombieHelper é‡Œä¹Ÿæœ‰ä¸€å¤„ zombies[_zombieId].level++; éœ€è¦ä¿®å¤ï¼Œä¸è¿‡æˆ‘ä»¬å·²ç»å¸®ä½ åšå¥½äº†ï¼Œè¿™æ ·æˆ‘ä»¬å°±ä¸ç”¨å†æ¥ä¸€ç« äº† ğŸ˜‰ï¼‰ã€‚</p>
<h4 id="â‘¬æ³¨é‡Š"><a href="#â‘¬æ³¨é‡Š" class="headerlink" title="â‘¬æ³¨é‡Š"></a>â‘¬æ³¨é‡Š</h4><p>åƒµå°¸æ¸¸æˆçš„ Solidity ä»£ç ç»ˆäºå®Œæˆå•¦ã€‚</p>
<p>åœ¨ä»¥åçš„è¯¾ç¨‹ä¸­ï¼Œæˆ‘ä»¬å°†å­¦ä¹ å¦‚ä½•å°†æ¸¸æˆéƒ¨ç½²åˆ°ä»¥å¤ªåŠï¼Œä»¥åŠå¦‚ä½•å’Œ Web3.js äº¤äº’ã€‚</p>
<p>ä¸è¿‡åœ¨ä½ ç¦»å¼€ç¬¬äº”è¯¾ä¹‹å‰ï¼Œæˆ‘ä»¬æ¥è°ˆè°ˆå¦‚ä½• ç»™ä½ çš„ä»£ç æ·»åŠ æ³¨é‡Š.</p>
<p><strong>æ³¨é‡Šè¯­æ³•</strong><br>Solidity é‡Œçš„æ³¨é‡Šå’Œ JavaScript ç›¸åŒã€‚åœ¨æˆ‘ä»¬çš„è¯¾ç¨‹ä¸­ä½ å·²ç»çœ‹åˆ°äº†ä¸å°‘å•è¡Œæ³¨é‡Šäº†ï¼š</p>
<p><code>// è¿™æ˜¯ä¸€ä¸ªå•è¡Œæ³¨é‡Šï¼Œå¯ä»¥ç†è§£ä¸ºç»™è‡ªå·±æˆ–è€…åˆ«äººçœ‹çš„ç¬”è®°</code></p>
<p>åªè¦åœ¨ä»»ä½•åœ°æ–¹æ·»åŠ ä¸€ä¸ª &#x2F;&#x2F; å°±æ„å‘³ç€ä½ åœ¨æ³¨é‡Šã€‚å¦‚æ­¤ç®€å•æ‰€ä»¥ä½ åº”è¯¥ç»å¸¸è¿™ä¹ˆåšã€‚</p>
<p>ä¸è¿‡æˆ‘ä»¬ä¹ŸçŸ¥é“ä½ çš„æƒ³æ³•ï¼šæœ‰æ—¶å€™å•è¡Œæ³¨é‡Šæ˜¯ä¸å¤Ÿçš„ã€‚æ¯•ç«Ÿä½ ç”Ÿæ¥è¯ç—¨ã€‚</p>
<p>æ‰€ä»¥æˆ‘ä»¬æœ‰äº†å¤šè¡Œæ³¨é‡Šï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">contract CryptoZombies &#123;</span><br><span class="line">  /* è¿™æ˜¯ä¸€ä¸ªå¤šè¡Œæ³¨é‡Šã€‚æˆ‘æƒ³å¯¹æ‰€æœ‰èŠ±æ—¶é—´æ¥å°è¯•è¿™ä¸ªç¼–ç¨‹è¯¾ç¨‹çš„äººè¯´å£°è°¢è°¢ã€‚</span><br><span class="line">  å®ƒæ˜¯å…è´¹çš„ï¼Œå¹¶å°†æ°¸è¿œå…è´¹ã€‚ä½†æ˜¯æˆ‘ä»¬ä¾ç„¶å€¾æ³¨äº†æˆ‘ä»¬çš„å¿ƒè¡€æ¥è®©å®ƒå˜å¾—æ›´å¥½ã€‚</span><br><span class="line"></span><br><span class="line">   è¦çŸ¥é“è¿™ä¾ç„¶åªæ˜¯åŒºå—é“¾å¼€å‘çš„å¼€å§‹è€Œå·²ï¼Œè™½ç„¶æˆ‘ä»¬å·²ç»èµ°äº†å¾ˆè¿œï¼Œ</span><br><span class="line">   ä»ç„¶æœ‰å¾ˆå¤šç§æ–¹å¼æ¥è®©æˆ‘ä»¬çš„ç¤¾åŒºå˜å¾—æ›´å¥½ã€‚</span><br><span class="line">   å¦‚æœæˆ‘ä»¬åœ¨å“ªä¸ªåœ°æ–¹å‡ºäº†é”™ï¼Œæ¬¢è¿åœ¨æˆ‘ä»¬çš„ github æäº¤ PR æˆ–è€… issue æ¥å¸®åŠ©æˆ‘ä»¬æ”¹è¿›ï¼š</span><br><span class="line">    https://github.com/loomnetwork/cryptozombie-lessons</span><br><span class="line"></span><br><span class="line">    æˆ–è€…ï¼Œå¦‚æœä½ æœ‰ä»»ä½•çš„æƒ³æ³•ã€å»ºè®®ç”šè‡³ä»…ä»…æƒ³å’Œæˆ‘ä»¬æ‰“å£°æ‹›å‘¼ï¼Œæ¬¢è¿æ¥æˆ‘ä»¬çš„ç”µæŠ¥ç¾¤ï¼š</span><br><span class="line">     https://t.me/loomnetworkdev</span><br><span class="line">  */</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>ç‰¹åˆ«æ˜¯ï¼Œæœ€å¥½ä¸ºä½ åˆçº¦ä¸­æ¯ä¸ªæ–¹æ³•æ·»åŠ æ³¨é‡Šæ¥è§£é‡Šå®ƒçš„é¢„æœŸè¡Œä¸ºã€‚è¿™æ ·å…¶ä»–å¼€å‘è€…ï¼ˆæˆ–è€…ä½ è‡ªå·±ï¼Œåœ¨6ä¸ªæœˆä»¥åå†å›åˆ°è¿™ä¸ªé¡¹ç›®ä¸­ï¼‰å¯ä»¥å¾ˆå¿«åœ°ç†è§£ä½ çš„ä»£ç è€Œä¸éœ€è¦é€è¡Œé˜…è¯»æ‰€æœ‰ä»£ç ã€‚</p>
<p>Solidity ç¤¾åŒºæ‰€ä½¿ç”¨çš„ä¸€ä¸ªæ ‡å‡†æ˜¯ä½¿ç”¨ä¸€ç§è¢«ç§°ä½œ natspec çš„æ ¼å¼ï¼Œçœ‹èµ·æ¥åƒè¿™æ ·ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">/// @title ä¸€ä¸ªç®€å•çš„åŸºç¡€è¿ç®—åˆçº¦</span><br><span class="line">/// @author H4XF13LD MORRIS ğŸ’¯ğŸ’¯ğŸ˜ğŸ’¯ğŸ’¯</span><br><span class="line">/// @notice ç°åœ¨ï¼Œè¿™ä¸ªåˆçº¦åªæ·»åŠ ä¸€ä¸ªä¹˜æ³•</span><br><span class="line">contract Math &#123;</span><br><span class="line">  /// @notice ä¸¤ä¸ªæ•°ç›¸ä¹˜</span><br><span class="line">  /// @param x ç¬¬ä¸€ä¸ª uint</span><br><span class="line">  /// @param y  ç¬¬äºŒä¸ª uint</span><br><span class="line">  /// @return z  (x * y) çš„ç»“æœ</span><br><span class="line">  /// @dev ç°åœ¨è¿™ä¸ªæ–¹æ³•ä¸æ£€æŸ¥æº¢å‡º</span><br><span class="line">  function multiply(uint x, uint y) returns (uint z) &#123;</span><br><span class="line">    // è¿™åªæ˜¯ä¸ªæ™®é€šçš„æ³¨é‡Šï¼Œä¸ä¼šè¢« natspec è§£é‡Š</span><br><span class="line">    z = x * y;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ol>
<li>@titleï¼ˆæ ‡é¢˜ï¼‰ å’Œ @author ï¼ˆä½œè€…ï¼‰å¾ˆç›´æ¥äº†.</li>
<li>@notice ï¼ˆé¡»çŸ¥ï¼‰å‘ ç”¨æˆ· è§£é‡Šè¿™ä¸ªæ–¹æ³•æˆ–è€…åˆçº¦æ˜¯åšä»€ä¹ˆçš„ã€‚ @dev ï¼ˆå¼€å‘è€…ï¼‰ æ˜¯å‘å¼€å‘è€…è§£é‡Šæ›´å¤šçš„ç»†èŠ‚ã€‚</li>
<li>@param ï¼ˆå‚æ•°ï¼‰å’Œ @return ï¼ˆè¿”å›ï¼‰ ç”¨æ¥æè¿°è¿™ä¸ªæ–¹æ³•éœ€è¦ä¼ å…¥ä»€ä¹ˆå‚æ•°ä»¥åŠè¿”å›ä»€ä¹ˆå€¼ã€‚</li>
</ol>
<p>æ³¨æ„ä½ å¹¶ä¸éœ€è¦æ¯æ¬¡éƒ½ç”¨ä¸Šæ‰€æœ‰çš„æ ‡ç­¾ï¼Œå®ƒä»¬éƒ½æ˜¯å¯é€‰çš„ã€‚ä¸è¿‡æœ€å°‘ï¼Œå†™ä¸‹ä¸€ä¸ª @dev æ³¨é‡Šæ¥è§£é‡Šæ¯ä¸ªæ–¹æ³•æ˜¯åšä»€ä¹ˆçš„ã€‚</p>
<p>å®æˆ˜æ¼”ä¹ ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">/// @title ä¸€ä¸ªç®¡ç†è½¬ç§»åƒµå°¸æ‰€æœ‰æƒçš„åˆçº¦</span><br><span class="line">/// @author formikasaever</span><br><span class="line">/// @dev ç¬¦åˆ OpenZeppelin å¯¹ ERC721 æ ‡å‡†è‰æ¡ˆçš„å®ç°</span><br><span class="line">contract ZombieOwnership is ZombieAttack, ERC721 &#123;</span><br></pre></td></tr></table></figure>
<h4 id="â‘­æ”¾åœ¨ä¸€èµ·"><a href="#â‘­æ”¾åœ¨ä¸€èµ·" class="headerlink" title="â‘­æ”¾åœ¨ä¸€èµ·"></a>â‘­æ”¾åœ¨ä¸€èµ·</h4><p><strong>æ€»ç»“ä¸€ä¸‹</strong><br>è¿™èŠ‚è¯¾é‡Œé¢æˆ‘ä»¬å­¦åˆ°äº†</p>
<ul>
<li>ä»£å¸, ERC721 æ ‡å‡†ï¼Œä»¥åŠå¯äº¤æ˜“çš„ç‰©ä»¶&#x2F;åƒµå°¸</li>
<li>åº“ä»¥åŠå¦‚ä½•ä½¿ç”¨åº“</li>
<li>å¦‚ä½•åˆ©ç”¨ SafeMath æ¥é˜²æ­¢æº¢å‡ºå’Œä¸‹æº¢</li>
<li>ä»£ç æ³¨é‡Šå’Œ natspec æ ‡å‡†</li>
</ul>
<p>è¿™èŠ‚æ•™ç¨‹å®Œæˆäº†æˆ‘ä»¬æ¸¸æˆçš„ Solidity ä»£ç ï¼ˆä»…é’ˆå¯¹å½“ä¸‹æ¥è¯´ï¼Œæœªæ¥çš„è¯¾ç¨‹æˆ‘ä»¬ä¹Ÿè®¸ä¼šåŠ å…¥æ›´å¤šè¿›å»ï¼‰ã€‚</p>
<p>åœ¨æ¥ä¸‹æ¥çš„ä¸¤èŠ‚è¯¾ä¸­ï¼Œæˆ‘ä»¬å°†å­¦ä¹ å¦‚ä½•å°†æ¸¸æˆéƒ¨ç½²åˆ°ä»¥å¤ªåŠä»¥åŠå’Œ web3.js äº¤äº’ ï¼ˆè¿™æ ·ä½ å°±èƒ½ä¸ºä½ çš„ DApp æ‰“é€ ä¸€ä¸ªç•Œé¢äº† ï¼‰ã€‚</p>
<h4 id="â‘®ç¬¬äº”è¯¾å®Œæˆ"><a href="#â‘®ç¬¬äº”è¯¾å®Œæˆ" class="headerlink" title="â‘®ç¬¬äº”è¯¾å®Œæˆ"></a>â‘®ç¬¬äº”è¯¾å®Œæˆ</h4><p>æˆªè‡³ç¬¬äº”è¯¾å®Œæˆï¼Œæ‰€æœ‰ä»£ç å¦‚ä¸‹ï¼š<br><strong>zombieownership.sol:</strong></p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">pragma solidity ^0.4.19;</span><br><span class="line"></span><br><span class="line">import &quot;./zombieattack.sol&quot;;</span><br><span class="line">import &quot;./erc721.sol&quot;;</span><br><span class="line">import &quot;./safemath.sol&quot;;</span><br><span class="line"></span><br><span class="line">/// @title ä¸€ä¸ªç®¡ç†è½¬ç§»åƒµå°¸æ‰€æœ‰æƒçš„åˆçº¦</span><br><span class="line">/// @author formikasaever</span><br><span class="line">/// @dev ç¬¦åˆ OpenZeppelin å¯¹ ERC721 æ ‡å‡†è‰æ¡ˆçš„å®ç°</span><br><span class="line">contract ZombieOwnership is ZombieAttack, ERC721 &#123;</span><br><span class="line"></span><br><span class="line">  using SafeMath for uint256;</span><br><span class="line"></span><br><span class="line">  mapping (uint =&gt; address) zombieApprovals;</span><br><span class="line"></span><br><span class="line">  function balanceOf(address _owner) public view returns (uint256 _balance) &#123;</span><br><span class="line">    return ownerZombieCount[_owner];</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  function ownerOf(uint256 _tokenId) public view returns (address _owner) &#123;</span><br><span class="line">    return zombieToOwner[_tokenId];</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  function _transfer(address _from, address _to, uint256 _tokenId) private &#123;</span><br><span class="line">    ownerZombieCount[_to] = ownerZombieCount[_to].add(1);</span><br><span class="line">    ownerZombieCount[msg.sender] = ownerZombieCount[msg.sender].sub(1);</span><br><span class="line">    zombieToOwner[_tokenId] = _to;</span><br><span class="line">    Transfer(_from, _to, _tokenId);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  function transfer(address _to, uint256 _tokenId) public onlyOwnerOf(_tokenId) &#123;</span><br><span class="line">    _transfer(msg.sender, _to, _tokenId);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  function approve(address _to, uint256 _tokenId) public onlyOwnerOf(_tokenId) &#123;</span><br><span class="line">    zombieApprovals[_tokenId] = _to;</span><br><span class="line">    Approval(msg.sender, _to, _tokenId);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  function takeOwnership(uint256 _tokenId) public &#123;</span><br><span class="line">    require(zombieApprovals[_tokenId] == msg.sender);</span><br><span class="line">    address owner = ownerOf(_tokenId);</span><br><span class="line">    _transfer(owner, msg.sender, _tokenId);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><strong>zombieattack.sol:</strong></p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">pragma solidity ^0.4.19;</span><br><span class="line"></span><br><span class="line">import &quot;./zombiehelper.sol&quot;;</span><br><span class="line"></span><br><span class="line">contract ZombieBattle is ZombieHelper &#123;</span><br><span class="line">  uint randNonce = 0;</span><br><span class="line">  uint attackVictoryProbability = 70;</span><br><span class="line"></span><br><span class="line">  function randMod(uint _modulus) internal returns(uint) &#123;</span><br><span class="line">    randNonce++;</span><br><span class="line">    return uint(keccak256(now, msg.sender, randNonce)) % _modulus;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  function attack(uint _zombieId, uint _targetId) external onlyOwnerOf(_zombieId) &#123;</span><br><span class="line">    Zombie storage myZombie = zombies[_zombieId];</span><br><span class="line">    Zombie storage enemyZombie = zombies[_targetId];</span><br><span class="line">    uint rand = randMod(100);</span><br><span class="line">    if (rand &lt;= attackVictoryProbability) &#123;</span><br><span class="line">      myZombie.winCount++;</span><br><span class="line">      myZombie.level++;</span><br><span class="line">      enemyZombie.lossCount++;</span><br><span class="line">      feedAndMultiply(_zombieId, enemyZombie.dna, &quot;zombie&quot;);</span><br><span class="line">    &#125; else &#123;</span><br><span class="line">      myZombie.lossCount++;</span><br><span class="line">      enemyZombie.winCount++;</span><br><span class="line">      _triggerCooldown(myZombie);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><strong>zombiehelper.sol:</strong></p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">pragma solidity ^0.4.19;</span><br><span class="line"></span><br><span class="line">import &quot;./zombiefeeding.sol&quot;;</span><br><span class="line"></span><br><span class="line">contract ZombieHelper is ZombieFeeding &#123;</span><br><span class="line"></span><br><span class="line">  uint levelUpFee = 0.001 ether;</span><br><span class="line"></span><br><span class="line">  modifier aboveLevel(uint _level, uint _zombieId) &#123;</span><br><span class="line">    require(zombies[_zombieId].level &gt;= _level);</span><br><span class="line">    _;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  function withdraw() external onlyOwner &#123;</span><br><span class="line">    owner.transfer(this.balance);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  function setLevelUpFee(uint _fee) external onlyOwner &#123;</span><br><span class="line">    levelUpFee = _fee;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  function levelUp(uint _zombieId) external payable &#123;</span><br><span class="line">    require(msg.value == levelUpFee);</span><br><span class="line">    zombies[_zombieId].level++;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  function changeName(uint _zombieId, string _newName) external aboveLevel(2, _zombieId) onlyOwnerOf(_zombieId) &#123;</span><br><span class="line">    zombies[_zombieId].name = _newName;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  function changeDna(uint _zombieId, uint _newDna) external aboveLevel(20, _zombieId) onlyOwnerOf(_zombieId) &#123;</span><br><span class="line">    zombies[_zombieId].dna = _newDna;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  function getZombiesByOwner(address _owner) external view returns(uint[]) &#123;</span><br><span class="line">    uint[] memory result = new uint[](ownerZombieCount[_owner]);</span><br><span class="line">    uint counter = 0;</span><br><span class="line">    for (uint i = 0; i &lt; zombies.length; i++) &#123;</span><br><span class="line">      if (zombieToOwner[i] == _owner) &#123;</span><br><span class="line">        result[counter] = i;</span><br><span class="line">        counter++;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    return result;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><strong>zombiefeeding.sol:</strong></p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">pragma solidity ^0.4.19;</span><br><span class="line"></span><br><span class="line">import &quot;./zombiefactory.sol&quot;;</span><br><span class="line"></span><br><span class="line">contract KittyInterface &#123;</span><br><span class="line">  function getKitty(uint256 _id) external view returns (</span><br><span class="line">    bool isGestating,</span><br><span class="line">    bool isReady,</span><br><span class="line">    uint256 cooldownIndex,</span><br><span class="line">    uint256 nextActionAt,</span><br><span class="line">    uint256 siringWithId,</span><br><span class="line">    uint256 birthTime,</span><br><span class="line">    uint256 matronId,</span><br><span class="line">    uint256 sireId,</span><br><span class="line">    uint256 generation,</span><br><span class="line">    uint256 genes</span><br><span class="line">  );</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">contract ZombieFeeding is ZombieFactory &#123;</span><br><span class="line"></span><br><span class="line">  KittyInterface kittyContract;</span><br><span class="line"></span><br><span class="line">  modifier onlyOwnerOf(uint _zombieId) &#123;</span><br><span class="line">    require(msg.sender == zombieToOwner[_zombieId]);</span><br><span class="line">    _;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  function setKittyContractAddress(address _address) external onlyOwner &#123;</span><br><span class="line">    kittyContract = KittyInterface(_address);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  function _triggerCooldown(Zombie storage _zombie) internal &#123;</span><br><span class="line">    _zombie.readyTime = uint32(now + cooldownTime);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  function _isReady(Zombie storage _zombie) internal view returns (bool) &#123;</span><br><span class="line">      return (_zombie.readyTime &lt;= now);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  function feedAndMultiply(uint _zombieId, uint _targetDna, string _species) internal onlyOwnerOf(_zombieId) &#123;</span><br><span class="line">    Zombie storage myZombie = zombies[_zombieId];</span><br><span class="line">    require(_isReady(myZombie));</span><br><span class="line">    _targetDna = _targetDna % dnaModulus;</span><br><span class="line">    uint newDna = (myZombie.dna + _targetDna) / 2;</span><br><span class="line">    if (keccak256(_species) == keccak256(&quot;kitty&quot;)) &#123;</span><br><span class="line">      newDna = newDna - newDna % 100 + 99;</span><br><span class="line">    &#125;</span><br><span class="line">    _createZombie(&quot;NoName&quot;, newDna);</span><br><span class="line">    _triggerCooldown(myZombie);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  function feedOnKitty(uint _zombieId, uint _kittyId) public &#123;</span><br><span class="line">    uint kittyDna;</span><br><span class="line">    (,,,,,,,,,kittyDna) = kittyContract.getKitty(_kittyId);</span><br><span class="line">    feedAndMultiply(_zombieId, kittyDna, &quot;kitty&quot;);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><strong>zombiefactory.sol:</strong></p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">pragma solidity ^0.4.19;</span><br><span class="line"></span><br><span class="line">import &quot;./ownable.sol&quot;;</span><br><span class="line">import &quot;./safemath.sol&quot;;</span><br><span class="line"></span><br><span class="line">contract ZombieFactory is Ownable &#123;</span><br><span class="line"></span><br><span class="line">  using SafeMath for uint256;</span><br><span class="line"></span><br><span class="line">  event NewZombie(uint zombieId, string name, uint dna);</span><br><span class="line"></span><br><span class="line">  uint dnaDigits = 16;</span><br><span class="line">  uint dnaModulus = 10 ** dnaDigits;</span><br><span class="line">  uint cooldownTime = 1 days;</span><br><span class="line"></span><br><span class="line">  struct Zombie &#123;</span><br><span class="line">    string name;</span><br><span class="line">    uint dna;</span><br><span class="line">    uint32 level;</span><br><span class="line">    uint32 readyTime;</span><br><span class="line">    uint16 winCount;</span><br><span class="line">    uint16 lossCount;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  Zombie[] public zombies;</span><br><span class="line"></span><br><span class="line">  mapping (uint =&gt; address) public zombieToOwner;</span><br><span class="line">  mapping (address =&gt; uint) ownerZombieCount;</span><br><span class="line"></span><br><span class="line">  function _createZombie(string _name, uint _dna) internal &#123;</span><br><span class="line">    uint id = zombies.push(Zombie(_name, _dna, 1, uint32(now + cooldownTime), 0, 0)) - 1;</span><br><span class="line">    zombieToOwner[id] = msg.sender;</span><br><span class="line">    ownerZombieCount[msg.sender]++;</span><br><span class="line">    NewZombie(id, _name, _dna);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  function _generateRandomDna(string _str) private view returns (uint) &#123;</span><br><span class="line">    uint rand = uint(keccak256(_str));</span><br><span class="line">    return rand % dnaModulus;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  function createRandomZombie(string _name) public &#123;</span><br><span class="line">    require(ownerZombieCount[msg.sender] == 0);</span><br><span class="line">    uint randDna = _generateRandomDna(_name);</span><br><span class="line">    randDna = randDna - randDna % 100;</span><br><span class="line">    _createZombie(_name, randDna);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><strong>ownable.sol:</strong></p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">pragma solidity ^0.4.19;</span><br><span class="line">/**</span><br><span class="line"> * @title Ownable</span><br><span class="line"> * @dev The Ownable contract has an owner address, and provides basic authorization control</span><br><span class="line"> * functions, this simplifies the implementation of &quot;user permissions&quot;.</span><br><span class="line"> */</span><br><span class="line">contract Ownable &#123;</span><br><span class="line">  address public owner;</span><br><span class="line"></span><br><span class="line">  event OwnershipTransferred(address indexed previousOwner, address indexed newOwner);</span><br><span class="line"></span><br><span class="line">  /**</span><br><span class="line">   * @dev The Ownable constructor sets the original `owner` of the contract to the sender</span><br><span class="line">   * account.</span><br><span class="line">   */</span><br><span class="line">  function Ownable() public &#123;</span><br><span class="line">    owner = msg.sender;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">  /**</span><br><span class="line">   * @dev Throws if called by any account other than the owner.</span><br><span class="line">   */</span><br><span class="line">  modifier onlyOwner() &#123;</span><br><span class="line">    require(msg.sender == owner);</span><br><span class="line">    _;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">  /**</span><br><span class="line">   * @dev Allows the current owner to transfer control of the contract to a newOwner.</span><br><span class="line">   * @param newOwner The address to transfer ownership to.</span><br><span class="line">   */</span><br><span class="line">  function transferOwnership(address newOwner) public onlyOwner &#123;</span><br><span class="line">    require(newOwner != address(0));</span><br><span class="line">    OwnershipTransferred(owner, newOwner);</span><br><span class="line">    owner = newOwner;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><strong>safemath.sol:</strong></p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">pragma solidity ^0.4.18;</span><br><span class="line"></span><br><span class="line">/**</span><br><span class="line"> * @title SafeMath</span><br><span class="line"> * @dev Math operations with safety checks that throw on error</span><br><span class="line"> */</span><br><span class="line">library SafeMath &#123;</span><br><span class="line"></span><br><span class="line">  /**</span><br><span class="line">  * @dev Multiplies two numbers, throws on overflow.</span><br><span class="line">  */</span><br><span class="line">  function mul(uint256 a, uint256 b) internal pure returns (uint256) &#123;</span><br><span class="line">    if (a == 0) &#123;</span><br><span class="line">      return 0;</span><br><span class="line">    &#125;</span><br><span class="line">    uint256 c = a * b;</span><br><span class="line">    assert(c / a == b);</span><br><span class="line">    return c;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  /**</span><br><span class="line">  * @dev Integer division of two numbers, truncating the quotient.</span><br><span class="line">  */</span><br><span class="line">  function div(uint256 a, uint256 b) internal pure returns (uint256) &#123;</span><br><span class="line">    // assert(b &gt; 0); // Solidity automatically throws when dividing by 0</span><br><span class="line">    uint256 c = a / b;</span><br><span class="line">    // assert(a == b * c + a % b); // There is no case in which this doesn&#x27;t hold</span><br><span class="line">    return c;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  /**</span><br><span class="line">  * @dev Substracts two numbers, throws on overflow (i.e. if subtrahend is greater than minuend).</span><br><span class="line">  */</span><br><span class="line">  function sub(uint256 a, uint256 b) internal pure returns (uint256) &#123;</span><br><span class="line">    assert(b &lt;= a);</span><br><span class="line">    return a - b;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  /**</span><br><span class="line">  * @dev Adds two numbers, throws on overflow.</span><br><span class="line">  */</span><br><span class="line">  function add(uint256 a, uint256 b) internal pure returns (uint256) &#123;</span><br><span class="line">    uint256 c = a + b;</span><br><span class="line">    assert(c &gt;= a);</span><br><span class="line">    return c;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><strong>erc721.sol:</strong></p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">pragma solidity ^0.4.19;</span><br><span class="line">contract ERC721 &#123;</span><br><span class="line">  event Transfer(address indexed _from, address indexed _to, uint256 _tokenId);</span><br><span class="line">  event Approval(address indexed _owner, address indexed _approved, uint256 _tokenId);</span><br><span class="line"></span><br><span class="line">  function balanceOf(address _owner) public view returns (uint256 _balance);</span><br><span class="line">  function ownerOf(uint256 _tokenId) public view returns (address _owner);</span><br><span class="line">  function transfer(address _to, uint256 _tokenId) public;</span><br><span class="line">  function approve(address _to, uint256 _tokenId) public;</span><br><span class="line">  function takeOwnership(uint256 _tokenId) public;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<hr>
<h3 id="å¿ƒå¾—"><a href="#å¿ƒå¾—" class="headerlink" title="å¿ƒå¾—"></a>å¿ƒå¾—</h3><h4 id="â‘ "><a href="#â‘ " class="headerlink" title="â‘ "></a>â‘ </h4>
  </div>
</article>



        
          <div id="footer-post-container">
  <div id="footer-post">

    <div id="nav-footer" style="display: none">
      <ul>
        
          <li><a href="/">Home</a></li>
        
          <li><a href="/about/">About</a></li>
        
          <li><a href="/search/">Search</a></li>
        
          <li><a href="/archives/">Writing</a></li>
        
          <li><a target="_blank" rel="noopener" href="http://github.com/probberechts">Projects</a></li>
        
      </ul>
    </div>

    <div id="toc-footer" style="display: none">
      <ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#%E4%B8%89%E5%8F%B6%E8%8D%89%E5%AE%9E%E9%AA%8C%E5%AE%A4%E2%80%9C%E6%9C%9F%E6%9C%AB%E4%BB%BB%E5%8A%A1%E2%80%9D%E6%80%BB%E7%BB%93%EF%BC%88%E7%BB%AD%EF%BC%89-%E7%AC%AC%E4%BA%94%E8%AF%BE"><span class="toc-number">1.</span> <span class="toc-text">ä¸‰å¶è‰å®éªŒå®¤â€œæœŸæœ«ä»»åŠ¡â€æ€»ç»“ï¼ˆç»­ï¼‰(ç¬¬äº”è¯¾)</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BB%BB%E5%8A%A1%E4%B8%80%EF%BC%9A%E5%AE%8C%E6%88%90%E5%8A%A0%E5%AF%86%E5%83%B5%E5%B0%B8%E7%9A%84%E6%B8%B8%E6%88%8F"><span class="toc-number">1.1.</span> <span class="toc-text">ä»»åŠ¡ä¸€ï¼šå®ŒæˆåŠ å¯†åƒµå°¸çš„æ¸¸æˆ</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#5-ERC721%E6%A0%87%E5%87%86%E5%92%8C%E5%8A%A0%E5%AF%86%E6%94%B6%E8%97%8F%E5%93%81"><span class="toc-number">1.1.1.</span> <span class="toc-text">5.ERC721æ ‡å‡†å’ŒåŠ å¯†æ”¶è—å“</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E2%91%A0%E4%BB%A5%E5%A4%AA%E5%9D%8A%E4%B8%8A%E7%9A%84%E4%BB%A3%E5%B8%81"><span class="toc-number">1.1.1.1.</span> <span class="toc-text">â‘ ä»¥å¤ªåŠä¸Šçš„ä»£å¸</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E2%91%A1ERC721-%E6%A0%87%E5%87%86-%E5%A4%9A%E9%87%8D%E7%BB%A7%E6%89%BF"><span class="toc-number">1.1.1.2.</span> <span class="toc-text">â‘¡ERC721 æ ‡å‡†, å¤šé‡ç»§æ‰¿</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E2%91%A2balanceOf-%E5%92%8C-ownerOf"><span class="toc-number">1.1.1.3.</span> <span class="toc-text">â‘¢balanceOf å’Œ ownerOf</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E2%91%A3%E9%87%8D%E6%9E%84"><span class="toc-number">1.1.1.4.</span> <span class="toc-text">â‘£é‡æ„</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E2%91%A4ERC721-%E8%BD%AC%E7%A7%BB%E6%A0%87%E5%87%86"><span class="toc-number">1.1.1.5.</span> <span class="toc-text">â‘¤ERC721: è½¬ç§»æ ‡å‡†</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E2%91%A5ERC721-%E8%BD%AC%E7%A7%BB-%E7%BB%AD"><span class="toc-number">1.1.1.6.</span> <span class="toc-text">â‘¥ERC721: è½¬ç§»-ç»­</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E2%91%A6ERC721-%E6%89%B9%E5%87%86"><span class="toc-number">1.1.1.7.</span> <span class="toc-text">â‘¦ERC721: æ‰¹å‡†</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E2%91%A7ERC721-takeOwnership"><span class="toc-number">1.1.1.8.</span> <span class="toc-text">â‘§ERC721: takeOwnership</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E2%91%A8%E9%A2%84%E9%98%B2%E6%BA%A2%E5%87%BA"><span class="toc-number">1.1.1.9.</span> <span class="toc-text">â‘¨é¢„é˜²æº¢å‡º</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E2%91%A9SafeMath%E7%AC%AC%E4%BA%8C%E9%83%A8%E5%88%86"><span class="toc-number">1.1.1.10.</span> <span class="toc-text">â‘©SafeMathç¬¬äºŒéƒ¨åˆ†</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E2%91%AASafeMath-%E7%AC%AC%E4%B8%89%E9%83%A8%E5%88%86"><span class="toc-number">1.1.1.11.</span> <span class="toc-text">â‘ªSafeMath ç¬¬ä¸‰éƒ¨åˆ†</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E2%91%ABSafeMath-%E7%AC%AC4%E9%83%A8%E5%88%86"><span class="toc-number">1.1.1.12.</span> <span class="toc-text">â‘«SafeMath ç¬¬4éƒ¨åˆ†</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E2%91%AC%E6%B3%A8%E9%87%8A"><span class="toc-number">1.1.1.13.</span> <span class="toc-text">â‘¬æ³¨é‡Š</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E2%91%AD%E6%94%BE%E5%9C%A8%E4%B8%80%E8%B5%B7"><span class="toc-number">1.1.1.14.</span> <span class="toc-text">â‘­æ”¾åœ¨ä¸€èµ·</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E2%91%AE%E7%AC%AC%E4%BA%94%E8%AF%BE%E5%AE%8C%E6%88%90"><span class="toc-number">1.1.1.15.</span> <span class="toc-text">â‘®ç¬¬äº”è¯¾å®Œæˆ</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%BF%83%E5%BE%97"><span class="toc-number">1.1.2.</span> <span class="toc-text">å¿ƒå¾—</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E2%91%A0"><span class="toc-number">1.1.2.1.</span> <span class="toc-text">â‘ </span></a></li></ol></li></ol></li></ol></li></ol>
    </div>

    <div id="share-footer" style="display: none">
      <ul>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.facebook.com/sharer.php?u=https://formikasaever.github.io./post/e9c8726a.html"><i class="fab fa-facebook fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://twitter.com/share?url=https://formikasaever.github.io./post/e9c8726a.html&text=åƒµå°¸æ¸¸æˆç¬¬äº”è¯¾"><i class="fab fa-twitter fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.linkedin.com/shareArticle?url=https://formikasaever.github.io./post/e9c8726a.html&title=åƒµå°¸æ¸¸æˆç¬¬äº”è¯¾"><i class="fab fa-linkedin fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://pinterest.com/pin/create/bookmarklet/?url=https://formikasaever.github.io./post/e9c8726a.html&is_video=false&description=åƒµå°¸æ¸¸æˆç¬¬äº”è¯¾"><i class="fab fa-pinterest fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="mailto:?subject=åƒµå°¸æ¸¸æˆç¬¬äº”è¯¾&body=Check out this article: https://formikasaever.github.io./post/e9c8726a.html"><i class="fa-solid fa-envelope fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://getpocket.com/save?url=https://formikasaever.github.io./post/e9c8726a.html&title=åƒµå°¸æ¸¸æˆç¬¬äº”è¯¾"><i class="fab fa-get-pocket fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://reddit.com/submit?url=https://formikasaever.github.io./post/e9c8726a.html&title=åƒµå°¸æ¸¸æˆç¬¬äº”è¯¾"><i class="fab fa-reddit fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.stumbleupon.com/submit?url=https://formikasaever.github.io./post/e9c8726a.html&title=åƒµå°¸æ¸¸æˆç¬¬äº”è¯¾"><i class="fab fa-stumbleupon fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://digg.com/submit?url=https://formikasaever.github.io./post/e9c8726a.html&title=åƒµå°¸æ¸¸æˆç¬¬äº”è¯¾"><i class="fab fa-digg fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.tumblr.com/share/link?url=https://formikasaever.github.io./post/e9c8726a.html&name=åƒµå°¸æ¸¸æˆç¬¬äº”è¯¾&description="><i class="fab fa-tumblr fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://news.ycombinator.com/submitlink?u=https://formikasaever.github.io./post/e9c8726a.html&t=åƒµå°¸æ¸¸æˆç¬¬äº”è¯¾"><i class="fab fa-hacker-news fa-lg" aria-hidden="true"></i></a></li>
</ul>

    </div>

    <div id="actions-footer">
        <a id="menu" class="icon" href="#" onclick="$('#nav-footer').toggle();return false;"><i class="fa-solid fa-bars fa-lg" aria-hidden="true"></i> Menu</a>
        <a id="toc" class="icon" href="#" onclick="$('#toc-footer').toggle();return false;"><i class="fa-solid fa-list fa-lg" aria-hidden="true"></i> TOC</a>
        <a id="share" class="icon" href="#" onclick="$('#share-footer').toggle();return false;"><i class="fa-solid fa-share-alt fa-lg" aria-hidden="true"></i> Share</a>
        <a id="top" style="display:none" class="icon" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');"><i class="fa-solid fa-chevron-up fa-lg" aria-hidden="true"></i> Top</a>
    </div>

  </div>
</div>

        
        <footer id="footer">
  <div class="footer-left">
    Copyright &copy;
    
    
    2023
    ForMikasaEver
  </div>
  <div class="footer-right">
    <nav>
      <ul>
        <!--
       --><li><a href="/">Home</a></li><!--
     --><!--
       --><li><a href="/about/">About</a></li><!--
     --><!--
       --><li><a href="/search/">Search</a></li><!--
     --><!--
       --><li><a href="/archives/">Writing</a></li><!--
     --><!--
       --><li><a target="_blank" rel="noopener" href="http://github.com/probberechts">Projects</a></li><!--
     -->
      </ul>
    </nav>
  </div>
</footer>

    </div>
    <!-- styles -->



  <link rel="preload" as="style" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" crossorigin="anonymous" onload="this.onload=null;this.rel='stylesheet'"/>


    <!-- jquery -->

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.0/jquery.min.js" crossorigin="anonymous"></script>




<!-- clipboard -->

  
    <script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.7/clipboard.min.js" crossorigin="anonymous"></script>
  
  <script type="text/javascript">
  $(function() {
    // copy-btn HTML
    var btn = "<span class=\"btn-copy tooltipped tooltipped-sw\" aria-label=\"Copy to clipboard!\">";
    btn += '<i class="fa-regular fa-clone"></i>';
    btn += '</span>';
    // mount it!
    $(".highlight table").before(btn);
    var clip = new ClipboardJS('.btn-copy', {
      text: function(trigger) {
        return Array.from(trigger.nextElementSibling.querySelectorAll('.code')).reduce((str,it)=>str+it.innerText+'\n','')
      }
    });
    clip.on('success', function(e) {
      e.trigger.setAttribute('aria-label', "Copied!");
      e.clearSelection();
    })
  })
  </script>


<script src="/js/main.js"></script>

<!-- search -->

<!-- Baidu Analytics -->

<!-- Cloudflare Analytics -->

<!-- Disqus Comments -->

<!-- utterances Comments -->


        <style>
            [bg-lazy] {
                background-image: none !important;
                background-color: #eee !important;
            }
        </style>
        <script>
            window.imageLazyLoadSetting = {
                isSPA: false,
                preloadRatio: 1,
                processImages: null,
            };
        </script><script>window.addEventListener("load",function(){var t=/\.(gif|jpg|jpeg|tiff|png)$/i,r=/^data:image\/[a-z]+;base64,/;Array.prototype.slice.call(document.querySelectorAll("img[data-original]")).forEach(function(a){var e=a.parentNode;"A"===e.tagName&&(e.href.match(t)||e.href.match(r))&&(e.href=a.dataset.original)})});</script><script>!function(r){r.imageLazyLoadSetting.processImages=t;var e=r.imageLazyLoadSetting.isSPA,n=r.imageLazyLoadSetting.preloadRatio||1,c=a();function a(){var t=Array.prototype.slice.call(document.querySelectorAll("img[data-original]")),e=Array.prototype.slice.call(document.querySelectorAll("[bg-lazy]"));return t.concat(e)}function t(){e&&(c=a());for(var t,o=0;o<c.length;o++)0<=(t=(t=c[o]).getBoundingClientRect()).bottom&&0<=t.left&&t.top<=(r.innerHeight*n||document.documentElement.clientHeight*n)&&function(){var t,e,n,a,i=c[o];e=function(){c=c.filter(function(t){return i!==t}),r.imageLazyLoadSetting.onImageLoaded&&r.imageLazyLoadSetting.onImageLoaded(i)},(t=i).hasAttribute("bg-lazy")?(t.removeAttribute("bg-lazy"),e&&e()):(n=new Image,a=t.getAttribute("data-original"),n.onload=function(){t.src=a,t.removeAttribute("data-original"),e&&e()},t.src!==a&&(n.src=a))}()}function i(){clearTimeout(t.tId),t.tId=setTimeout(t,500)}t(),document.addEventListener("scroll",i),r.addEventListener("resize",i),r.addEventListener("orientationchange",i)}(this);</script></body>
</html>

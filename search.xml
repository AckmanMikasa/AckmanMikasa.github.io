<?xml version="1.0" encoding="utf-8"?>
<search> 
  
  
    
    <entry>
      <title>åƒµå°¸æ¸¸æˆç¬¬ä¸€è¯¾</title>
      <link href="/post/4c73e1c2.html"/>
      <url>/post/4c73e1c2.html</url>
      
        <content type="html"><![CDATA[<h1 id="pdfæ–‡ä»¶"><a href="#pdfæ–‡ä»¶" class="headerlink" title="pdfæ–‡ä»¶"></a>pdfæ–‡ä»¶</h1><p><a href="https://formikasaever.github.io/pdf/%E4%B8%89%E5%8F%B6%E8%8D%89%E5%AE%9E%E9%AA%8C%E5%AE%A4%E2%80%9C%E6%9C%9F%E6%9C%AB%E4%BB%BB%E5%8A%A1%E2%80%9D%E4%BB%BB%E5%8A%A1%E4%B8%80%EF%BC%88%E7%AC%AC%E4%B8%80%E8%AF%BE%EF%BC%89.pdf">https://formikasaever.github.io/pdf/%E4%B8%89%E5%8F%B6%E8%8D%89%E5%AE%9E%E9%AA%8C%E5%AE%A4%E2%80%9C%E6%9C%9F%E6%9C%AB%E4%BB%BB%E5%8A%A1%E2%80%9D%E4%BB%BB%E5%8A%A1%E4%B8%80%EF%BC%88%E7%AC%AC%E4%B8%80%E8%AF%BE%EF%BC%89.pdf</a></p>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>åƒµå°¸æ¸¸æˆç¬¬å…­è¯¾</title>
      <link href="/post/8cc639b3.html"/>
      <url>/post/8cc639b3.html</url>
      
        <content type="html"><![CDATA[<h1 id="ä¸‰å¶è‰å®éªŒå®¤â€œæœŸæœ«ä»»åŠ¡â€ä»»åŠ¡ä¸€-ç¬¬å…­è¯¾"><a href="#ä¸‰å¶è‰å®éªŒå®¤â€œæœŸæœ«ä»»åŠ¡â€ä»»åŠ¡ä¸€-ç¬¬å…­è¯¾" class="headerlink" title="ä¸‰å¶è‰å®éªŒå®¤â€œæœŸæœ«ä»»åŠ¡â€ä»»åŠ¡ä¸€(ç¬¬å…­è¯¾)"></a>ä¸‰å¶è‰å®éªŒå®¤â€œæœŸæœ«ä»»åŠ¡â€ä»»åŠ¡ä¸€(ç¬¬å…­è¯¾)</h1><h2 id="ä»»åŠ¡ä¸€ï¼šå®ŒæˆåŠ å¯†åƒµå°¸çš„æ¸¸æˆ"><a href="#ä»»åŠ¡ä¸€ï¼šå®ŒæˆåŠ å¯†åƒµå°¸çš„æ¸¸æˆ" class="headerlink" title="ä»»åŠ¡ä¸€ï¼šå®ŒæˆåŠ å¯†åƒµå°¸çš„æ¸¸æˆ"></a>ä»»åŠ¡ä¸€ï¼šå®ŒæˆåŠ å¯†åƒµå°¸çš„æ¸¸æˆ</h2><h3 id="6-åº”ç”¨å‰ç«¯å’ŒWeb3-js"><a href="#6-åº”ç”¨å‰ç«¯å’ŒWeb3-js" class="headerlink" title="6.åº”ç”¨å‰ç«¯å’ŒWeb3.js"></a>6.åº”ç”¨å‰ç«¯å’ŒWeb3.js</h3><h4 id="â‘ ä»‹ç»-Web3-js"><a href="#â‘ ä»‹ç»-Web3-js" class="headerlink" title="â‘ ä»‹ç» Web3.js"></a>â‘ ä»‹ç» Web3.js</h4><p>å®Œæˆç¬¬äº”è¯¾ä»¥åï¼Œæˆ‘ä»¬çš„åƒµå°¸ DApp çš„ Solidity åˆçº¦éƒ¨åˆ†å°±å®Œæˆäº†ã€‚ç°åœ¨æˆ‘ä»¬æ¥åšä¸€ä¸ªåŸºæœ¬çš„ç½‘é¡µå¥½è®©ä½ çš„ç”¨æˆ·èƒ½ç©å®ƒã€‚ è¦åšåˆ°è¿™ä¸€ç‚¹ï¼Œæˆ‘ä»¬å°†ä½¿ç”¨ä»¥å¤ªåŠåŸºé‡‘å‘å¸ƒçš„ JavaScript åº“ â€”â€” <code>Web3.js.</code></p><p><strong>ä»€ä¹ˆæ˜¯ Web3.js?</strong></p><p>è¿˜è®°å¾—ä¹ˆï¼Ÿä»¥å¤ªåŠç½‘ç»œæ˜¯ç”±èŠ‚ç‚¹ç»„æˆçš„ï¼Œæ¯ä¸€ä¸ªèŠ‚ç‚¹éƒ½åŒ…å«äº†åŒºå—é“¾çš„ä¸€ä»½æ‹·è´ã€‚å½“ä½ æƒ³è¦è°ƒç”¨ä¸€ä»½æ™ºèƒ½åˆçº¦çš„ä¸€ä¸ªæ–¹æ³•ï¼Œä½ éœ€è¦ä»å…¶ä¸­ä¸€ä¸ªèŠ‚ç‚¹ä¸­æŸ¥æ‰¾å¹¶å‘Šè¯‰å®ƒ:</p><ol><li>æ™ºèƒ½åˆçº¦çš„åœ°å€</li><li>ä½ æƒ³è°ƒç”¨çš„æ–¹æ³•ï¼Œä»¥åŠ</li><li>ä½ æƒ³ä¼ å…¥é‚£ä¸ªæ–¹æ³•çš„å‚æ•°</li></ol><p>ä»¥å¤ªåŠèŠ‚ç‚¹åªèƒ½è¯†åˆ«ä¸€ç§å«åš <code>JSON-RPC</code> çš„è¯­è¨€ã€‚è¿™ç§è¯­è¨€ç›´æ¥è¯»èµ·æ¥å¹¶ä¸å¥½æ‡‚ã€‚å½“ä½ ä½ æƒ³è°ƒç”¨ä¸€ä¸ªåˆçº¦çš„æ–¹æ³•çš„æ—¶å€™ï¼Œéœ€è¦å‘é€çš„æŸ¥è¯¢è¯­å¥å°†ä¼šæ˜¯è¿™æ ·çš„ï¼š</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">// å“ˆâ€¦â€¦ç¥ä½ å†™æ‰€æœ‰è¿™æ ·çš„å‡½æ•°è°ƒç”¨çš„æ—¶å€™éƒ½ä¸€æ¬¡é€šè¿‡</span><br><span class="line">// å¾€å³è¾¹æ‹‰â€¦â€¦ ==&gt;</span><br><span class="line">&#123;&quot;jsonrpc&quot;:&quot;2.0&quot;,&quot;method&quot;:&quot;eth_sendTransaction&quot;,&quot;params&quot;:[&#123;&quot;from&quot;:&quot;0xb60e8dd61c5d32be8058bb8eb970870f07233155&quot;,&quot;to&quot;:&quot;0xd46e8dd67c5d32be8058bb8eb970870f07244567&quot;,&quot;gas&quot;:&quot;0x76c0&quot;,&quot;gasPrice&quot;:&quot;0x9184e72a000&quot;,&quot;value&quot;:&quot;0x9184e72a&quot;,&quot;data&quot;:&quot;0xd46e8dd67c5d32be8d46e8dd67c5d32be8058bb8eb970870f072445675058bb8eb970870f072445675&quot;&#125;],&quot;id&quot;:1&#125;</span><br></pre></td></tr></table></figure><p>å¹¸è¿çš„æ˜¯ Web3.js æŠŠè¿™äº›ä»¤äººè®¨åŒçš„æŸ¥è¯¢è¯­å¥éƒ½éšè—èµ·æ¥äº†ï¼Œ æ‰€ä»¥ä½ åªéœ€è¦ä¸æ–¹ä¾¿æ˜“æ‡‚çš„ JavaScript ç•Œé¢è¿›è¡Œäº¤äº’å³å¯ã€‚</p><p>ä½ ä¸éœ€è¦æ„å»ºä¸Šé¢çš„æŸ¥è¯¢è¯­å¥ï¼Œåœ¨ä½ çš„ä»£ç ä¸­è°ƒç”¨ä¸€ä¸ªå‡½æ•°çœ‹èµ·æ¥å°†æ˜¯è¿™æ ·ï¼š</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">CryptoZombies.methods.createRandomZombie(&quot;Vitalik Nakamoto ğŸ¤”&quot;)</span><br><span class="line">  .send(&#123; from: &quot;0xb60e8dd61c5d32be8058bb8eb970870f07233155&quot;, gas: &quot;3000000&quot; &#125;)</span><br></pre></td></tr></table></figure><p>æˆ‘ä»¬å°†åœ¨æ¥ä¸‹æ¥çš„å‡ ç« è¯¦ç»†è§£é‡Šè¿™äº›è¯­å¥ï¼Œä¸è¿‡é¦–å…ˆæˆ‘ä»¬æ¥æŠŠ Web3.js ç¯å¢ƒæ­å»ºèµ·æ¥ã€‚</p><p><strong>å‡†å¤‡å¥½äº†ä¹ˆï¼Ÿ</strong><br>å–å†³äºä½ çš„é¡¹ç›®å·¥ä½œæµç¨‹å’Œä½ çš„çˆ±å¥½ï¼Œä½ å¯ä»¥ç”¨ä¸€äº›å¸¸ç”¨å·¥å…·æŠŠ Web3.js æ·»åŠ è¿›æ¥ï¼š</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">// ç”¨ NPM</span><br><span class="line">npm install web3</span><br><span class="line"></span><br><span class="line">// ç”¨ Yarn</span><br><span class="line">yarn add web3</span><br><span class="line"></span><br><span class="line">// ç”¨ Bower</span><br><span class="line">bower install web3</span><br><span class="line"></span><br><span class="line">// ...æˆ–è€…å…¶ä»–ã€‚</span><br></pre></td></tr></table></figure><p>ç”šè‡³ï¼Œä½ å¯ä»¥ä» <code>github</code> ç›´æ¥ä¸‹è½½å‹ç¼©åçš„ <code>.js </code>æ–‡ä»¶ ç„¶ååŒ…å«åˆ°ä½ çš„é¡¹ç›®æ–‡ä»¶ä¸­ï¼š</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">&lt;script language=&quot;javascript&quot; type=&quot;text/javascript&quot; src=&quot;web3.min.js&quot;&gt;&lt;/script&gt;</span><br></pre></td></tr></table></figure><p>å› ä¸ºæˆ‘ä»¬ä¸æƒ³è®©ä½ èŠ±å¤ªå¤šåœ¨é¡¹ç›®ç¯å¢ƒæ­å»ºä¸Šï¼Œåœ¨æœ¬æ•™ç¨‹ä¸­æˆ‘ä»¬å°†ä½¿ç”¨ä¸Šé¢çš„ <code>script</code> æ ‡ç­¾æ¥å°† Web3.js å¼•å…¥ã€‚</p><p>å®æˆ˜æ¼”ä¹ ï¼š<br><strong>index.html:</strong></p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">&lt;!DOCTYPE html&gt;</span><br><span class="line">&lt;html lang=&quot;en&quot;&gt;</span><br><span class="line">  &lt;head&gt;</span><br><span class="line">    &lt;meta charset=&quot;UTF-8&quot;&gt;</span><br><span class="line">    &lt;title&gt;CryptoZombies front-end&lt;/title&gt;</span><br><span class="line">    &lt;script language=&quot;javascript&quot; type=&quot;text/javascript&quot; src=&quot;https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js&quot;&gt;&lt;/script&gt;</span><br><span class="line">    &lt;script language=&quot;javascript&quot; type=&quot;text/javascript&quot; src=&quot;web3.min.js&quot;&gt;&lt;/script&gt;</span><br><span class="line">  &lt;/head&gt;</span><br><span class="line">  &lt;body&gt;</span><br><span class="line"></span><br><span class="line">  &lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure><h4 id="â‘¡Web3-æä¾›è€…"><a href="#â‘¡Web3-æä¾›è€…" class="headerlink" title="â‘¡Web3 æä¾›è€…"></a>â‘¡Web3 æä¾›è€…</h4><hr><h3 id="å¿ƒå¾—"><a href="#å¿ƒå¾—" class="headerlink" title="å¿ƒå¾—"></a>å¿ƒå¾—</h3><h4 id="â‘ "><a href="#â‘ " class="headerlink" title="â‘ "></a>â‘ </h4>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>åƒµå°¸æ¸¸æˆç¬¬äº”è¯¾</title>
      <link href="/post/e9c8726a.html"/>
      <url>/post/e9c8726a.html</url>
      
        <content type="html"><![CDATA[<h1 id="ä¸‰å¶è‰å®éªŒå®¤â€œæœŸæœ«ä»»åŠ¡â€æ€»ç»“ï¼ˆç»­ï¼‰-ç¬¬äº”è¯¾"><a href="#ä¸‰å¶è‰å®éªŒå®¤â€œæœŸæœ«ä»»åŠ¡â€æ€»ç»“ï¼ˆç»­ï¼‰-ç¬¬äº”è¯¾" class="headerlink" title="ä¸‰å¶è‰å®éªŒå®¤â€œæœŸæœ«ä»»åŠ¡â€æ€»ç»“ï¼ˆç»­ï¼‰(ç¬¬äº”è¯¾)"></a>ä¸‰å¶è‰å®éªŒå®¤â€œæœŸæœ«ä»»åŠ¡â€æ€»ç»“ï¼ˆç»­ï¼‰(ç¬¬äº”è¯¾)</h1><h2 id="ä»»åŠ¡ä¸€ï¼šå®ŒæˆåŠ å¯†åƒµå°¸çš„æ¸¸æˆ"><a href="#ä»»åŠ¡ä¸€ï¼šå®ŒæˆåŠ å¯†åƒµå°¸çš„æ¸¸æˆ" class="headerlink" title="ä»»åŠ¡ä¸€ï¼šå®ŒæˆåŠ å¯†åƒµå°¸çš„æ¸¸æˆ"></a>ä»»åŠ¡ä¸€ï¼šå®ŒæˆåŠ å¯†åƒµå°¸çš„æ¸¸æˆ</h2><h3 id="5-ERC721æ ‡å‡†å’ŒåŠ å¯†æ”¶è—å“"><a href="#5-ERC721æ ‡å‡†å’ŒåŠ å¯†æ”¶è—å“" class="headerlink" title="5.ERC721æ ‡å‡†å’ŒåŠ å¯†æ”¶è—å“"></a>5.ERC721æ ‡å‡†å’ŒåŠ å¯†æ”¶è—å“</h3><h4 id="â‘ ä»¥å¤ªåŠä¸Šçš„ä»£å¸"><a href="#â‘ ä»¥å¤ªåŠä¸Šçš„ä»£å¸" class="headerlink" title="â‘ ä»¥å¤ªåŠä¸Šçš„ä»£å¸"></a>â‘ ä»¥å¤ªåŠä¸Šçš„ä»£å¸</h4><p>è®©æˆ‘ä»¬æ¥èŠèŠ <em>ä»£å¸</em>.</p><p>å¦‚æœä½ å¯¹ä»¥å¤ªåŠçš„ä¸–ç•Œæœ‰ä¸€äº›äº†è§£ï¼Œä½ å¾ˆå¯èƒ½å¬è¿‡äººä»¬èŠåˆ°ä»£å¸â€”â€”å°¤å…¶æ˜¯ ERC20 ä»£å¸.</p><p>ä¸€ä¸ª <em>ä»£å¸</em> åœ¨ä»¥å¤ªåŠåŸºæœ¬ä¸Šå°±æ˜¯ä¸€ä¸ªéµå¾ªä¸€äº›å…±åŒè§„åˆ™çš„æ™ºèƒ½åˆçº¦â€”â€”å³å®ƒå®ç°äº†æ‰€æœ‰å…¶ä»–ä»£å¸åˆçº¦å…±äº«çš„ä¸€ç»„æ ‡å‡†å‡½æ•°ï¼Œä¾‹å¦‚ <code>transfer(address _to, uint256 _value)</code> å’Œ <code>balanceOf(address _owner)</code>.</p><p>åœ¨æ™ºèƒ½åˆçº¦å†…éƒ¨ï¼Œé€šå¸¸æœ‰ä¸€ä¸ªæ˜ å°„ï¼Œ<code>mapping(address =&gt; uint256) balances</code>ï¼Œç”¨äºè¿½è¸ªæ¯ä¸ªåœ°å€è¿˜æœ‰å¤šå°‘ä½™é¢ã€‚</p><p>æ‰€ä»¥åŸºæœ¬ä¸Šä¸€ä¸ªä»£å¸åªæ˜¯ä¸€ä¸ªè¿½è¸ªè°æ‹¥æœ‰å¤šå°‘è¯¥ä»£å¸çš„åˆçº¦ï¼Œå’Œä¸€äº›å¯ä»¥è®©é‚£äº›ç”¨æˆ·å°†ä»–ä»¬çš„ä»£å¸è½¬ç§»åˆ°å…¶ä»–åœ°å€çš„å‡½æ•°ã€‚</p><p><strong>å®ƒä¸ºä»€ä¹ˆé‡è¦å‘¢ï¼Ÿ</strong><br>ç”±äºæ‰€æœ‰ ERC20 ä»£å¸å…±äº«å…·æœ‰ç›¸åŒåç§°çš„åŒä¸€ç»„å‡½æ•°ï¼Œå®ƒä»¬éƒ½å¯ä»¥ä»¥ç›¸åŒçš„æ–¹å¼è¿›è¡Œäº¤äº’ã€‚</p><p>è¿™æ„å‘³ç€å¦‚æœä½ æ„å»ºçš„åº”ç”¨ç¨‹åºèƒ½å¤Ÿä¸ä¸€ä¸ª ERC20 ä»£å¸è¿›è¡Œäº¤äº’ï¼Œé‚£ä¹ˆå®ƒå°±ä¹Ÿèƒ½å¤Ÿä¸ä»»ä½• ERC20 ä»£å¸è¿›è¡Œäº¤äº’ã€‚ è¿™æ ·ä¸€æ¥ï¼Œå°†æ¥ä½ å°±å¯ä»¥è½»æ¾åœ°å°†æ›´å¤šçš„ä»£å¸æ·»åŠ åˆ°ä½ çš„åº”ç”¨ä¸­ï¼Œè€Œæ— éœ€è¿›è¡Œè‡ªå®šä¹‰ç¼–ç ã€‚ ä½ å¯ä»¥ç®€å•åœ°æ’å…¥æ–°çš„ä»£å¸åˆçº¦åœ°å€ï¼Œç„¶åå“—å•¦ï¼Œä½ çš„åº”ç”¨ç¨‹åºæœ‰å¦ä¸€ä¸ªå®ƒå¯ä»¥ä½¿ç”¨çš„ä»£å¸äº†ã€‚</p><p>å…¶ä¸­ä¸€ä¸ªä¾‹å­å°±æ˜¯äº¤æ˜“æ‰€ã€‚ å½“äº¤æ˜“æ‰€æ·»åŠ ä¸€ä¸ªæ–°çš„ ERC20 ä»£å¸æ—¶ï¼Œå®é™…ä¸Šå®ƒåªéœ€è¦æ·»åŠ ä¸ä¹‹å¯¹è¯çš„å¦ä¸€ä¸ªæ™ºèƒ½åˆçº¦ã€‚ ç”¨æˆ·å¯ä»¥è®©é‚£ä¸ªåˆçº¦å°†ä»£å¸å‘é€åˆ°äº¤æ˜“æ‰€çš„é’±åŒ…åœ°å€ï¼Œç„¶åäº¤æ˜“æ‰€å¯ä»¥è®©åˆçº¦åœ¨ç”¨æˆ·è¦æ±‚å–æ¬¾æ—¶å°†ä»£å¸å‘é€å›ç»™ä»–ä»¬ã€‚</p><p>äº¤æ˜“æ‰€åªéœ€è¦å®ç°è¿™ç§è½¬ç§»é€»è¾‘ä¸€æ¬¡ï¼Œç„¶åå½“å®ƒæƒ³è¦æ·»åŠ ä¸€ä¸ªæ–°çš„ ERC20 ä»£å¸æ—¶ï¼Œåªéœ€å°†æ–°çš„åˆçº¦åœ°å€æ·»åŠ åˆ°å®ƒçš„æ•°æ®åº“å³å¯ã€‚</p><p><strong>å…¶ä»–ä»£å¸æ ‡å‡†</strong><br>å¯¹äºåƒè´§å¸ä¸€æ ·çš„ä»£å¸æ¥è¯´ï¼ŒERC20 ä»£å¸éå¸¸é…·ã€‚ ä½†æ˜¯è¦åœ¨æˆ‘ä»¬åƒµå°¸æ¸¸æˆä¸­ä»£è¡¨åƒµå°¸å°±å¹¶ä¸æ˜¯ç‰¹åˆ«æœ‰ç”¨ã€‚</p><p>é¦–å…ˆï¼Œåƒµå°¸ä¸åƒè´§å¸å¯ä»¥åˆ†å‰² â€”â€” æˆ‘å¯ä»¥å‘ç»™ä½  0.237 ä»¥å¤ªï¼Œä½†æ˜¯è½¬ç§»ç»™ä½  0.237 çš„åƒµå°¸å¬èµ·æ¥å°±æœ‰äº›æç¬‘ã€‚</p><p>å…¶æ¬¡ï¼Œå¹¶ä¸æ˜¯æ‰€æœ‰åƒµå°¸éƒ½æ˜¯å¹³ç­‰çš„ã€‚ ä½ çš„2çº§åƒµå°¸â€Steveâ€å®Œå…¨ä¸èƒ½ç­‰åŒäºæˆ‘732çº§çš„åƒµå°¸â€H4XF13LD MORRIS ğŸ’¯ğŸ’¯ğŸ˜ğŸ’¯ğŸ’¯â€ã€‚ï¼ˆä½ å·®å¾—è¿œå‘¢ï¼ŒSteveï¼‰ã€‚</p><p>æœ‰å¦ä¸€ä¸ªä»£å¸æ ‡å‡†æ›´é€‚åˆå¦‚ CryptoZombies è¿™æ ·çš„åŠ å¯†æ”¶è—å“â€”â€”å®ƒä»¬è¢«ç§°ä¸ºERC721 ä»£å¸.</p><p>ERC721 ä»£å¸æ˜¯ä¸èƒ½äº’æ¢çš„ï¼Œå› ä¸ºæ¯ä¸ªä»£å¸éƒ½è¢«è®¤ä¸ºæ˜¯å”¯ä¸€ä¸”ä¸å¯åˆ†å‰²çš„ã€‚ ä½ åªèƒ½ä»¥æ•´ä¸ªå•ä½äº¤æ˜“å®ƒä»¬ï¼Œå¹¶ä¸”æ¯ä¸ªå•ä½éƒ½æœ‰å”¯ä¸€çš„ IDã€‚ è¿™äº›ç‰¹æ€§æ­£å¥½è®©æˆ‘ä»¬çš„åƒµå°¸å¯ä»¥ç”¨æ¥äº¤æ˜“ã€‚</p><blockquote><p>è¯·æ³¨æ„ï¼Œä½¿ç”¨åƒ ERC721 è¿™æ ·çš„æ ‡å‡†çš„ä¼˜åŠ¿å°±æ˜¯ï¼Œæˆ‘ä»¬ä¸å¿…åœ¨æˆ‘ä»¬çš„åˆçº¦ä¸­å®ç°æ‹å–æˆ–æ‰˜ç®¡é€»è¾‘ï¼Œè¿™å†³å®šäº†ç©å®¶èƒ½å¤Ÿå¦‚ä½•äº¤æ˜“ï¼å‡ºå”®æˆ‘ä»¬çš„åƒµå°¸ã€‚ å¦‚æœæˆ‘ä»¬ç¬¦åˆè§„èŒƒï¼Œå…¶ä»–äººå¯ä»¥ä¸ºåŠ å¯†å¯äº¤æ˜“çš„ ERC721 èµ„äº§æ­å»ºä¸€ä¸ªäº¤æ˜“æ‰€å¹³å°ï¼Œæˆ‘ä»¬çš„ ERC721 åƒµå°¸å°†å¯ä»¥åœ¨è¯¥å¹³å°ä¸Šä½¿ç”¨ã€‚ æ‰€ä»¥ä½¿ç”¨ä»£å¸æ ‡å‡†ç›¸è¾ƒäºä½¿ç”¨ä½ è‡ªå·±çš„äº¤æ˜“é€»è¾‘æœ‰æ˜æ˜¾çš„å¥½å¤„ã€‚</p></blockquote><p>å®æˆ˜æ¼”ä¹ :<br>zombieownership.sol:</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">pragma solidity ^0.4.19;</span><br><span class="line"></span><br><span class="line">import &quot;./zombieattack.sol&quot;;</span><br><span class="line"></span><br><span class="line">contract ZombieOwnership is ZombieAttack &#123;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="â‘¡ERC721-æ ‡å‡†-å¤šé‡ç»§æ‰¿"><a href="#â‘¡ERC721-æ ‡å‡†-å¤šé‡ç»§æ‰¿" class="headerlink" title="â‘¡ERC721 æ ‡å‡†, å¤šé‡ç»§æ‰¿"></a>â‘¡ERC721 æ ‡å‡†, å¤šé‡ç»§æ‰¿</h4><p>è®©æˆ‘ä»¬æ¥çœ‹ä¸€çœ‹ ERC721 æ ‡å‡†ï¼š</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">contract ERC721 &#123;</span><br><span class="line">  event Transfer(address indexed _from, address indexed _to, uint256 _tokenId);</span><br><span class="line">  event Approval(address indexed _owner, address indexed _approved, uint256 _tokenId);</span><br><span class="line"></span><br><span class="line">  function balanceOf(address _owner) public view returns (uint256 _balance);</span><br><span class="line">  function ownerOf(uint256 _tokenId) public view returns (address _owner);</span><br><span class="line">  function transfer(address _to, uint256 _tokenId) public;</span><br><span class="line">  function approve(address _to, uint256 _tokenId) public;</span><br><span class="line">  function takeOwnership(uint256 _tokenId) public;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿™æ˜¯æˆ‘ä»¬éœ€è¦å®ç°çš„æ–¹æ³•åˆ—è¡¨ï¼Œæˆ‘ä»¬å°†åœ¨æ¥ä¸‹æ¥çš„ç« èŠ‚ä¸­é€ä¸ªå­¦ä¹ ã€‚</p><p>è™½ç„¶çœ‹èµ·æ¥å¾ˆå¤šï¼Œä½†ä¸è¦è¢«å“åˆ°äº†ï¼æˆ‘ä»¬åœ¨è¿™é‡Œå°±æ˜¯å‡†å¤‡å¸¦ç€ä½ ä¸€æ­¥ä¸€æ­¥äº†è§£å®ƒä»¬çš„ã€‚</p><blockquote><p>æ³¨æ„ï¼š ERC721ç›®å‰æ˜¯ä¸€ä¸ª è‰ç¨¿ï¼Œè¿˜æ²¡æœ‰æ­£å¼å•†å®šçš„å®ç°ã€‚åœ¨æœ¬æ•™ç¨‹ä¸­ï¼Œæˆ‘ä»¬ä½¿ç”¨çš„æ˜¯ OpenZeppelin åº“ä¸­çš„å½“å‰ç‰ˆæœ¬ï¼Œä½†åœ¨æœªæ¥æ­£å¼å‘å¸ƒä¹‹å‰å®ƒå¯èƒ½ä¼šæœ‰æ›´æ”¹ã€‚ æ‰€ä»¥æŠŠè¿™ ä¸€ä¸ª å¯èƒ½çš„å®ç°å½“ä½œè€ƒè™‘ï¼Œä½†ä¸è¦æŠŠå®ƒä½œä¸º ERC721 ä»£å¸çš„å®˜æ–¹æ ‡å‡†ã€‚</p></blockquote><p><strong>å®ç°ä¸€ä¸ªä»£å¸åˆçº¦</strong><br>åœ¨å®ç°ä¸€ä¸ªä»£å¸åˆçº¦çš„æ—¶å€™ï¼Œæˆ‘ä»¬é¦–å…ˆè¦åšçš„æ˜¯å°†æ¥å£å¤åˆ¶åˆ°å®ƒè‡ªå·±çš„ Solidity æ–‡ä»¶å¹¶å¯¼å…¥å®ƒï¼Œ<code>import &quot;./erc721.sol&quot;;</code>ã€‚ æ¥ç€ï¼Œè®©æˆ‘ä»¬çš„åˆçº¦ç»§æ‰¿å®ƒï¼Œç„¶åæˆ‘ä»¬ç”¨ä¸€ä¸ªå‡½æ•°å®šä¹‰æ¥é‡å†™æ¯ä¸ªæ–¹æ³•ã€‚</p><p>ä½†ç­‰ä¸€ä¸‹â€”â€” <code>ZombieOwnership</code>å·²ç»ç»§æ‰¿è‡ª <code>ZombieAttack</code>äº† â€”â€” å®ƒå¦‚ä½•èƒ½å¤Ÿä¹Ÿç»§æ‰¿äº <code>ERC721</code>å‘¢ï¼Ÿ</p><p>å¹¸è¿çš„æ˜¯åœ¨Solidityï¼Œä½ çš„åˆçº¦å¯ä»¥ç»§æ‰¿è‡ªå¤šä¸ªåˆçº¦ï¼Œå‚è€ƒå¦‚ä¸‹ï¼š</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">contract SatoshiNakamoto is NickSzabo, HalFinney &#123;</span><br><span class="line">  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ­£å¦‚ä½ æ‰€è§ï¼Œå½“ä½¿ç”¨å¤šé‡ç»§æ‰¿çš„æ—¶å€™ï¼Œä½ åªéœ€è¦ç”¨é€—å· , æ¥éš”å¼€å‡ ä¸ªä½ æƒ³è¦ç»§æ‰¿çš„åˆçº¦ã€‚åœ¨ä¸Šé¢çš„ä¾‹å­ä¸­ï¼Œæˆ‘ä»¬çš„åˆçº¦ç»§æ‰¿è‡ª <code>NickSzabo</code> å’Œ <code>HalFinney</code>ã€‚</p><p>å®æˆ˜æ¼”ä¹ ï¼š</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">pragma solidity ^0.4.19;</span><br><span class="line"></span><br><span class="line">import &quot;./zombieattack.sol&quot;;</span><br><span class="line">import &quot;./erc721.sol&quot;;</span><br><span class="line"></span><br><span class="line">contract ZombieOwnership is ZombieAttack, ERC721 &#123;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="â‘¢balanceOf-å’Œ-ownerOf"><a href="#â‘¢balanceOf-å’Œ-ownerOf" class="headerlink" title="â‘¢balanceOf å’Œ ownerOf"></a>â‘¢balanceOf å’Œ ownerOf</h4><p>åœ¨æœ¬ç« èŠ‚ï¼Œæˆ‘ä»¬å°†å®ç°å¤´ä¸¤ä¸ªæ–¹æ³•ï¼š balanceOf å’Œ ownerOfã€‚</p><p><strong>balanceOf</strong><br><code>function balanceOf(address _owner) public view returns (uint256 _balance);</code><br>è¿™ä¸ªå‡½æ•°åªéœ€è¦ä¸€ä¸ªä¼ å…¥ address å‚æ•°ï¼Œç„¶åè¿”å›è¿™ä¸ª address æ‹¥æœ‰å¤šå°‘ä»£å¸ã€‚</p><p>åœ¨æˆ‘ä»¬çš„ä¾‹å­ä¸­ï¼Œæˆ‘ä»¬çš„â€œä»£å¸â€æ˜¯åƒµå°¸ã€‚ä½ è¿˜è®°å¾—åœ¨æˆ‘ä»¬ DApp çš„å“ªé‡Œå­˜å‚¨äº†ä¸€ä¸ªä¸»äººæ‹¥æœ‰å¤šå°‘åªåƒµå°¸å—ï¼Ÿ</p><p><strong>ownerOf</strong></p><p><code>function ownerOf(uint256 _tokenId) public view returns (address _owner);</code><br>è¿™ä¸ªå‡½æ•°éœ€è¦ä¼ å…¥ä¸€ä¸ªä»£å¸ ID ä½œä¸ºå‚æ•° (æˆ‘ä»¬çš„æƒ…å†µå°±æ˜¯ä¸€ä¸ªåƒµå°¸ ID)ï¼Œç„¶åè¿”å›è¯¥ä»£å¸æ‹¥æœ‰è€…çš„ addressã€‚</p><p>åŒæ ·çš„ï¼Œå› ä¸ºåœ¨æˆ‘ä»¬çš„ DApp é‡Œå·²ç»æœ‰ä¸€ä¸ª mapping (æ˜ å°„) å­˜å‚¨äº†è¿™ä¸ªä¿¡æ¯ï¼Œæ‰€ä»¥å¯¹æˆ‘ä»¬æ¥è¯´è¿™ä¸ªå®ç°éå¸¸ç›´æ¥æ¸…æ™°ã€‚æˆ‘ä»¬å¯ä»¥åªç”¨ä¸€è¡Œ return è¯­å¥æ¥å®ç°è¿™ä¸ªå‡½æ•°ã€‚</p><blockquote><p>æ³¨æ„ï¼šè¦è®°å¾—ï¼Œ uint256 ç­‰åŒäºuintã€‚æˆ‘ä»¬ä»è¯¾ç¨‹çš„å¼€å§‹ä¸€ç›´åœ¨ä»£ç ä¸­ä½¿ç”¨ uintï¼Œä½†ä»ç°åœ¨å¼€å§‹æˆ‘ä»¬å°†åœ¨è¿™é‡Œç”¨ uint256ï¼Œå› ä¸ºæˆ‘ä»¬ç›´æ¥ä»è§„èŒƒä¸­å¤åˆ¶ç²˜è´´ã€‚</p></blockquote><p>å®æˆ˜æ¼”ä¹ ï¼š</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">function balanceOf(address _owner) public view returns (uint256 _balance) &#123;</span><br><span class="line">  return ownerZombieCount[_owner];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">function ownerOf(uint256 _tokenId) public view returns (address _owner) &#123;</span><br><span class="line">  return zombieToOwner[_tokenId];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="â‘£é‡æ„"><a href="#â‘£é‡æ„" class="headerlink" title="â‘£é‡æ„"></a>â‘£é‡æ„</h4><p>æˆ‘ä»¬åˆšåˆšçš„ä»£ç ä¸­å…¶å®æœ‰ä¸ªé”™è¯¯ï¼Œä»¥è‡³äºå…¶æ ¹æœ¬æ— æ³•é€šè¿‡ç¼–è¯‘ï¼Œä½ å‘ç°äº†æ²¡ï¼Ÿ</p><p>åœ¨å‰ä¸€ä¸ªç« èŠ‚æˆ‘ä»¬å®šä¹‰äº†ä¸€ä¸ªå« ownerOf çš„å‡½æ•°ã€‚ä½†å¦‚æœä½ è¿˜è®°å¾—ç¬¬4è¯¾çš„å†…å®¹ï¼Œæˆ‘ä»¬åŒæ ·åœ¨zombiefeeding.sol é‡Œä»¥ ownerOf å‘½ååˆ›å»ºäº†ä¸€ä¸ª modifierï¼ˆä¿®é¥°ç¬¦ï¼‰ã€‚</p><p>å¦‚æœä½ å°è¯•ç¼–è¯‘è¿™æ®µä»£ç ï¼Œç¼–è¯‘å™¨ä¼šç»™ä½ ä¸€ä¸ªé”™è¯¯è¯´ä½ ä¸èƒ½æœ‰ç›¸åŒåç§°çš„ä¿®é¥°ç¬¦å’Œå‡½æ•°ã€‚</p><p>æ‰€ä»¥æˆ‘ä»¬åº”è¯¥æŠŠåœ¨ ZombieOwnership é‡Œçš„å‡½æ•°åç§°æ”¹æˆåˆ«çš„å—ï¼Ÿ</p><p>ä¸ï¼Œæˆ‘ä»¬ä¸èƒ½é‚£æ ·åšï¼ï¼ï¼è¦è®°å¾—ï¼Œæˆ‘ä»¬æ­£åœ¨ç”¨ ERC721 ä»£å¸æ ‡å‡†ï¼Œæ„å‘³ç€å…¶ä»–åˆçº¦å°†æœŸæœ›æˆ‘ä»¬çš„åˆçº¦ä»¥è¿™äº›ç¡®åˆ‡çš„åç§°æ¥å®šä¹‰å‡½æ•°ã€‚è¿™å°±æ˜¯è¿™äº›æ ‡å‡†å®ç”¨çš„åŸå› â€”â€”å¦‚æœå¦ä¸€ä¸ªåˆçº¦çŸ¥é“æˆ‘ä»¬çš„åˆçº¦ç¬¦åˆ ERC721 æ ‡å‡†ï¼Œå®ƒå¯ä»¥ç›´æ¥ä¸æˆ‘ä»¬äº¤äº’ï¼Œè€Œæ— éœ€äº†è§£ä»»ä½•å…³äºæˆ‘ä»¬å†…éƒ¨å¦‚ä½•å®ç°çš„ç»†èŠ‚ã€‚</p><p>æ‰€ä»¥ï¼Œé‚£æ„å‘³ç€æˆ‘ä»¬å°†å¿…é¡»é‡æ„æˆ‘ä»¬ç¬¬4è¯¾ä¸­çš„ä»£ç ï¼Œå°† modifier çš„åç§°æ¢æˆåˆ«çš„ã€‚</p><p>å®æˆ˜æ¼”ä¹ ï¼š<br>æˆ‘ä»¬å›åˆ°äº† zombiefeeding.sol ã€‚æˆ‘ä»¬å°†æŠŠ modifier çš„åç§°ä» ownerOf æ”¹æˆ onlyOwnerOfã€‚</p><ol><li><p>æŠŠä¿®é¥°ç¬¦å®šä¹‰ä¸­çš„åç§°æ”¹æˆ onlyOwnerOf</p></li><li><p>å¾€ä¸‹æ»‘åˆ°ä½¿ç”¨æ­¤ä¿®é¥°ç¬¦çš„å‡½æ•° feedAndMultiply ã€‚æˆ‘ä»¬ä¹Ÿéœ€è¦æ”¹è¿™é‡Œçš„åç§°ã€‚</p></li></ol><blockquote><p>æ³¨æ„ï¼šæˆ‘ä»¬åœ¨ zombiehelper.sol å’Œ zombieattack.sol é‡Œä¹Ÿä½¿ç”¨äº†è¿™ä¸ªä¿®é¥°ç¬¦ï¼Œä½†ä¸ºäº†ä¸åœ¨è¿™èŠ‚è¯¾çš„é‡æ„é‡ŒèŠ±å¤ªå¤šæ—¶é—´ï¼Œæˆ‘ä»¬å·²ç»å°†é‚£äº›æ–‡ä»¶é‡Œçš„ä¿®é¥°ç¬¦åç§°ä¸ºä½ æ”¹å¥½äº†ã€‚</p></blockquote><h4 id="â‘¤ERC721-è½¬ç§»æ ‡å‡†"><a href="#â‘¤ERC721-è½¬ç§»æ ‡å‡†" class="headerlink" title="â‘¤ERC721: è½¬ç§»æ ‡å‡†"></a>â‘¤ERC721: è½¬ç§»æ ‡å‡†</h4><p>ç°åœ¨æˆ‘ä»¬å°†é€šè¿‡å­¦ä¹ æŠŠæ‰€æœ‰æƒä»ä¸€ä¸ªäººè½¬ç§»ç»™å¦ä¸€ä¸ªäººæ¥ç»§ç»­æˆ‘ä»¬çš„ ERC721 è§„èŒƒçš„å®ç°ã€‚</p><p>æ³¨æ„ ERC721 è§„èŒƒæœ‰ä¸¤ç§ä¸åŒçš„æ–¹æ³•æ¥è½¬ç§»ä»£å¸ï¼š</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">function transfer(address _to, uint256 _tokenId) public;</span><br><span class="line"></span><br><span class="line">function approve(address _to, uint256 _tokenId) public;</span><br><span class="line">function takeOwnership(uint256 _tokenId) public;</span><br></pre></td></tr></table></figure><ol><li><p>ç¬¬ä¸€ç§æ–¹æ³•æ˜¯ä»£å¸çš„æ‹¥æœ‰è€…è°ƒç”¨transfer æ–¹æ³•ï¼Œä¼ å…¥ä»–æƒ³è½¬ç§»åˆ°çš„ address å’Œä»–æƒ³è½¬ç§»çš„ä»£å¸çš„ _tokenIdã€‚</p></li><li><p>ç¬¬äºŒç§æ–¹æ³•æ˜¯ä»£å¸æ‹¥æœ‰è€…é¦–å…ˆè°ƒç”¨ approveï¼Œç„¶åä¼ å…¥ä¸ä»¥ä¸Šç›¸åŒçš„å‚æ•°ã€‚æ¥ç€ï¼Œè¯¥åˆçº¦ä¼šå­˜å‚¨è°è¢«å…è®¸æå–ä»£å¸ï¼Œé€šå¸¸å­˜å‚¨åˆ°ä¸€ä¸ª mapping (uint256 &#x3D;&gt; address) é‡Œã€‚ç„¶åï¼Œå½“æœ‰äººè°ƒç”¨ takeOwnership æ—¶ï¼Œåˆçº¦ä¼šæ£€æŸ¥ msg.sender æ˜¯å¦å¾—åˆ°æ‹¥æœ‰è€…çš„æ‰¹å‡†æ¥æå–ä»£å¸ï¼Œå¦‚æœæ˜¯ï¼Œåˆ™å°†ä»£å¸è½¬ç§»ç»™ä»–ã€‚</p></li></ol><p>ä½ æ³¨æ„åˆ°äº†å—ï¼Œtransfer å’Œ takeOwnership éƒ½å°†åŒ…å«ç›¸åŒçš„è½¬ç§»é€»è¾‘ï¼Œåªæ˜¯ä»¥ç›¸åçš„é¡ºåºã€‚ ï¼ˆä¸€ç§æƒ…å†µæ˜¯ä»£å¸çš„å‘é€è€…è°ƒç”¨å‡½æ•°ï¼›å¦ä¸€ç§æƒ…å†µæ˜¯ä»£å¸çš„æ¥æ”¶è€…è°ƒç”¨å®ƒï¼‰ã€‚</p><p>æ‰€ä»¥æˆ‘ä»¬æŠŠè¿™ä¸ªé€»è¾‘æŠ½è±¡æˆå®ƒè‡ªå·±çš„ç§æœ‰å‡½æ•° _transferï¼Œç„¶åç”±è¿™ä¸¤ä¸ªå‡½æ•°æ¥è°ƒç”¨å®ƒã€‚ è¿™æ ·æˆ‘ä»¬å°±ä¸ç”¨å†™é‡å¤çš„ä»£ç äº†ã€‚</p><p>å®æˆ˜æ¼”ä¹ :</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">function _transfer(address _from, address _to, uint256 _tokenId) private &#123;</span><br><span class="line">    ownerZombieCount[_to]++;</span><br><span class="line">    ownerZombieCount[_from]--;</span><br><span class="line">    zombieToOwner[_tokenId] = _to;</span><br><span class="line">    Transfer(_from, _to, _tokenId);</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure><h4 id="â‘¥ERC721-è½¬ç§»-ç»­"><a href="#â‘¥ERC721-è½¬ç§»-ç»­" class="headerlink" title="â‘¥ERC721: è½¬ç§»-ç»­"></a>â‘¥ERC721: è½¬ç§»-ç»­</h4><p>å®æˆ˜æ¼”ä¹ ï¼š</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">function transfer(address _to, uint256 _tokenId) public onlyOwnerOf(_tokenId) &#123;</span><br><span class="line">    _transfer(msg.sender, _to, _tokenId);</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure><h4 id="â‘¦ERC721-æ‰¹å‡†"><a href="#â‘¦ERC721-æ‰¹å‡†" class="headerlink" title="â‘¦ERC721: æ‰¹å‡†"></a>â‘¦ERC721: æ‰¹å‡†</h4><p>ç°åœ¨ï¼Œè®©æˆ‘ä»¬æ¥å®ç° approveã€‚</p><p>è®°ä½ï¼Œä½¿ç”¨ approve æˆ–è€… takeOwnership çš„æ—¶å€™ï¼Œè½¬ç§»æœ‰2ä¸ªæ­¥éª¤ï¼š</p><ol><li><p>ä½ ï¼Œä½œä¸ºæ‰€æœ‰è€…ï¼Œç”¨æ–°ä¸»äººçš„ address å’Œä½ å¸Œæœ›ä»–è·å–çš„ _tokenId æ¥è°ƒç”¨ approve</p></li><li><p>æ–°ä¸»äººç”¨ _tokenId æ¥è°ƒç”¨ takeOwnershipï¼Œåˆçº¦ä¼šæ£€æŸ¥ç¡®ä¿ä»–è·å¾—äº†æ‰¹å‡†ï¼Œç„¶åæŠŠä»£å¸è½¬ç§»ç»™ä»–ã€‚</p></li></ol><p>å› ä¸ºè¿™å‘ç”Ÿåœ¨2ä¸ªå‡½æ•°çš„è°ƒç”¨ä¸­ï¼Œæ‰€ä»¥åœ¨å‡½æ•°è°ƒç”¨ä¹‹é—´ï¼Œæˆ‘ä»¬éœ€è¦ä¸€ä¸ªæ•°æ®ç»“æ„æ¥å­˜å‚¨ä»€ä¹ˆäººè¢«æ‰¹å‡†è·å–ä»€ä¹ˆã€‚</p><p>å®æˆ˜æ¼”ä¹ ï¼š</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">mapping (uint =&gt; address) zombieApprovals;</span><br><span class="line"></span><br><span class="line">function approve(address _to, uint256 _tokenId) public onlyOwnerOf(_tokenId) &#123;</span><br><span class="line">    zombieApprovals[_tokenId] = _to;</span><br><span class="line">    Approval(msg.sender, _to, _tokenId);</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure><h4 id="â‘§ERC721-takeOwnership"><a href="#â‘§ERC721-takeOwnership" class="headerlink" title="â‘§ERC721: takeOwnership"></a>â‘§ERC721: takeOwnership</h4><p>æœ€åä¸€ä¸ªå‡½æ•° takeOwnershipï¼Œ åº”è¯¥åªæ˜¯ç®€å•åœ°æ£€æŸ¥ä»¥ç¡®ä¿ msg.sender å·²ç»è¢«æ‰¹å‡†æ¥æå–è¿™ä¸ªä»£å¸æˆ–è€…åƒµå°¸ã€‚è‹¥ç¡®è®¤ï¼Œå°±è°ƒç”¨ _transferï¼›</p><p>å®æˆ˜æ¼”ä¹ ï¼š</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">function takeOwnership(uint256 _tokenId) public &#123;</span><br><span class="line">    require(zombieApprovals[_tokenId] == msg.sender);</span><br><span class="line">    address owner = ownerOf(_tokenId);</span><br><span class="line">    _transfer(owner, msg.sender, _tokenId);</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure><h4 id="â‘¨é¢„é˜²æº¢å‡º"><a href="#â‘¨é¢„é˜²æº¢å‡º" class="headerlink" title="â‘¨é¢„é˜²æº¢å‡º"></a>â‘¨é¢„é˜²æº¢å‡º</h4><p>æˆ‘ä»¬å®Œæˆäº† ERC721 çš„å®ç°ã€‚</p><p>ä¸è¿‡è¦è®°ä½é‚£åªæ˜¯æœ€ç®€å•çš„å®ç°ã€‚è¿˜æœ‰å¾ˆå¤šçš„ç‰¹æ€§æˆ‘ä»¬ä¹Ÿè®¸æƒ³åŠ å…¥åˆ°æˆ‘ä»¬çš„å®ç°ä¸­æ¥ï¼Œæ¯”å¦‚ä¸€äº›é¢å¤–çš„æ£€æŸ¥ï¼Œæ¥ç¡®ä¿ç”¨æˆ·ä¸ä¼šä¸å°å¿ƒæŠŠä»–ä»¬çš„åƒµå°¸è½¬ç§»ç»™0 åœ°å€ï¼ˆè¿™è¢«ç§°ä½œ â€œçƒ§å¸â€, åŸºæœ¬ä¸Šå°±æ˜¯æŠŠä»£å¸è½¬ç§»åˆ°ä¸€ä¸ªè°ä¹Ÿæ²¡æœ‰ç§é’¥çš„åœ°å€ï¼Œè®©è¿™ä¸ªä»£å¸æ°¸è¿œä¹Ÿæ— æ³•æ¢å¤ï¼‰ã€‚ æˆ–è€…åœ¨ DApp ä¸­åŠ å…¥ä¸€äº›åŸºæœ¬çš„æ‹å–é€»è¾‘ã€‚ï¼ˆä½ èƒ½æƒ³å‡ºä¸€äº›å®ç°çš„æ–¹æ³•ä¹ˆï¼Ÿï¼‰</p><p>ä½†æ˜¯ä¸ºäº†è®©æˆ‘ä»¬çš„è¯¾ç¨‹ä¸è‡³äºç¦»é¢˜å¤ªè¿œï¼Œæ‰€ä»¥æˆ‘ä»¬åªä¸“æ³¨äºä¸€äº›åŸºç¡€å®ç°ã€‚å¦‚æœä½ æƒ³å­¦ä¹ ä¸€äº›æ›´æ·±å±‚æ¬¡çš„å®ç°ï¼Œå¯ä»¥åœ¨è¿™ä¸ªæ•™ç¨‹ç»“æŸåï¼Œå»çœ‹çœ‹ OpenZeppelin çš„ ERC721 åˆçº¦ã€‚</p><p><strong>åˆçº¦å®‰å…¨å¢å¼º: æº¢å‡ºå’Œä¸‹æº¢</strong><br>æˆ‘ä»¬å°†æ¥å­¦ä¹ ä½ åœ¨ç¼–å†™æ™ºèƒ½åˆçº¦çš„æ—¶å€™éœ€è¦æ³¨æ„çš„ä¸€ä¸ªä¸»è¦çš„å®‰å…¨ç‰¹æ€§ï¼šé˜²æ­¢æº¢å‡ºå’Œä¸‹æº¢ã€‚</p><p>ä»€ä¹ˆæ˜¯ <em>æº¢å‡º</em> (overflow)?</p><p>å‡è®¾æˆ‘ä»¬æœ‰ä¸€ä¸ª uint8, åªèƒ½å­˜å‚¨8 bitæ•°æ®ã€‚è¿™æ„å‘³ç€æˆ‘ä»¬èƒ½å­˜å‚¨çš„æœ€å¤§æ•°å­—å°±æ˜¯äºŒè¿›åˆ¶ 11111111 (æˆ–è€…è¯´åè¿›åˆ¶çš„ 2^8 - 1 &#x3D; 255).</p><p>æ¥çœ‹çœ‹ä¸‹é¢çš„ä»£ç ã€‚æœ€å number å°†ä¼šæ˜¯ä»€ä¹ˆå€¼ï¼Ÿ</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">uint8 number = 255;</span><br><span class="line">number++;</span><br></pre></td></tr></table></figure><p>åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œæˆ‘ä»¬å¯¼è‡´äº†æº¢å‡º â€” è™½ç„¶æˆ‘ä»¬åŠ äº†1ï¼Œ ä½†æ˜¯ number å‡ºä¹æ„æ–™åœ°ç­‰äº 0äº†ã€‚ (å¦‚æœä½ ç»™äºŒè¿›åˆ¶ 11111111 åŠ 1, å®ƒå°†è¢«é‡ç½®ä¸º 00000000ï¼Œå°±åƒé’Ÿè¡¨ä» 23:59 èµ°å‘ 00:00)ã€‚</p><p>ä¸‹æº¢(underflow)ä¹Ÿç±»ä¼¼ï¼Œå¦‚æœä½ ä»ä¸€ä¸ªç­‰äº 0 çš„ uint8 å‡å» 1, å®ƒå°†å˜æˆ 255 (å› ä¸º uint æ˜¯æ— ç¬¦å·çš„ï¼Œå…¶ä¸èƒ½ç­‰äºè´Ÿæ•°)ã€‚</p><p>è™½ç„¶æˆ‘ä»¬åœ¨è¿™é‡Œä¸ä½¿ç”¨ uint8ï¼Œè€Œä¸”æ¯æ¬¡ç»™ä¸€ä¸ª uint256 åŠ  1 ä¹Ÿä¸å¤ªå¯èƒ½æº¢å‡º (2^256 çœŸçš„æ˜¯ä¸€ä¸ªå¾ˆå¤§çš„æ•°äº†)ï¼Œåœ¨æˆ‘ä»¬çš„åˆçº¦ä¸­æ·»åŠ ä¸€äº›ä¿æŠ¤æœºåˆ¶ä¾ç„¶æ˜¯éå¸¸æœ‰å¿…è¦çš„ï¼Œä»¥é˜²æˆ‘ä»¬çš„ DApp ä»¥åå‡ºç°ä»€ä¹ˆå¼‚å¸¸æƒ…å†µã€‚</p><p><strong>ä½¿ç”¨ SafeMath</strong><br>ä¸ºäº†é˜²æ­¢è¿™äº›æƒ…å†µï¼ŒOpenZeppelin å»ºç«‹äº†ä¸€ä¸ªå«åš SafeMath çš„ <em>åº“</em>(library)ï¼Œé»˜è®¤æƒ…å†µä¸‹å¯ä»¥é˜²æ­¢è¿™äº›é—®é¢˜ã€‚</p><p>ä¸è¿‡åœ¨æˆ‘ä»¬ä½¿ç”¨ä¹‹å‰â€¦â€¦ ä»€ä¹ˆå«åšåº“?</p><p>ä¸€ä¸ª_åº“_ æ˜¯ Solidity ä¸­ä¸€ç§ç‰¹æ®Šçš„åˆçº¦ã€‚å…¶ä¸­ä¸€ä¸ªæœ‰ç”¨çš„åŠŸèƒ½æ˜¯ç»™åŸå§‹æ•°æ®ç±»å‹å¢åŠ ä¸€äº›æ–¹æ³•ã€‚</p><p>æ¯”å¦‚ï¼Œä½¿ç”¨ SafeMath åº“çš„æ—¶å€™ï¼Œæˆ‘ä»¬å°†ä½¿ç”¨ using SafeMath for uint256 è¿™æ ·çš„è¯­æ³•ã€‚ SafeMath åº“æœ‰å››ä¸ªæ–¹æ³• â€” addï¼Œ subï¼Œ mulï¼Œ ä»¥åŠ divã€‚ç°åœ¨æˆ‘ä»¬å¯ä»¥è¿™æ ·æ¥è®© uint256 è°ƒç”¨è¿™äº›æ–¹æ³•ï¼š</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">using SafeMath for uint256;</span><br><span class="line"></span><br><span class="line">uint256 a = 5;</span><br><span class="line">uint256 b = a.add(3); // 5 + 3 = 8</span><br><span class="line">uint256 c = a.mul(2); // 5 * 2 = 10</span><br></pre></td></tr></table></figure><p>æˆ‘ä»¬å°†åœ¨ä¸‹ä¸€ç« æ¥å­¦ä¹ è¿™äº›æ–¹æ³•ï¼Œä¸è¿‡ç°åœ¨æˆ‘ä»¬å…ˆå°† SafeMath åº“æ·»åŠ è¿›æˆ‘ä»¬çš„åˆçº¦ã€‚</p><p>å®æˆ˜æ¼”ä¹ ï¼š</p><ol><li>å°† safemath.sol å¼•å…¥åˆ° zombiefactory.sol.</li><li>æ·»åŠ å®šä¹‰ï¼š using SafeMath for uint256;.</li></ol><h4 id="â‘©SafeMathç¬¬äºŒéƒ¨åˆ†"><a href="#â‘©SafeMathç¬¬äºŒéƒ¨åˆ†" class="headerlink" title="â‘©SafeMathç¬¬äºŒéƒ¨åˆ†"></a>â‘©SafeMathç¬¬äºŒéƒ¨åˆ†</h4><p>æ¥çœ‹çœ‹ SafeMath çš„éƒ¨åˆ†ä»£ç :</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">library SafeMath &#123;</span><br><span class="line"></span><br><span class="line">  function mul(uint256 a, uint256 b) internal pure returns (uint256) &#123;</span><br><span class="line">    if (a == 0) &#123;</span><br><span class="line">      return 0;</span><br><span class="line">    &#125;</span><br><span class="line">    uint256 c = a * b;</span><br><span class="line">    assert(c / a == b);</span><br><span class="line">    return c;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  function div(uint256 a, uint256 b) internal pure returns (uint256) &#123;</span><br><span class="line">    // assert(b &gt; 0); // Solidity automatically throws when dividing by 0</span><br><span class="line">    uint256 c = a / b;</span><br><span class="line">    // assert(a == b * c + a % b); // There is no case in which this doesn&#x27;t hold</span><br><span class="line">    return c;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  function sub(uint256 a, uint256 b) internal pure returns (uint256) &#123;</span><br><span class="line">    assert(b &lt;= a);</span><br><span class="line">    return a - b;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  function add(uint256 a, uint256 b) internal pure returns (uint256) &#123;</span><br><span class="line">    uint256 c = a + b;</span><br><span class="line">    assert(c &gt;= a);</span><br><span class="line">    return c;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>é¦–å…ˆæˆ‘ä»¬æœ‰äº† library å…³é”®å­— â€” åº“å’Œ åˆçº¦å¾ˆç›¸ä¼¼ï¼Œä½†æ˜¯åˆæœ‰ä¸€äº›ä¸åŒã€‚ å°±æˆ‘ä»¬çš„ç›®çš„è€Œè¨€ï¼Œåº“å…è®¸æˆ‘ä»¬ä½¿ç”¨ using å…³é”®å­—ï¼Œå®ƒå¯ä»¥è‡ªåŠ¨æŠŠåº“çš„æ‰€æœ‰æ–¹æ³•æ·»åŠ ç»™ä¸€ä¸ªæ•°æ®ç±»å‹ï¼š</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">using SafeMath for uint;</span><br><span class="line">// è¿™ä¸‹æˆ‘ä»¬å¯ä»¥ä¸ºä»»ä½• uint è°ƒç”¨è¿™äº›æ–¹æ³•äº†</span><br><span class="line">uint test = 2;</span><br><span class="line">test = test.mul(3); // test ç­‰äº 6 äº†</span><br><span class="line">test = test.add(5); // test ç­‰äº 11 äº†</span><br></pre></td></tr></table></figure><p>æ³¨æ„ mul å’Œ add å…¶å®éƒ½éœ€è¦ä¸¤ä¸ªå‚æ•°ã€‚ åœ¨æˆ‘ä»¬å£°æ˜äº† using SafeMath for uint åï¼Œæˆ‘ä»¬ç”¨æ¥è°ƒç”¨è¿™äº›æ–¹æ³•çš„ uint å°±è‡ªåŠ¨è¢«ä½œä¸ºç¬¬ä¸€ä¸ªå‚æ•°ä¼ é€’è¿›å»äº†(åœ¨æ­¤ä¾‹ä¸­å°±æ˜¯ test)</p><p>æˆ‘ä»¬æ¥çœ‹çœ‹ add çš„æºä»£ç çœ‹ SafeMath åšäº†ä»€ä¹ˆ:</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">function add(uint256 a, uint256 b) internal pure returns (uint256) &#123;</span><br><span class="line">  uint256 c = a + b;</span><br><span class="line">  assert(c &gt;= a);</span><br><span class="line">  return c;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>åŸºæœ¬ä¸Š add åªæ˜¯åƒ + ä¸€æ ·å¯¹ä¸¤ä¸ª uint ç›¸åŠ ï¼Œ ä½†æ˜¯å®ƒç”¨ä¸€ä¸ª assert è¯­å¥æ¥ç¡®ä¿ç»“æœå¤§äº aã€‚è¿™æ ·å°±é˜²æ­¢äº†æº¢å‡ºã€‚</p><p>assert å’Œ require ç›¸ä¼¼ï¼Œè‹¥ç»“æœä¸ºå¦å®ƒå°±ä¼šæŠ›å‡ºé”™è¯¯ã€‚ assert å’Œ require åŒºåˆ«åœ¨äºï¼Œrequire è‹¥å¤±è´¥åˆ™ä¼šè¿”è¿˜ç»™ç”¨æˆ·å‰©ä¸‹çš„ gasï¼Œ assert åˆ™ä¸ä¼šã€‚æ‰€ä»¥å¤§éƒ¨åˆ†æƒ…å†µä¸‹ï¼Œä½ å†™ä»£ç çš„æ—¶å€™ä¼šæ¯”è¾ƒå–œæ¬¢ requireï¼Œassert åªåœ¨ä»£ç å¯èƒ½å‡ºç°ä¸¥é‡é”™è¯¯çš„æ—¶å€™ä½¿ç”¨ï¼Œæ¯”å¦‚ uint æº¢å‡ºã€‚</p><p>æ‰€ä»¥ç®€è€Œè¨€ä¹‹ï¼Œ SafeMath çš„ addï¼Œ subï¼Œ mulï¼Œ å’Œ div æ–¹æ³•åªåšç®€å•çš„å››åˆ™è¿ç®—ï¼Œç„¶ååœ¨å‘ç”Ÿæº¢å‡ºæˆ–ä¸‹æº¢çš„æ—¶å€™æŠ›å‡ºé”™è¯¯ã€‚</p><p><strong>åœ¨æˆ‘ä»¬çš„ä»£ç é‡Œä½¿ç”¨ SafeMathã€‚</strong><br>ä¸ºäº†é˜²æ­¢æº¢å‡ºå’Œä¸‹æº¢ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨æˆ‘ä»¬çš„ä»£ç é‡Œæ‰¾ +ï¼Œ -ï¼Œ *ï¼Œ æˆ– &#x2F;ï¼Œç„¶åæ›¿æ¢ä¸º add, sub, mul, div.</p><p>æ¯”å¦‚ï¼Œä¸å…¶è¿™æ ·åš:<code>myUint++;</code><br>æˆ‘ä»¬è¿™æ ·åš:<code>myUint = myUint.add(1);</code></p><p>å®æˆ˜æ¼”ä¹ ï¼š<br>    &#x2F;&#x2F; 1. æ›¿æ¢æˆ SafeMath çš„ <code>add</code><br>    ownerZombieCount[_to]++;<br>    &#x2F;&#x2F; 2. æ›¿æ¢æˆ SafeMath çš„ <code>sub</code><br>    ownerZombieCount[_from]â€“;</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">ownerZombieCount[_to] = ownerZombieCount[_to].add(1);</span><br><span class="line">ownerZombieCount[msg.sender] = ownerZombieCount[msg.sender].sub(1);</span><br></pre></td></tr></table></figure><h4 id="â‘ªSafeMath-ç¬¬ä¸‰éƒ¨åˆ†"><a href="#â‘ªSafeMath-ç¬¬ä¸‰éƒ¨åˆ†" class="headerlink" title="â‘ªSafeMath ç¬¬ä¸‰éƒ¨åˆ†"></a>â‘ªSafeMath ç¬¬ä¸‰éƒ¨åˆ†</h4><p>å¤ªå¥½äº†ï¼Œè¿™ä¸‹æˆ‘ä»¬çš„ ERC721 å®ç°ä¸ä¼šæœ‰æº¢å‡ºæˆ–è€…ä¸‹æº¢äº†ã€‚</p><p>å›å¤´çœ‹çœ‹æˆ‘ä»¬åœ¨ä¹‹å‰è¯¾ç¨‹å†™çš„ä»£ç ï¼Œè¿˜æœ‰å…¶ä»–å‡ ä¸ªåœ°æ–¹ä¹Ÿæœ‰å¯èƒ½å¯¼è‡´æº¢å‡ºæˆ–ä¸‹æº¢ã€‚</p><p>æ¯”å¦‚ï¼Œ åœ¨ ZombieAttack é‡Œé¢æˆ‘ä»¬æœ‰ï¼š</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">myZombie.winCount++;</span><br><span class="line">myZombie.level++;</span><br><span class="line">enemyZombie.lossCount++;</span><br></pre></td></tr></table></figure><p>æˆ‘ä»¬åŒæ ·åº”è¯¥åœ¨è¿™äº›åœ°æ–¹é˜²æ­¢æº¢å‡ºã€‚ï¼ˆé€šå¸¸æƒ…å†µä¸‹ï¼Œæ€»æ˜¯ä½¿ç”¨ SafeMath è€Œä¸æ˜¯æ™®é€šæ•°å­¦è¿ç®—æ˜¯ä¸ªå¥½ä¸»æ„ï¼Œä¹Ÿè®¸åœ¨ä»¥å Solidity çš„æ–°ç‰ˆæœ¬é‡Œè¿™ç‚¹ä¼šè¢«é»˜è®¤å®ç°ï¼Œä½†æ˜¯ç°åœ¨æˆ‘ä»¬å¾—è‡ªå·±åœ¨ä»£ç é‡Œå®ç°è¿™äº›é¢å¤–çš„å®‰å…¨æªæ–½ï¼‰ã€‚</p><p>ä¸è¿‡æˆ‘ä»¬é‡åˆ°ä¸ªå°é—®é¢˜ â€” winCount å’Œ lossCount æ˜¯ uint16ï¼Œ è€Œ level æ˜¯ uint32ã€‚ æ‰€ä»¥å¦‚æœæˆ‘ä»¬ç”¨è¿™äº›ä½œä¸ºå‚æ•°ä¼ å…¥ SafeMath çš„ add æ–¹æ³•ã€‚ å®ƒå®é™…ä¸Šå¹¶ä¸ä¼šé˜²æ­¢æº¢å‡ºï¼Œå› ä¸ºå®ƒä¼šæŠŠè¿™äº›å˜é‡éƒ½è½¬æ¢æˆ uint256:</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">function add(uint256 a, uint256 b) internal pure returns (uint256) &#123;</span><br><span class="line">  uint256 c = a + b;</span><br><span class="line">  assert(c &gt;= a);</span><br><span class="line">  return c;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// å¦‚æœæˆ‘ä»¬åœ¨`uint8` ä¸Šè°ƒç”¨ `.add`ã€‚å®ƒå°†ä¼šè¢«è½¬æ¢æˆ `uint256`.</span><br><span class="line">// æ‰€ä»¥å®ƒä¸ä¼šåœ¨ 2^8 æ—¶æº¢å‡ºï¼Œå› ä¸º 256 æ˜¯ä¸€ä¸ªæœ‰æ•ˆçš„ `uint256`.</span><br></pre></td></tr></table></figure><p>è¿™å°±æ„å‘³ç€ï¼Œæˆ‘ä»¬éœ€è¦å†å®ç°ä¸¤ä¸ªåº“æ¥é˜²æ­¢ uint16 å’Œ uint32 æº¢å‡ºæˆ–ä¸‹æº¢ã€‚æˆ‘ä»¬å¯ä»¥å°†å…¶å‘½åä¸º SafeMath16 å’Œ SafeMath32ã€‚</p><p>ä»£ç å°†å’Œ SafeMath å®Œå…¨ç›¸åŒï¼Œé™¤äº†æ‰€æœ‰çš„ uint256 å®ä¾‹éƒ½å°†è¢«æ›¿æ¢æˆ uint32 æˆ– uint16ã€‚</p><p>æˆ‘ä»¬å·²ç»å°†è¿™äº›ä»£ç å¸®ä½ å†™å¥½äº†ï¼Œæ‰“å¼€ safemath.sol åˆçº¦çœ‹çœ‹ä»£ç å§ã€‚</p><p>ç°åœ¨æˆ‘ä»¬éœ€è¦åœ¨ ZombieFactory é‡Œä½¿ç”¨å®ƒä»¬ã€‚</p><p>å®æˆ˜æ¼”ä¹ ï¼š</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">using SafeMath for uint256;</span><br><span class="line">using SafeMath32 for uint32;</span><br><span class="line">using SafeMath16 for uint16;</span><br></pre></td></tr></table></figure><h4 id="â‘«SafeMath-ç¬¬4éƒ¨åˆ†"><a href="#â‘«SafeMath-ç¬¬4éƒ¨åˆ†" class="headerlink" title="â‘«SafeMath ç¬¬4éƒ¨åˆ†"></a>â‘«SafeMath ç¬¬4éƒ¨åˆ†</h4><p>çœŸæ£’ï¼Œç°åœ¨æˆ‘ä»¬å·²ç»ä¸ºæˆ‘ä»¬çš„ DApp é‡Œé¢ç”¨åˆ°çš„ uint æ•°æ®ç±»å‹éƒ½å®ç°äº† SafeMath äº†ã€‚</p><p>è®©æˆ‘ä»¬æŠŠ ZombieAttack é‡Œæ‰€æœ‰æ½œåœ¨çš„é—®é¢˜éƒ½ä¿®å¤äº†å§ã€‚ ï¼ˆå…¶å®åœ¨ ZombieHelper é‡Œä¹Ÿæœ‰ä¸€å¤„ zombies[_zombieId].level++; éœ€è¦ä¿®å¤ï¼Œä¸è¿‡æˆ‘ä»¬å·²ç»å¸®ä½ åšå¥½äº†ï¼Œè¿™æ ·æˆ‘ä»¬å°±ä¸ç”¨å†æ¥ä¸€ç« äº† ğŸ˜‰ï¼‰ã€‚</p><h4 id="â‘¬æ³¨é‡Š"><a href="#â‘¬æ³¨é‡Š" class="headerlink" title="â‘¬æ³¨é‡Š"></a>â‘¬æ³¨é‡Š</h4><p>åƒµå°¸æ¸¸æˆçš„ Solidity ä»£ç ç»ˆäºå®Œæˆå•¦ã€‚</p><p>åœ¨ä»¥åçš„è¯¾ç¨‹ä¸­ï¼Œæˆ‘ä»¬å°†å­¦ä¹ å¦‚ä½•å°†æ¸¸æˆéƒ¨ç½²åˆ°ä»¥å¤ªåŠï¼Œä»¥åŠå¦‚ä½•å’Œ Web3.js äº¤äº’ã€‚</p><p>ä¸è¿‡åœ¨ä½ ç¦»å¼€ç¬¬äº”è¯¾ä¹‹å‰ï¼Œæˆ‘ä»¬æ¥è°ˆè°ˆå¦‚ä½• ç»™ä½ çš„ä»£ç æ·»åŠ æ³¨é‡Š.</p><p><strong>æ³¨é‡Šè¯­æ³•</strong><br>Solidity é‡Œçš„æ³¨é‡Šå’Œ JavaScript ç›¸åŒã€‚åœ¨æˆ‘ä»¬çš„è¯¾ç¨‹ä¸­ä½ å·²ç»çœ‹åˆ°äº†ä¸å°‘å•è¡Œæ³¨é‡Šäº†ï¼š</p><p><code>// è¿™æ˜¯ä¸€ä¸ªå•è¡Œæ³¨é‡Šï¼Œå¯ä»¥ç†è§£ä¸ºç»™è‡ªå·±æˆ–è€…åˆ«äººçœ‹çš„ç¬”è®°</code></p><p>åªè¦åœ¨ä»»ä½•åœ°æ–¹æ·»åŠ ä¸€ä¸ª &#x2F;&#x2F; å°±æ„å‘³ç€ä½ åœ¨æ³¨é‡Šã€‚å¦‚æ­¤ç®€å•æ‰€ä»¥ä½ åº”è¯¥ç»å¸¸è¿™ä¹ˆåšã€‚</p><p>ä¸è¿‡æˆ‘ä»¬ä¹ŸçŸ¥é“ä½ çš„æƒ³æ³•ï¼šæœ‰æ—¶å€™å•è¡Œæ³¨é‡Šæ˜¯ä¸å¤Ÿçš„ã€‚æ¯•ç«Ÿä½ ç”Ÿæ¥è¯ç—¨ã€‚</p><p>æ‰€ä»¥æˆ‘ä»¬æœ‰äº†å¤šè¡Œæ³¨é‡Šï¼š</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">contract CryptoZombies &#123;</span><br><span class="line">  /* è¿™æ˜¯ä¸€ä¸ªå¤šè¡Œæ³¨é‡Šã€‚æˆ‘æƒ³å¯¹æ‰€æœ‰èŠ±æ—¶é—´æ¥å°è¯•è¿™ä¸ªç¼–ç¨‹è¯¾ç¨‹çš„äººè¯´å£°è°¢è°¢ã€‚</span><br><span class="line">  å®ƒæ˜¯å…è´¹çš„ï¼Œå¹¶å°†æ°¸è¿œå…è´¹ã€‚ä½†æ˜¯æˆ‘ä»¬ä¾ç„¶å€¾æ³¨äº†æˆ‘ä»¬çš„å¿ƒè¡€æ¥è®©å®ƒå˜å¾—æ›´å¥½ã€‚</span><br><span class="line"></span><br><span class="line">   è¦çŸ¥é“è¿™ä¾ç„¶åªæ˜¯åŒºå—é“¾å¼€å‘çš„å¼€å§‹è€Œå·²ï¼Œè™½ç„¶æˆ‘ä»¬å·²ç»èµ°äº†å¾ˆè¿œï¼Œ</span><br><span class="line">   ä»ç„¶æœ‰å¾ˆå¤šç§æ–¹å¼æ¥è®©æˆ‘ä»¬çš„ç¤¾åŒºå˜å¾—æ›´å¥½ã€‚</span><br><span class="line">   å¦‚æœæˆ‘ä»¬åœ¨å“ªä¸ªåœ°æ–¹å‡ºäº†é”™ï¼Œæ¬¢è¿åœ¨æˆ‘ä»¬çš„ github æäº¤ PR æˆ–è€… issue æ¥å¸®åŠ©æˆ‘ä»¬æ”¹è¿›ï¼š</span><br><span class="line">    https://github.com/loomnetwork/cryptozombie-lessons</span><br><span class="line"></span><br><span class="line">    æˆ–è€…ï¼Œå¦‚æœä½ æœ‰ä»»ä½•çš„æƒ³æ³•ã€å»ºè®®ç”šè‡³ä»…ä»…æƒ³å’Œæˆ‘ä»¬æ‰“å£°æ‹›å‘¼ï¼Œæ¬¢è¿æ¥æˆ‘ä»¬çš„ç”µæŠ¥ç¾¤ï¼š</span><br><span class="line">     https://t.me/loomnetworkdev</span><br><span class="line">  */</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ç‰¹åˆ«æ˜¯ï¼Œæœ€å¥½ä¸ºä½ åˆçº¦ä¸­æ¯ä¸ªæ–¹æ³•æ·»åŠ æ³¨é‡Šæ¥è§£é‡Šå®ƒçš„é¢„æœŸè¡Œä¸ºã€‚è¿™æ ·å…¶ä»–å¼€å‘è€…ï¼ˆæˆ–è€…ä½ è‡ªå·±ï¼Œåœ¨6ä¸ªæœˆä»¥åå†å›åˆ°è¿™ä¸ªé¡¹ç›®ä¸­ï¼‰å¯ä»¥å¾ˆå¿«åœ°ç†è§£ä½ çš„ä»£ç è€Œä¸éœ€è¦é€è¡Œé˜…è¯»æ‰€æœ‰ä»£ç ã€‚</p><p>Solidity ç¤¾åŒºæ‰€ä½¿ç”¨çš„ä¸€ä¸ªæ ‡å‡†æ˜¯ä½¿ç”¨ä¸€ç§è¢«ç§°ä½œ natspec çš„æ ¼å¼ï¼Œçœ‹èµ·æ¥åƒè¿™æ ·ï¼š</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">/// @title ä¸€ä¸ªç®€å•çš„åŸºç¡€è¿ç®—åˆçº¦</span><br><span class="line">/// @author H4XF13LD MORRIS ğŸ’¯ğŸ’¯ğŸ˜ğŸ’¯ğŸ’¯</span><br><span class="line">/// @notice ç°åœ¨ï¼Œè¿™ä¸ªåˆçº¦åªæ·»åŠ ä¸€ä¸ªä¹˜æ³•</span><br><span class="line">contract Math &#123;</span><br><span class="line">  /// @notice ä¸¤ä¸ªæ•°ç›¸ä¹˜</span><br><span class="line">  /// @param x ç¬¬ä¸€ä¸ª uint</span><br><span class="line">  /// @param y  ç¬¬äºŒä¸ª uint</span><br><span class="line">  /// @return z  (x * y) çš„ç»“æœ</span><br><span class="line">  /// @dev ç°åœ¨è¿™ä¸ªæ–¹æ³•ä¸æ£€æŸ¥æº¢å‡º</span><br><span class="line">  function multiply(uint x, uint y) returns (uint z) &#123;</span><br><span class="line">    // è¿™åªæ˜¯ä¸ªæ™®é€šçš„æ³¨é‡Šï¼Œä¸ä¼šè¢« natspec è§£é‡Š</span><br><span class="line">    z = x * y;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ol><li>@titleï¼ˆæ ‡é¢˜ï¼‰ å’Œ @author ï¼ˆä½œè€…ï¼‰å¾ˆç›´æ¥äº†.</li><li>@notice ï¼ˆé¡»çŸ¥ï¼‰å‘ ç”¨æˆ· è§£é‡Šè¿™ä¸ªæ–¹æ³•æˆ–è€…åˆçº¦æ˜¯åšä»€ä¹ˆçš„ã€‚ @dev ï¼ˆå¼€å‘è€…ï¼‰ æ˜¯å‘å¼€å‘è€…è§£é‡Šæ›´å¤šçš„ç»†èŠ‚ã€‚</li><li>@param ï¼ˆå‚æ•°ï¼‰å’Œ @return ï¼ˆè¿”å›ï¼‰ ç”¨æ¥æè¿°è¿™ä¸ªæ–¹æ³•éœ€è¦ä¼ å…¥ä»€ä¹ˆå‚æ•°ä»¥åŠè¿”å›ä»€ä¹ˆå€¼ã€‚</li></ol><p>æ³¨æ„ä½ å¹¶ä¸éœ€è¦æ¯æ¬¡éƒ½ç”¨ä¸Šæ‰€æœ‰çš„æ ‡ç­¾ï¼Œå®ƒä»¬éƒ½æ˜¯å¯é€‰çš„ã€‚ä¸è¿‡æœ€å°‘ï¼Œå†™ä¸‹ä¸€ä¸ª @dev æ³¨é‡Šæ¥è§£é‡Šæ¯ä¸ªæ–¹æ³•æ˜¯åšä»€ä¹ˆçš„ã€‚</p><p>å®æˆ˜æ¼”ä¹ ï¼š</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">/// @title ä¸€ä¸ªç®¡ç†è½¬ç§»åƒµå°¸æ‰€æœ‰æƒçš„åˆçº¦</span><br><span class="line">/// @author formikasaever</span><br><span class="line">/// @dev ç¬¦åˆ OpenZeppelin å¯¹ ERC721 æ ‡å‡†è‰æ¡ˆçš„å®ç°</span><br><span class="line">contract ZombieOwnership is ZombieAttack, ERC721 &#123;</span><br></pre></td></tr></table></figure><h4 id="â‘­æ”¾åœ¨ä¸€èµ·"><a href="#â‘­æ”¾åœ¨ä¸€èµ·" class="headerlink" title="â‘­æ”¾åœ¨ä¸€èµ·"></a>â‘­æ”¾åœ¨ä¸€èµ·</h4><p><strong>æ€»ç»“ä¸€ä¸‹</strong><br>è¿™èŠ‚è¯¾é‡Œé¢æˆ‘ä»¬å­¦åˆ°äº†</p><ul><li>ä»£å¸, ERC721 æ ‡å‡†ï¼Œä»¥åŠå¯äº¤æ˜“çš„ç‰©ä»¶&#x2F;åƒµå°¸</li><li>åº“ä»¥åŠå¦‚ä½•ä½¿ç”¨åº“</li><li>å¦‚ä½•åˆ©ç”¨ SafeMath æ¥é˜²æ­¢æº¢å‡ºå’Œä¸‹æº¢</li><li>ä»£ç æ³¨é‡Šå’Œ natspec æ ‡å‡†</li></ul><p>è¿™èŠ‚æ•™ç¨‹å®Œæˆäº†æˆ‘ä»¬æ¸¸æˆçš„ Solidity ä»£ç ï¼ˆä»…é’ˆå¯¹å½“ä¸‹æ¥è¯´ï¼Œæœªæ¥çš„è¯¾ç¨‹æˆ‘ä»¬ä¹Ÿè®¸ä¼šåŠ å…¥æ›´å¤šè¿›å»ï¼‰ã€‚</p><p>åœ¨æ¥ä¸‹æ¥çš„ä¸¤èŠ‚è¯¾ä¸­ï¼Œæˆ‘ä»¬å°†å­¦ä¹ å¦‚ä½•å°†æ¸¸æˆéƒ¨ç½²åˆ°ä»¥å¤ªåŠä»¥åŠå’Œ web3.js äº¤äº’ ï¼ˆè¿™æ ·ä½ å°±èƒ½ä¸ºä½ çš„ DApp æ‰“é€ ä¸€ä¸ªç•Œé¢äº† ï¼‰ã€‚</p><h4 id="â‘®ç¬¬äº”è¯¾å®Œæˆ"><a href="#â‘®ç¬¬äº”è¯¾å®Œæˆ" class="headerlink" title="â‘®ç¬¬äº”è¯¾å®Œæˆ"></a>â‘®ç¬¬äº”è¯¾å®Œæˆ</h4><p>æˆªè‡³ç¬¬äº”è¯¾å®Œæˆï¼Œæ‰€æœ‰ä»£ç å¦‚ä¸‹ï¼š<br><strong>zombieownership.sol:</strong></p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">pragma solidity ^0.4.19;</span><br><span class="line"></span><br><span class="line">import &quot;./zombieattack.sol&quot;;</span><br><span class="line">import &quot;./erc721.sol&quot;;</span><br><span class="line">import &quot;./safemath.sol&quot;;</span><br><span class="line"></span><br><span class="line">/// @title ä¸€ä¸ªç®¡ç†è½¬ç§»åƒµå°¸æ‰€æœ‰æƒçš„åˆçº¦</span><br><span class="line">/// @author formikasaever</span><br><span class="line">/// @dev ç¬¦åˆ OpenZeppelin å¯¹ ERC721 æ ‡å‡†è‰æ¡ˆçš„å®ç°</span><br><span class="line">contract ZombieOwnership is ZombieAttack, ERC721 &#123;</span><br><span class="line"></span><br><span class="line">  using SafeMath for uint256;</span><br><span class="line"></span><br><span class="line">  mapping (uint =&gt; address) zombieApprovals;</span><br><span class="line"></span><br><span class="line">  function balanceOf(address _owner) public view returns (uint256 _balance) &#123;</span><br><span class="line">    return ownerZombieCount[_owner];</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  function ownerOf(uint256 _tokenId) public view returns (address _owner) &#123;</span><br><span class="line">    return zombieToOwner[_tokenId];</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  function _transfer(address _from, address _to, uint256 _tokenId) private &#123;</span><br><span class="line">    ownerZombieCount[_to] = ownerZombieCount[_to].add(1);</span><br><span class="line">    ownerZombieCount[msg.sender] = ownerZombieCount[msg.sender].sub(1);</span><br><span class="line">    zombieToOwner[_tokenId] = _to;</span><br><span class="line">    Transfer(_from, _to, _tokenId);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  function transfer(address _to, uint256 _tokenId) public onlyOwnerOf(_tokenId) &#123;</span><br><span class="line">    _transfer(msg.sender, _to, _tokenId);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  function approve(address _to, uint256 _tokenId) public onlyOwnerOf(_tokenId) &#123;</span><br><span class="line">    zombieApprovals[_tokenId] = _to;</span><br><span class="line">    Approval(msg.sender, _to, _tokenId);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  function takeOwnership(uint256 _tokenId) public &#123;</span><br><span class="line">    require(zombieApprovals[_tokenId] == msg.sender);</span><br><span class="line">    address owner = ownerOf(_tokenId);</span><br><span class="line">    _transfer(owner, msg.sender, _tokenId);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>zombieattack.sol:</strong></p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">pragma solidity ^0.4.19;</span><br><span class="line"></span><br><span class="line">import &quot;./zombiehelper.sol&quot;;</span><br><span class="line"></span><br><span class="line">contract ZombieBattle is ZombieHelper &#123;</span><br><span class="line">  uint randNonce = 0;</span><br><span class="line">  uint attackVictoryProbability = 70;</span><br><span class="line"></span><br><span class="line">  function randMod(uint _modulus) internal returns(uint) &#123;</span><br><span class="line">    randNonce++;</span><br><span class="line">    return uint(keccak256(now, msg.sender, randNonce)) % _modulus;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  function attack(uint _zombieId, uint _targetId) external onlyOwnerOf(_zombieId) &#123;</span><br><span class="line">    Zombie storage myZombie = zombies[_zombieId];</span><br><span class="line">    Zombie storage enemyZombie = zombies[_targetId];</span><br><span class="line">    uint rand = randMod(100);</span><br><span class="line">    if (rand &lt;= attackVictoryProbability) &#123;</span><br><span class="line">      myZombie.winCount++;</span><br><span class="line">      myZombie.level++;</span><br><span class="line">      enemyZombie.lossCount++;</span><br><span class="line">      feedAndMultiply(_zombieId, enemyZombie.dna, &quot;zombie&quot;);</span><br><span class="line">    &#125; else &#123;</span><br><span class="line">      myZombie.lossCount++;</span><br><span class="line">      enemyZombie.winCount++;</span><br><span class="line">      _triggerCooldown(myZombie);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>zombiehelper.sol:</strong></p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">pragma solidity ^0.4.19;</span><br><span class="line"></span><br><span class="line">import &quot;./zombiefeeding.sol&quot;;</span><br><span class="line"></span><br><span class="line">contract ZombieHelper is ZombieFeeding &#123;</span><br><span class="line"></span><br><span class="line">  uint levelUpFee = 0.001 ether;</span><br><span class="line"></span><br><span class="line">  modifier aboveLevel(uint _level, uint _zombieId) &#123;</span><br><span class="line">    require(zombies[_zombieId].level &gt;= _level);</span><br><span class="line">    _;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  function withdraw() external onlyOwner &#123;</span><br><span class="line">    owner.transfer(this.balance);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  function setLevelUpFee(uint _fee) external onlyOwner &#123;</span><br><span class="line">    levelUpFee = _fee;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  function levelUp(uint _zombieId) external payable &#123;</span><br><span class="line">    require(msg.value == levelUpFee);</span><br><span class="line">    zombies[_zombieId].level++;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  function changeName(uint _zombieId, string _newName) external aboveLevel(2, _zombieId) onlyOwnerOf(_zombieId) &#123;</span><br><span class="line">    zombies[_zombieId].name = _newName;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  function changeDna(uint _zombieId, uint _newDna) external aboveLevel(20, _zombieId) onlyOwnerOf(_zombieId) &#123;</span><br><span class="line">    zombies[_zombieId].dna = _newDna;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  function getZombiesByOwner(address _owner) external view returns(uint[]) &#123;</span><br><span class="line">    uint[] memory result = new uint[](ownerZombieCount[_owner]);</span><br><span class="line">    uint counter = 0;</span><br><span class="line">    for (uint i = 0; i &lt; zombies.length; i++) &#123;</span><br><span class="line">      if (zombieToOwner[i] == _owner) &#123;</span><br><span class="line">        result[counter] = i;</span><br><span class="line">        counter++;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    return result;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>zombiefeeding.sol:</strong></p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">pragma solidity ^0.4.19;</span><br><span class="line"></span><br><span class="line">import &quot;./zombiefactory.sol&quot;;</span><br><span class="line"></span><br><span class="line">contract KittyInterface &#123;</span><br><span class="line">  function getKitty(uint256 _id) external view returns (</span><br><span class="line">    bool isGestating,</span><br><span class="line">    bool isReady,</span><br><span class="line">    uint256 cooldownIndex,</span><br><span class="line">    uint256 nextActionAt,</span><br><span class="line">    uint256 siringWithId,</span><br><span class="line">    uint256 birthTime,</span><br><span class="line">    uint256 matronId,</span><br><span class="line">    uint256 sireId,</span><br><span class="line">    uint256 generation,</span><br><span class="line">    uint256 genes</span><br><span class="line">  );</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">contract ZombieFeeding is ZombieFactory &#123;</span><br><span class="line"></span><br><span class="line">  KittyInterface kittyContract;</span><br><span class="line"></span><br><span class="line">  modifier onlyOwnerOf(uint _zombieId) &#123;</span><br><span class="line">    require(msg.sender == zombieToOwner[_zombieId]);</span><br><span class="line">    _;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  function setKittyContractAddress(address _address) external onlyOwner &#123;</span><br><span class="line">    kittyContract = KittyInterface(_address);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  function _triggerCooldown(Zombie storage _zombie) internal &#123;</span><br><span class="line">    _zombie.readyTime = uint32(now + cooldownTime);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  function _isReady(Zombie storage _zombie) internal view returns (bool) &#123;</span><br><span class="line">      return (_zombie.readyTime &lt;= now);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  function feedAndMultiply(uint _zombieId, uint _targetDna, string _species) internal onlyOwnerOf(_zombieId) &#123;</span><br><span class="line">    Zombie storage myZombie = zombies[_zombieId];</span><br><span class="line">    require(_isReady(myZombie));</span><br><span class="line">    _targetDna = _targetDna % dnaModulus;</span><br><span class="line">    uint newDna = (myZombie.dna + _targetDna) / 2;</span><br><span class="line">    if (keccak256(_species) == keccak256(&quot;kitty&quot;)) &#123;</span><br><span class="line">      newDna = newDna - newDna % 100 + 99;</span><br><span class="line">    &#125;</span><br><span class="line">    _createZombie(&quot;NoName&quot;, newDna);</span><br><span class="line">    _triggerCooldown(myZombie);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  function feedOnKitty(uint _zombieId, uint _kittyId) public &#123;</span><br><span class="line">    uint kittyDna;</span><br><span class="line">    (,,,,,,,,,kittyDna) = kittyContract.getKitty(_kittyId);</span><br><span class="line">    feedAndMultiply(_zombieId, kittyDna, &quot;kitty&quot;);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>zombiefactory.sol:</strong></p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">pragma solidity ^0.4.19;</span><br><span class="line"></span><br><span class="line">import &quot;./ownable.sol&quot;;</span><br><span class="line">import &quot;./safemath.sol&quot;;</span><br><span class="line"></span><br><span class="line">contract ZombieFactory is Ownable &#123;</span><br><span class="line"></span><br><span class="line">  using SafeMath for uint256;</span><br><span class="line"></span><br><span class="line">  event NewZombie(uint zombieId, string name, uint dna);</span><br><span class="line"></span><br><span class="line">  uint dnaDigits = 16;</span><br><span class="line">  uint dnaModulus = 10 ** dnaDigits;</span><br><span class="line">  uint cooldownTime = 1 days;</span><br><span class="line"></span><br><span class="line">  struct Zombie &#123;</span><br><span class="line">    string name;</span><br><span class="line">    uint dna;</span><br><span class="line">    uint32 level;</span><br><span class="line">    uint32 readyTime;</span><br><span class="line">    uint16 winCount;</span><br><span class="line">    uint16 lossCount;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  Zombie[] public zombies;</span><br><span class="line"></span><br><span class="line">  mapping (uint =&gt; address) public zombieToOwner;</span><br><span class="line">  mapping (address =&gt; uint) ownerZombieCount;</span><br><span class="line"></span><br><span class="line">  function _createZombie(string _name, uint _dna) internal &#123;</span><br><span class="line">    uint id = zombies.push(Zombie(_name, _dna, 1, uint32(now + cooldownTime), 0, 0)) - 1;</span><br><span class="line">    zombieToOwner[id] = msg.sender;</span><br><span class="line">    ownerZombieCount[msg.sender]++;</span><br><span class="line">    NewZombie(id, _name, _dna);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  function _generateRandomDna(string _str) private view returns (uint) &#123;</span><br><span class="line">    uint rand = uint(keccak256(_str));</span><br><span class="line">    return rand % dnaModulus;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  function createRandomZombie(string _name) public &#123;</span><br><span class="line">    require(ownerZombieCount[msg.sender] == 0);</span><br><span class="line">    uint randDna = _generateRandomDna(_name);</span><br><span class="line">    randDna = randDna - randDna % 100;</span><br><span class="line">    _createZombie(_name, randDna);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>ownable.sol:</strong></p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">pragma solidity ^0.4.19;</span><br><span class="line">/**</span><br><span class="line"> * @title Ownable</span><br><span class="line"> * @dev The Ownable contract has an owner address, and provides basic authorization control</span><br><span class="line"> * functions, this simplifies the implementation of &quot;user permissions&quot;.</span><br><span class="line"> */</span><br><span class="line">contract Ownable &#123;</span><br><span class="line">  address public owner;</span><br><span class="line"></span><br><span class="line">  event OwnershipTransferred(address indexed previousOwner, address indexed newOwner);</span><br><span class="line"></span><br><span class="line">  /**</span><br><span class="line">   * @dev The Ownable constructor sets the original `owner` of the contract to the sender</span><br><span class="line">   * account.</span><br><span class="line">   */</span><br><span class="line">  function Ownable() public &#123;</span><br><span class="line">    owner = msg.sender;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">  /**</span><br><span class="line">   * @dev Throws if called by any account other than the owner.</span><br><span class="line">   */</span><br><span class="line">  modifier onlyOwner() &#123;</span><br><span class="line">    require(msg.sender == owner);</span><br><span class="line">    _;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">  /**</span><br><span class="line">   * @dev Allows the current owner to transfer control of the contract to a newOwner.</span><br><span class="line">   * @param newOwner The address to transfer ownership to.</span><br><span class="line">   */</span><br><span class="line">  function transferOwnership(address newOwner) public onlyOwner &#123;</span><br><span class="line">    require(newOwner != address(0));</span><br><span class="line">    OwnershipTransferred(owner, newOwner);</span><br><span class="line">    owner = newOwner;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>safemath.sol:</strong></p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">pragma solidity ^0.4.18;</span><br><span class="line"></span><br><span class="line">/**</span><br><span class="line"> * @title SafeMath</span><br><span class="line"> * @dev Math operations with safety checks that throw on error</span><br><span class="line"> */</span><br><span class="line">library SafeMath &#123;</span><br><span class="line"></span><br><span class="line">  /**</span><br><span class="line">  * @dev Multiplies two numbers, throws on overflow.</span><br><span class="line">  */</span><br><span class="line">  function mul(uint256 a, uint256 b) internal pure returns (uint256) &#123;</span><br><span class="line">    if (a == 0) &#123;</span><br><span class="line">      return 0;</span><br><span class="line">    &#125;</span><br><span class="line">    uint256 c = a * b;</span><br><span class="line">    assert(c / a == b);</span><br><span class="line">    return c;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  /**</span><br><span class="line">  * @dev Integer division of two numbers, truncating the quotient.</span><br><span class="line">  */</span><br><span class="line">  function div(uint256 a, uint256 b) internal pure returns (uint256) &#123;</span><br><span class="line">    // assert(b &gt; 0); // Solidity automatically throws when dividing by 0</span><br><span class="line">    uint256 c = a / b;</span><br><span class="line">    // assert(a == b * c + a % b); // There is no case in which this doesn&#x27;t hold</span><br><span class="line">    return c;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  /**</span><br><span class="line">  * @dev Substracts two numbers, throws on overflow (i.e. if subtrahend is greater than minuend).</span><br><span class="line">  */</span><br><span class="line">  function sub(uint256 a, uint256 b) internal pure returns (uint256) &#123;</span><br><span class="line">    assert(b &lt;= a);</span><br><span class="line">    return a - b;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  /**</span><br><span class="line">  * @dev Adds two numbers, throws on overflow.</span><br><span class="line">  */</span><br><span class="line">  function add(uint256 a, uint256 b) internal pure returns (uint256) &#123;</span><br><span class="line">    uint256 c = a + b;</span><br><span class="line">    assert(c &gt;= a);</span><br><span class="line">    return c;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>erc721.sol:</strong></p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">pragma solidity ^0.4.19;</span><br><span class="line">contract ERC721 &#123;</span><br><span class="line">  event Transfer(address indexed _from, address indexed _to, uint256 _tokenId);</span><br><span class="line">  event Approval(address indexed _owner, address indexed _approved, uint256 _tokenId);</span><br><span class="line"></span><br><span class="line">  function balanceOf(address _owner) public view returns (uint256 _balance);</span><br><span class="line">  function ownerOf(uint256 _tokenId) public view returns (address _owner);</span><br><span class="line">  function transfer(address _to, uint256 _tokenId) public;</span><br><span class="line">  function approve(address _to, uint256 _tokenId) public;</span><br><span class="line">  function takeOwnership(uint256 _tokenId) public;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><hr><h3 id="å¿ƒå¾—"><a href="#å¿ƒå¾—" class="headerlink" title="å¿ƒå¾—"></a>å¿ƒå¾—</h3><h4 id="â‘ "><a href="#â‘ " class="headerlink" title="â‘ "></a>â‘ </h4>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>åƒµå°¸æ¸¸æˆç¬¬å››è¯¾</title>
      <link href="/post/8656b72d.html"/>
      <url>/post/8656b72d.html</url>
      
        <content type="html"><![CDATA[<h1 id="ä¸‰å¶è‰å®éªŒå®¤â€œæœŸæœ«ä»»åŠ¡â€æ€»ç»“ï¼ˆç»­ï¼‰-ç¬¬å››è¯¾"><a href="#ä¸‰å¶è‰å®éªŒå®¤â€œæœŸæœ«ä»»åŠ¡â€æ€»ç»“ï¼ˆç»­ï¼‰-ç¬¬å››è¯¾" class="headerlink" title="ä¸‰å¶è‰å®éªŒå®¤â€œæœŸæœ«ä»»åŠ¡â€æ€»ç»“ï¼ˆç»­ï¼‰(ç¬¬å››è¯¾)"></a>ä¸‰å¶è‰å®éªŒå®¤â€œæœŸæœ«ä»»åŠ¡â€æ€»ç»“ï¼ˆç»­ï¼‰(ç¬¬å››è¯¾)</h1><h2 id="ä»»åŠ¡ä¸€ï¼šå®ŒæˆåŠ å¯†åƒµå°¸çš„æ¸¸æˆ"><a href="#ä»»åŠ¡ä¸€ï¼šå®ŒæˆåŠ å¯†åƒµå°¸çš„æ¸¸æˆ" class="headerlink" title="ä»»åŠ¡ä¸€ï¼šå®ŒæˆåŠ å¯†åƒµå°¸çš„æ¸¸æˆ"></a>ä»»åŠ¡ä¸€ï¼šå®ŒæˆåŠ å¯†åƒµå°¸çš„æ¸¸æˆ</h2><h3 id="4-åƒµå°¸ä½œæˆ˜ç³»ç»Ÿ"><a href="#4-åƒµå°¸ä½œæˆ˜ç³»ç»Ÿ" class="headerlink" title="4.åƒµå°¸ä½œæˆ˜ç³»ç»Ÿ"></a>4.åƒµå°¸ä½œæˆ˜ç³»ç»Ÿ</h3><h4 id="â‘ å¯æ”¯ä»˜"><a href="#â‘ å¯æ”¯ä»˜" class="headerlink" title="â‘ å¯æ”¯ä»˜"></a>â‘ å¯æ”¯ä»˜</h4><p>æˆªè‡³ç›®å‰ï¼Œæˆ‘ä»¬åªæ¥è§¦åˆ°å¾ˆå°‘çš„ å‡½æ•°ä¿®é¥°ç¬¦ã€‚ è¦è®°ä½æ‰€æœ‰çš„ä¸œè¥¿å¾ˆéš¾ï¼Œæ‰€ä»¥æˆ‘ä»¬æ¥ä¸ªæ¦‚è§ˆï¼š</p><ol><li><p>æˆ‘ä»¬æœ‰å†³å®šå‡½æ•°ä½•æ—¶å’Œè¢«è°è°ƒç”¨çš„å¯è§æ€§ä¿®é¥°ç¬¦: private æ„å‘³ç€å®ƒåªèƒ½è¢«åˆçº¦å†…éƒ¨è°ƒç”¨ï¼› internal å°±åƒ private ä½†æ˜¯ä¹Ÿèƒ½è¢«ç»§æ‰¿çš„åˆçº¦è°ƒç”¨ï¼› external åªèƒ½ä»åˆçº¦å¤–éƒ¨è°ƒç”¨ï¼›æœ€å public å¯ä»¥åœ¨ä»»ä½•åœ°æ–¹è°ƒç”¨ï¼Œä¸ç®¡æ˜¯å†…éƒ¨è¿˜æ˜¯å¤–éƒ¨ã€‚</p></li><li><p>æˆ‘ä»¬ä¹Ÿæœ‰çŠ¶æ€ä¿®é¥°ç¬¦ï¼Œ å‘Šè¯‰æˆ‘ä»¬å‡½æ•°å¦‚ä½•å’ŒåŒºå—é“¾äº¤äº’: view å‘Šè¯‰æˆ‘ä»¬è¿è¡Œè¿™ä¸ªå‡½æ•°ä¸ä¼šæ›´æ”¹å’Œä¿å­˜ä»»ä½•æ•°æ®ï¼› pure å‘Šè¯‰æˆ‘ä»¬è¿™ä¸ªå‡½æ•°ä¸ä½†ä¸ä¼šå¾€åŒºå—é“¾å†™æ•°æ®ï¼Œå®ƒç”šè‡³ä¸ä»åŒºå—é“¾è¯»å–æ•°æ®ã€‚è¿™ä¸¤ç§åœ¨è¢«ä»åˆçº¦å¤–éƒ¨è°ƒç”¨çš„æ—¶å€™éƒ½ä¸èŠ±è´¹ä»»ä½•gasï¼ˆä½†æ˜¯å®ƒä»¬åœ¨è¢«å†…éƒ¨å…¶ä»–å‡½æ•°è°ƒç”¨çš„æ—¶å€™å°†ä¼šè€—è´¹gasï¼‰ã€‚</p></li><li><p>ç„¶åæˆ‘ä»¬æœ‰äº†è‡ªå®šä¹‰çš„ modifiersï¼Œä¾‹å¦‚åœ¨ç¬¬ä¸‰è¯¾å­¦ä¹ çš„: onlyOwner å’Œ aboveLevelã€‚ å¯¹äºè¿™äº›ä¿®é¥°ç¬¦æˆ‘ä»¬å¯ä»¥è‡ªå®šä¹‰å…¶å¯¹å‡½æ•°çš„çº¦æŸé€»è¾‘ã€‚</p></li></ol><p>è¿™äº›ä¿®é¥°ç¬¦å¯ä»¥åŒæ—¶ä½œç”¨äºä¸€ä¸ªå‡½æ•°å®šä¹‰ä¸Šï¼š</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">function test() external view onlyOwner anotherModifier &#123; /* ... */ &#125;</span><br></pre></td></tr></table></figure><p>åœ¨è¿™ä¸€ç« ï¼Œæˆ‘ä»¬æ¥å­¦ä¹ ä¸€ä¸ªæ–°çš„ä¿®é¥°ç¬¦ payable.</p><p><strong>payable ä¿®é¥°ç¬¦</strong></p><p>payable æ–¹æ³•æ˜¯è®© Solidity å’Œä»¥å¤ªåŠå˜å¾—å¦‚æ­¤é…·çš„ä¸€éƒ¨åˆ† â€”â€” å®ƒä»¬æ˜¯ä¸€ç§å¯ä»¥æ¥æ”¶ä»¥å¤ªçš„ç‰¹æ®Šå‡½æ•°ã€‚</p><p>å…ˆæ”¾ä¸€ä¸‹ã€‚å½“ä½ åœ¨è°ƒç”¨ä¸€ä¸ªæ™®é€šç½‘ç«™æœåŠ¡å™¨ä¸Šçš„APIå‡½æ•°çš„æ—¶å€™ï¼Œä½ æ— æ³•ç”¨ä½ çš„å‡½æ•°ä¼ é€ç¾å…ƒâ€”â€”ä½ ä¹Ÿä¸èƒ½ä¼ é€æ¯”ç‰¹å¸ã€‚</p><p>ä½†æ˜¯åœ¨ä»¥å¤ªåŠä¸­ï¼Œ å› ä¸ºé’± (<em>ä»¥å¤ª</em>), æ•°æ® (äº‹åŠ¡è´Ÿè½½)ï¼Œ ä»¥åŠåˆçº¦ä»£ç æœ¬èº«éƒ½å­˜åœ¨äºä»¥å¤ªåŠã€‚ä½ å¯ä»¥åœ¨åŒæ—¶è°ƒç”¨å‡½æ•° å¹¶ä»˜é’±ç»™å¦å¤–ä¸€ä¸ªåˆçº¦ã€‚</p><p>è¿™å°±å…è®¸å‡ºç°å¾ˆå¤šæœ‰è¶£çš„é€»è¾‘ï¼Œ æ¯”å¦‚å‘ä¸€ä¸ªåˆçº¦è¦æ±‚æ”¯ä»˜ä¸€å®šçš„é’±æ¥è¿è¡Œä¸€ä¸ªå‡½æ•°ã€‚</p><p><strong>æ¥çœ‹ä¸ªä¾‹å­</strong></p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">contract OnlineStore &#123;</span><br><span class="line">  function buySomething() external payable &#123;</span><br><span class="line">    // æ£€æŸ¥ä»¥ç¡®å®š0.001ä»¥å¤ªå‘é€å‡ºå»æ¥è¿è¡Œå‡½æ•°:</span><br><span class="line">    require(msg.value == 0.001 ether);</span><br><span class="line">    // å¦‚æœä¸ºçœŸï¼Œä¸€äº›ç”¨æ¥å‘å‡½æ•°è°ƒç”¨è€…å‘é€æ•°å­—å†…å®¹çš„é€»è¾‘</span><br><span class="line">    transferThing(msg.sender);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>åœ¨è¿™é‡Œï¼Œmsg.value æ˜¯ä¸€ç§å¯ä»¥æŸ¥çœ‹å‘åˆçº¦å‘é€äº†å¤šå°‘ä»¥å¤ªçš„æ–¹æ³•ï¼Œå¦å¤– ether æ˜¯ä¸€ä¸ªå…§å»ºå•å…ƒã€‚</p><p>è¿™é‡Œå‘ç”Ÿçš„äº‹æ˜¯ï¼Œä¸€äº›äººä¼šä» web3.js è°ƒç”¨è¿™ä¸ªå‡½æ•° (ä»DAppçš„å‰ç«¯)ï¼Œ åƒè¿™æ · :</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">// å‡è®¾ `OnlineStore` åœ¨ä»¥å¤ªåŠä¸ŠæŒ‡å‘ä½ çš„åˆçº¦:</span><br><span class="line">OnlineStore.buySomething().send(from: web3.eth.defaultAccount, value: web3.utils.toWei(0.001))</span><br></pre></td></tr></table></figure><p>æ³¨æ„è¿™ä¸ª value å­—æ®µï¼Œ JavaScript è°ƒç”¨æ¥æŒ‡å®šå‘é€å¤šå°‘(0.001)ä»¥å¤ªã€‚å¦‚æœæŠŠäº‹åŠ¡æƒ³è±¡æˆä¸€ä¸ªä¿¡å°ï¼Œä½ å‘é€åˆ°å‡½æ•°çš„å‚æ•°å°±æ˜¯ä¿¡çš„å†…å®¹ã€‚ æ·»åŠ ä¸€ä¸ª value å¾ˆåƒåœ¨ä¿¡å°é‡Œé¢æ”¾é’± â€”â€” ä¿¡ä»¶å†…å®¹å’Œé’±åŒæ—¶å‘é€ç»™äº†æ¥æ”¶è€…ã€‚</p><blockquote><p>æ³¨æ„ï¼š å¦‚æœä¸€ä¸ªå‡½æ•°æ²¡æ ‡è®°ä¸ºpayableï¼Œ è€Œä½ å°è¯•åˆ©ç”¨ä¸Šé¢çš„æ–¹æ³•å‘é€ä»¥å¤ªï¼Œå‡½æ•°å°†æ‹’ç»ä½ çš„äº‹åŠ¡ã€‚</p></blockquote><p>å®æˆ˜æ¼”ä¹ ï¼š</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">uint levelUpFee = 0.001 ether;</span><br><span class="line"></span><br><span class="line">function levelUp(uint _zombieId) external payable &#123;</span><br><span class="line">    require(msg.value == levelUpFee);</span><br><span class="line">    zombies[_zombieId].level++;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="â‘¡æç°"><a href="#â‘¡æç°" class="headerlink" title="â‘¡æç°"></a>â‘¡æç°</h4><p>åœ¨ä½ å‘é€ä»¥å¤ªä¹‹åï¼Œå®ƒå°†è¢«å­˜å‚¨è¿›ä»¥åˆçº¦çš„ä»¥å¤ªåŠè´¦æˆ·ä¸­ï¼Œ å¹¶å†»ç»“åœ¨å“ªé‡Œ â€”â€” é™¤éä½ æ·»åŠ ä¸€ä¸ªå‡½æ•°æ¥ä»åˆçº¦ä¸­æŠŠä»¥å¤ªæç°ã€‚</p><p>ä½ å¯ä»¥å†™ä¸€ä¸ªå‡½æ•°æ¥ä»åˆçº¦ä¸­æç°ä»¥å¤ªï¼Œç±»ä¼¼è¿™æ ·ï¼š</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">contract GetPaid is Ownable &#123;</span><br><span class="line">  function withdraw() external onlyOwner &#123;</span><br><span class="line">    owner.transfer(this.balance);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ³¨æ„æˆ‘ä»¬ä½¿ç”¨ Ownable åˆçº¦ä¸­çš„ owner å’Œ onlyOwnerï¼Œå‡å®šå®ƒå·²ç»è¢«å¼•å…¥äº†ã€‚</p><p>ä½ å¯ä»¥é€šè¿‡ transfer å‡½æ•°å‘ä¸€ä¸ªåœ°å€å‘é€ä»¥å¤ªï¼Œ ç„¶å this.balance å°†è¿”å›å½“å‰åˆçº¦å­˜å‚¨äº†å¤šå°‘ä»¥å¤ªã€‚ æ‰€ä»¥å¦‚æœ100ä¸ªç”¨æˆ·æ¯äººå‘æˆ‘ä»¬æ”¯ä»˜1ä»¥å¤ªï¼Œ this.balance å°†æ˜¯100ä»¥å¤ªã€‚</p><p>ä½ å¯ä»¥é€šè¿‡ transfer å‘ä»»ä½•ä»¥å¤ªåŠåœ°å€ä»˜é’±ã€‚ æ¯”å¦‚ï¼Œä½ å¯ä»¥æœ‰ä¸€ä¸ªå‡½æ•°åœ¨ msg.sender è¶…é¢ä»˜æ¬¾çš„æ—¶å€™ç»™ä»–ä»¬é€€é’±ï¼š</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">uint itemFee = 0.001 ether;</span><br><span class="line">msg.sender.transfer(msg.value - itemFee);</span><br></pre></td></tr></table></figure><p>æˆ–è€…åœ¨ä¸€ä¸ªæœ‰å–å®¶å’Œå–å®¶çš„åˆçº¦ä¸­ï¼Œ ä½ å¯ä»¥æŠŠå–å®¶çš„åœ°å€å­˜å‚¨èµ·æ¥ï¼Œ å½“æœ‰äººä¹°äº†å®ƒçš„ä¸œè¥¿çš„æ—¶å€™ï¼ŒæŠŠä¹°å®¶æ”¯ä»˜çš„é’±å‘é€ç»™å®ƒ seller.transfer(msg.value)ã€‚</p><p>æœ‰å¾ˆå¤šä¾‹å­æ¥å±•ç¤ºä»€ä¹ˆè®©ä»¥å¤ªåŠç¼–ç¨‹å¦‚æ­¤ä¹‹é…· â€”â€” ä½ å¯ä»¥æ‹¥æœ‰ä¸€ä¸ªä¸è¢«ä»»ä½•äººæ§åˆ¶çš„å»ä¸­å¿ƒåŒ–å¸‚åœºã€‚</p><p>å®æˆ˜æ¼”ä¹ ï¼š</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">function withdraw() external onlyOwner &#123;</span><br><span class="line">    owner.transfer(this.balance);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  function setLevelUpFee(uint _fee) external onlyOwner &#123;</span><br><span class="line">    levelUpFee = _fee;</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure><h4 id="â‘¢åƒµå°¸æˆ˜æ–—"><a href="#â‘¢åƒµå°¸æˆ˜æ–—" class="headerlink" title="â‘¢åƒµå°¸æˆ˜æ–—"></a>â‘¢åƒµå°¸æˆ˜æ–—</h4><p>åœ¨æˆ‘ä»¬å­¦ä¹ äº†å¯æ”¯ä»˜å‡½æ•°å’Œåˆçº¦ä½™é¢ä¹‹åï¼Œæ˜¯æ—¶å€™ä¸ºåƒµå°¸æˆ˜æ–—æ·»åŠ åŠŸèƒ½äº†ã€‚</p><p>éµå¾ªä¸Šä¸€ç« çš„æ ¼å¼ï¼Œæˆ‘ä»¬æ–°å»ºä¸€ä¸ªæ”»å‡»åŠŸèƒ½åˆçº¦ï¼Œå¹¶å°†ä»£ç æ”¾è¿›æ–°çš„æ–‡ä»¶ä¸­ï¼Œå¼•å…¥ä¸Šä¸€ä¸ªåˆçº¦ã€‚<br>å®æˆ˜æ¼”ä¹ ï¼š<br>zombieattack.sol:</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">pragma solidity ^0.4.19;</span><br><span class="line"></span><br><span class="line">import &quot;./zombiehelper.sol&quot;;</span><br><span class="line"></span><br><span class="line">contract ZombieBattle is ZombieHelper &#123;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="â‘£éšæœºæ•°"><a href="#â‘£éšæœºæ•°" class="headerlink" title="â‘£éšæœºæ•°"></a>â‘£éšæœºæ•°</h4><p><strong>ç”¨ keccak256 æ¥åˆ¶é€ éšæœºæ•°ã€‚</strong><br>Solidity ä¸­æœ€å¥½çš„éšæœºæ•°ç”Ÿæˆå™¨æ˜¯ keccak256 å“ˆå¸Œå‡½æ•°.</p><p>æˆ‘ä»¬å¯ä»¥è¿™æ ·æ¥ç”Ÿæˆä¸€äº›éšæœºæ•°</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">// ç”Ÿæˆä¸€ä¸ª0åˆ°100çš„éšæœºæ•°:</span><br><span class="line">uint randNonce = 0;</span><br><span class="line">uint random = uint(keccak256(now, msg.sender, randNonce)) % 100;</span><br><span class="line">randNonce++;</span><br><span class="line">uint random2 = uint(keccak256(now, msg.sender, randNonce)) % 100;</span><br></pre></td></tr></table></figure><p>è¿™ä¸ªæ–¹æ³•é¦–å…ˆæ‹¿åˆ° now çš„æ—¶é—´æˆ³ã€ msg.senderã€ ä»¥åŠä¸€ä¸ªè‡ªå¢æ•° nonce ï¼ˆä¸€ä¸ªä»…ä¼šè¢«ä½¿ç”¨ä¸€æ¬¡çš„æ•°ï¼Œè¿™æ ·æˆ‘ä»¬å°±ä¸ä¼šå¯¹ç›¸åŒçš„è¾“å…¥å€¼è°ƒç”¨ä¸€æ¬¡ä»¥ä¸Šå“ˆå¸Œå‡½æ•°äº†ï¼‰ã€‚</p><p>ç„¶ååˆ©ç”¨ keccak æŠŠè¾“å…¥çš„å€¼è½¬å˜ä¸ºä¸€ä¸ªå“ˆå¸Œå€¼, å†å°†å“ˆå¸Œå€¼è½¬æ¢ä¸º uint, ç„¶ååˆ©ç”¨ % 100 æ¥å–æœ€åä¸¤ä½, å°±ç”Ÿæˆäº†ä¸€ä¸ª0åˆ°100ä¹‹é—´éšæœºæ•°äº†ã€‚</p><p><strong>è¿™ä¸ªæ–¹æ³•å¾ˆå®¹æ˜“è¢«ä¸è¯šå®çš„èŠ‚ç‚¹æ”»å‡»</strong><br>åœ¨ä»¥å¤ªåŠä¸Š, å½“ä½ åœ¨å’Œä¸€ä¸ªåˆçº¦ä¸Šè°ƒç”¨å‡½æ•°çš„æ—¶å€™, ä½ ä¼šæŠŠå®ƒå¹¿æ’­ç»™ä¸€ä¸ªèŠ‚ç‚¹æˆ–è€…åœ¨ç½‘ç»œä¸Šçš„ transaction èŠ‚ç‚¹ä»¬ã€‚ ç½‘ç»œä¸Šçš„èŠ‚ç‚¹å°†æ”¶é›†å¾ˆå¤šäº‹åŠ¡, è¯•ç€æˆä¸ºç¬¬ä¸€ä¸ªè§£å†³è®¡ç®—å¯†é›†å‹æ•°å­¦é—®é¢˜çš„äººï¼Œä½œä¸ºâ€œå·¥ä½œè¯æ˜â€ï¼Œç„¶åå°†â€œå·¥ä½œè¯æ˜â€(Proof of Work, PoW)å’Œäº‹åŠ¡ä¸€èµ·ä½œä¸ºä¸€ä¸ª block å‘å¸ƒåœ¨ç½‘ç»œä¸Šã€‚</p><p>ä¸€æ—¦ä¸€ä¸ªèŠ‚ç‚¹è§£å†³äº†ä¸€ä¸ªPoW, å…¶ä»–èŠ‚ç‚¹å°±ä¼šåœæ­¢å°è¯•è§£å†³è¿™ä¸ª PoW, å¹¶éªŒè¯å…¶ä»–èŠ‚ç‚¹çš„äº‹åŠ¡åˆ—è¡¨æ˜¯æœ‰æ•ˆçš„ï¼Œç„¶åæ¥å—è¿™ä¸ªèŠ‚ç‚¹è½¬è€Œå°è¯•è§£å†³ä¸‹ä¸€ä¸ªèŠ‚ç‚¹ã€‚</p><p>è¿™å°±è®©æˆ‘ä»¬çš„éšæœºæ•°å‡½æ•°å˜å¾—å¯åˆ©ç”¨äº†</p><p>æˆ‘ä»¬å‡è®¾æˆ‘ä»¬æœ‰ä¸€ä¸ªç¡¬å¸ç¿»è½¬åˆçº¦â€”â€”æ­£é¢ä½ èµ¢åŒå€é’±ï¼Œåé¢ä½ è¾“æ‰æ‰€æœ‰çš„é’±ã€‚å‡å¦‚å®ƒä½¿ç”¨ä¸Šé¢çš„æ–¹æ³•æ¥å†³å®šæ˜¯æ­£é¢è¿˜æ˜¯åé¢ (random &gt;&#x3D; 50 ç®—æ­£é¢, random &lt; 50 ç®—åé¢)ã€‚</p><p>å¦‚æœæˆ‘æ­£è¿è¡Œä¸€ä¸ªèŠ‚ç‚¹ï¼Œæˆ‘å¯ä»¥ åªå¯¹æˆ‘è‡ªå·±çš„èŠ‚ç‚¹ å‘å¸ƒä¸€ä¸ªäº‹åŠ¡ï¼Œä¸”ä¸åˆ†äº«å®ƒã€‚ æˆ‘å¯ä»¥è¿è¡Œç¡¬å¸ç¿»è½¬æ–¹æ³•æ¥å·çª¥æˆ‘çš„è¾“èµ¢ â€” å¦‚æœæˆ‘è¾“äº†ï¼Œæˆ‘å°±ä¸æŠŠè¿™ä¸ªäº‹åŠ¡åŒ…å«è¿›æˆ‘è¦è§£å†³çš„ä¸‹ä¸€ä¸ªåŒºå—ä¸­å»ã€‚æˆ‘å¯ä»¥ä¸€ç›´è¿è¡Œè¿™ä¸ªæ–¹æ³•ï¼Œç›´åˆ°æˆ‘èµ¢å¾—äº†ç¡¬å¸ç¿»è½¬å¹¶è§£å†³äº†ä¸‹ä¸€ä¸ªåŒºå—ï¼Œç„¶åè·åˆ©ã€‚</p><p><strong>æ‰€ä»¥æˆ‘ä»¬è¯¥å¦‚ä½•åœ¨ä»¥å¤ªåŠä¸Šå®‰å…¨åœ°ç”Ÿæˆéšæœºæ•°å‘¢</strong><br>å› ä¸ºåŒºå—é“¾çš„å…¨éƒ¨å†…å®¹å¯¹æ‰€æœ‰å‚ä¸è€…æ¥è¯´æ˜¯é€æ˜çš„ï¼Œ è¿™å°±è®©è¿™ä¸ªé—®é¢˜å˜å¾—å¾ˆéš¾ï¼Œå®ƒçš„è§£å†³æ–¹æ³•ä¸åœ¨æœ¬è¯¾ç¨‹è®¨è®ºèŒƒå›´ï¼Œä½ å¯ä»¥é˜…è¯» è¿™ä¸ª StackOverflow ä¸Šçš„è®¨è®º æ¥è·å¾—ä¸€äº›ä¸»æ„ã€‚ ä¸€ä¸ªæ–¹æ³•æ˜¯åˆ©ç”¨ oracle æ¥è®¿é—®ä»¥å¤ªåŠåŒºå—é“¾ä¹‹å¤–çš„éšæœºæ•°å‡½æ•°ã€‚</p><p>å½“ç„¶ï¼Œ å› ä¸ºç½‘ç»œä¸Šæˆåƒä¸Šä¸‡çš„ä»¥å¤ªåŠèŠ‚ç‚¹éƒ½åœ¨ç«äº‰è§£å†³ä¸‹ä¸€ä¸ªåŒºå—ï¼Œæˆ‘èƒ½æˆåŠŸè§£å†³ä¸‹ä¸€ä¸ªåŒºå—çš„å‡ ç‡éå¸¸ä¹‹ä½ã€‚ è¿™å°†èŠ±è´¹æˆ‘ä»¬å·¨å¤§çš„è®¡ç®—èµ„æºæ¥å¼€å‘è¿™ä¸ªè·åˆ©æ–¹æ³• â€” ä½†æ˜¯å¦‚æœå¥–åŠ±å¼‚å¸¸åœ°é«˜(æ¯”å¦‚æˆ‘å¯ä»¥åœ¨ç¡¬å¸ç¿»è½¬å‡½æ•°ä¸­èµ¢å¾— 1ä¸ªäº¿)ï¼Œ é‚£å°±å¾ˆå€¼å¾—å»æ”»å‡»äº†ã€‚</p><p>æ‰€ä»¥å°½ç®¡è¿™ä¸ªæ–¹æ³•åœ¨ä»¥å¤ªåŠä¸Šä¸å®‰å…¨ï¼Œåœ¨å®é™…ä¸­ï¼Œé™¤éæˆ‘ä»¬çš„éšæœºå‡½æ•°æœ‰ä¸€å¤§ç¬”é’±åœ¨ä¸Šé¢ï¼Œä½ æ¸¸æˆçš„ç”¨æˆ·ä¸€èˆ¬æ˜¯æ²¡æœ‰è¶³å¤Ÿçš„èµ„æºå»æ”»å‡»çš„ã€‚</p><p>å› ä¸ºåœ¨è¿™ä¸ªæ•™ç¨‹ä¸­ï¼Œæˆ‘ä»¬åªæ˜¯åœ¨ç¼–å†™ä¸€ä¸ªç®€å•çš„æ¸¸æˆæ¥åšæ¼”ç¤ºï¼Œä¹Ÿæ²¡æœ‰çœŸæ­£çš„é’±åœ¨é‡Œé¢ï¼Œæ‰€ä»¥æˆ‘ä»¬å†³å®šæ¥å—è¿™ä¸ªä¸è¶³ä¹‹å¤„ï¼Œä½¿ç”¨è¿™ä¸ªç®€å•çš„éšæœºæ•°ç”Ÿæˆå‡½æ•°ã€‚ä½†æ˜¯è¦è°¨è®°å®ƒæ˜¯ä¸å®‰å…¨çš„ã€‚</p><p>å®æˆ˜æ¼”ä¹ ï¼š</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">uint randNonce = 0;</span><br><span class="line"></span><br><span class="line">  function randMod(uint _modulus) internal returns(uint) &#123;</span><br><span class="line">    randNonce++;</span><br><span class="line">    return uint(keccak256(now, msg.sender, randNonce)) % _modulus;</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure><h4 id="â‘¤åƒµå°¸å¯¹å†³"><a href="#â‘¤åƒµå°¸å¯¹å†³" class="headerlink" title="â‘¤åƒµå°¸å¯¹å†³"></a>â‘¤åƒµå°¸å¯¹å†³</h4><p>æˆ‘ä»¬çš„åˆçº¦å·²ç»æœ‰äº†ä¸€äº›éšæœºæ€§çš„æ¥æºï¼Œå¯ä»¥ç”¨è¿›æˆ‘ä»¬çš„åƒµå°¸æˆ˜æ–—ä¸­å»è®¡ç®—ç»“æœã€‚</p><p>æˆ‘ä»¬çš„åƒµå°¸æˆ˜æ–—çœ‹èµ·æ¥å°†æ˜¯è¿™ä¸ªæµç¨‹ï¼š</p><ul><li>ä½ é€‰æ‹©ä¸€ä¸ªè‡ªå·±çš„åƒµå°¸ï¼Œç„¶åé€‰æ‹©ä¸€ä¸ªå¯¹æ‰‹çš„åƒµå°¸å»æ”»å‡»ã€‚</li><li>å¦‚æœä½ æ˜¯æ”»å‡»æ–¹ï¼Œä½ å°†æœ‰70%çš„å‡ ç‡è·èƒœï¼Œé˜²å®ˆæ–¹å°†æœ‰30%çš„å‡ ç‡è·èƒœã€‚</li><li>æ‰€æœ‰çš„åƒµå°¸ï¼ˆæ”»å®ˆåŒæ–¹ï¼‰éƒ½å°†æœ‰ä¸€ä¸ª winCount å’Œä¸€ä¸ª lossCountï¼Œè¿™ä¸¤ä¸ªå€¼éƒ½å°†æ ¹æ®æˆ˜æ–—ç»“æœå¢é•¿ã€‚</li><li>è‹¥æ”»å‡»æ–¹è·èƒœï¼Œè¿™ä¸ªåƒµå°¸å°†å‡çº§å¹¶äº§ç”Ÿä¸€ä¸ªæ–°åƒµå°¸ã€‚</li><li>å¦‚æœæ”»å‡»æ–¹å¤±è´¥ï¼Œé™¤äº†å¤±è´¥æ¬¡æ•°å°†åŠ ä¸€å¤–ï¼Œä»€ä¹ˆéƒ½ä¸ä¼šå‘ç”Ÿã€‚</li><li>æ— è®ºè¾“èµ¢ï¼Œå½“å‰åƒµå°¸çš„å†·å´æ—¶é—´éƒ½å°†è¢«æ¿€æ´»ã€‚</li></ul><p>è¿™æœ‰ä¸€å¤§å †çš„é€»è¾‘éœ€è¦å¤„ç†ï¼Œæˆ‘ä»¬å°†æŠŠè¿™äº›æ­¥éª¤åˆ†è§£åˆ°æ¥ä¸‹æ¥çš„è¯¾ç¨‹ä¸­å»ã€‚</p><p>å®æˆ˜æ¼”ä¹ ï¼š</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">// åœ¨è¿™é‡Œåˆ›å»º attackVictoryProbability</span><br><span class="line">uint attackVictoryProbability = 70;</span><br><span class="line"></span><br><span class="line">// åœ¨è¿™é‡Œåˆ›å»ºæ–°å‡½æ•°</span><br><span class="line">function attack(uint _zombieId, uint _targetId) external &#123;</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure><h4 id="â‘¥é‡æ„é€šç”¨é€»è¾‘"><a href="#â‘¥é‡æ„é€šç”¨é€»è¾‘" class="headerlink" title="â‘¥é‡æ„é€šç”¨é€»è¾‘"></a>â‘¥é‡æ„é€šç”¨é€»è¾‘</h4><p>ä¸ç®¡è°è°ƒç”¨æˆ‘ä»¬çš„ attack å‡½æ•° â€”â€” æˆ‘ä»¬æƒ³ç¡®ä¿ç”¨æˆ·çš„ç¡®æ‹¥æœ‰ä»–ä»¬ç”¨æ¥æ”»å‡»çš„åƒµå°¸ã€‚å¦‚æœä½ èƒ½ç”¨å…¶ä»–äººçš„åƒµå°¸æ¥æ”»å‡»å°†æ˜¯ä¸€ä¸ªå¾ˆå¤§çš„å®‰å…¨é—®é¢˜ã€‚</p><p>ä½ èƒ½æƒ³ä¸€ä¸‹æˆ‘ä»¬å¦‚ä½•æ·»åŠ ä¸€ä¸ªæ£€æŸ¥æ­¥éª¤æ¥çœ‹çœ‹è°ƒç”¨è¿™ä¸ªå‡½æ•°çš„äººå°±æ˜¯ä»–ä»¬ä¼ å…¥çš„ _zombieId çš„æ‹¥æœ‰è€…ä¹ˆï¼Ÿ</p><p>æƒ³ä¸€æƒ³ï¼Œçœ‹çœ‹ä½ èƒ½ä¸èƒ½è‡ªå·±æ‰¾åˆ°ä¸€äº›ç­”æ¡ˆã€‚</p><p>èŠ±ç‚¹æ—¶é—´â€¦â€¦ å‚è€ƒæˆ‘ä»¬å‰é¢è¯¾ç¨‹çš„ä»£ç æ¥è·å¾—çµæ„Ÿã€‚</p><p><strong>ç­”æ¡ˆ</strong><br>æˆ‘ä»¬åœ¨å‰é¢çš„è¯¾ç¨‹é‡Œé¢å·²ç»åšè¿‡å¾ˆå¤šæ¬¡è¿™æ ·çš„æ£€æŸ¥äº†ã€‚ åœ¨ changeName(), changeDna(), å’Œ feedAndMultiply()é‡Œï¼Œæˆ‘ä»¬åšè¿‡è¿™æ ·çš„æ£€æŸ¥ï¼š</p><p>require(msg.sender &#x3D;&#x3D; zombieToOwner[_zombieId]);<br>è¿™å’Œæˆ‘ä»¬ attack å‡½æ•°å°†è¦ç”¨åˆ°çš„æ£€æŸ¥é€»è¾‘æ˜¯ç›¸åŒçš„ã€‚ æ­£å› æˆ‘ä»¬è¦å¤šæ¬¡è°ƒç”¨è¿™ä¸ªæ£€æŸ¥é€»è¾‘ï¼Œè®©æˆ‘ä»¬æŠŠå®ƒç§»åˆ°å®ƒè‡ªå·±çš„ modifier ä¸­æ¥æ¸…ç†ä»£ç å¹¶é¿å…é‡å¤ç¼–ç ã€‚</p><p>å®æˆ˜æ¼”ä¹ ï¼š</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">// 1. åœ¨è¿™é‡Œåˆ›å»º modifier</span><br><span class="line">modifier ownerOf(uint _zombieId) &#123;</span><br><span class="line">    require(msg.sender == zombieToOwner[_zombieId]);</span><br><span class="line">    _;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">// 2. åœ¨å‡½æ•°å®šä¹‰æ—¶å¢åŠ  modifier :</span><br><span class="line">  function feedAndMultiply(uint _zombieId, uint _targetDna, string _species) internal ownerOf(_zombieId) &#123;</span><br><span class="line">    // 3. ç§»é™¤è¿™ä¸€è¡Œ</span><br><span class="line">    require(msg.sender == zombieToOwner[_zombieId]);</span><br></pre></td></tr></table></figure><h4 id="â‘¦æ›´å¤šé‡æ„"><a href="#â‘¦æ›´å¤šé‡æ„" class="headerlink" title="â‘¦æ›´å¤šé‡æ„"></a>â‘¦æ›´å¤šé‡æ„</h4><p>åœ¨ zombiehelper.solé‡Œæœ‰å‡ å¤„åœ°æ–¹ï¼Œéœ€è¦æˆ‘ä»¬å®ç°æˆ‘ä»¬æ–°çš„ modifierâ€”â€” ownerOfã€‚</p><p>å®æˆ˜æ¼”ä¹ ï¼š</p><ol><li><p>ä¿®æ”¹ changeName() ä½¿å…¶ä½¿ç”¨ ownerOf</p></li><li><p>ä¿®æ”¹ changeDna() ä½¿å…¶ä½¿ç”¨ ownerOf</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">åœ¨changeName()å‡½æ•°ä¸changeDna()å‡½æ•°çš„aboveLevelä¿®é¥°ç¬¦åé¢</span><br><span class="line">å†™ä¸ŠownerOf(_zombieId)</span><br><span class="line">å¹¶åˆ é™¤ä¸¤ä¸ªå‡½æ•°ä¸­çš„</span><br><span class="line">require(msg.sender == zombieToOwner[_zombieId]);</span><br><span class="line">è¿™ä¸€è¡Œä»£ç å³å¯</span><br></pre></td></tr></table></figure></li></ol><h4 id="â‘§å›åˆ°æ”»å‡»"><a href="#â‘§å›åˆ°æ”»å‡»" class="headerlink" title="â‘§å›åˆ°æ”»å‡»"></a>â‘§å›åˆ°æ”»å‡»</h4><p>é‡æ„å®Œæˆäº†ï¼Œå›åˆ° zombieattack.solã€‚</p><p>ç»§ç»­æ¥å®Œå–„æˆ‘ä»¬çš„ attack å‡½æ•°ï¼Œ ç°åœ¨æˆ‘ä»¬æœ‰äº† ownerOf ä¿®é¥°ç¬¦æ¥ç”¨äº†ã€‚</p><p>å®æˆ˜æ¼”ä¹ ï¼š</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">function attack(uint _zombieId, uint _targetId) external ownerOf(_zombieId) &#123;</span><br><span class="line">    Zombie storage myZombie = zombies[_zombieId];</span><br><span class="line">    Zombie storage enemyZombie = zombies[_targetId];</span><br><span class="line">    uint rand = randMod(100);</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure><h4 id="â‘¨åƒµå°¸çš„è¾“èµ¢"><a href="#â‘¨åƒµå°¸çš„è¾“èµ¢" class="headerlink" title="â‘¨åƒµå°¸çš„è¾“èµ¢"></a>â‘¨åƒµå°¸çš„è¾“èµ¢</h4><p>å¯¹æˆ‘ä»¬çš„åƒµå°¸æ¸¸æˆæ¥è¯´ï¼Œæˆ‘ä»¬å°†è¦è¿½è¸ªæˆ‘ä»¬çš„åƒµå°¸è¾“èµ¢äº†å¤šå°‘åœºã€‚æœ‰äº†è¿™ä¸ªæˆ‘ä»¬å¯ä»¥åœ¨æ¸¸æˆé‡Œç»´æŠ¤ä¸€ä¸ª â€œåƒµå°¸æ’è¡Œæ¦œâ€ã€‚</p><p>æœ‰å¤šç§æ–¹æ³•åœ¨æˆ‘ä»¬çš„DAppé‡Œé¢ä¿å­˜ä¸€ä¸ªæ•°å€¼ â€” ä½œä¸ºä¸€ä¸ªå•ç‹¬çš„æ˜ å°„ï¼Œä½œä¸ºä¸€ä¸ªâ€œæ’è¡Œæ¦œâ€ç»“æ„ä½“ï¼Œæˆ–è€…ä¿å­˜åœ¨ Zombie ç»“æ„ä½“å†…ã€‚</p><p>æ¯ä¸ªæ–¹æ³•éƒ½æœ‰å…¶ä¼˜ç¼ºç‚¹ï¼Œå–å†³äºæˆ‘ä»¬æ‰“ç®—å¦‚ä½•å’Œè¿™äº›æ•°æ®æ‰“äº¤é“ã€‚åœ¨è¿™ä¸ªæ•™ç¨‹ä¸­ï¼Œç®€å•èµ·è§æˆ‘ä»¬å°†è¿™ä¸ªçŠ¶æ€ä¿å­˜åœ¨ Zombie ç»“æ„ä½“ä¸­ï¼Œå°†å…¶å‘½åä¸º winCount å’Œ lossCountã€‚</p><p>æˆ‘ä»¬è·³å› zombiefactory.sol, å°†è¿™äº›å±æ€§æ·»åŠ è¿› Zombie ç»“æ„ä½“.</p><p>å®æˆ˜æ¼”ä¹ ï¼š</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">struct Zombie &#123;</span><br><span class="line">      string name;</span><br><span class="line">      uint dna;</span><br><span class="line">      uint32 level;</span><br><span class="line">      uint32 readyTime;</span><br><span class="line">      uint16 winCount;</span><br><span class="line">      uint16 lossCount;</span><br><span class="line">    &#125;</span><br><span class="line">// 2. åœ¨è¿™é‡Œä¿®æ”¹ä¿®æ”¹æ–°åƒµå°¸çš„åˆ›å»º:</span><br><span class="line">uint id = zombies.push(Zombie(_name, _dna, 1, uint32(now + cooldownTime), 0, 0)) - 1;</span><br></pre></td></tr></table></figure><h4 id="â‘©åƒµå°¸èƒœåˆ©äº†ğŸ˜„"><a href="#â‘©åƒµå°¸èƒœåˆ©äº†ğŸ˜„" class="headerlink" title="â‘©åƒµå°¸èƒœåˆ©äº†ğŸ˜„"></a>â‘©åƒµå°¸èƒœåˆ©äº†ğŸ˜„</h4><p>æœ‰äº† winCount å’Œ lossCountï¼Œæˆ‘ä»¬å¯ä»¥æ ¹æ®åƒµå°¸å“ªä¸ªåƒµå°¸èµ¢äº†æˆ˜æ–—æ¥æ›´æ–°å®ƒä»¬äº†ã€‚</p><p>åœ¨ç¬¬å…­ç« æˆ‘ä»¬è®¡ç®—å‡ºæ¥ä¸€ä¸ª0åˆ°100çš„éšæœºæ•°ã€‚ç°åœ¨è®©æˆ‘ä»¬ç”¨é‚£ä¸ªæ•°æ¥å†³å®šé‚£è°èµ¢äº†æˆ˜æ–—ï¼Œå¹¶ä»¥æ­¤æ›´æ–°æˆ‘ä»¬çš„çŠ¶æ€ã€‚</p><p>å®æˆ˜æ¼”ä¹ ï¼š</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">if (rand &lt;= attackVictoryProbability) &#123;</span><br><span class="line">  myZombie.winCount++;</span><br><span class="line">  myZombie.level++;</span><br><span class="line">  enemyZombie.lossCount++;</span><br><span class="line">  feedAndMultiply(_zombieId, enemyZombie.dna, &quot;zombie&quot;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="â‘ªåƒµå°¸å¤±è´¥ğŸ˜"><a href="#â‘ªåƒµå°¸å¤±è´¥ğŸ˜" class="headerlink" title="â‘ªåƒµå°¸å¤±è´¥ğŸ˜"></a>â‘ªåƒµå°¸å¤±è´¥ğŸ˜</h4><p>æˆ‘ä»¬å·²ç»ç¼–å†™äº†ä½ çš„åƒµå°¸èµ¢äº†ä¹‹åä¼šå‘ç”Ÿä»€ä¹ˆï¼Œ è¯¥çœ‹çœ‹ è¾“äº† çš„æ—¶å€™è¦æ€ä¹ˆåšäº†ã€‚</p><p>åœ¨æˆ‘ä»¬çš„æ¸¸æˆä¸­ï¼Œåƒµå°¸è¾“äº†åå¹¶ä¸ä¼šé™çº§ â€”â€” åªæ˜¯ç®€å•åœ°ç»™ lossCount åŠ ä¸€ï¼Œå¹¶è§¦å‘å†·å´ï¼Œç­‰å¾…ä¸€å¤©åæ‰èƒ½å†æ¬¡å‚æˆ˜ã€‚</p><p>è¦å®ç°è¿™ä¸ªé€»è¾‘ï¼Œæˆ‘ä»¬éœ€è¦ä¸€ä¸ª else è¯­å¥ã€‚</p><p>else è¯­å¥å’Œ JavaScript ä»¥åŠå¾ˆå¤šå…¶ä»–è¯­è¨€çš„ else è¯­å¥ä¸€æ ·ã€‚</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">if (zombieCoins[msg.sender] &gt; 100000000) &#123;</span><br><span class="line">  // ä½ å¥½æœ‰é’±!!!</span><br><span class="line">&#125; else &#123;</span><br><span class="line">  // æˆ‘ä»¬éœ€è¦æ›´å¤šçš„åƒµå°¸å¸...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å®æˆ˜æ¼”ä¹ ï¼š</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">else&#123;</span><br><span class="line">  myZombie.lossCount++;</span><br><span class="line">  enemyZombie.winCount++;</span><br><span class="line">  _triggerCooldown(myZombie);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="â‘«æ”¾åœ¨ä¸€èµ·"><a href="#â‘«æ”¾åœ¨ä¸€èµ·" class="headerlink" title="â‘«æ”¾åœ¨ä¸€èµ·"></a>â‘«æ”¾åœ¨ä¸€èµ·</h4><p><strong>è®¤é¢†ä½ çš„æˆ˜åˆ©å“</strong><br>åœ¨èµ¢äº†æˆ˜æ–—ä¹‹åï¼š</p><ol><li><p>ä½ çš„åƒµå°¸å°†ä¼šå‡çº§</p></li><li><p>ä½ åƒµå°¸çš„ winCount å°†ä¼šå¢åŠ </p></li><li><p>ä½ å°†ä¸ºä½ çš„åƒµå°¸å¤§å†›è·å¾—ä¸€ä¸ªæ–°çš„åƒµå°¸</p></li></ol><h4 id="â‘¬Lesson-4-Completeï¼"><a href="#â‘¬Lesson-4-Completeï¼" class="headerlink" title="â‘¬Lesson 4 Completeï¼"></a>â‘¬Lesson 4 Completeï¼</h4><p>æˆªè‡³ç¬¬å››è¯¾å®Œæˆï¼Œæ‰€æœ‰ä»£ç å¦‚ä¸‹ï¼š<br><strong>zombieattack.sol:</strong></p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">pragma solidity ^0.4.19;</span><br><span class="line"></span><br><span class="line">import &quot;./zombiehelper.sol&quot;;</span><br><span class="line"></span><br><span class="line">contract ZombieBattle is ZombieHelper &#123;</span><br><span class="line">  uint randNonce = 0;</span><br><span class="line">  uint attackVictoryProbability = 70;</span><br><span class="line"></span><br><span class="line">  function randMod(uint _modulus) internal returns(uint) &#123;</span><br><span class="line">    randNonce++;</span><br><span class="line">    return uint(keccak256(now, msg.sender, randNonce)) % _modulus;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  function attack(uint _zombieId, uint _targetId) external ownerOf(_zombieId) &#123;</span><br><span class="line">    Zombie storage myZombie = zombies[_zombieId];</span><br><span class="line">    Zombie storage enemyZombie = zombies[_targetId];</span><br><span class="line">    uint rand = randMod(100);</span><br><span class="line">    if (rand &lt;= attackVictoryProbability) &#123;</span><br><span class="line">      myZombie.winCount++;</span><br><span class="line">      myZombie.level++;</span><br><span class="line">      enemyZombie.lossCount++;</span><br><span class="line">      feedAndMultiply(_zombieId, enemyZombie.dna, &quot;zombie&quot;);</span><br><span class="line">    &#125; else &#123;</span><br><span class="line">      myZombie.lossCount++;</span><br><span class="line">      enemyZombie.winCount++;</span><br><span class="line">      _triggerCooldown(myZombie);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>zombiehelper.sol:</strong></p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">pragma solidity ^0.4.19;</span><br><span class="line"></span><br><span class="line">import &quot;./zombiefeeding.sol&quot;;</span><br><span class="line"></span><br><span class="line">contract ZombieHelper is ZombieFeeding &#123;</span><br><span class="line"></span><br><span class="line">  uint levelUpFee = 0.001 ether;</span><br><span class="line"></span><br><span class="line">  modifier aboveLevel(uint _level, uint _zombieId) &#123;</span><br><span class="line">    require(zombies[_zombieId].level &gt;= _level);</span><br><span class="line">    _;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  function withdraw() external onlyOwner &#123;</span><br><span class="line">    owner.transfer(this.balance);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  function setLevelUpFee(uint _fee) external onlyOwner &#123;</span><br><span class="line">    levelUpFee = _fee;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  function levelUp(uint _zombieId) external payable &#123;</span><br><span class="line">    require(msg.value == levelUpFee);</span><br><span class="line">    zombies[_zombieId].level++;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  function changeName(uint _zombieId, string _newName) external aboveLevel(2, _zombieId) ownerOf(_zombieId) &#123;</span><br><span class="line">    zombies[_zombieId].name = _newName;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  function changeDna(uint _zombieId, uint _newDna) external aboveLevel(20, _zombieId) ownerOf(_zombieId) &#123;</span><br><span class="line">    zombies[_zombieId].dna = _newDna;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  function getZombiesByOwner(address _owner) external view returns(uint[]) &#123;</span><br><span class="line">    uint[] memory result = new uint[](ownerZombieCount[_owner]);</span><br><span class="line">    uint counter = 0;</span><br><span class="line">    for (uint i = 0; i &lt; zombies.length; i++) &#123;</span><br><span class="line">      if (zombieToOwner[i] == _owner) &#123;</span><br><span class="line">        result[counter] = i;</span><br><span class="line">        counter++;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    return result;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>zombiefeeding.sol:</strong></p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">pragma solidity ^0.4.19;</span><br><span class="line"></span><br><span class="line">import &quot;./zombiefactory.sol&quot;;</span><br><span class="line"></span><br><span class="line">contract KittyInterface &#123;</span><br><span class="line">  function getKitty(uint256 _id) external view returns (</span><br><span class="line">    bool isGestating,</span><br><span class="line">    bool isReady,</span><br><span class="line">    uint256 cooldownIndex,</span><br><span class="line">    uint256 nextActionAt,</span><br><span class="line">    uint256 siringWithId,</span><br><span class="line">    uint256 birthTime,</span><br><span class="line">    uint256 matronId,</span><br><span class="line">    uint256 sireId,</span><br><span class="line">    uint256 generation,</span><br><span class="line">    uint256 genes</span><br><span class="line">  );</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">contract ZombieFeeding is ZombieFactory &#123;</span><br><span class="line"></span><br><span class="line">  KittyInterface kittyContract;</span><br><span class="line"></span><br><span class="line">  modifier ownerOf(uint _zombieId) &#123;</span><br><span class="line">    require(msg.sender == zombieToOwner[_zombieId]);</span><br><span class="line">    _;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  function setKittyContractAddress(address _address) external onlyOwner &#123;</span><br><span class="line">    kittyContract = KittyInterface(_address);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  function _triggerCooldown(Zombie storage _zombie) internal &#123;</span><br><span class="line">    _zombie.readyTime = uint32(now + cooldownTime);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  function _isReady(Zombie storage _zombie) internal view returns (bool) &#123;</span><br><span class="line">      return (_zombie.readyTime &lt;= now);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  function feedAndMultiply(uint _zombieId, uint _targetDna, string _species) internal ownerOf(_zombieId) &#123;</span><br><span class="line">    Zombie storage myZombie = zombies[_zombieId];</span><br><span class="line">    require(_isReady(myZombie));</span><br><span class="line">    _targetDna = _targetDna % dnaModulus;</span><br><span class="line">    uint newDna = (myZombie.dna + _targetDna) / 2;</span><br><span class="line">    if (keccak256(_species) == keccak256(&quot;kitty&quot;)) &#123;</span><br><span class="line">      newDna = newDna - newDna % 100 + 99;</span><br><span class="line">    &#125;</span><br><span class="line">    _createZombie(&quot;NoName&quot;, newDna);</span><br><span class="line">    _triggerCooldown(myZombie);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  function feedOnKitty(uint _zombieId, uint _kittyId) public &#123;</span><br><span class="line">    uint kittyDna;</span><br><span class="line">    (,,,,,,,,,kittyDna) = kittyContract.getKitty(_kittyId);</span><br><span class="line">    feedAndMultiply(_zombieId, kittyDna, &quot;kitty&quot;);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>zombiefactory.sol:</strong></p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">pragma solidity ^0.4.19;</span><br><span class="line"></span><br><span class="line">import &quot;./ownable.sol&quot;;</span><br><span class="line"></span><br><span class="line">contract ZombieFactory is Ownable &#123;</span><br><span class="line"></span><br><span class="line">    event NewZombie(uint zombieId, string name, uint dna);</span><br><span class="line"></span><br><span class="line">    uint dnaDigits = 16;</span><br><span class="line">    uint dnaModulus = 10 ** dnaDigits;</span><br><span class="line">    uint cooldownTime = 1 days;</span><br><span class="line"></span><br><span class="line">    struct Zombie &#123;</span><br><span class="line">      string name;</span><br><span class="line">      uint dna;</span><br><span class="line">      uint32 level;</span><br><span class="line">      uint32 readyTime;</span><br><span class="line">      uint16 winCount;</span><br><span class="line">      uint16 lossCount;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    Zombie[] public zombies;</span><br><span class="line"></span><br><span class="line">    mapping (uint =&gt; address) public zombieToOwner;</span><br><span class="line">    mapping (address =&gt; uint) ownerZombieCount;</span><br><span class="line"></span><br><span class="line">    function _createZombie(string _name, uint _dna) internal &#123;</span><br><span class="line">        uint id = zombies.push(Zombie(_name, _dna, 1, uint32(now + cooldownTime), 0, 0)) - 1;</span><br><span class="line">        zombieToOwner[id] = msg.sender;</span><br><span class="line">        ownerZombieCount[msg.sender]++;</span><br><span class="line">        NewZombie(id, _name, _dna);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    function _generateRandomDna(string _str) private view returns (uint) &#123;</span><br><span class="line">        uint rand = uint(keccak256(_str));</span><br><span class="line">        return rand % dnaModulus;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    function createRandomZombie(string _name) public &#123;</span><br><span class="line">        require(ownerZombieCount[msg.sender] == 0);</span><br><span class="line">        uint randDna = _generateRandomDna(_name);</span><br><span class="line">        randDna = randDna - randDna % 100;</span><br><span class="line">        _createZombie(_name, randDna);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>ownable.sol:</strong></p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">pragma solidity ^0.4.19;</span><br><span class="line"></span><br><span class="line">/**</span><br><span class="line"> * @title Ownable</span><br><span class="line"> * @dev The Ownable contract has an owner address, and provides basic authorization control</span><br><span class="line"> * functions, this simplifies the implementation of &quot;user permissions&quot;.</span><br><span class="line"> */</span><br><span class="line">contract Ownable &#123;</span><br><span class="line">  address public owner;</span><br><span class="line"></span><br><span class="line">  event OwnershipTransferred(address indexed previousOwner, address indexed newOwner);</span><br><span class="line"></span><br><span class="line">  /**</span><br><span class="line">   * @dev The Ownable constructor sets the original `owner` of the contract to the sender</span><br><span class="line">   * account.</span><br><span class="line">   */</span><br><span class="line">  function Ownable() public &#123;</span><br><span class="line">    owner = msg.sender;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">  /**</span><br><span class="line">   * @dev Throws if called by any account other than the owner.</span><br><span class="line">   */</span><br><span class="line">  modifier onlyOwner() &#123;</span><br><span class="line">    require(msg.sender == owner);</span><br><span class="line">    _;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">  /**</span><br><span class="line">   * @dev Allows the current owner to transfer control of the contract to a newOwner.</span><br><span class="line">   * @param newOwner The address to transfer ownership to.</span><br><span class="line">   */</span><br><span class="line">  function transferOwnership(address newOwner) public onlyOwner &#123;</span><br><span class="line">    require(newOwner != address(0));</span><br><span class="line">    OwnershipTransferred(owner, newOwner);</span><br><span class="line">    owner = newOwner;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><hr><h3 id="å¿ƒå¾—"><a href="#å¿ƒå¾—" class="headerlink" title="å¿ƒå¾—"></a>å¿ƒå¾—</h3><h4 id="â‘ ç¬¬å››è¯¾-ç¬¬â‘©èŠ‚"><a href="#â‘ ç¬¬å››è¯¾-ç¬¬â‘©èŠ‚" class="headerlink" title="â‘ ç¬¬å››è¯¾ ç¬¬â‘©èŠ‚"></a>â‘ ç¬¬å››è¯¾ ç¬¬â‘©èŠ‚</h4><p>å®æˆ˜æ¼”ä¹ ä¸­ifè¯­å¥çš„æœ€åä¸€è¡Œ<br>feedAndMultiply(_zombieId, enemyZombie.dna, â€œzombieâ€);<br>ç¬¬äºŒä¸ªä¼ å…¥â€™feedAndMultiplyâ€™å‡½æ•°çš„å‚æ•°<br>ä¸ºä»€ä¹ˆæ˜¯enemyZombie.dna</p>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>åƒµå°¸æ¸¸æˆç¬¬äºŒã€ä¸‰è¯¾</title>
      <link href="/post/d9a0b533.html"/>
      <url>/post/d9a0b533.html</url>
      
        <content type="html"><![CDATA[<h1 id="ä¸‰å¶è‰å®éªŒå®¤â€œæœŸæœ«ä»»åŠ¡â€æ€»ç»“ï¼ˆç»­ï¼‰-ç¬¬äºŒè¯¾ï¼Œç¬¬ä¸‰è¯¾"><a href="#ä¸‰å¶è‰å®éªŒå®¤â€œæœŸæœ«ä»»åŠ¡â€æ€»ç»“ï¼ˆç»­ï¼‰-ç¬¬äºŒè¯¾ï¼Œç¬¬ä¸‰è¯¾" class="headerlink" title="ä¸‰å¶è‰å®éªŒå®¤â€œæœŸæœ«ä»»åŠ¡â€æ€»ç»“ï¼ˆç»­ï¼‰(ç¬¬äºŒè¯¾ï¼Œç¬¬ä¸‰è¯¾)"></a>ä¸‰å¶è‰å®éªŒå®¤â€œæœŸæœ«ä»»åŠ¡â€æ€»ç»“ï¼ˆç»­ï¼‰(ç¬¬äºŒè¯¾ï¼Œç¬¬ä¸‰è¯¾)</h1><h2 id="ä»»åŠ¡ä¸€ï¼šå®ŒæˆåŠ å¯†åƒµå°¸çš„æ¸¸æˆ"><a href="#ä»»åŠ¡ä¸€ï¼šå®ŒæˆåŠ å¯†åƒµå°¸çš„æ¸¸æˆ" class="headerlink" title="ä»»åŠ¡ä¸€ï¼šå®ŒæˆåŠ å¯†åƒµå°¸çš„æ¸¸æˆ"></a>ä»»åŠ¡ä¸€ï¼šå®ŒæˆåŠ å¯†åƒµå°¸çš„æ¸¸æˆ</h2><h3 id="2-åƒµå°¸æ”»å‡»äººç±»"><a href="#2-åƒµå°¸æ”»å‡»äººç±»" class="headerlink" title="2.åƒµå°¸æ”»å‡»äººç±»"></a>2.åƒµå°¸æ”»å‡»äººç±»</h3><h4 id="â‘ ç¬¬äºŒè¯¾æ¦‚è§ˆ"><a href="#â‘ ç¬¬äºŒè¯¾æ¦‚è§ˆ" class="headerlink" title="â‘ ç¬¬äºŒè¯¾æ¦‚è§ˆ"></a>â‘ ç¬¬äºŒè¯¾æ¦‚è§ˆ</h4><p>åƒµå°¸çŒé£Ÿ<br>åƒµå°¸çŒé£Ÿçš„æ—¶å€™ï¼Œåƒµå°¸ç—…æ¯’ä¾µå…¥çŒç‰©ï¼Œè¿™äº›ç—…æ¯’ä¼šå°†çŒç‰©å˜ä¸ºæ–°çš„åƒµå°¸ï¼ŒåŠ å…¥ä½ çš„åƒµå°¸å¤§å†›ã€‚ç³»ç»Ÿä¼šé€š è¿‡çŒç‰©å’ŒçŒé£Ÿè€…åƒµå°¸çš„DNAè®¡ç®—å‡ºæ–°åƒµå°¸çš„DNAã€‚</p><h4 id="â‘¡æ˜ å°„ï¼ˆMappingï¼‰å’Œåœ°å€ï¼ˆAddressï¼‰"><a href="#â‘¡æ˜ å°„ï¼ˆMappingï¼‰å’Œåœ°å€ï¼ˆAddressï¼‰" class="headerlink" title="â‘¡æ˜ å°„ï¼ˆMappingï¼‰å’Œåœ°å€ï¼ˆAddressï¼‰"></a>â‘¡æ˜ å°„ï¼ˆMappingï¼‰å’Œåœ°å€ï¼ˆAddressï¼‰</h4><p>æˆ‘ä»¬éœ€è¦å¼•å…¥2ä¸ªæ–°çš„æ•°æ®ç±»å‹ï¼šmappingï¼ˆæ˜ å°„ï¼‰ å’Œ addressï¼ˆåœ°å€ï¼‰ã€‚</p><p>Addresses ï¼ˆåœ°å€ï¼‰<br>ä»¥å¤ªåŠåŒºå—é“¾ç”± _ account _ (è´¦æˆ·)ç»„æˆï¼Œä½ å¯ä»¥æŠŠå®ƒæƒ³è±¡æˆé“¶è¡Œè´¦æˆ·ã€‚ä¸€ä¸ªå¸æˆ·çš„ä½™é¢æ˜¯ <em>ä»¥å¤ª</em> ï¼ˆåœ¨ä»¥å¤ªåŠåŒºå—é“¾ä¸Šä½¿ç”¨çš„å¸ç§ï¼‰ï¼Œä½ å¯ä»¥å’Œå…¶ä»–å¸æˆ·ä¹‹é—´æ”¯ä»˜å’Œæ¥å—ä»¥å¤ªå¸ï¼Œå°±åƒä½ çš„é“¶è¡Œå¸æˆ·å¯ä»¥ç”µæ±‡èµ„é‡‘åˆ°å…¶ä»–é“¶è¡Œå¸æˆ·ä¸€æ ·ã€‚</p><p>æ¯ä¸ªå¸æˆ·éƒ½æœ‰ä¸€ä¸ªâ€œåœ°å€â€ï¼Œä½ å¯ä»¥æŠŠå®ƒæƒ³è±¡æˆé“¶è¡Œè´¦å·ã€‚è¿™æ˜¯è´¦æˆ·å”¯ä¸€çš„æ ‡è¯†ç¬¦ï¼Œå®ƒçœ‹èµ·æ¥é•¿è¿™æ ·ï¼š</p><p>0x0cE446255506E92DF41614C46F1d6df9Cc969183</p><p>æˆ‘ä»¬å°†åœ¨åé¢çš„è¯¾ç¨‹ä¸­ä»‹ç»åœ°å€çš„ç»†èŠ‚ï¼Œç°åœ¨ä½ åªéœ€è¦äº†è§£åœ°å€å±äºç‰¹å®šç”¨æˆ·ï¼ˆæˆ–æ™ºèƒ½åˆçº¦ï¼‰çš„ã€‚</p><p>æ‰€ä»¥æˆ‘ä»¬å¯ä»¥æŒ‡å®šâ€œåœ°å€â€ä½œä¸ºåƒµå°¸ä¸»äººçš„ IDã€‚å½“ç”¨æˆ·é€šè¿‡ä¸æˆ‘ä»¬çš„åº”ç”¨ç¨‹åºäº¤äº’æ¥åˆ›å»ºæ–°çš„åƒµå°¸æ—¶ï¼Œæ–°åƒµå°¸çš„æ‰€æœ‰æƒè¢«è®¾ç½®åˆ°è°ƒç”¨è€…çš„ä»¥å¤ªåŠåœ°å€ä¸‹ã€‚</p><p>Mappingï¼ˆæ˜ å°„ï¼‰<br>æ˜ å°„æ˜¯è¿™æ ·å®šä¹‰çš„ï¼š</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">//å¯¹äºé‡‘èåº”ç”¨ç¨‹åºï¼Œå°†ç”¨æˆ·çš„ä½™é¢ä¿å­˜åœ¨ä¸€ä¸ª uintç±»å‹çš„å˜é‡ä¸­ï¼š</span><br><span class="line">mapping (address =&gt; uint) public accountBalance;</span><br><span class="line">//æˆ–è€…å¯ä»¥ç”¨æ¥é€šè¿‡userId å­˜å‚¨/æŸ¥æ‰¾çš„ç”¨æˆ·å</span><br><span class="line">mapping (uint =&gt; string) userIdToName;</span><br></pre></td></tr></table></figure><p>æ˜ å°„æœ¬è´¨ä¸Šæ˜¯å­˜å‚¨å’ŒæŸ¥æ‰¾æ•°æ®æ‰€ç”¨çš„é”®-å€¼å¯¹ã€‚åœ¨ç¬¬ä¸€ä¸ªä¾‹å­ä¸­ï¼Œé”®æ˜¯ä¸€ä¸ª addressï¼Œå€¼æ˜¯ä¸€ä¸ª uintï¼Œåœ¨ç¬¬äºŒä¸ªä¾‹å­ä¸­ï¼Œé”®æ˜¯ä¸€ä¸ªuintï¼Œå€¼æ˜¯ä¸€ä¸ª stringã€‚</p><p>å®æˆ˜æ¼”ä¹ :</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">mapping (uint =&gt; address) public zombieToOwner;</span><br><span class="line">mapping (address =&gt; uint) ownerZombieCount;</span><br></pre></td></tr></table></figure><h4 id="â‘¢Msg-sender"><a href="#â‘¢Msg-sender" class="headerlink" title="â‘¢Msg.sender"></a>â‘¢Msg.sender</h4><p>åœ¨ Solidity ä¸­ï¼Œæœ‰ä¸€äº›å…¨å±€å˜é‡å¯ä»¥è¢«æ‰€æœ‰å‡½æ•°è°ƒç”¨ã€‚ å…¶ä¸­ä¸€ä¸ªå°±æ˜¯ msg.senderï¼Œå®ƒæŒ‡çš„æ˜¯å½“å‰è°ƒç”¨è€…ï¼ˆæˆ–æ™ºèƒ½åˆçº¦ï¼‰çš„ addressã€‚</p><p>æ³¨æ„ï¼šåœ¨ Solidity ä¸­ï¼ŒåŠŸèƒ½æ‰§è¡Œå§‹ç»ˆéœ€è¦ä»å¤–éƒ¨è°ƒç”¨è€…å¼€å§‹ã€‚ ä¸€ä¸ªåˆçº¦åªä¼šåœ¨åŒºå—é“¾ä¸Šä»€ä¹ˆä¹Ÿä¸åšï¼Œé™¤éæœ‰äººè°ƒç”¨å…¶ä¸­çš„å‡½æ•°ã€‚æ‰€ä»¥ msg.senderæ€»æ˜¯å­˜åœ¨çš„ã€‚</p><p>ä»¥ä¸‹æ˜¯ä½¿ç”¨ msg.sender æ¥æ›´æ–° mapping çš„ä¾‹å­ï¼š</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">mapping (address =&gt; uint) favoriteNumber;</span><br><span class="line"></span><br><span class="line">function setMyNumber(uint _myNumber) public &#123;</span><br><span class="line">  // æ›´æ–°æˆ‘ä»¬çš„ `favoriteNumber` æ˜ å°„æ¥å°† `_myNumber`å­˜å‚¨åœ¨ `msg.sender`åä¸‹</span><br><span class="line">  favoriteNumber[msg.sender] = _myNumber;</span><br><span class="line">  // å­˜å‚¨æ•°æ®è‡³æ˜ å°„çš„æ–¹æ³•å’Œå°†æ•°æ®å­˜å‚¨åœ¨æ•°ç»„ç›¸ä¼¼</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">function whatIsMyNumber() public view returns (uint) &#123;</span><br><span class="line">  // æ‹¿åˆ°å­˜å‚¨åœ¨è°ƒç”¨è€…åœ°å€åä¸‹çš„å€¼</span><br><span class="line">  // è‹¥è°ƒç”¨è€…è¿˜æ²¡è°ƒç”¨ setMyNumberï¼Œ åˆ™å€¼ä¸º `0`</span><br><span class="line">  return favoriteNumber[msg.sender];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>åœ¨è¿™ä¸ªå°å°çš„ä¾‹å­ä¸­ï¼Œä»»ä½•äººéƒ½å¯ä»¥è°ƒç”¨ setMyNumber åœ¨æˆ‘ä»¬çš„åˆçº¦ä¸­å­˜ä¸‹ä¸€ä¸ª uint å¹¶ä¸”ä¸ä»–ä»¬çš„åœ°å€ç›¸ç»‘å®šã€‚ ç„¶åï¼Œä»–ä»¬è°ƒç”¨ whatIsMyNumber å°±ä¼šè¿”å›ä»–ä»¬å­˜å‚¨çš„ uintã€‚</p><p>ä½¿ç”¨ msg.sender å¾ˆå®‰å…¨ï¼Œå› ä¸ºå®ƒå…·æœ‰ä»¥å¤ªåŠåŒºå—é“¾çš„å®‰å…¨ä¿éšœ â€”â€” é™¤éçªƒå–ä¸ä»¥å¤ªåŠåœ°å€ç›¸å…³è”çš„ç§é’¥ï¼Œå¦åˆ™æ˜¯æ²¡æœ‰åŠæ³•ä¿®æ”¹å…¶ä»–äººçš„æ•°æ®çš„ã€‚</p><p>å®æˆ˜æ¼”ä¹ </p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">mapping (uint =&gt; address) public zombieToOwner;</span><br><span class="line">mapping (address =&gt; uint) ownerZombieCount;</span><br><span class="line"></span><br><span class="line">function _createZombie(string _name, uint _dna) private &#123;</span><br><span class="line">    uint id = zombies.push(Zombie(_name, _dna)) - 1;</span><br><span class="line">    zombieToOwner[id] = msg.sender;</span><br><span class="line">    ownerZombieCount[msg.sender]++;</span><br><span class="line">    NewZombie(id, _name, _dna);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>####â‘£Require<br>requireä½¿å¾—å‡½æ•°åœ¨æ‰§è¡Œè¿‡ç¨‹ä¸­ï¼Œå½“ä¸æ»¡è¶³æŸäº›æ¡ä»¶æ—¶æŠ›å‡ºé”™è¯¯ï¼Œå¹¶åœæ­¢æ‰§è¡Œï¼š</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">function sayHiToVitalik(string _name) public returns (string) &#123;</span><br><span class="line">  // æ¯”è¾ƒ _name æ˜¯å¦ç­‰äº &quot;Vitalik&quot;. å¦‚æœä¸æˆç«‹ï¼ŒæŠ›å‡ºå¼‚å¸¸å¹¶ç»ˆæ­¢ç¨‹åº</span><br><span class="line">  // (æ•²é»‘æ¿: Solidity å¹¶ä¸æ”¯æŒåŸç”Ÿçš„å­—ç¬¦ä¸²æ¯”è¾ƒ, æˆ‘ä»¬åªèƒ½é€šè¿‡æ¯”è¾ƒ</span><br><span class="line">  // ä¸¤å­—ç¬¦ä¸²çš„ keccak256 å“ˆå¸Œå€¼æ¥è¿›è¡Œåˆ¤æ–­)</span><br><span class="line">  require(keccak256(_name) == keccak256(&quot;Vitalik&quot;));</span><br><span class="line">  // å¦‚æœè¿”å› true, è¿è¡Œå¦‚ä¸‹è¯­å¥</span><br><span class="line">  return &quot;Hi!&quot;;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å¦‚æœä½ è¿™æ ·è°ƒç”¨å‡½æ•° sayHiToVitalikï¼ˆâ€œVitalikâ€ï¼‰ ,å®ƒä¼šè¿”å›â€œHiï¼â€ã€‚è€Œå¦‚æœè°ƒç”¨çš„æ—¶å€™ä½¿ç”¨äº†å…¶ä»–å‚æ•°ï¼Œå®ƒåˆ™ä¼šæŠ›å‡ºé”™è¯¯å¹¶åœæ­¢æ‰§è¡Œã€‚</p><p>å› æ­¤ï¼Œåœ¨è°ƒç”¨ä¸€ä¸ªå‡½æ•°ä¹‹å‰ï¼Œç”¨ require éªŒè¯å‰ç½®æ¡ä»¶æ˜¯éå¸¸æœ‰å¿…è¦çš„ã€‚</p><p>å®æˆ˜æ¼”ä¹ </p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">function createRandomZombie(string _name) public &#123;</span><br><span class="line">        require(ownerZombieCount[msg.sender] == 0);</span><br><span class="line">        uint randDna = _generateRandomDna(_name);</span><br><span class="line">        _createZombie(_name, randDna);</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><p>####â‘¤ç»§æ‰¿ï¼ˆInheritanceï¼‰<br>ä¸ªè®© Solidity çš„ä»£ç æ˜“äºç®¡ç†çš„åŠŸèƒ½ï¼Œå°±æ˜¯åˆçº¦ inheritance (ç»§æ‰¿)ï¼š</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">contract Doge &#123;</span><br><span class="line">  function catchphrase() public returns (string) &#123;</span><br><span class="line">    return &quot;So Wow CryptoDoge&quot;;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">contract BabyDoge is Doge &#123;</span><br><span class="line">  function anotherCatchphrase() public returns (string) &#123;</span><br><span class="line">    return &quot;Such Moon BabyDoge&quot;;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ç”±äº BabyDoge æ˜¯ä» Doge é‚£é‡Œ inherits ï¼ˆç»§æ‰¿)è¿‡æ¥çš„ã€‚ è¿™æ„å‘³ç€å½“ä½ ç¼–è¯‘å’Œéƒ¨ç½²äº† BabyDogeï¼Œå®ƒå°†å¯ä»¥è®¿é—® catchphrase() å’Œ anotherCatchphrase()å’Œå…¶ä»–æˆ‘ä»¬åœ¨ Doge ä¸­å®šä¹‰çš„å…¶ä»–å…¬å…±å‡½æ•°ã€‚<br>å®æˆ˜æ¼”ä¹ </p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">contract ZombieFeeding is ZombieFactory &#123;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>####â‘¥å¼•å…¥ï¼ˆImportï¼‰<br>åœ¨ Solidity ä¸­ï¼Œå½“ä½ æœ‰å¤šä¸ªæ–‡ä»¶å¹¶ä¸”æƒ³æŠŠä¸€ä¸ªæ–‡ä»¶å¯¼å…¥å¦ä¸€ä¸ªæ–‡ä»¶æ—¶ï¼Œå¯ä»¥ä½¿ç”¨ import è¯­å¥ï¼š</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">import &quot;./someothercontract.sol&quot;;</span><br><span class="line"></span><br><span class="line">contract newContract is SomeOtherContract &#123;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿™æ ·å½“æˆ‘ä»¬åœ¨åˆçº¦ï¼ˆcontractï¼‰ç›®å½•ä¸‹æœ‰ä¸€ä¸ªåä¸º someothercontract.sol çš„æ–‡ä»¶ï¼ˆ .&#x2F; å°±æ˜¯åŒä¸€ç›®å½•çš„æ„æ€ï¼‰ï¼Œå®ƒå°±ä¼šè¢«ç¼–è¯‘å™¨å¯¼å…¥ã€‚</p><p>å®æˆ˜æ¼”ä¹ </p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">pragma solidity ^0.4.19;</span><br><span class="line"></span><br><span class="line">import &quot;./zombiefactory.sol&quot;;</span><br><span class="line"></span><br><span class="line">contract ZombieFeeding is ZombieFactory &#123;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>####â‘¦Storageä¸Memory<br>åœ¨ Solidity ä¸­ï¼Œæœ‰ä¸¤ä¸ªåœ°æ–¹å¯ä»¥å­˜å‚¨å˜é‡ â€”â€” storage æˆ– memoryã€‚</p><p>Storage å˜é‡æ˜¯æŒ‡æ°¸ä¹…å­˜å‚¨åœ¨åŒºå—é“¾ä¸­çš„å˜é‡ã€‚ Memory å˜é‡åˆ™æ˜¯ä¸´æ—¶çš„ï¼Œå½“å¤–éƒ¨å‡½æ•°å¯¹æŸåˆçº¦è°ƒç”¨å®Œæˆæ—¶ï¼Œå†…å­˜å‹å˜é‡å³è¢«ç§»é™¤ã€‚ ä½ å¯ä»¥æŠŠå®ƒæƒ³è±¡æˆå­˜å‚¨åœ¨ä½ ç”µè„‘çš„ç¡¬ç›˜æˆ–æ˜¯RAMä¸­æ•°æ®çš„å…³ç³»ã€‚</p><p>å¤§å¤šæ•°æ—¶å€™ä½ éƒ½ç”¨ä¸åˆ°è¿™äº›å…³é”®å­—ï¼Œé»˜è®¤æƒ…å†µä¸‹ Solidity ä¼šè‡ªåŠ¨å¤„ç†å®ƒä»¬ã€‚ çŠ¶æ€å˜é‡ï¼ˆåœ¨å‡½æ•°ä¹‹å¤–å£°æ˜çš„å˜é‡ï¼‰é»˜è®¤ä¸ºâ€œå­˜å‚¨â€å½¢å¼ï¼Œå¹¶æ°¸ä¹…å†™å…¥åŒºå—é“¾ï¼›è€Œåœ¨å‡½æ•°å†…éƒ¨å£°æ˜çš„å˜é‡æ˜¯â€œå†…å­˜â€å‹çš„ï¼Œå®ƒä»¬å‡½æ•°è°ƒç”¨ç»“æŸåæ¶ˆå¤±ã€‚</p><p>ç„¶è€Œä¹Ÿæœ‰ä¸€äº›æƒ…å†µä¸‹ï¼Œä½ éœ€è¦æ‰‹åŠ¨å£°æ˜å­˜å‚¨ç±»å‹ï¼Œä¸»è¦ç”¨äºå¤„ç†å‡½æ•°å†…çš„ _ ç»“æ„ä½“ _ å’Œ _ æ•°ç»„ _ æ—¶ï¼š</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">contract SandwichFactory &#123;</span><br><span class="line">  struct Sandwich &#123;</span><br><span class="line">    string name;</span><br><span class="line">    string status;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  Sandwich[] sandwiches;</span><br><span class="line"></span><br><span class="line">  function eatSandwich(uint _index) public &#123;</span><br><span class="line">    // Sandwich mySandwich = sandwiches[_index];</span><br><span class="line"></span><br><span class="line">    // ^ çœ‹ä¸Šå»å¾ˆç›´æ¥ï¼Œä¸è¿‡ Solidity å°†ä¼šç»™å‡ºè­¦å‘Š</span><br><span class="line">    // å‘Šè¯‰ä½ åº”è¯¥æ˜ç¡®åœ¨è¿™é‡Œå®šä¹‰ `storage` æˆ–è€… `memory`ã€‚</span><br><span class="line"></span><br><span class="line">    // æ‰€ä»¥ä½ åº”è¯¥æ˜ç¡®å®šä¹‰ `storage`:</span><br><span class="line">    Sandwich storage mySandwich = sandwiches[_index];</span><br><span class="line">    // ...è¿™æ · `mySandwich` æ˜¯æŒ‡å‘ `sandwiches[_index]`çš„æŒ‡é’ˆ</span><br><span class="line">    // åœ¨å­˜å‚¨é‡Œï¼Œå¦å¤–...</span><br><span class="line">    mySandwich.status = &quot;Eaten!&quot;;</span><br><span class="line">    // ...è¿™å°†æ°¸ä¹…æŠŠ `sandwiches[_index]` å˜ä¸ºåŒºå—é“¾ä¸Šçš„å­˜å‚¨</span><br><span class="line"></span><br><span class="line">    // å¦‚æœä½ åªæƒ³è¦ä¸€ä¸ªå‰¯æœ¬ï¼Œå¯ä»¥ä½¿ç”¨`memory`:</span><br><span class="line">    Sandwich memory anotherSandwich = sandwiches[_index + 1];</span><br><span class="line">    // ...è¿™æ · `anotherSandwich` å°±ä»…ä»…æ˜¯ä¸€ä¸ªå†…å­˜é‡Œçš„å‰¯æœ¬äº†</span><br><span class="line">    // å¦å¤–</span><br><span class="line">    anotherSandwich.status = &quot;Eaten!&quot;;</span><br><span class="line">    // ...å°†ä»…ä»…ä¿®æ”¹ä¸´æ—¶å˜é‡ï¼Œå¯¹ `sandwiches[_index + 1]` æ²¡æœ‰ä»»ä½•å½±å“</span><br><span class="line">    // ä¸è¿‡ä½ å¯ä»¥è¿™æ ·åš:</span><br><span class="line">    sandwiches[_index + 1] = anotherSandwich;</span><br><span class="line">    // ...å¦‚æœä½ æƒ³æŠŠå‰¯æœ¬çš„æ”¹åŠ¨ä¿å­˜å›åŒºå—é“¾å­˜å‚¨</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å¦‚æœä½ è¿˜æ²¡æœ‰å®Œå…¨ç†è§£ç©¶ç«Ÿåº”è¯¥ä½¿ç”¨å“ªä¸€ä¸ª,Solidity ç¼–è¯‘å™¨ä¼šå‘è­¦ç¤ºæé†’ä½ çš„ã€‚</p><p>å®æˆ˜æ¼”ç¤º</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">function feedAndMultiply(uint _zombieId, uint _targetDna) public &#123;</span><br><span class="line">    require(msg.sender == zombieToOwner[_zombieId]);</span><br><span class="line">    Zombie storage myZombie = zombies[_zombieId];</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure><p>####â‘§åƒµå°¸çš„DNA<br>è·å–æ–°çš„åƒµå°¸DNAçš„å…¬å¼å¾ˆç®€å•ï¼šè®¡ç®—çŒé£Ÿåƒµå°¸DNAå’Œè¢«çŒåƒµå°¸DNAä¹‹é—´çš„å¹³å‡å€¼ã€‚</p><p>ä¾‹å¦‚ï¼š</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">function testDnaSplicing() public &#123;</span><br><span class="line">  uint zombieDna = 2222222222222222;</span><br><span class="line">  uint targetDna = 4444444444444444;</span><br><span class="line">  uint newZombieDna = (zombieDna + targetDna) / 2;</span><br><span class="line">  // newZombieDna å°†ç­‰äº 3333333333333333</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å®æˆ˜æ¼”ä¹ </p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">function feedAndMultiply(uint _zombieId, uint _targetDna) public &#123;</span><br><span class="line">    require(msg.sender == zombieToOwner[_zombieId]);</span><br><span class="line">    Zombie storage myZombie = zombies[_zombieId];</span><br><span class="line">    _targetDna = _targetDna % dnaModulus;</span><br><span class="line">    uint newDna = (myZombie.dna + _targetDna) / 2;</span><br><span class="line">    _createZombie(&quot;NoName&quot;, newDna);</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure><h4 id="â‘¨æ›´å¤šå…³äºå‡½æ•°å¯è§æ€§"><a href="#â‘¨æ›´å¤šå…³äºå‡½æ•°å¯è§æ€§" class="headerlink" title="â‘¨æ›´å¤šå…³äºå‡½æ•°å¯è§æ€§"></a>â‘¨æ›´å¤šå…³äºå‡½æ•°å¯è§æ€§</h4><p>internal å’Œ external<br>é™¤ public å’Œ private å±æ€§ä¹‹å¤–ï¼ŒSolidity è¿˜ä½¿ç”¨äº†å¦å¤–ä¸¤ä¸ªæè¿°å‡½æ•°å¯è§æ€§çš„ä¿®é¥°è¯ï¼šinternalï¼ˆå†…éƒ¨ï¼‰ å’Œ externalï¼ˆå¤–éƒ¨ï¼‰ã€‚</p><p>internal å’Œ private ç±»ä¼¼ï¼Œä¸è¿‡ï¼Œ å¦‚æœæŸä¸ªåˆçº¦ç»§æ‰¿è‡ªå…¶çˆ¶åˆçº¦ï¼Œè¿™ä¸ªåˆçº¦å³å¯ä»¥è®¿é—®çˆ¶åˆçº¦ä¸­å®šä¹‰çš„â€œå†…éƒ¨â€å‡½æ•°ã€‚</p><p>external ä¸public ç±»ä¼¼ï¼Œåªä¸è¿‡è¿™äº›å‡½æ•°åªèƒ½åœ¨åˆçº¦ä¹‹å¤–è°ƒç”¨ - å®ƒä»¬ä¸èƒ½è¢«åˆçº¦å†…çš„å…¶ä»–å‡½æ•°è°ƒç”¨ã€‚</p><p>å£°æ˜å‡½æ•° internal æˆ– external ç±»å‹çš„è¯­æ³•ï¼Œä¸å£°æ˜ private å’Œ publicç±» å‹ç›¸åŒï¼š</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">contract Sandwich &#123;</span><br><span class="line">  uint private sandwichesEaten = 0;</span><br><span class="line"></span><br><span class="line">  function eat() internal &#123;</span><br><span class="line">    sandwichesEaten++;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">contract BLT is Sandwich &#123;</span><br><span class="line">  uint private baconSandwichesEaten = 0;</span><br><span class="line"></span><br><span class="line">  function eatWithBacon() public returns (string) &#123;</span><br><span class="line">    baconSandwichesEaten++;</span><br><span class="line">    // å› ä¸ºeat() æ˜¯internal çš„ï¼Œæ‰€ä»¥æˆ‘ä»¬èƒ½åœ¨è¿™é‡Œè°ƒç”¨</span><br><span class="line">    eat();</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å®æˆ˜æ¼”ä¹ :å°† _createZombie() å‡½æ•°çš„å±æ€§ä» private æ”¹ä¸º internal</p><h4 id="â‘©åƒµå°¸åƒä»€ä¹ˆ"><a href="#â‘©åƒµå°¸åƒä»€ä¹ˆ" class="headerlink" title="â‘©åƒµå°¸åƒä»€ä¹ˆ?"></a>â‘©åƒµå°¸åƒä»€ä¹ˆ?</h4><p>ä¸å…¶ä»–åˆçº¦çš„äº¤äº’ï¼š<br>å¦‚æœæˆ‘ä»¬çš„åˆçº¦éœ€è¦å’ŒåŒºå—é“¾ä¸Šçš„å…¶ä»–çš„åˆçº¦ä¼šè¯ï¼Œåˆ™éœ€å…ˆå®šä¹‰ä¸€ä¸ª interface (æ¥å£)ã€‚</p><p>å…ˆä¸¾ä¸€ä¸ªç®€å•çš„æ —å­ã€‚ å‡è®¾åœ¨åŒºå—é“¾ä¸Šæœ‰è¿™ä¹ˆä¸€ä¸ªåˆçº¦ï¼š</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">contract LuckyNumber &#123;</span><br><span class="line">  mapping(address =&gt; uint) numbers;</span><br><span class="line"></span><br><span class="line">  function setNum(uint _num) public &#123;</span><br><span class="line">    numbers[msg.sender] = _num;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  function getNum(address _myAddress) public view returns (uint) &#123;</span><br><span class="line">    return numbers[_myAddress];</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿™æ˜¯ä¸ªå¾ˆç®€å•çš„åˆçº¦ï¼Œæ‚¨å¯ä»¥ç”¨å®ƒå­˜å‚¨è‡ªå·±çš„å¹¸è¿å·ç ï¼Œå¹¶å°†å…¶ä¸æ‚¨çš„ä»¥å¤ªåŠåœ°å€å…³è”ã€‚ è¿™æ ·å…¶ä»–äººå°±å¯ä»¥é€šè¿‡æ‚¨çš„åœ°å€æŸ¥æ‰¾æ‚¨çš„å¹¸è¿å·ç äº†ã€‚</p><p>ç°åœ¨å‡è®¾æˆ‘ä»¬æœ‰ä¸€ä¸ªå¤–éƒ¨åˆçº¦ï¼Œä½¿ç”¨ getNum å‡½æ•°å¯è¯»å–å…¶ä¸­çš„æ•°æ®ã€‚</p><p>é¦–å…ˆï¼Œæˆ‘ä»¬å®šä¹‰ LuckyNumber åˆçº¦çš„ interface ï¼š</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">contract NumberInterface &#123;</span><br><span class="line">  function getNum(address _myAddress) public view returns (uint);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¯·æ³¨æ„ï¼Œè¿™ä¸ªè¿‡ç¨‹è™½ç„¶çœ‹èµ·æ¥åƒåœ¨å®šä¹‰ä¸€ä¸ªåˆçº¦ï¼Œä½†å…¶å®å†…é‡Œä¸åŒï¼š</p><p>é¦–å…ˆï¼Œæˆ‘ä»¬åªå£°æ˜äº†è¦ä¸ä¹‹äº¤äº’çš„å‡½æ•° â€”â€” åœ¨æœ¬ä¾‹ä¸­ä¸º getNum â€”â€” åœ¨å…¶ä¸­æˆ‘ä»¬æ²¡æœ‰ä½¿ç”¨åˆ°ä»»ä½•å…¶ä»–çš„å‡½æ•°æˆ–çŠ¶æ€å˜é‡ã€‚</p><p>å…¶æ¬¡ï¼Œæˆ‘ä»¬å¹¶æ²¡æœ‰ä½¿ç”¨å¤§æ‹¬å·ï¼ˆ{ å’Œ }ï¼‰å®šä¹‰å‡½æ•°ä½“ï¼Œæˆ‘ä»¬å•å•ç”¨åˆ†å·ï¼ˆ;ï¼‰ç»“æŸäº†å‡½æ•°å£°æ˜ã€‚è¿™ä½¿å®ƒçœ‹èµ·æ¥åƒä¸€ä¸ªåˆçº¦æ¡†æ¶ã€‚</p><p>ç¼–è¯‘å™¨å°±æ˜¯é è¿™äº›ç‰¹å¾è®¤å‡ºå®ƒæ˜¯ä¸€ä¸ªæ¥å£çš„ã€‚<br>å®æˆ˜æ¼”ä¹ ï¼š</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">contract KittyInterface &#123;</span><br><span class="line">  function getKitty(uint256 _id) external view returns (</span><br><span class="line">    bool isGestating,</span><br><span class="line">    bool isReady,</span><br><span class="line">    uint256 cooldownIndex,</span><br><span class="line">    uint256 nextActionAt,</span><br><span class="line">    uint256 siringWithId,</span><br><span class="line">    uint256 birthTime,</span><br><span class="line">    uint256 matronId,</span><br><span class="line">    uint256 sireId,</span><br><span class="line">    uint256 generation,</span><br><span class="line">    uint256 genes</span><br><span class="line">  );</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="â‘ªä½¿ç”¨æ¥å£"><a href="#â‘ªä½¿ç”¨æ¥å£" class="headerlink" title="â‘ªä½¿ç”¨æ¥å£"></a>â‘ªä½¿ç”¨æ¥å£</h4><p>ç»§ç»­å‰é¢ NumberInterface çš„ä¾‹å­ï¼Œæˆ‘ä»¬æ—¢ç„¶å°†æ¥å£å®šä¹‰ä¸ºï¼š</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">contract NumberInterface &#123;</span><br><span class="line">  function getNum(address _myAddress) public view returns (uint);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æˆ‘ä»¬å¯ä»¥åœ¨åˆçº¦ä¸­è¿™æ ·ä½¿ç”¨ï¼š</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">contract MyContract &#123;</span><br><span class="line">  address NumberInterfaceAddress = 0xab38...;</span><br><span class="line">  // ^ è¿™æ˜¯FavoriteNumberåˆçº¦åœ¨ä»¥å¤ªåŠä¸Šçš„åœ°å€</span><br><span class="line">  NumberInterface numberContract = NumberInterface(NumberInterfaceAddress);</span><br><span class="line">  // ç°åœ¨å˜é‡ `numberContract` æŒ‡å‘å¦ä¸€ä¸ªåˆçº¦å¯¹è±¡</span><br><span class="line"></span><br><span class="line">  function someFunction() public &#123;</span><br><span class="line">    // ç°åœ¨æˆ‘ä»¬å¯ä»¥è°ƒç”¨åœ¨é‚£ä¸ªåˆçº¦ä¸­å£°æ˜çš„ `getNum`å‡½æ•°:</span><br><span class="line">    uint num = numberContract.getNum(msg.sender);</span><br><span class="line">    // ...åœ¨è¿™å„¿ä½¿ç”¨ `num`å˜é‡åšäº›ä»€ä¹ˆ</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>é€šè¿‡è¿™ç§æ–¹å¼ï¼Œåªè¦å°†æ‚¨åˆçº¦çš„å¯è§æ€§è®¾ç½®ä¸ºpublic(å…¬å…±)æˆ–external(å¤–éƒ¨)ï¼Œå®ƒä»¬å°±å¯ä»¥ä¸ä»¥å¤ªåŠåŒºå—é“¾ä¸Šçš„ä»»ä½•å…¶ä»–åˆçº¦è¿›è¡Œäº¤äº’ã€‚</p><p>å®æˆ˜æ¼”ä¹ :</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">KittyInterface kittyContract = KittyInterface(ckAddress);</span><br></pre></td></tr></table></figure><h4 id="â‘«å¤„ç†å¤šè¿”å›å€¼"><a href="#â‘«å¤„ç†å¤šè¿”å›å€¼" class="headerlink" title="â‘«å¤„ç†å¤šè¿”å›å€¼"></a>â‘«å¤„ç†å¤šè¿”å›å€¼</h4><p>getKitty æ˜¯æˆ‘ä»¬æ‰€çœ‹åˆ°çš„ç¬¬ä¸€ä¸ªè¿”å›å¤šä¸ªå€¼çš„å‡½æ•°ã€‚æˆ‘ä»¬æ¥çœ‹çœ‹æ˜¯å¦‚ä½•å¤„ç†çš„ï¼š</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">function multipleReturns() internal returns(uint a, uint b, uint c) &#123;</span><br><span class="line">  return (1, 2, 3);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">function processMultipleReturns() external &#123;</span><br><span class="line">  uint a;</span><br><span class="line">  uint b;</span><br><span class="line">  uint c;</span><br><span class="line">  // è¿™æ ·æ¥åšæ‰¹é‡èµ‹å€¼:</span><br><span class="line">  (a, b, c) = multipleReturns();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// æˆ–è€…å¦‚æœæˆ‘ä»¬åªæƒ³è¿”å›å…¶ä¸­ä¸€ä¸ªå˜é‡:</span><br><span class="line">function getLastReturnValue() external &#123;</span><br><span class="line">  uint c;</span><br><span class="line">  // å¯ä»¥å¯¹å…¶ä»–å­—æ®µç•™ç©º:</span><br><span class="line">  (,,c) = multipleReturns();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å®æˆ˜æ¼”ä¹ :</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">function feedOnKitty(uint _zombieId, uint _kittyId) public &#123;</span><br><span class="line">    uint kittyDna;</span><br><span class="line">    (,,,,,,,,,kittyDna) = kittyContract.getKitty(_kittyId);</span><br><span class="line">    // å¹¶ä¿®æ”¹å‡½æ•°è°ƒç”¨</span><br><span class="line">    feedAndMultiply(_zombieId, kittyDna);</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure><h4 id="â‘¬å¥–åŠ±-Kitty-åŸºå› "><a href="#â‘¬å¥–åŠ±-Kitty-åŸºå› " class="headerlink" title="â‘¬å¥–åŠ±: Kitty åŸºå› "></a>â‘¬å¥–åŠ±: Kitty åŸºå› </h4><p>è¿˜è®°å¾—å—ï¼Œç¬¬ä¸€è¯¾ä¸­æˆ‘ä»¬æåˆ°ï¼Œæˆ‘ä»¬ç›®å‰åªä½¿ç”¨16ä½DNAçš„å‰12ä½æ•°æ¥æŒ‡å®šåƒµå°¸çš„å¤–è§‚ã€‚æ‰€ä»¥ç°åœ¨æˆ‘ä»¬å¯ä»¥ä½¿ç”¨æœ€å2ä¸ªæ•°å­—æ¥å¤„ç†â€œç‰¹æ®Šâ€çš„ç‰¹å¾ã€‚</p><p>è¿™æ ·å§ï¼ŒæŠŠçŒ«åƒµå°¸DNAçš„æœ€åä¸¤ä¸ªæ•°å­—è®¾å®šä¸º99ï¼ˆå› ä¸ºçŒ«æœ‰9æ¡å‘½ï¼‰ã€‚æ‰€ä»¥åœ¨æˆ‘ä»¬è¿™ä¹ˆæ¥å†™ä»£ç ï¼šå¦‚æœè¿™ä¸ªåƒµå°¸æ˜¯ä¸€åªçŒ«å˜æ¥çš„ï¼Œå°±å°†å®ƒDNAçš„æœ€åä¸¤ä½æ•°å­—è®¾ç½®ä¸º99ã€‚</p><p>if è¯­å¥<br>ifè¯­å¥çš„è¯­æ³•åœ¨ Solidity ä¸­ï¼Œä¸åœ¨ JavaScript ä¸­å·®ä¸å¤šï¼š</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">function eatBLT(string sandwich) public &#123;</span><br><span class="line">  // çœ‹æ¸…æ¥šäº†ï¼Œå½“æˆ‘ä»¬æ¯”è¾ƒå­—ç¬¦ä¸²çš„æ—¶å€™ï¼Œéœ€è¦æ¯”è¾ƒä»–ä»¬çš„ keccak256 å“ˆå¸Œç </span><br><span class="line">  if (keccak256(sandwich) == keccak256(&quot;BLT&quot;)) &#123;</span><br><span class="line">    eat();</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="â‘­æ”¾åœ¨ä¸€èµ·"><a href="#â‘­æ”¾åœ¨ä¸€èµ·" class="headerlink" title="â‘­æ”¾åœ¨ä¸€èµ·"></a>â‘­æ”¾åœ¨ä¸€èµ·</h4><p>JavaScript å®ç°<br>æˆ‘ä»¬åªç”¨ç¼–è¯‘å’Œéƒ¨ç½² ZombieFeedingï¼Œå°±å¯ä»¥å°†è¿™ä¸ªåˆçº¦éƒ¨ç½²åˆ°ä»¥å¤ªåŠäº†ã€‚æˆ‘ä»¬æœ€ç»ˆå®Œæˆçš„è¿™ä¸ªåˆçº¦ç»§æ‰¿è‡ª ZombieFactoryï¼Œå› æ­¤å®ƒå¯ä»¥è®¿é—®è‡ªå·±å’Œçˆ¶è¾ˆåˆçº¦ä¸­çš„æ‰€æœ‰ public æ–¹æ³•ã€‚</p><p>æˆ‘ä»¬æ¥çœ‹ä¸€ä¸ªä¸æˆ‘ä»¬çš„åˆšéƒ¨ç½²çš„åˆçº¦è¿›è¡Œäº¤äº’çš„ä¾‹å­ï¼Œ è¿™ä¸ªä¾‹å­ä½¿ç”¨äº† JavaScript å’Œ web3.jsï¼š</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">var abi = /* abi generated by the compiler */</span><br><span class="line">var ZombieFeedingContract = web3.eth.contract(abi)</span><br><span class="line">var contractAddress = /* our contract address on Ethereum after deploying */</span><br><span class="line">var ZombieFeeding = ZombieFeedingContract.at(contractAddress)</span><br><span class="line"></span><br><span class="line">// å‡è®¾æˆ‘ä»¬æœ‰æˆ‘ä»¬çš„åƒµå°¸IDå’Œè¦æ”»å‡»çš„çŒ«å’ªID</span><br><span class="line">let zombieId = 1;</span><br><span class="line">let kittyId = 1;</span><br><span class="line"></span><br><span class="line">// è¦æ‹¿åˆ°çŒ«å’ªçš„DNAï¼Œæˆ‘ä»¬éœ€è¦è°ƒç”¨å®ƒçš„APIã€‚è¿™äº›æ•°æ®ä¿å­˜åœ¨å®ƒä»¬çš„æœåŠ¡å™¨ä¸Šè€Œä¸æ˜¯åŒºå—é“¾ä¸Šã€‚</span><br><span class="line">// å¦‚æœä¸€åˆ‡éƒ½åœ¨åŒºå—é“¾ä¸Šï¼Œæˆ‘ä»¬å°±ä¸ç”¨æ‹…å¿ƒå®ƒä»¬çš„æœåŠ¡å™¨æŒ‚äº†ï¼Œæˆ–è€…å®ƒä»¬ä¿®æ”¹äº†APIï¼Œ</span><br><span class="line">// æˆ–è€…å› ä¸ºä¸å–œæ¬¢æˆ‘ä»¬çš„åƒµå°¸æ¸¸æˆè€Œå°æ€äº†æˆ‘ä»¬</span><br><span class="line">let apiUrl = &quot;https://api.cryptokitties.co/kitties/&quot; + kittyId</span><br><span class="line">$.get(apiUrl, function(data) &#123;</span><br><span class="line">  let imgUrl = data.image_url</span><br><span class="line">  // ä¸€äº›æ˜¾ç¤ºå›¾ç‰‡çš„ä»£ç </span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">// å½“ç”¨æˆ·ç‚¹å‡»ä¸€åªçŒ«å’ªçš„æ—¶å€™:</span><br><span class="line">$(&quot;.kittyImage&quot;).click(function(e) &#123;</span><br><span class="line">  // è°ƒç”¨æˆ‘ä»¬åˆçº¦çš„ `feedOnKitty` å‡½æ•°</span><br><span class="line">  ZombieFeeding.feedOnKitty(zombieId, kittyId)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">// ä¾¦å¬æ¥è‡ªæˆ‘ä»¬åˆçº¦çš„æ–°åƒµå°¸äº‹ä»¶å¥½æ¥å¤„ç†</span><br><span class="line">ZombieFactory.NewZombie(function(error, result) &#123;</span><br><span class="line">  if (error) return</span><br><span class="line">  // è¿™ä¸ªå‡½æ•°ç”¨æ¥æ˜¾ç¤ºåƒµå°¸:</span><br><span class="line">  generateZombie(result.zombieId, result.name, result.dna)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><h4 id="â‘®ç¬¬äºŒè¯¾å®Œæˆ"><a href="#â‘®ç¬¬äºŒè¯¾å®Œæˆ" class="headerlink" title="â‘®ç¬¬äºŒè¯¾å®Œæˆ"></a>â‘®ç¬¬äºŒè¯¾å®Œæˆ</h4><p>æˆªè‡³ç¬¬äºŒè¯¾å®Œæˆï¼Œæ‰€æœ‰ä»£ç å¦‚ä¸‹ï¼š<br>zombiefactory.sol</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">pragma solidity ^0.4.19;</span><br><span class="line"></span><br><span class="line">contract ZombieFactory &#123;</span><br><span class="line"></span><br><span class="line">    event NewZombie(uint zombieId, string name, uint dna);</span><br><span class="line"></span><br><span class="line">    uint dnaDigits = 16;</span><br><span class="line">    uint dnaModulus = 10 ** dnaDigits;</span><br><span class="line"></span><br><span class="line">    struct Zombie &#123;</span><br><span class="line">        string name;</span><br><span class="line">        uint dna;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    Zombie[] public zombies;</span><br><span class="line"></span><br><span class="line">    mapping (uint =&gt; address) public zombieToOwner;</span><br><span class="line">    mapping (address =&gt; uint) ownerZombieCount;</span><br><span class="line"></span><br><span class="line">    function _createZombie(string _name, uint _dna) internal &#123;</span><br><span class="line">        uint id = zombies.push(Zombie(_name, _dna)) - 1;</span><br><span class="line">        zombieToOwner[id] = msg.sender;</span><br><span class="line">        ownerZombieCount[msg.sender]++;</span><br><span class="line">        NewZombie(id, _name, _dna);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    function _generateRandomDna(string _str) private view returns (uint) &#123;</span><br><span class="line">        uint rand = uint(keccak256(_str));</span><br><span class="line">        return rand % dnaModulus;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    function createRandomZombie(string _name) public &#123;</span><br><span class="line">        require(ownerZombieCount[msg.sender] == 0);</span><br><span class="line">        uint randDna = _generateRandomDna(_name);</span><br><span class="line">        randDna = randDna - randDna % 100;</span><br><span class="line">        _createZombie(_name, randDna);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>zombiefeeding.sol</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">pragma solidity ^0.4.19;</span><br><span class="line">import &quot;./zombiefactory.sol&quot;;</span><br><span class="line">contract KittyInterface &#123;</span><br><span class="line">  function getKitty(uint256 _id) external view returns (</span><br><span class="line">    bool isGestating,</span><br><span class="line">    bool isReady,</span><br><span class="line">    uint256 cooldownIndex,</span><br><span class="line">    uint256 nextActionAt,</span><br><span class="line">    uint256 siringWithId,</span><br><span class="line">    uint256 birthTime,</span><br><span class="line">    uint256 matronId,</span><br><span class="line">    uint256 sireId,</span><br><span class="line">    uint256 generation,</span><br><span class="line">    uint256 genes</span><br><span class="line">  );</span><br><span class="line">&#125;</span><br><span class="line">contract ZombieFeeding is ZombieFactory &#123;</span><br><span class="line"></span><br><span class="line">  address ckAddress = 0x06012c8cf97BEaD5deAe237070F9587f8E7A266d;</span><br><span class="line">  KittyInterface kittyContract = KittyInterface(ckAddress);</span><br><span class="line"></span><br><span class="line">  function feedAndMultiply(uint _zombieId, uint _targetDna, string _species) public &#123;</span><br><span class="line">    require(msg.sender == zombieToOwner[_zombieId]);</span><br><span class="line">    Zombie storage myZombie = zombies[_zombieId];</span><br><span class="line">    _targetDna = _targetDna % dnaModulus;</span><br><span class="line">    uint newDna = (myZombie.dna + _targetDna) / 2;</span><br><span class="line">    if (keccak256(_species) == keccak256(&quot;kitty&quot;)) &#123;</span><br><span class="line">      newDna = newDna - newDna % 100 + 99;</span><br><span class="line">    &#125;</span><br><span class="line">    _createZombie(&quot;NoName&quot;, newDna);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  function feedOnKitty(uint _zombieId, uint _kittyId) public &#123;</span><br><span class="line">    uint kittyDna;</span><br><span class="line">    (,,,,,,,,,kittyDna) = kittyContract.getKitty(_kittyId);</span><br><span class="line">    feedAndMultiply(_zombieId, kittyDna, &quot;kitty&quot;);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><hr><h3 id="3-é«˜çº§-Solidity-ç†è®º"><a href="#3-é«˜çº§-Solidity-ç†è®º" class="headerlink" title="3.é«˜çº§ Solidity ç†è®º"></a>3.é«˜çº§ Solidity ç†è®º</h3><h4 id="â‘ æ™ºèƒ½åè®®çš„æ°¸å›ºæ€§"><a href="#â‘ æ™ºèƒ½åè®®çš„æ°¸å›ºæ€§" class="headerlink" title="â‘ æ™ºèƒ½åè®®çš„æ°¸å›ºæ€§"></a>â‘ æ™ºèƒ½åè®®çš„æ°¸å›ºæ€§</h4><p>åˆ°ç°åœ¨ä¸ºæ­¢ï¼Œæˆ‘ä»¬è®²çš„ Solidity å’Œå…¶ä»–è¯­è¨€æ²¡æœ‰è´¨çš„åŒºåˆ«ï¼Œå®ƒé•¿å¾—ä¹Ÿå¾ˆåƒ JavaScriptã€‚</p><p>ä½†æ˜¯ï¼Œåœ¨æœ‰å‡ ç‚¹ä»¥å¤ªåŠä¸Šçš„ DApp è·Ÿæ™®é€šçš„åº”ç”¨ç¨‹åºæœ‰ç€å¤©å£¤ä¹‹åˆ«ã€‚</p><p>ç¬¬ä¸€ä¸ªä¾‹å­ï¼Œåœ¨ä½ æŠŠæ™ºèƒ½åè®®ä¼ ä¸Šä»¥å¤ªåŠä¹‹åï¼Œå®ƒå°±å˜å¾—ä¸å¯æ›´æ”¹, è¿™ç§æ°¸å›ºæ€§æ„å‘³ç€ä½ çš„ä»£ç æ°¸è¿œä¸èƒ½è¢«è°ƒæ•´æˆ–æ›´æ–°ã€‚</p><p>ä½ ç¼–è¯‘çš„ç¨‹åºä¼šä¸€ç›´ï¼Œæ°¸ä¹…çš„ï¼Œä¸å¯æ›´æ”¹çš„ï¼Œå­˜åœ¨ä»¥å¤ªåŠä¸Šã€‚è¿™å°±æ˜¯ Solidity ä»£ç çš„å®‰å…¨æ€§å¦‚æ­¤é‡è¦çš„ä¸€ä¸ªåŸå› ã€‚å¦‚æœä½ çš„æ™ºèƒ½åè®®æœ‰ä»»ä½•æ¼æ´ï¼Œå³ä½¿ä½ å‘ç°äº†ä¹Ÿæ— æ³•è¡¥æ•‘ã€‚ä½ åªèƒ½è®©ä½ çš„ç”¨æˆ·ä»¬æ”¾å¼ƒè¿™ä¸ªæ™ºèƒ½åè®®ï¼Œç„¶åè½¬ç§»åˆ°ä¸€ä¸ªæ–°çš„ä¿®å¤åçš„åˆçº¦ä¸Šã€‚</p><p>ä½†è¿™æ°å¥½ä¹Ÿæ˜¯æ™ºèƒ½åˆçº¦çš„ä¸€å¤§ä¼˜åŠ¿ã€‚ä»£ç è¯´æ˜ä¸€åˆ‡ã€‚å¦‚æœä½ å»è¯»æ™ºèƒ½åˆçº¦çš„ä»£ç ï¼Œå¹¶éªŒè¯å®ƒï¼Œä½ ä¼šå‘ç°ï¼Œä¸€æ—¦å‡½æ•°è¢«å®šä¹‰ä¸‹æ¥ï¼Œæ¯ä¸€æ¬¡çš„è¿è¡Œï¼Œç¨‹åºéƒ½ä¼šä¸¥æ ¼éµç…§å‡½æ•°ä¸­åŸæœ‰çš„ä»£ç é€»è¾‘ä¸€ä¸ä¸è‹Ÿåœ°æ‰§è¡Œï¼Œå®Œå…¨ä¸ç”¨æ‹…å¿ƒå‡½æ•°è¢«äººç¯¡æ”¹è€Œå¾—åˆ°æ„å¤–çš„ç»“æœã€‚</p><p>å¤–éƒ¨ä¾èµ–å…³ç³»ï¼š<br>åœ¨ç¬¬2è¯¾ä¸­ï¼Œæˆ‘ä»¬å°†åŠ å¯†å°çŒ«ï¼ˆCryptoKittiesï¼‰åˆçº¦çš„åœ°å€ç¡¬ç¼–ç åˆ° DApp ä¸­å»äº†ã€‚æœ‰æ²¡æœ‰æƒ³è¿‡ï¼Œå¦‚æœåŠ å¯†å°çŒ«å‡ºäº†ç‚¹é—®é¢˜ï¼Œæ¯”æ–¹è¯´ï¼Œé›†ä½“æ¶ˆå¤±äº†ä¼šæ€ä¹ˆæ ·ï¼Ÿ è™½ç„¶è¿™ç§äº‹æƒ…å‡ ä¹ä¸å¯èƒ½å‘ç”Ÿï¼Œä½†æ˜¯ï¼Œå¦‚æœå°çŒ«æ²¡äº†ï¼Œæˆ‘ä»¬çš„ DApp ä¹Ÿä¼šéšä¹‹å¤±æ•ˆ â€“ å› ä¸ºæˆ‘ä»¬åœ¨ DApp çš„ä»£ç ä¸­ç”¨â€œç¡¬ç¼–ç â€çš„æ–¹å¼æŒ‡å®šäº†åŠ å¯†å°çŒ«çš„åœ°å€ï¼Œå¦‚æœè¿™ä¸ªæ ¹æ®åœ°å€æ‰¾ä¸åˆ°å°çŒ«ï¼Œæˆ‘ä»¬çš„åƒµå°¸ä¹Ÿå°±åƒä¸åˆ°å°çŒ«äº†ï¼Œè€ŒæŒ‰ç…§å‰é¢çš„æè¿°ï¼Œæˆ‘ä»¬å´æ²¡æ³•ä¿®æ”¹åˆçº¦å»åº”ä»˜è¿™ä¸ªå˜åŒ–ï¼</p><p>å› æ­¤ï¼Œæˆ‘ä»¬ä¸èƒ½ç¡¬ç¼–ç ï¼Œè€Œè¦é‡‡ç”¨â€œå‡½æ•°â€ï¼Œä»¥ä¾¿äº DApp çš„å…³é”®éƒ¨åˆ†å¯ä»¥ä»¥å‚æ•°å½¢å¼ä¿®æ”¹ã€‚</p><p>æ¯”æ–¹è¯´ï¼Œæˆ‘ä»¬ä¸å†ä¸€å¼€å§‹å°±æŠŠçŒç‰©åœ°å€ç»™å†™å…¥ä»£ç ï¼Œè€Œæ˜¯å†™ä¸ªå‡½æ•° setKittyContractAddress, è¿è¡Œæ—¶å†è®¾å®šçŒç‰©çš„åœ°å€ï¼Œè¿™æ ·æˆ‘ä»¬å°±å¯ä»¥éšæ—¶å»é”å®šæ–°çš„çŒç‰©ï¼Œä¹Ÿä¸ç”¨æ‹…å¿ƒåŠ å¯†å°çŒ«é›†ä½“æ¶ˆå¤±äº†ã€‚</p><p>å®æˆ˜æ¼”ä¹ ï¼š</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">KittyInterface kittyContract;</span><br><span class="line"></span><br><span class="line">  function setKittyContractAddress(address _address) external &#123;</span><br><span class="line">    kittyContract = KittyInterface(_address);</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure><h4 id="â‘¡Ownable-Contracts"><a href="#â‘¡Ownable-Contracts" class="headerlink" title="â‘¡Ownable Contracts"></a>â‘¡Ownable Contracts</h4><p>OpenZeppelinåº“çš„Ownable åˆçº¦<br>ä¸‹é¢æ˜¯ä¸€ä¸ª Ownable åˆçº¦çš„ä¾‹å­ï¼š æ¥è‡ª _ OpenZeppelin _ Solidity åº“çš„ Ownable åˆçº¦ã€‚ OpenZeppelin æ˜¯ä¸»æ‰“å®‰ä¿å’Œç¤¾åŒºå®¡æŸ¥çš„æ™ºèƒ½åˆçº¦åº“ï¼Œæ‚¨å¯ä»¥åœ¨è‡ªå·±çš„ DAppsä¸­å¼•ç”¨ã€‚ç­‰æŠŠè¿™ä¸€è¯¾å­¦å®Œï¼Œæ‚¨ä¸è¦å‚¬æˆ‘ä»¬å‘å¸ƒä¸‹ä¸€è¯¾ï¼Œæœ€å¥½åˆ©ç”¨è¿™ä¸ªæ—¶é—´æŠŠ OpenZeppelin çš„ç½‘ç«™çœ‹çœ‹ï¼Œä¿ç®¡æ‚¨ä¼šå­¦åˆ°å¾ˆå¤šä¸œè¥¿ï¼</p><p>æŠŠæ¥¼ä¸‹è¿™ä¸ªåˆçº¦è¯»è¯»é€šï¼Œæ˜¯ä¸æ˜¯è¿˜æœ‰äº›æ²¡è§è¿‡ä»£ç ï¼Ÿåˆ«æ‹…å¿ƒï¼Œæˆ‘ä»¬éšåä¼šè§£é‡Šã€‚</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">/**</span><br><span class="line"> * @title Ownable</span><br><span class="line"> * @dev The Ownable contract has an owner address, and provides basic authorization control</span><br><span class="line"> * functions, this simplifies the implementation of &quot;user permissions&quot;.</span><br><span class="line"> */</span><br><span class="line">contract Ownable &#123;</span><br><span class="line">  address public owner;</span><br><span class="line">  event OwnershipTransferred(address indexed previousOwner, address indexed newOwner);</span><br><span class="line"></span><br><span class="line">  /**</span><br><span class="line">   * @dev The Ownable constructor sets the original `owner` of the contract to the sender</span><br><span class="line">   * account.</span><br><span class="line">   */</span><br><span class="line">  function Ownable() public &#123;</span><br><span class="line">    owner = msg.sender;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  /**</span><br><span class="line">   * @dev Throws if called by any account other than the owner.</span><br><span class="line">   */</span><br><span class="line">  modifier onlyOwner() &#123;</span><br><span class="line">    require(msg.sender == owner);</span><br><span class="line">    _;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  /**</span><br><span class="line">   * @dev Allows the current owner to transfer control of the contract to a newOwner.</span><br><span class="line">   * @param newOwner The address to transfer ownership to.</span><br><span class="line">   */</span><br><span class="line">  function transferOwnership(address newOwner) public onlyOwner &#123;</span><br><span class="line">    require(newOwner != address(0));</span><br><span class="line">    OwnershipTransferred(owner, newOwner);</span><br><span class="line">    owner = newOwner;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ol><li>æ„é€ å‡½æ•°ï¼šfunction Ownable()æ˜¯ä¸€ä¸ª _ constructor_ (æ„é€ å‡½æ•°)ï¼Œæ„é€ å‡½æ•°ä¸æ˜¯å¿…é¡»çš„ï¼Œå®ƒä¸åˆçº¦åŒåï¼Œæ„é€ å‡½æ•°ä¸€ç”Ÿä¸­å”¯ä¸€çš„ä¸€æ¬¡æ‰§è¡Œï¼Œå°±æ˜¯åœ¨åˆçº¦æœ€åˆè¢«åˆ›å»ºçš„æ—¶å€™ã€‚</li><li>å‡½æ•°ä¿®é¥°ç¬¦ï¼šmodifier onlyOwner()ã€‚ ä¿®é¥°ç¬¦è·Ÿå‡½æ•°å¾ˆç±»ä¼¼ï¼Œä¸è¿‡æ˜¯ç”¨æ¥ä¿®é¥°å…¶ä»–å·²æœ‰å‡½æ•°ç”¨çš„ï¼Œ åœ¨å…¶ä»–è¯­å¥æ‰§è¡Œå‰ï¼Œä¸ºå®ƒæ£€æŸ¥ä¸‹å…ˆéªŒæ¡ä»¶ã€‚ åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œæˆ‘ä»¬å°±å¯ä»¥å†™ä¸ªä¿®é¥°ç¬¦ onlyOwner æ£€æŸ¥ä¸‹è°ƒç”¨è€…ï¼Œç¡®ä¿åªæœ‰åˆçº¦çš„ä¸»äººæ‰èƒ½è¿è¡Œæœ¬å‡½æ•°ã€‚æˆ‘ä»¬ä¸‹ä¸€ç« ä¸­ä¼šè¯¦ç»†è®²è¿°ä¿®é¥°ç¬¦ï¼Œä»¥åŠé‚£ä¸ªå¥‡æ€ªçš„_;ã€‚</li><li>indexed å…³é”®å­—ï¼šåˆ«æ‹…å¿ƒï¼Œæˆ‘ä»¬è¿˜ç”¨ä¸åˆ°å®ƒã€‚</li></ol><p>æ‰€ä»¥Ownable åˆçº¦åŸºæœ¬éƒ½ä¼šè¿™ä¹ˆå¹²ï¼š</p><ol><li>åˆçº¦åˆ›å»ºï¼Œæ„é€ å‡½æ•°å…ˆè¡Œï¼Œå°†å…¶ owner è®¾ç½®ä¸ºmsg.senderï¼ˆå…¶éƒ¨ç½²è€…ï¼‰</li><li>ä¸ºå®ƒåŠ ä¸Šä¸€ä¸ªä¿®é¥°ç¬¦ onlyOwnerï¼Œå®ƒä¼šé™åˆ¶é™Œç”Ÿäººçš„è®¿é—®ï¼Œå°†è®¿é—®æŸäº›å‡½æ•°çš„æƒé™é”å®šåœ¨ owner ä¸Šã€‚</li><li>å…è®¸å°†åˆçº¦æ‰€æœ‰æƒè½¬è®©ç»™ä»–äººã€‚</li></ol><p>onlyOwner ç®€ç›´äººè§äººçˆ±ï¼Œå¤§å¤šæ•°äººå¼€å‘è‡ªå·±çš„ Solidity DAppsï¼Œéƒ½æ˜¯ä»å¤åˆ¶&#x2F;ç²˜è´´ Ownable å¼€å§‹çš„ï¼Œä»å®ƒå†ç»§æ‰¿å‡ºçš„å­ç±»ï¼Œå¹¶åœ¨ä¹‹ä¸Šè¿›è¡ŒåŠŸèƒ½å¼€å‘ã€‚</p><p>æ—¢ç„¶æˆ‘ä»¬æƒ³æŠŠ setKittyContractAddress é™åˆ¶ä¸º onlyOwner ï¼Œæˆ‘ä»¬ä¹Ÿè¦åšåŒæ ·çš„äº‹æƒ…ã€‚<br>å®æˆ˜æ¼”ä¹ ï¼š</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">import &quot;./ownable.sol&quot;;</span><br><span class="line"></span><br><span class="line">contract ZombieFactory is Ownable &#123;</span><br></pre></td></tr></table></figure><h4 id="â‘¢onlyOwner-å‡½æ•°ä¿®é¥°ç¬¦"><a href="#â‘¢onlyOwner-å‡½æ•°ä¿®é¥°ç¬¦" class="headerlink" title="â‘¢onlyOwner å‡½æ•°ä¿®é¥°ç¬¦"></a>â‘¢onlyOwner å‡½æ•°ä¿®é¥°ç¬¦</h4><p>ç°åœ¨æˆ‘ä»¬æœ‰äº†ä¸ªåŸºæœ¬ç‰ˆçš„åˆçº¦ ZombieFactory äº†ï¼Œå®ƒç»§æ‰¿è‡ª Ownable æ¥å£ï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥ç»™ ZombieFeeding åŠ ä¸Š onlyOwner å‡½æ•°ä¿®é¥°ç¬¦ã€‚</p><p>è¿™å°±æ˜¯åˆçº¦ç»§æ‰¿çš„å·¥ä½œåŸç†ã€‚è®°å¾—ï¼š</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">ZombieFeeding æ˜¯ä¸ª ZombieFactory</span><br><span class="line">ZombieFactory æ˜¯ä¸ª Ownable</span><br></pre></td></tr></table></figure><p>å› æ­¤ ZombieFeeding ä¹Ÿæ˜¯ä¸ª Ownable, å¹¶å¯ä»¥é€šè¿‡ Ownable æ¥å£è®¿é—®çˆ¶ç±»ä¸­çš„å‡½æ•°&#x2F;äº‹ä»¶&#x2F;ä¿®é¥°ç¬¦ã€‚å¾€åï¼ŒZombieFeeding çš„ç»§æ‰¿è€…åˆçº¦ä»¬åŒæ ·ä¹Ÿå¯ä»¥è¿™ä¹ˆå»¶ç»­ä¸‹å»ã€‚</p><p><strong>å‡½æ•°ä¿®é¥°ç¬¦</strong><br>å‡½æ•°ä¿®é¥°ç¬¦çœ‹èµ·æ¥è·Ÿå‡½æ•°æ²¡ä»€ä¹ˆä¸åŒï¼Œä¸è¿‡å…³é”®å­—modifier å‘Šè¯‰ç¼–è¯‘å™¨ï¼Œè¿™æ˜¯ä¸ªmodifier(ä¿®é¥°ç¬¦)ï¼Œè€Œä¸æ˜¯ä¸ªfunction(å‡½æ•°)ã€‚å®ƒä¸èƒ½åƒå‡½æ•°é‚£æ ·è¢«ç›´æ¥è°ƒç”¨ï¼Œåªèƒ½è¢«æ·»åŠ åˆ°å‡½æ•°å®šä¹‰çš„æœ«å°¾ï¼Œç”¨ä»¥æ”¹å˜å‡½æ•°çš„è¡Œä¸ºã€‚</p><p>å’±ä»¬ä»”ç»†è¯»è¯» onlyOwner:</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">/**</span><br><span class="line"> * @dev è°ƒç”¨è€…ä¸æ˜¯â€˜ä¸»äººâ€™ï¼Œå°±ä¼šæŠ›å‡ºå¼‚å¸¸</span><br><span class="line"> */</span><br><span class="line">modifier onlyOwner() &#123;</span><br><span class="line">  require(msg.sender == owner);</span><br><span class="line">  _;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>onlyOwner å‡½æ•°ä¿®é¥°ç¬¦æ˜¯è¿™ä¹ˆç”¨çš„ï¼š</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">contract MyContract is Ownable &#123;</span><br><span class="line">  event LaughManiacally(string laughter);</span><br><span class="line"></span><br><span class="line">  //æ³¨æ„ï¼ `onlyOwner`ä¸Šåœº :</span><br><span class="line">  function likeABoss() external onlyOwner &#123;</span><br><span class="line">    LaughManiacally(&quot;Muahahahaha&quot;);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ³¨æ„ likeABoss å‡½æ•°ä¸Šçš„ onlyOwner ä¿®é¥°ç¬¦ã€‚ å½“ä½ è°ƒç”¨ likeABoss æ—¶ï¼Œé¦–å…ˆæ‰§è¡Œ onlyOwner ä¸­çš„ä»£ç ï¼Œ æ‰§è¡Œåˆ° onlyOwner ä¸­çš„ _; è¯­å¥æ—¶ï¼Œç¨‹åºå†è¿”å›å¹¶æ‰§è¡Œ likeABoss ä¸­çš„ä»£ç ã€‚</p><p>å¯è§ï¼Œå°½ç®¡å‡½æ•°ä¿®é¥°ç¬¦ä¹Ÿå¯ä»¥åº”ç”¨åˆ°å„ç§åœºåˆï¼Œä½†æœ€å¸¸è§çš„è¿˜æ˜¯æ”¾åœ¨å‡½æ•°æ‰§è¡Œä¹‹å‰æ·»åŠ å¿«é€Ÿçš„ requireæ£€æŸ¥ã€‚</p><p>å› ä¸ºç»™å‡½æ•°æ·»åŠ äº†ä¿®é¥°ç¬¦ onlyOwnerï¼Œä½¿å¾—å”¯æœ‰åˆçº¦çš„ä¸»äººï¼ˆä¹Ÿå°±æ˜¯éƒ¨ç½²è€…ï¼‰æ‰èƒ½è°ƒç”¨å®ƒã€‚</p><blockquote><p>æ³¨æ„ï¼šä¸»äººå¯¹åˆçº¦äº«æœ‰çš„ç‰¹æƒå½“ç„¶æ˜¯æ­£å½“çš„ï¼Œä¸è¿‡ä¹Ÿå¯èƒ½è¢«æ¶æ„ä½¿ç”¨ã€‚æ¯”å¦‚ï¼Œä¸‡ä¸€ï¼Œä¸»äººæ·»åŠ äº†ä¸ªåé—¨ï¼Œå…è®¸ä»–å·èµ°åˆ«äººçš„åƒµå°¸å‘¢ï¼Ÿ</p></blockquote><blockquote><p>æ‰€ä»¥éå¸¸é‡è¦çš„æ˜¯ï¼Œéƒ¨ç½²åœ¨ä»¥å¤ªåŠä¸Šçš„ DAppï¼Œå¹¶ä¸èƒ½ä¿è¯å®ƒçœŸæ­£åšåˆ°å»ä¸­å¿ƒï¼Œä½ éœ€è¦é˜…è¯»å¹¶ç†è§£å®ƒçš„æºä»£ç ï¼Œæ‰èƒ½é˜²æ­¢å…¶ä¸­æ²¡æœ‰è¢«éƒ¨ç½²è€…æ¶æ„æ¤å…¥åé—¨ï¼›ä½œä¸ºå¼€å‘äººå‘˜ï¼Œå¦‚ä½•åšåˆ°æ—¢è¦ç»™è‡ªå·±ç•™ä¸‹ä¿®å¤ bug çš„ä½™åœ°ï¼Œåˆè¦å°½é‡åœ°æ”¾æƒç»™ä½¿ç”¨è€…ï¼Œä»¥ä¾¿è®©ä»–ä»¬æ”¾å¿ƒä½ ï¼Œä»è€Œæ„¿æ„æŠŠæ•°æ®æ”¾åœ¨ä½ çš„ DApp ä¸­ï¼Œè¿™ç¡®å®éœ€è¦ä¸ªå¾®å¦™çš„å¹³è¡¡ã€‚<br>å®æˆ˜æ¼”ä¹ ï¼š</p></blockquote><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">// ä¿®æ”¹è¿™ä¸ªå‡½æ•°:</span><br><span class="line">function setKittyContractAddress(address _address) external &#123;</span><br><span class="line">//ä¿®æ”¹åï¼š</span><br><span class="line">function setKittyContractAddress(address _address) external onlyOwner &#123;</span><br></pre></td></tr></table></figure><h4 id="â‘£Gas"><a href="#â‘£Gas" class="headerlink" title="â‘£Gas"></a>â‘£Gas</h4><p><strong>Gas - é©±åŠ¨ä»¥å¤ªåŠDAppsçš„èƒ½æº</strong><br>åœ¨ Solidity ä¸­ï¼Œä½ çš„ç”¨æˆ·æƒ³è¦æ¯æ¬¡æ‰§è¡Œä½ çš„ DApp éƒ½éœ€è¦æ”¯ä»˜ä¸€å®šçš„ gasï¼Œgas å¯ä»¥ç”¨ä»¥å¤ªå¸è´­ä¹°ï¼Œå› æ­¤ï¼Œç”¨æˆ·æ¯æ¬¡è·‘ DApp éƒ½å¾—èŠ±è´¹ä»¥å¤ªå¸ã€‚</p><p>ä¸€ä¸ª DApp æ”¶å–å¤šå°‘ gas å–å†³äºåŠŸèƒ½é€»è¾‘çš„å¤æ‚ç¨‹åº¦ã€‚æ¯ä¸ªæ“ä½œèƒŒåï¼Œéƒ½åœ¨è®¡ç®—å®Œæˆè¿™ä¸ªæ“ä½œæ‰€éœ€è¦çš„è®¡ç®—èµ„æºï¼Œï¼ˆæ¯”å¦‚ï¼Œå­˜å‚¨æ•°æ®å°±æ¯”åšä¸ªåŠ æ³•è¿ç®—è´µå¾—å¤šï¼‰ï¼Œ ä¸€æ¬¡æ“ä½œæ‰€éœ€è¦èŠ±è´¹çš„ gas ç­‰äºè¿™ä¸ªæ“ä½œèƒŒåçš„æ‰€æœ‰è¿ç®—èŠ±é”€çš„æ€»å’Œã€‚</p><p>ç”±äºè¿è¡Œä½ çš„ç¨‹åºéœ€è¦èŠ±è´¹ç”¨æˆ·çš„çœŸé‡‘ç™½é“¶ï¼Œåœ¨ä»¥å¤ªåŠä¸­ä»£ç çš„ç¼–ç¨‹è¯­è¨€ï¼Œæ¯”å…¶ä»–ä»»ä½•ç¼–ç¨‹è¯­è¨€éƒ½æ›´å¼ºè°ƒä¼˜åŒ–ã€‚åŒæ ·çš„åŠŸèƒ½ï¼Œä½¿ç”¨ç¬¨æ‹™çš„ä»£ç å¼€å‘çš„ç¨‹åºï¼Œæ¯”èµ·ç»è¿‡ç²¾å·§ä¼˜åŒ–çš„ä»£ç æ¥ï¼Œè¿è¡ŒèŠ±è´¹æ›´é«˜ï¼Œè¿™æ˜¾ç„¶ä¼šç»™æˆåƒä¸Šä¸‡çš„ç”¨æˆ·å¸¦æ¥å¤§é‡ä¸å¿…è¦çš„å¼€é”€ã€‚<br><strong>ä¸ºä»€ä¹ˆè¦ç”¨ gas æ¥é©±åŠ¨ï¼Ÿ</strong><br>ä»¥å¤ªåŠå°±åƒä¸€ä¸ªå·¨å¤§ã€ç¼“æ…¢ã€ä½†éå¸¸å®‰å…¨çš„ç”µè„‘ã€‚å½“ä½ è¿è¡Œä¸€ä¸ªç¨‹åºçš„æ—¶å€™ï¼Œç½‘ç»œä¸Šçš„æ¯ä¸€ä¸ªèŠ‚ç‚¹éƒ½åœ¨è¿›è¡Œç›¸åŒçš„è¿ç®—ï¼Œä»¥éªŒè¯å®ƒçš„è¾“å‡º â€”â€” è¿™å°±æ˜¯æ‰€è°“çš„â€œå»ä¸­å¿ƒåŒ–â€ ç”±äºæ•°ä»¥åƒè®¡çš„èŠ‚ç‚¹åŒæ—¶åœ¨éªŒè¯ç€æ¯ä¸ªåŠŸèƒ½çš„è¿è¡Œï¼Œè¿™å¯ä»¥ç¡®ä¿å®ƒçš„æ•°æ®ä¸ä¼šè¢«è¢«ç›‘æ§ï¼Œæˆ–è€…è¢«åˆ»æ„ä¿®æ”¹ã€‚</p><p>å¯èƒ½ä¼šæœ‰ç”¨æˆ·ç”¨æ— é™å¾ªç¯å µå¡ç½‘ç»œï¼ŒæŠ‘æˆ–ç”¨å¯†é›†è¿ç®—æ¥å ç”¨å¤§é‡çš„ç½‘ç»œèµ„æºï¼Œä¸ºäº†é˜²æ­¢è¿™ç§äº‹æƒ…çš„å‘ç”Ÿï¼Œä»¥å¤ªåŠçš„åˆ›å»ºè€…ä¸ºä»¥å¤ªåŠä¸Šçš„èµ„æºåˆ¶å®šäº†ä»·æ ¼ï¼Œæƒ³è¦åœ¨ä»¥å¤ªåŠä¸Šè¿ç®—æˆ–è€…å­˜å‚¨ï¼Œä½ éœ€è¦å…ˆä»˜è´¹ã€‚</p><blockquote><p>æ³¨æ„ï¼šå¦‚æœä½ ä½¿ç”¨ä¾§é“¾ï¼Œå€’æ˜¯ä¸ä¸€å®šéœ€è¦ä»˜è´¹ï¼Œæ¯”å¦‚å’±ä»¬åœ¨ Loom Network ä¸Šæ„å»ºçš„ CryptoZombies å°±å…è´¹ã€‚ä½ ä¸ä¼šæƒ³è¦åœ¨ä»¥å¤ªåŠä¸»ç½‘ä¸Šç©å„¿â€œé­”å…½ä¸–ç•Œâ€å§ï¼Ÿ - æ‰€éœ€è¦çš„ gas å¯èƒ½ä¼šä¹°åˆ°ä½ ç ´äº§ã€‚ä½†æ˜¯ä½ å¯ä»¥æ‰¾ä¸ªç®—æ³•ç†å¿µä¸åŒçš„ä¾§é“¾æ¥ç©å®ƒã€‚æˆ‘ä»¬å°†åœ¨ä»¥åçš„è¯¾ç¨‹ä¸­å’±ä»¬ä¼šè®¨è®ºåˆ°ï¼Œä»€ä¹ˆæ ·çš„ DApp åº”è¯¥éƒ¨ç½²åœ¨å¤ªåŠä¸»é“¾ä¸Šï¼Œä»€ä¹ˆåˆæœ€å¥½æ”¾åœ¨ä¾§é“¾ã€‚</p></blockquote><p><strong>çœ gas çš„æ‹›æ•°ï¼šç»“æ„å°è£… ï¼ˆStruct packingï¼‰</strong><br>åœ¨ç¬¬1è¯¾ä¸­ï¼Œæˆ‘ä»¬æåˆ°é™¤äº†åŸºæœ¬ç‰ˆçš„ uint å¤–ï¼Œè¿˜æœ‰å…¶ä»–å˜ç§ uintï¼šuint8ï¼Œuint16ï¼Œuint32ç­‰ã€‚</p><p>é€šå¸¸æƒ…å†µä¸‹æˆ‘ä»¬ä¸ä¼šè€ƒè™‘ä½¿ç”¨ uint å˜ç§ï¼Œå› ä¸ºæ— è®ºå¦‚ä½•å®šä¹‰ uintçš„å¤§å°ï¼ŒSolidity ä¸ºå®ƒä¿ç•™256ä½çš„å­˜å‚¨ç©ºé—´ã€‚ä¾‹å¦‚ï¼Œä½¿ç”¨ uint8 è€Œä¸æ˜¯uintï¼ˆuint256ï¼‰ä¸ä¼šä¸ºä½ èŠ‚çœä»»ä½• gasã€‚</p><p>é™¤éï¼ŒæŠŠ uint ç»‘å®šåˆ° struct é‡Œé¢ã€‚</p><p>å¦‚æœä¸€ä¸ª struct ä¸­æœ‰å¤šä¸ª uintï¼Œåˆ™å°½å¯èƒ½ä½¿ç”¨è¾ƒå°çš„ uint, Solidity ä¼šå°†è¿™äº› uint æ‰“åŒ…åœ¨ä¸€èµ·ï¼Œä»è€Œå ç”¨è¾ƒå°‘çš„å­˜å‚¨ç©ºé—´ã€‚ä¾‹å¦‚ï¼š</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">struct NormalStruct &#123;</span><br><span class="line">  uint a;</span><br><span class="line">  uint b;</span><br><span class="line">  uint c;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">struct MiniMe &#123;</span><br><span class="line">  uint32 a;</span><br><span class="line">  uint32 b;</span><br><span class="line">  uint c;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// å› ä¸ºä½¿ç”¨äº†ç»“æ„æ‰“åŒ…ï¼Œ`mini` æ¯” `normal` å ç”¨çš„ç©ºé—´æ›´å°‘</span><br><span class="line">NormalStruct normal = NormalStruct(10, 20, 30);</span><br><span class="line">MiniMe mini = MiniMe(10, 20, 30); </span><br></pre></td></tr></table></figure><p>æ‰€ä»¥ï¼Œå½“ uint å®šä¹‰åœ¨ä¸€ä¸ª struct ä¸­çš„æ—¶å€™ï¼Œå°½é‡ä½¿ç”¨æœ€å°çš„æ•´æ•°å­ç±»å‹ä»¥èŠ‚çº¦ç©ºé—´ã€‚ å¹¶ä¸”æŠŠåŒæ ·ç±»å‹çš„å˜é‡æ”¾ä¸€èµ·ï¼ˆå³åœ¨ struct ä¸­å°†æŠŠå˜é‡æŒ‰ç…§ç±»å‹ä¾æ¬¡æ”¾ç½®ï¼‰ï¼Œè¿™æ · Solidity å¯ä»¥å°†å­˜å‚¨ç©ºé—´æœ€å°åŒ–ã€‚ä¾‹å¦‚ï¼Œæœ‰ä¸¤ä¸ª structï¼š</p><p>uint c; uint32 a; uint32 b; å’Œ uint32 a; uint c; uint32 b;</p><p>å‰è€…æ¯”åè€…éœ€è¦çš„gasæ›´å°‘ï¼Œå› ä¸ºå‰è€…æŠŠuint32æ”¾ä¸€èµ·äº†ã€‚<br>å®æˆ˜æ¼”ä¹ ï¼š</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">struct Zombie &#123;</span><br><span class="line">        string name;</span><br><span class="line">        uint dna;</span><br><span class="line">        uint32 level;</span><br><span class="line">        uint32 readyTime;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><h4 id="â‘¤æ—¶é—´å•ä½"><a href="#â‘¤æ—¶é—´å•ä½" class="headerlink" title="â‘¤æ—¶é—´å•ä½"></a>â‘¤æ—¶é—´å•ä½</h4><p>level å±æ€§è¡¨ç¤ºåƒµå°¸çš„çº§åˆ«ã€‚ä»¥åï¼Œåœ¨æˆ‘ä»¬åˆ›å»ºçš„æˆ˜æ–—ç³»ç»Ÿä¸­ï¼Œæ‰“èƒœä»—çš„åƒµå°¸ä¼šé€æ¸å‡çº§å¹¶è·å¾—æ›´å¤šçš„èƒ½åŠ›ã€‚</p><p>readyTime ç¨å¾®å¤æ‚ç‚¹ã€‚æˆ‘ä»¬å¸Œæœ›å¢åŠ ä¸€ä¸ªâ€œå†·å´å‘¨æœŸâ€ï¼Œè¡¨ç¤ºåƒµå°¸åœ¨ä¸¤æ¬¡çŒé£Ÿæˆ–æ”»å‡»ä¹‹ä¹‹é—´å¿…é¡»ç­‰å¾…çš„æ—¶é—´ã€‚å¦‚æœæ²¡æœ‰å®ƒï¼Œåƒµå°¸æ¯å¤©å¯èƒ½ä¼šæ”»å‡»å’Œç¹æ®–1,000æ¬¡ï¼Œè¿™æ ·æ¸¸æˆå°±å¤ªç®€å•äº†ã€‚</p><p>ä¸ºäº†è®°å½•åƒµå°¸åœ¨ä¸‹ä¸€æ¬¡è¿›å‡»å‰éœ€è¦ç­‰å¾…çš„æ—¶é—´ï¼Œæˆ‘ä»¬ä½¿ç”¨äº† Solidity çš„æ—¶é—´å•ä½ã€‚<br><strong>æ—¶é—´å•ä½</strong><br>Solidity ä½¿ç”¨è‡ªå·±çš„æœ¬åœ°æ—¶é—´å•ä½ã€‚</p><p>å˜é‡ now å°†è¿”å›å½“å‰çš„unixæ—¶é—´æˆ³ï¼ˆè‡ª1970å¹´1æœˆ1æ—¥ä»¥æ¥ç»è¿‡çš„ç§’æ•°ï¼‰ã€‚æˆ‘å†™è¿™å¥è¯æ—¶ unix æ—¶é—´æ˜¯ 1515527488ã€‚</p><blockquote><p>æ³¨æ„ï¼šUnixæ—¶é—´ä¼ ç»Ÿç”¨ä¸€ä¸ª32ä½çš„æ•´æ•°è¿›è¡Œå­˜å‚¨ã€‚è¿™ä¼šå¯¼è‡´â€œ2038å¹´â€é—®é¢˜ï¼Œå½“è¿™ä¸ª32ä½çš„unixæ—¶é—´æˆ³ä¸å¤Ÿç”¨ï¼Œäº§ç”Ÿæº¢å‡ºï¼Œä½¿ç”¨è¿™ä¸ªæ—¶é—´çš„é—ç•™ç³»ç»Ÿå°±éº»çƒ¦äº†ã€‚æ‰€ä»¥ï¼Œå¦‚æœæˆ‘ä»¬æƒ³è®©æˆ‘ä»¬çš„ DApp è·‘å¤Ÿ20å¹´ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨64ä½æ•´æ•°è¡¨ç¤ºæ—¶é—´ï¼Œä½†ä¸ºæ­¤æˆ‘ä»¬çš„ç”¨æˆ·åˆå¾—æ”¯ä»˜æ›´å¤šçš„ gasã€‚çœŸæ˜¯ä¸ªä¸¤éš¾çš„è®¾è®¡å•Šï¼</p></blockquote><p>Solidity è¿˜åŒ…å«ç§’(seconds)ï¼Œåˆ†é’Ÿ(minutes)ï¼Œå°æ—¶(hours)ï¼Œå¤©(days)ï¼Œå‘¨(weeks) å’Œ å¹´(years) ç­‰æ—¶é—´å•ä½ã€‚å®ƒä»¬éƒ½ä¼šè½¬æ¢æˆå¯¹åº”çš„ç§’æ•°æ”¾å…¥ uint ä¸­ã€‚æ‰€ä»¥ 1åˆ†é’Ÿ å°±æ˜¯ 60ï¼Œ1å°æ—¶æ˜¯ 3600ï¼ˆ60ç§’Ã—60åˆ†é’Ÿï¼‰ï¼Œ1å¤©æ˜¯86400ï¼ˆ24å°æ—¶Ã—60åˆ†é’ŸÃ—60ç§’ï¼‰ï¼Œä»¥æ­¤ç±»æ¨ã€‚</p><p>ä¸‹é¢æ˜¯ä¸€äº›ä½¿ç”¨æ—¶é—´å•ä½çš„å®ç”¨æ¡ˆä¾‹ï¼š</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">uint lastUpdated;</span><br><span class="line"></span><br><span class="line">// å°†â€˜ä¸Šæ¬¡æ›´æ–°æ—¶é—´â€™ è®¾ç½®ä¸º â€˜ç°åœ¨â€™</span><br><span class="line">function updateTimestamp() public &#123;</span><br><span class="line">  lastUpdated = now;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// å¦‚æœåˆ°ä¸Šæ¬¡`updateTimestamp` è¶…è¿‡5åˆ†é’Ÿï¼Œè¿”å› &#x27;true&#x27;</span><br><span class="line">// ä¸åˆ°5åˆ†é’Ÿè¿”å› &#x27;false&#x27;</span><br><span class="line">function fiveMinutesHavePassed() public view returns (bool) &#123;</span><br><span class="line">  return (now &gt;= (lastUpdated + 5 minutes));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æœ‰äº†è¿™äº›å·¥å…·ï¼Œæˆ‘ä»¬å¯ä»¥ä¸ºåƒµå°¸è®¾å®šâ€œå†·é™æ—¶é—´â€åŠŸèƒ½ã€‚<br>å®æˆ˜æ¼”ä¹ ï¼š</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">// 1. åœ¨è¿™é‡Œå®šä¹‰ `cooldownTime`</span><br><span class="line"></span><br><span class="line">// 2. ä¿®æ”¹ä¸‹é¢è¿™è¡Œ:</span><br><span class="line">        uint id = zombies.push(Zombie(_name, _dna)) - 1;</span><br><span class="line">// uint cooldownTime = 1 days;</span><br><span class="line">   uint id = zombies.push(Zombie(_name, _dna, 1, uint32(now + cooldownTime))) - 1;</span><br></pre></td></tr></table></figure><h4 id="â‘¥åƒµå°¸å†·å´"><a href="#â‘¥åƒµå°¸å†·å´" class="headerlink" title="â‘¥åƒµå°¸å†·å´"></a>â‘¥åƒµå°¸å†·å´</h4><p>ç°åœ¨ï¼ŒZombie ç»“æ„ä½“ä¸­å®šä¹‰å¥½äº†ä¸€ä¸ª readyTime å±æ€§ï¼Œè®©æˆ‘ä»¬è·³åˆ° zombiefeeding.solï¼Œ å»å®ç°ä¸€ä¸ªâ€å†·å´å‘¨æœŸå®šæ—¶å™¨â€œã€‚</p><p>æŒ‰ç…§ä»¥ä¸‹æ­¥éª¤ä¿®æ”¹ feedAndMultiplyï¼š</p><ol><li>â€æ•çŒâ€œè¡Œä¸ºä¼šè§¦å‘åƒµå°¸çš„â€å†·å´å‘¨æœŸâ€œ</li><li>åƒµå°¸åœ¨è¿™æ®µâ€å†·å´å‘¨æœŸâ€œç»“æŸå‰ä¸å¯å†æ•çŒå°çŒ«</li></ol><p>è¿™å°†é™åˆ¶åƒµå°¸ï¼Œé˜²æ­¢å…¶æ— é™åˆ¶åœ°æ•çŒå°çŒ«æˆ–è€…æ•´å¤©ä¸åœåœ°ç¹æ®–ã€‚å°†æ¥ï¼Œå½“æˆ‘ä»¬å¢åŠ æˆ˜æ–—åŠŸèƒ½æ—¶ï¼Œæˆ‘ä»¬åŒæ ·ç”¨â€å†·å´å‘¨æœŸâ€œé™åˆ¶åƒµå°¸ä¹‹é—´æ‰“æ–—çš„é¢‘ç‡ã€‚</p><p>é¦–å…ˆï¼Œæˆ‘ä»¬è¦å®šä¹‰ä¸€äº›è¾…åŠ©å‡½æ•°ï¼Œè®¾ç½®å¹¶æ£€æŸ¥åƒµå°¸çš„ readyTimeã€‚<br><strong>å°†ç»“æ„ä½“ä½œä¸ºå‚æ•°ä¼ å…¥</strong><br>ç”±äºç»“æ„ä½“çš„å­˜å‚¨æŒ‡é’ˆå¯ä»¥ä»¥å‚æ•°çš„æ–¹å¼ä¼ é€’ç»™ä¸€ä¸ª private æˆ– internal çš„å‡½æ•°ï¼Œå› æ­¤ç»“æ„ä½“å¯ä»¥åœ¨å¤šä¸ªå‡½æ•°ä¹‹é—´ç›¸äº’ä¼ é€’ã€‚</p><p>éµå¾ªè¿™æ ·çš„è¯­æ³•ï¼š</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">function _doStuff(Zombie storage _zombie) internal &#123;</span><br><span class="line">  // do stuff with _zombie</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿™æ ·æˆ‘ä»¬å¯ä»¥å°†æŸåƒµå°¸çš„å¼•ç”¨ç›´æ¥ä¼ é€’ç»™ä¸€ä¸ªå‡½æ•°ï¼Œè€Œä¸ç”¨æ˜¯é€šè¿‡å‚æ•°ä¼ å…¥åƒµå°¸IDåï¼Œå‡½æ•°å†ä¾æ®IDå»æŸ¥æ‰¾ã€‚<br>å®æˆ˜æ¼”ä¹ ï¼š</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">function _triggerCooldown(Zombie storage _zombie) internal &#123;</span><br><span class="line">  _zombie.readyTime = uint32(now + cooldownTime);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">function _isReady(Zombie storage _zombie) internal view returns (bool) &#123;</span><br><span class="line">    return (_zombie.readyTime &lt;= now);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="â‘¦å…¬æœ‰å‡½æ•°å’Œå®‰å…¨æ€§"><a href="#â‘¦å…¬æœ‰å‡½æ•°å’Œå®‰å…¨æ€§" class="headerlink" title="â‘¦å…¬æœ‰å‡½æ•°å’Œå®‰å…¨æ€§"></a>â‘¦å…¬æœ‰å‡½æ•°å’Œå®‰å…¨æ€§</h4><p>ç°åœ¨æ¥ä¿®æ”¹ feedAndMultiply ï¼Œå®ç°å†·å´å‘¨æœŸã€‚</p><p>å›é¡¾ä¸€ä¸‹è¿™ä¸ªå‡½æ•°ï¼Œå‰ä¸€è¯¾ä¸Šæˆ‘ä»¬å°†å…¶å¯è§æ€§è®¾ç½®ä¸ºpublicã€‚ä½ å¿…é¡»ä»”ç»†åœ°æ£€æŸ¥æ‰€æœ‰å£°æ˜ä¸º public å’Œ externalçš„å‡½æ•°ï¼Œä¸€ä¸ªä¸ªæ’é™¤ç”¨æˆ·æ»¥ç”¨å®ƒä»¬çš„å¯èƒ½ï¼Œè°¨é˜²å®‰å…¨æ¼æ´ã€‚è¯·è®°ä½ï¼Œå¦‚æœè¿™äº›å‡½æ•°æ²¡æœ‰ç±»ä¼¼ onlyOwner è¿™æ ·çš„å‡½æ•°ä¿®é¥°ç¬¦ï¼Œç”¨æˆ·èƒ½åˆ©ç”¨å„ç§å¯èƒ½çš„å‚æ•°å»è°ƒç”¨å®ƒä»¬ã€‚</p><p>æ£€æŸ¥å®Œè¿™ä¸ªå‡½æ•°ï¼Œç”¨æˆ·å°±å¯ä»¥ç›´æ¥è°ƒç”¨è¿™ä¸ªå®ƒï¼Œå¹¶ä¼ å…¥ä»–ä»¬æ‰€å¸Œæœ›çš„ _targetDna æˆ– species ã€‚</p><p>ä»”ç»†è§‚å¯Ÿï¼Œè¿™ä¸ªå‡½æ•°åªéœ€è¢« feedOnKitty() è°ƒç”¨ï¼Œå› æ­¤ï¼Œæƒ³è¦é˜²æ­¢æ¼æ´ï¼Œæœ€ç®€å•çš„æ–¹æ³•å°±æ˜¯è®¾å…¶å¯è§æ€§ä¸º internalã€‚<br>å®æˆ˜æ¼”ä¹ ï¼š</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">// 1. ä½¿è¿™ä¸ªå‡½æ•°çš„å¯è§æ€§ä¸º internal</span><br><span class="line">  function feedAndMultiply(uint _zombieId, uint _targetDna, string species) internal &#123;</span><br><span class="line">    require(msg.sender == zombieToOwner[_zombieId]);</span><br><span class="line">    Zombie storage myZombie = zombies[_zombieId];</span><br><span class="line">    require(_isReady(myZombie));// 2. åœ¨è¿™é‡Œä¸º `_isReady` å¢åŠ ä¸€ä¸ªæ£€æŸ¥</span><br><span class="line">    _targetDna = _targetDna % dnaModulus;</span><br><span class="line">    uint newDna = (myZombie.dna + _targetDna) / 2;</span><br><span class="line">    if (keccak256(species) == keccak256(&quot;kitty&quot;)) &#123;</span><br><span class="line">      newDna = newDna - newDna % 100 + 99;</span><br><span class="line">    &#125;</span><br><span class="line">    _createZombie(&quot;NoName&quot;, newDna);</span><br><span class="line">    _triggerCooldown(myZombie);// 3. è°ƒç”¨ `_triggerCooldown`</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure><h4 id="â‘§è¿›ä¸€æ­¥äº†è§£å‡½æ•°ä¿®é¥°ç¬¦"><a href="#â‘§è¿›ä¸€æ­¥äº†è§£å‡½æ•°ä¿®é¥°ç¬¦" class="headerlink" title="â‘§è¿›ä¸€æ­¥äº†è§£å‡½æ•°ä¿®é¥°ç¬¦"></a>â‘§è¿›ä¸€æ­¥äº†è§£å‡½æ•°ä¿®é¥°ç¬¦</h4><p><strong>å¸¦å‚æ•°çš„å‡½æ•°ä¿®é¥°ç¬¦</strong><br>ä¹‹å‰æˆ‘ä»¬å·²ç»è¯»è¿‡ä¸€ä¸ªç®€å•çš„å‡½æ•°ä¿®é¥°ç¬¦äº†ï¼šonlyOwnerã€‚å‡½æ•°ä¿®é¥°ç¬¦ä¹Ÿå¯ä»¥å¸¦å‚æ•°ã€‚ä¾‹å¦‚ï¼š</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">// å­˜å‚¨ç”¨æˆ·å¹´é¾„çš„æ˜ å°„</span><br><span class="line">mapping (uint =&gt; uint) public age;</span><br><span class="line"></span><br><span class="line">// é™å®šç”¨æˆ·å¹´é¾„çš„ä¿®é¥°ç¬¦</span><br><span class="line">modifier olderThan(uint _age, uint _userId) &#123;</span><br><span class="line">  require(age[_userId] &gt;= _age);</span><br><span class="line">  _;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// å¿…é¡»å¹´æ»¡16å‘¨å²æ‰å…è®¸å¼€è½¦ (è‡³å°‘åœ¨ç¾å›½æ˜¯è¿™æ ·çš„).</span><br><span class="line">// æˆ‘ä»¬å¯ä»¥ç”¨å¦‚ä¸‹å‚æ•°è°ƒç”¨`olderThan` ä¿®é¥°ç¬¦:</span><br><span class="line">function driveCar(uint _userId) public olderThan(16, _userId) &#123;</span><br><span class="line">  // å…¶ä½™çš„ç¨‹åºé€»è¾‘</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>çœ‹åˆ°äº†å§ï¼Œ olderThan ä¿®é¥°ç¬¦å¯ä»¥åƒå‡½æ•°ä¸€æ ·æ¥æ”¶å‚æ•°ï¼Œæ˜¯â€œå®¿ä¸»â€å‡½æ•° driveCar æŠŠå‚æ•°ä¼ é€’ç»™å®ƒçš„ä¿®é¥°ç¬¦çš„ã€‚</p><p>æ¥ï¼Œæˆ‘ä»¬è‡ªå·±ç”Ÿäº§ä¸€ä¸ªä¿®é¥°ç¬¦ï¼Œé€šè¿‡ä¼ å…¥çš„levelå‚æ•°æ¥é™åˆ¶åƒµå°¸ä½¿ç”¨æŸäº›ç‰¹æ®ŠåŠŸèƒ½ã€‚<br>å®æˆ˜æ¼”ä¹ ï¼š</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">pragma solidity ^0.4.19;</span><br><span class="line"></span><br><span class="line">import &quot;./zombiefeeding.sol&quot;;</span><br><span class="line"></span><br><span class="line">contract ZombieHelper is ZombieFeeding &#123;</span><br><span class="line"></span><br><span class="line">  modifier aboveLevel(uint _level, uint _zombieId) &#123;</span><br><span class="line">    require(zombies[_zombieId].level &gt;= _level);</span><br><span class="line">    _;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="â‘¨åƒµå°¸ä¿®é¥°ç¬¦"><a href="#â‘¨åƒµå°¸ä¿®é¥°ç¬¦" class="headerlink" title="â‘¨åƒµå°¸ä¿®é¥°ç¬¦"></a>â‘¨åƒµå°¸ä¿®é¥°ç¬¦</h4><p>ç°åœ¨è®©æˆ‘ä»¬è®¾è®¡ä¸€äº›ä½¿ç”¨ aboveLevel ä¿®é¥°ç¬¦çš„å‡½æ•°ã€‚</p><p>ä½œä¸ºæ¸¸æˆï¼Œæ‚¨å¾—æœ‰ä¸€äº›æªæ–½æ¿€åŠ±ç©å®¶ä»¬å»å‡çº§ä»–ä»¬çš„åƒµå°¸ï¼š</p><ul><li>2çº§ä»¥ä¸Šçš„åƒµå°¸ï¼Œç©å®¶å¯ç»™ä»–ä»¬æ”¹åã€‚</li><li>20çº§ä»¥ä¸Šçš„åƒµå°¸ï¼Œç©å®¶èƒ½ç»™ä»–ä»¬å®šåˆ¶çš„ DNAã€‚</li></ul><p>æ˜¯å®ç°è¿™äº›åŠŸèƒ½çš„æ—¶å€™äº†ã€‚ä»¥ä¸‹æ˜¯ä¸Šä¸€è¯¾çš„ç¤ºä¾‹ä»£ç ï¼Œä¾›å‚è€ƒï¼šï¼ˆç¬¬å…«èŠ‚è¯¾çš„ä»£ç ï¼‰<br>å®æˆ˜æ¼”ä¹ ï¼š</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">function changeName(uint _zombieId, string _newName) external aboveLevel(2, _zombieId) &#123;</span><br><span class="line">    require(msg.sender == zombieToOwner[_zombieId]);</span><br><span class="line">    zombies[_zombieId].name = _newName;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  function changeDna(uint _zombieId, uint _newDna) external aboveLevel(20, _zombieId) &#123;</span><br><span class="line">    require(msg.sender == zombieToOwner[_zombieId]);</span><br><span class="line">    zombies[_zombieId].dna = _newDna;</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure><h4 id="â‘©åˆ©ç”¨-â€˜Viewâ€™-å‡½æ•°èŠ‚çœ-Gas"><a href="#â‘©åˆ©ç”¨-â€˜Viewâ€™-å‡½æ•°èŠ‚çœ-Gas" class="headerlink" title="â‘©åˆ©ç”¨ â€˜Viewâ€™ å‡½æ•°èŠ‚çœ Gas"></a>â‘©åˆ©ç”¨ â€˜Viewâ€™ å‡½æ•°èŠ‚çœ Gas</h4><p>ç°åœ¨éœ€è¦æ·»åŠ çš„ä¸€ä¸ªåŠŸèƒ½æ˜¯ï¼šæˆ‘ä»¬çš„ DApp éœ€è¦ä¸€ä¸ªæ–¹æ³•æ¥æŸ¥çœ‹æŸç©å®¶çš„æ•´ä¸ªåƒµå°¸å†›å›¢ - æˆ‘ä»¬ç§°ä¹‹ä¸º getZombiesByOwnerã€‚</p><p>å®ç°è¿™ä¸ªåŠŸèƒ½åªéœ€ä»åŒºå—é“¾ä¸­è¯»å–æ•°æ®ï¼Œæ‰€ä»¥å®ƒå¯ä»¥æ˜¯ä¸€ä¸ª view å‡½æ•°ã€‚è¿™è®©æˆ‘ä»¬ä¸å¾—ä¸å›é¡¾ä¸€ä¸‹â€œgasä¼˜åŒ–â€è¿™ä¸ªé‡è¦è¯é¢˜ã€‚</p><p><strong>â€œviewâ€ å‡½æ•°ä¸èŠ± â€œgasâ€</strong><br>å½“ç©å®¶ä»å¤–éƒ¨è°ƒç”¨ä¸€ä¸ªviewå‡½æ•°ï¼Œæ˜¯ä¸éœ€è¦æ”¯ä»˜ä¸€åˆ† gas çš„ã€‚</p><p>è¿™æ˜¯å› ä¸º view å‡½æ•°ä¸ä¼šçœŸæ­£æ”¹å˜åŒºå—é“¾ä¸Šçš„ä»»ä½•æ•°æ® - å®ƒä»¬åªæ˜¯è¯»å–ã€‚å› æ­¤ç”¨ view æ ‡è®°ä¸€ä¸ªå‡½æ•°ï¼Œæ„å‘³ç€å‘Šè¯‰ web3.jsï¼Œè¿è¡Œè¿™ä¸ªå‡½æ•°åªéœ€è¦æŸ¥è¯¢ä½ çš„æœ¬åœ°ä»¥å¤ªåŠèŠ‚ç‚¹ï¼Œè€Œä¸éœ€è¦åœ¨åŒºå—é“¾ä¸Šåˆ›å»ºä¸€ä¸ªäº‹åŠ¡ï¼ˆäº‹åŠ¡éœ€è¦è¿è¡Œåœ¨æ¯ä¸ªèŠ‚ç‚¹ä¸Šï¼Œå› æ­¤èŠ±è´¹ gasï¼‰ã€‚</p><p>ç¨åæˆ‘ä»¬å°†ä»‹ç»å¦‚ä½•åœ¨è‡ªå·±çš„èŠ‚ç‚¹ä¸Šè®¾ç½® web3.jsã€‚ä½†ç°åœ¨ï¼Œä½ å…³é”®æ˜¯è¦è®°ä½ï¼Œåœ¨æ‰€èƒ½åªè¯»çš„å‡½æ•°ä¸Šæ ‡è®°ä¸Šè¡¨ç¤ºâ€œåªè¯»â€çš„â€œexternal view å£°æ˜ï¼Œå°±èƒ½ä¸ºä½ çš„ç©å®¶å‡å°‘åœ¨ DApp ä¸­ gas ç”¨é‡ã€‚</p><blockquote><p>æ³¨æ„ï¼šå¦‚æœä¸€ä¸ª view å‡½æ•°åœ¨å¦ä¸€ä¸ªå‡½æ•°çš„å†…éƒ¨è¢«è°ƒç”¨ï¼Œè€Œè°ƒç”¨å‡½æ•°ä¸ view å‡½æ•°çš„ä¸å±äºåŒä¸€ä¸ªåˆçº¦ï¼Œä¹Ÿä¼šäº§ç”Ÿè°ƒç”¨æˆæœ¬ã€‚è¿™æ˜¯å› ä¸ºå¦‚æœä¸»è°ƒå‡½æ•°åœ¨ä»¥å¤ªåŠåˆ›å»ºäº†ä¸€ä¸ªäº‹åŠ¡ï¼Œå®ƒä»ç„¶éœ€è¦é€ä¸ªèŠ‚ç‚¹å»éªŒè¯ã€‚æ‰€ä»¥æ ‡è®°ä¸º view çš„å‡½æ•°åªæœ‰åœ¨å¤–éƒ¨è°ƒç”¨æ—¶æ‰æ˜¯å…è´¹çš„ã€‚<br>å®æˆ˜æ¼”ä¹ ï¼š</p></blockquote><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">function getZombiesByOwner(address _owner) external view returns(uint[]) &#123;</span><br><span class="line">   </span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure><h4 id="â‘ªå­˜å‚¨éå¸¸æ˜‚è´µ"><a href="#â‘ªå­˜å‚¨éå¸¸æ˜‚è´µ" class="headerlink" title="â‘ªå­˜å‚¨éå¸¸æ˜‚è´µ"></a>â‘ªå­˜å‚¨éå¸¸æ˜‚è´µ</h4><p>Solidity ä½¿ç”¨storage(å­˜å‚¨)æ˜¯ç›¸å½“æ˜‚è´µçš„ï¼Œâ€å†™å…¥â€œæ“ä½œå°¤å…¶è´µã€‚</p><p>è¿™æ˜¯å› ä¸ºï¼Œæ— è®ºæ˜¯å†™å…¥è¿˜æ˜¯æ›´æ”¹ä¸€æ®µæ•°æ®ï¼Œ è¿™éƒ½å°†æ°¸ä¹…æ€§åœ°å†™å…¥åŒºå—é“¾ã€‚â€æ°¸ä¹…æ€§â€œå•Šï¼éœ€è¦åœ¨å…¨çƒæ•°åƒä¸ªèŠ‚ç‚¹çš„ç¡¬ç›˜ä¸Šå­˜å…¥è¿™äº›æ•°æ®ï¼Œéšç€åŒºå—é“¾çš„å¢é•¿ï¼Œæ‹·è´ä»½æ•°æ›´å¤šï¼Œå­˜å‚¨é‡ä¹Ÿå°±è¶Šå¤§ã€‚è¿™æ˜¯éœ€è¦æˆæœ¬çš„ï¼</p><p>ä¸ºäº†é™ä½æˆæœ¬ï¼Œä¸åˆ°ä¸‡ä¸å¾—å·²ï¼Œé¿å…å°†æ•°æ®å†™å…¥å­˜å‚¨ã€‚è¿™ä¹Ÿä¼šå¯¼è‡´æ•ˆç‡ä½ä¸‹çš„ç¼–ç¨‹é€»è¾‘ - æ¯”å¦‚æ¯æ¬¡è°ƒç”¨ä¸€ä¸ªå‡½æ•°ï¼Œéƒ½éœ€è¦åœ¨ memory(å†…å­˜) ä¸­é‡å»ºä¸€ä¸ªæ•°ç»„ï¼Œè€Œä¸æ˜¯ç®€å•åœ°å°†ä¸Šæ¬¡è®¡ç®—çš„æ•°ç»„ç»™å­˜å‚¨ä¸‹æ¥ä»¥ä¾¿å¿«é€ŸæŸ¥æ‰¾ã€‚</p><p>åœ¨å¤§å¤šæ•°ç¼–ç¨‹è¯­è¨€ä¸­ï¼Œéå†å¤§æ•°æ®é›†åˆéƒ½æ˜¯æ˜‚è´µçš„ã€‚ä½†æ˜¯åœ¨ Solidity ä¸­ï¼Œä½¿ç”¨ä¸€ä¸ªæ ‡è®°äº†external viewçš„å‡½æ•°ï¼Œéå†æ¯” storage è¦ä¾¿å®œå¤ªå¤šï¼Œå› ä¸º view å‡½æ•°ä¸ä¼šäº§ç”Ÿä»»ä½•èŠ±é”€ã€‚</p><p>æˆ‘ä»¬å°†åœ¨ä¸‹ä¸€ç« è®¨è®ºforå¾ªç¯ï¼Œç°åœ¨æˆ‘ä»¬æ¥çœ‹ä¸€ä¸‹çœ‹å¦‚ä½•å¦‚ä½•åœ¨å†…å­˜ä¸­å£°æ˜æ•°ç»„ã€‚</p><p><strong>åœ¨å†…å­˜ä¸­å£°æ˜æ•°ç»„</strong><br>åœ¨æ•°ç»„åé¢åŠ ä¸Š memoryå…³é”®å­—ï¼Œ è¡¨æ˜è¿™ä¸ªæ•°ç»„æ˜¯ä»…ä»…åœ¨å†…å­˜ä¸­åˆ›å»ºï¼Œä¸éœ€è¦å†™å…¥å¤–éƒ¨å­˜å‚¨ï¼Œå¹¶ä¸”åœ¨å‡½æ•°è°ƒç”¨ç»“æŸæ—¶å®ƒå°±è§£æ•£äº†ã€‚ä¸åœ¨ç¨‹åºç»“æŸæ—¶æŠŠæ•°æ®ä¿å­˜è¿› storage çš„åšæ³•ç›¸æ¯”ï¼Œå†…å­˜è¿ç®—å¯ä»¥å¤§å¤§èŠ‚çœgaså¼€é”€ â€“ æŠŠè¿™æ•°ç»„æ”¾åœ¨viewé‡Œç”¨ï¼Œå®Œå…¨ä¸ç”¨èŠ±é’±ã€‚</p><p>ä»¥ä¸‹æ˜¯ç”³æ˜ä¸€ä¸ªå†…å­˜æ•°ç»„çš„ä¾‹å­ï¼š</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">function getArray() external pure returns(uint[]) &#123;</span><br><span class="line">  // åˆå§‹åŒ–ä¸€ä¸ªé•¿åº¦ä¸º3çš„å†…å­˜æ•°ç»„</span><br><span class="line">  uint[] memory values = new uint[](3);</span><br><span class="line">  // èµ‹å€¼</span><br><span class="line">  values.push(1);</span><br><span class="line">  values.push(2);</span><br><span class="line">  values.push(3);</span><br><span class="line">  // è¿”å›æ•°ç»„</span><br><span class="line">  return values;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿™ä¸ªå°ä¾‹å­å±•ç¤ºäº†ä¸€äº›è¯­æ³•è§„åˆ™ï¼Œä¸‹ä¸€ç« ä¸­ï¼Œæˆ‘ä»¬å°†é€šè¿‡ä¸€ä¸ªå®é™…ç”¨ä¾‹ï¼Œå±•ç¤ºå®ƒå’Œ for å¾ªç¯ç»“åˆçš„åšæ³•ã€‚</p><blockquote><p>æ³¨æ„ï¼šå†…å­˜æ•°ç»„ å¿…é¡» ç”¨é•¿åº¦å‚æ•°ï¼ˆåœ¨æœ¬ä¾‹ä¸­ä¸º3ï¼‰åˆ›å»ºã€‚ç›®å‰ä¸æ”¯æŒ array.push()ä¹‹ç±»çš„æ–¹æ³•è°ƒæ•´æ•°ç»„å¤§å°ï¼Œåœ¨æœªæ¥çš„ç‰ˆæœ¬å¯èƒ½ä¼šæ”¯æŒé•¿åº¦ä¿®æ”¹ã€‚<br>å®æˆ˜æ¼”ä¹ ï¼š</p></blockquote><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">function getZombiesByOwner(address _owner) external view returns(uint[]) &#123;</span><br><span class="line">    uint[] memory result = new uint[](ownerZombieCount[_owner]);</span><br><span class="line">    return result;</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure><h4 id="â‘«Forå¾ªç¯"><a href="#â‘«Forå¾ªç¯" class="headerlink" title="â‘«Forå¾ªç¯"></a>â‘«Forå¾ªç¯</h4><p>åœ¨ä¹‹å‰çš„ç« èŠ‚ä¸­ï¼Œæˆ‘ä»¬æåˆ°è¿‡ï¼Œå‡½æ•°ä¸­ä½¿ç”¨çš„æ•°ç»„æ˜¯è¿è¡Œæ—¶åœ¨å†…å­˜ä¸­é€šè¿‡ for å¾ªç¯å®æ—¶æ„å»ºï¼Œè€Œä¸æ˜¯é¢„å…ˆå»ºç«‹åœ¨å­˜å‚¨ä¸­çš„ã€‚</p><p>ä¸ºä»€ä¹ˆè¦è¿™æ ·åšå‘¢ï¼Ÿ</p><p>ä¸ºäº†å®ç° getZombiesByOwner å‡½æ•°ï¼Œä¸€ç§â€œæ— è„‘å¼â€çš„è§£å†³æ–¹æ¡ˆæ˜¯åœ¨ ZombieFactory ä¸­å­˜å…¥â€ä¸»äººâ€œå’Œâ€åƒµå°¸å†›å›¢â€œçš„æ˜ å°„ã€‚</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">mapping (address =&gt; uint[]) public ownerToZombies</span><br></pre></td></tr></table></figure><p>ç„¶åæˆ‘ä»¬æ¯æ¬¡åˆ›å»ºæ–°åƒµå°¸æ—¶ï¼Œæ‰§è¡Œ ownerToZombies [owner] .pushï¼ˆzombieIdï¼‰ å°†å…¶æ·»åŠ åˆ°ä¸»äººçš„åƒµå°¸æ•°ç»„ä¸­ã€‚è€Œ getZombiesByOwner å‡½æ•°ä¹Ÿéå¸¸ç®€å•ï¼š</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">function getZombiesByOwner(address _owner) external view returns (uint[]) &#123;</span><br><span class="line">  return ownerToZombies[_owner];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>è¿™ä¸ªåšæ³•æœ‰é—®é¢˜</strong><br>åšæ³•å€’æ˜¯ç®€å•ã€‚å¯æ˜¯å¦‚æœæˆ‘ä»¬éœ€è¦ä¸€ä¸ªå‡½æ•°æ¥æŠŠä¸€å¤´åƒµå°¸è½¬ç§»åˆ°å¦ä¸€ä¸ªä¸»äººåä¸‹ï¼ˆæˆ‘ä»¬ä¸€å®šä¼šåœ¨åé¢çš„è¯¾ç¨‹ä¸­å®ç°çš„ï¼‰ï¼Œåˆä¼šå‘ç”Ÿä»€ä¹ˆï¼Ÿ</p><p>è¿™ä¸ªâ€œæ¢ä¸»â€å‡½æ•°è¦åšåˆ°ï¼š</p><p>1.å°†åƒµå°¸pushåˆ°æ–°ä¸»äººçš„ ownerToZombies æ•°ç»„ä¸­ï¼Œ 2.ä»æ—§ä¸»çš„ ownerToZombies æ•°ç»„ä¸­ç§»é™¤åƒµå°¸ï¼Œ 3.å°†æ—§ä¸»åƒµå°¸æ•°ç»„ä¸­â€œæ¢ä¸»åƒµå°¸â€ä¹‹åçš„çš„æ¯å¤´åƒµå°¸éƒ½å¾€å‰æŒªä¸€ä½ï¼ŒæŠŠæŒªèµ°â€œæ¢ä¸»åƒµå°¸â€åç•™ä¸‹çš„â€œç©ºæ§½â€å¡«ä¸Šï¼Œ 4.å°†æ•°ç»„é•¿åº¦å‡1ã€‚</p><p>ä½†æ˜¯ç¬¬ä¸‰æ­¥å®åœ¨æ˜¯å¤ªè´µäº†ï¼å› ä¸ºæ¯æŒªåŠ¨ä¸€å¤´åƒµå°¸ï¼Œæˆ‘ä»¬éƒ½è¦æ‰§è¡Œä¸€æ¬¡å†™æ“ä½œã€‚å¦‚æœä¸€ä¸ªä¸»äººæœ‰20å¤´åƒµå°¸ï¼Œè€Œç¬¬ä¸€å¤´è¢«æŒªèµ°äº†ï¼Œé‚£ä¸ºäº†ä¿æŒæ•°ç»„çš„é¡ºåºï¼Œæˆ‘ä»¬å¾—åš19ä¸ªå†™æ“ä½œã€‚</p><p>ç”±äºå†™å…¥å­˜å‚¨æ˜¯ Solidity ä¸­æœ€è´¹ gas çš„æ“ä½œä¹‹ä¸€ï¼Œä½¿å¾—æ¢ä¸»å‡½æ•°çš„æ¯æ¬¡è°ƒç”¨éƒ½éå¸¸æ˜‚è´µã€‚æ›´ç³Ÿç³•çš„æ˜¯ï¼Œæ¯æ¬¡è°ƒç”¨çš„æ—¶å€™èŠ±è´¹çš„ gas éƒ½ä¸åŒï¼å…·ä½“è¿˜å–å†³äºç”¨æˆ·åœ¨åŸä¸»å†›å›¢ä¸­çš„åƒµå°¸å¤´æ•°ï¼Œä»¥åŠç§»èµ°çš„åƒµå°¸æ‰€åœ¨çš„ä½ç½®ã€‚ä»¥è‡³äºç”¨æˆ·éƒ½ä¸çŸ¥é“åº”è¯¥æ”¯ä»˜å¤šå°‘ gasã€‚</p><blockquote><p>æ³¨æ„ï¼šå½“ç„¶ï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥æŠŠæ•°ç»„ä¸­æœ€åä¸€ä¸ªåƒµå°¸å¾€å‰æŒªæ¥å¡«è¡¥ç©ºæ§½ï¼Œå¹¶å°†æ•°ç»„é•¿åº¦å‡å°‘ä¸€ã€‚ä½†è¿™æ ·æ¯åšä¸€ç¬”äº¤æ˜“ï¼Œéƒ½ä¼šæ”¹å˜åƒµå°¸å†›å›¢çš„ç§©åºã€‚</p></blockquote><p>ç”±äºä»å¤–éƒ¨è°ƒç”¨ä¸€ä¸ª view å‡½æ•°æ˜¯å…è´¹çš„ï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥åœ¨ getZombiesByOwner å‡½æ•°ä¸­ç”¨ä¸€ä¸ªforå¾ªç¯éå†æ•´ä¸ªåƒµå°¸æ•°ç»„ï¼ŒæŠŠå±äºæŸä¸ªä¸»äººçš„åƒµå°¸æŒ‘å‡ºæ¥æ„å»ºå‡ºåƒµå°¸æ•°ç»„ã€‚é‚£ä¹ˆæˆ‘ä»¬çš„ transfer å‡½æ•°å°†ä¼šä¾¿å®œå¾—å¤šï¼Œå› ä¸ºæˆ‘ä»¬ä¸éœ€è¦æŒªåŠ¨å­˜å‚¨é‡Œçš„åƒµå°¸æ•°ç»„é‡æ–°æ’åºï¼Œæ€»ä½“ä¸Šè¿™ä¸ªæ–¹æ³•ä¼šæ›´ä¾¿å®œï¼Œè™½ç„¶æœ‰ç‚¹åç›´è§‰ã€‚</p><p><strong>ä½¿ç”¨ for å¾ªç¯</strong><br>forå¾ªç¯çš„è¯­æ³•åœ¨ Solidity å’Œ JavaScript ä¸­ç±»ä¼¼ã€‚</p><p>æ¥çœ‹ä¸€ä¸ªåˆ›å»ºå¶æ•°æ•°ç»„çš„ä¾‹å­ï¼š</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">function getEvens() pure external returns(uint[]) &#123;</span><br><span class="line">  uint[] memory evens = new uint[](5);</span><br><span class="line">  // åœ¨æ–°æ•°ç»„ä¸­è®°å½•åºåˆ—å·</span><br><span class="line">  uint counter = 0;</span><br><span class="line">  // åœ¨å¾ªç¯ä»1è¿­ä»£åˆ°10ï¼š</span><br><span class="line">  for (uint i = 1; i &lt;= 10; i++) &#123;</span><br><span class="line">    // å¦‚æœ `i` æ˜¯å¶æ•°...</span><br><span class="line">    if (i % 2 == 0) &#123;</span><br><span class="line">      // æŠŠå®ƒåŠ å…¥å¶æ•°æ•°ç»„</span><br><span class="line">      evens[counter] = i;</span><br><span class="line">      //ç´¢å¼•åŠ ä¸€ï¼Œ æŒ‡å‘ä¸‹ä¸€ä¸ªç©ºçš„â€˜evenâ€™</span><br><span class="line">      counter++;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  return evens;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿™ä¸ªå‡½æ•°å°†è¿”å›ä¸€ä¸ªå½¢ä¸º [2,4,6,8,10] çš„æ•°ç»„ã€‚<br>å®æˆ˜æ¼”ä¹ ï¼š</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">function getZombiesByOwner(address _owner) external view returns(uint[]) &#123;</span><br><span class="line">    uint[] memory result = new uint[](ownerZombieCount[_owner]);</span><br><span class="line">    uint counter = 0;</span><br><span class="line">    for (uint i = 0; i &lt; zombies.length; i++) &#123;</span><br><span class="line">      if (zombieToOwner[i] == _owner) &#123;</span><br><span class="line">        result[counter] = i;</span><br><span class="line">        counter++;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    return result;</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure><h4 id="â‘¬æ”¾åœ¨ä¸€èµ·"><a href="#â‘¬æ”¾åœ¨ä¸€èµ·" class="headerlink" title="â‘¬æ”¾åœ¨ä¸€èµ·"></a>â‘¬æ”¾åœ¨ä¸€èµ·</h4><p><strong>è®©æˆ‘ä»¬å›é¡¾ä¸€ä¸‹ï¼š</strong></p><ul><li>æ·»åŠ äº†ä¸€ç§æ–°æ–¹æ³•æ¥ä¿®æ”¹CryptoKittiesåˆçº¦</li><li>å­¦ä¼šä½¿ç”¨ onlyOwner è¿›è¡Œè°ƒç”¨æƒé™é™åˆ¶</li><li>äº†è§£äº† gas å’Œ gas çš„ä¼˜åŒ–</li><li>ä¸ºåƒµå°¸æ·»åŠ äº† â€œçº§åˆ«â€ å’Œ â€œå†·å´å‘¨æœŸâ€å±æ€§</li><li>å½“åƒµå°¸è¾¾åˆ°ä¸€å®šçº§åˆ«æ—¶ï¼Œå…è®¸ä¿®æ”¹åƒµå°¸çš„åå­—å’Œ DNA</li><li>æœ€åï¼Œå®šä¹‰äº†ä¸€ä¸ªå‡½æ•°ï¼Œç”¨ä»¥è¿”å›æŸä¸ªç©å®¶çš„åƒµå°¸å†›å›¢</li></ul><h4 id="â‘­ç¬¬ä¸‰è¯¾å®Œæˆ"><a href="#â‘­ç¬¬ä¸‰è¯¾å®Œæˆ" class="headerlink" title="â‘­ç¬¬ä¸‰è¯¾å®Œæˆ"></a>â‘­ç¬¬ä¸‰è¯¾å®Œæˆ</h4><p>æˆªè‡³ç¬¬ä¸‰è¯¾å®Œæˆï¼Œæ‰€æœ‰ä»£ç å¦‚ä¸‹ï¼š<br>zombiehelper.sol:</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">pragma solidity ^0.4.19;</span><br><span class="line"></span><br><span class="line">import &quot;./zombiefeeding.sol&quot;;</span><br><span class="line"></span><br><span class="line">contract ZombieHelper is ZombieFeeding &#123;</span><br><span class="line"></span><br><span class="line">  modifier aboveLevel(uint _level, uint _zombieId) &#123;</span><br><span class="line">    require(zombies[_zombieId].level &gt;= _level);</span><br><span class="line">    _;</span><br><span class="line">  &#125; </span><br><span class="line"></span><br><span class="line">  function changeName(uint _zombieId, string _newName) external aboveLevel(2, _zombieId) &#123;</span><br><span class="line">    require(msg.sender == zombieToOwner[_zombieId]);</span><br><span class="line">    zombies[_zombieId].name = _newName;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  function changeDna(uint _zombieId, uint _newDna) external aboveLevel(20, _zombieId) &#123;</span><br><span class="line">    require(msg.sender == zombieToOwner[_zombieId]);</span><br><span class="line">    zombies[_zombieId].dna = _newDna;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  function getZombiesByOwner(address _owner) external view returns(uint[]) &#123;</span><br><span class="line">    uint[] memory result = new uint[](ownerZombieCount[_owner]);</span><br><span class="line">    uint counter = 0;</span><br><span class="line">    for (uint i = 0; i &lt; zombies.length; i++) &#123;</span><br><span class="line">      if (zombieToOwner[i] == _owner) &#123;</span><br><span class="line">        result[counter] = i;</span><br><span class="line">        counter++;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    return result;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>zombiefeeding.sol:</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">pragma solidity ^0.4.19;</span><br><span class="line"></span><br><span class="line">import &quot;./zombiefactory.sol&quot;;</span><br><span class="line"></span><br><span class="line">contract KittyInterface &#123;</span><br><span class="line">  function getKitty(uint256 _id) external view returns (</span><br><span class="line">    bool isGestating,</span><br><span class="line">    bool isReady,</span><br><span class="line">    uint256 cooldownIndex,</span><br><span class="line">    uint256 nextActionAt,</span><br><span class="line">    uint256 siringWithId,</span><br><span class="line">    uint256 birthTime,</span><br><span class="line">    uint256 matronId,</span><br><span class="line">    uint256 sireId,</span><br><span class="line">    uint256 generation,</span><br><span class="line">    uint256 genes</span><br><span class="line">  );</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">contract ZombieFeeding is ZombieFactory &#123;</span><br><span class="line"></span><br><span class="line">  KittyInterface kittyContract;</span><br><span class="line"></span><br><span class="line">  function setKittyContractAddress(address _address) external onlyOwner &#123;</span><br><span class="line">    kittyContract = KittyInterface(_address);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  function _triggerCooldown(Zombie storage _zombie) internal &#123;</span><br><span class="line">    _zombie.readyTime = uint32(now + cooldownTime);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  function _isReady(Zombie storage _zombie) internal view returns (bool) &#123;</span><br><span class="line">      return (_zombie.readyTime &lt;= now);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  function feedAndMultiply(uint _zombieId, uint _targetDna, string _species) internal &#123;</span><br><span class="line">    require(msg.sender == zombieToOwner[_zombieId]);</span><br><span class="line">    Zombie storage myZombie = zombies[_zombieId];</span><br><span class="line">    require(_isReady(myZombie));</span><br><span class="line">    _targetDna = _targetDna % dnaModulus;</span><br><span class="line">    uint newDna = (myZombie.dna + _targetDna) / 2;</span><br><span class="line">    if (keccak256(_species) == keccak256(&quot;kitty&quot;)) &#123;</span><br><span class="line">      newDna = newDna - newDna % 100 + 99;</span><br><span class="line">    &#125;</span><br><span class="line">    _createZombie(&quot;NoName&quot;, newDna);</span><br><span class="line">    _triggerCooldown(myZombie);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  function feedOnKitty(uint _zombieId, uint _kittyId) public &#123;</span><br><span class="line">    uint kittyDna;</span><br><span class="line">    (,,,,,,,,,kittyDna) = kittyContract.getKitty(_kittyId);</span><br><span class="line">    feedAndMultiply(_zombieId, kittyDna, &quot;kitty&quot;);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>zombiefactory.sol:</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">pragma solidity ^0.4.19;</span><br><span class="line"></span><br><span class="line">import &quot;./ownable.sol&quot;;</span><br><span class="line"></span><br><span class="line">contract ZombieFactory is Ownable &#123;</span><br><span class="line"></span><br><span class="line">    event NewZombie(uint zombieId, string name, uint dna);</span><br><span class="line"></span><br><span class="line">    uint dnaDigits = 16;</span><br><span class="line">    uint dnaModulus = 10 ** dnaDigits;</span><br><span class="line">    uint cooldownTime = 1 days;</span><br><span class="line"></span><br><span class="line">    struct Zombie &#123;</span><br><span class="line">      string name;</span><br><span class="line">      uint dna;</span><br><span class="line">      uint32 level;</span><br><span class="line">      uint32 readyTime;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    Zombie[] public zombies;</span><br><span class="line"></span><br><span class="line">    mapping (uint =&gt; address) public zombieToOwner;</span><br><span class="line">    mapping (address =&gt; uint) ownerZombieCount;</span><br><span class="line"></span><br><span class="line">    function _createZombie(string _name, uint _dna) internal &#123;</span><br><span class="line">        uint id = zombies.push(Zombie(_name, _dna, 1, uint32(now + cooldownTime))) - 1;</span><br><span class="line">        zombieToOwner[id] = msg.sender;</span><br><span class="line">        ownerZombieCount[msg.sender]++;</span><br><span class="line">        NewZombie(id, _name, _dna);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    function _generateRandomDna(string _str) private view returns (uint) &#123;</span><br><span class="line">        uint rand = uint(keccak256(_str));</span><br><span class="line">        return rand % dnaModulus;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    function createRandomZombie(string _name) public &#123;</span><br><span class="line">        require(ownerZombieCount[msg.sender] == 0);</span><br><span class="line">        uint randDna = _generateRandomDna(_name);</span><br><span class="line">        randDna = randDna - randDna % 100;</span><br><span class="line">        _createZombie(_name, randDna);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ownable.sol:</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">/**</span><br><span class="line"> * @title Ownable</span><br><span class="line"> * @dev The Ownable contract has an owner address, and provides basic authorization control</span><br><span class="line"> * functions, this simplifies the implementation of &quot;user permissions&quot;.</span><br><span class="line"> */</span><br><span class="line">contract Ownable &#123;</span><br><span class="line">  address public owner;</span><br><span class="line"></span><br><span class="line">  event OwnershipTransferred(address indexed previousOwner, address indexed newOwner);</span><br><span class="line"></span><br><span class="line">  /**</span><br><span class="line">   * @dev The Ownable constructor sets the original `owner` of the contract to the sender</span><br><span class="line">   * account.</span><br><span class="line">   */</span><br><span class="line">  function Ownable() public &#123;</span><br><span class="line">    owner = msg.sender;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">  /**</span><br><span class="line">   * @dev Throws if called by any account other than the owner.</span><br><span class="line">   */</span><br><span class="line">  modifier onlyOwner() &#123;</span><br><span class="line">    require(msg.sender == owner);</span><br><span class="line">    _;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">  /**</span><br><span class="line">   * @dev Allows the current owner to transfer control of the contract to a newOwner.</span><br><span class="line">   * @param newOwner The address to transfer ownership to.</span><br><span class="line">   */</span><br><span class="line">  function transferOwnership(address newOwner) public onlyOwner &#123;</span><br><span class="line">    require(newOwner != address(0));</span><br><span class="line">    OwnershipTransferred(owner, newOwner);</span><br><span class="line">    owner = newOwner;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><hr><h3 id="å¿ƒå¾—-â‘ -â‘¡-â‘¢-â‘£-â‘¤-â‘¥-â‘¦-â‘§-â‘¨-â‘©-â‘ª-â‘«-â‘¬-â‘­-â‘®-â‘¯-â‘°-â‘±-â‘²-â‘³"><a href="#å¿ƒå¾—-â‘ -â‘¡-â‘¢-â‘£-â‘¤-â‘¥-â‘¦-â‘§-â‘¨-â‘©-â‘ª-â‘«-â‘¬-â‘­-â‘®-â‘¯-â‘°-â‘±-â‘²-â‘³" class="headerlink" title="å¿ƒå¾— â‘  â‘¡ â‘¢ â‘£ â‘¤ â‘¥ â‘¦ â‘§ â‘¨ â‘© â‘ª â‘« â‘¬ â‘­ â‘® â‘¯ â‘° â‘± â‘² â‘³"></a>å¿ƒå¾— â‘  â‘¡ â‘¢ â‘£ â‘¤ â‘¥ â‘¦ â‘§ â‘¨ â‘© â‘ª â‘« â‘¬ â‘­ â‘® â‘¯ â‘° â‘± â‘² â‘³</h3><h4 id="â‘ ç¬¬äºŒè¯¾-ç¬¬7èŠ‚Storageä¸Memory"><a href="#â‘ ç¬¬äºŒè¯¾-ç¬¬7èŠ‚Storageä¸Memory" class="headerlink" title="â‘ ç¬¬äºŒè¯¾ ç¬¬7èŠ‚Storageä¸Memory"></a>â‘ ç¬¬äºŒè¯¾ ç¬¬7èŠ‚Storageä¸Memory</h4><p>å®æˆ˜æ¼”ä¹ ä»£ç çš„ç¬¬ä¸‰è¡Œ<br>require(msg.sender &#x3D;&#x3D; zombieToOwner[_zombieId]);<br>&#x3D;&#x3D; åé¢ä¸ºä»€ä¹ˆæ˜¯ zombieToOwner[_zombieId]);<br>è€Œä¸æ˜¯ _zombieId</p><h4 id="â‘¡ç¬¬äºŒè¯¾-ç¬¬3èŠ‚Msg-sender"><a href="#â‘¡ç¬¬äºŒè¯¾-ç¬¬3èŠ‚Msg-sender" class="headerlink" title="â‘¡ç¬¬äºŒè¯¾ ç¬¬3èŠ‚Msg.sender"></a>â‘¡ç¬¬äºŒè¯¾ ç¬¬3èŠ‚Msg.sender</h4><p>å®æˆ˜æ¼”ä¹ ä¸­<br>    zombieToOwner[id] &#x3D; msg.sender;<br>    ownerZombieCount[msg.sender]++;<br>çš„è¿™ä¸¤å¥ä»£ç æ— æ³•ç†è§£</p><h4 id="â‘¢ç¬¬ä¸€è¯¾-ç¬¬8èŠ‚"><a href="#â‘¢ç¬¬ä¸€è¯¾-ç¬¬8èŠ‚" class="headerlink" title="â‘¢ç¬¬ä¸€è¯¾ ç¬¬8èŠ‚"></a>â‘¢ç¬¬ä¸€è¯¾ ç¬¬8èŠ‚</h4><p>æ¸¸æˆç¬¬ä¸€è¯¾çš„ç¬¬å…«å°èŠ‚çš„å®æˆ˜æ¼”ä¹ ä¸­<br>è¯¯æŠŠ zombies.push(Zombie(_name, _dna)); å†™æˆäº†zombies.push(Zombie(name, dna));</p><h4 id="â‘£ç¬¬ä¸€è¯¾-ç¬¬9èŠ‚"><a href="#â‘£ç¬¬ä¸€è¯¾-ç¬¬9èŠ‚" class="headerlink" title="â‘£ç¬¬ä¸€è¯¾ ç¬¬9èŠ‚"></a>â‘£ç¬¬ä¸€è¯¾ ç¬¬9èŠ‚</h4><p>æ¸¸æˆç¬¬ä¸€è¯¾çš„ç¬¬ä¹å°èŠ‚çš„å®æˆ˜æ¼”ä¹ ä¸­<br>è¯¯æŠŠ function createZombie(string _name, uint _dna) private {; å†™æˆäº†function _createZombie(string _name, uint <em>dna) private {;</em></p><h4 id="â‘¤ç¬¬ä¸€è¯¾-ç¬¬11èŠ‚"><a href="#â‘¤ç¬¬ä¸€è¯¾-ç¬¬11èŠ‚" class="headerlink" title="â‘¤ç¬¬ä¸€è¯¾ ç¬¬11èŠ‚"></a>â‘¤ç¬¬ä¸€è¯¾ ç¬¬11èŠ‚</h4><p>æ¸¸æˆç¬¬ä¸€è¯¾çš„ç¬¬åä¸€å°èŠ‚çš„å®æˆ˜æ¼”ä¹ ä¸­ æŠŠuint rand &#x3D; uint(keccak256(_str));<br>å†™æˆäº†uint rand &#x3D; (uint)keccak256(_str);</p><h4 id="â‘¥ç¬¬äºŒè¯¾ç¬¬6èŠ‚"><a href="#â‘¥ç¬¬äºŒè¯¾ç¬¬6èŠ‚" class="headerlink" title="â‘¥ç¬¬äºŒè¯¾ç¬¬6èŠ‚"></a>â‘¥ç¬¬äºŒè¯¾ç¬¬6èŠ‚</h4><p>â€˜_isReadyâ€™å‡½æ•°é‡Œä¸ºä»€ä¹ˆæ˜¯â€™return (_zombie.readyTime &lt;&#x3D; now);â€™<br>è€Œä¸æ˜¯â€™require(_zombie.readyTime &lt;&#x3D; now);â€™</p>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>Markdownè¯­è¨€å­¦ä¹ </title>
      <link href="/post/0.html"/>
      <url>/post/0.html</url>
      
        <content type="html"><![CDATA[<h1 id="RUNOOB-Markdown-Testå­¦ä¹ "><a href="#RUNOOB-Markdown-Testå­¦ä¹ " class="headerlink" title="RUNOOB Markdown Testå­¦ä¹ "></a>RUNOOB Markdown Testå­¦ä¹ </h1><h2 id="Hello-World"><a href="#Hello-World" class="headerlink" title="Hello World!"></a>Hello World!</h2><h1 id="æ ‡é¢˜æ ¼å¼ï¼š"><a href="#æ ‡é¢˜æ ¼å¼ï¼š" class="headerlink" title="æ ‡é¢˜æ ¼å¼ï¼š"></a>æ ‡é¢˜æ ¼å¼ï¼š</h1><h1 id="ä¸€çº§æ ‡é¢˜"><a href="#ä¸€çº§æ ‡é¢˜" class="headerlink" title="ä¸€çº§æ ‡é¢˜"></a>ä¸€çº§æ ‡é¢˜</h1><h2 id="äºŒçº§æ ‡é¢˜"><a href="#äºŒçº§æ ‡é¢˜" class="headerlink" title="äºŒçº§æ ‡é¢˜"></a>äºŒçº§æ ‡é¢˜</h2><h3 id="ä¸‰çº§æ ‡é¢˜"><a href="#ä¸‰çº§æ ‡é¢˜" class="headerlink" title="ä¸‰çº§æ ‡é¢˜"></a>ä¸‰çº§æ ‡é¢˜</h3><h4 id="å››çº§æ ‡é¢˜"><a href="#å››çº§æ ‡é¢˜" class="headerlink" title="å››çº§æ ‡é¢˜"></a>å››çº§æ ‡é¢˜</h4><h5 id="äº”çº§æ ‡é¢˜"><a href="#äº”çº§æ ‡é¢˜" class="headerlink" title="äº”çº§æ ‡é¢˜"></a>äº”çº§æ ‡é¢˜</h5><h6 id="å…­çº§æ ‡é¢˜"><a href="#å…­çº§æ ‡é¢˜" class="headerlink" title="å…­çº§æ ‡é¢˜"></a>å…­çº§æ ‡é¢˜</h6><h1 id="æˆ‘å±•ç¤ºçš„æ˜¯ä¸€çº§æ ‡é¢˜"><a href="#æˆ‘å±•ç¤ºçš„æ˜¯ä¸€çº§æ ‡é¢˜" class="headerlink" title="æˆ‘å±•ç¤ºçš„æ˜¯ä¸€çº§æ ‡é¢˜"></a>æˆ‘å±•ç¤ºçš„æ˜¯ä¸€çº§æ ‡é¢˜</h1><h2 id="æˆ‘å±•ç¤ºçš„æ˜¯äºŒçº§æ ‡é¢˜"><a href="#æˆ‘å±•ç¤ºçš„æ˜¯äºŒçº§æ ‡é¢˜" class="headerlink" title="æˆ‘å±•ç¤ºçš„æ˜¯äºŒçº§æ ‡é¢˜"></a>æˆ‘å±•ç¤ºçš„æ˜¯äºŒçº§æ ‡é¢˜</h2><h1 id="å­—ä½“æ ¼å¼ï¼š"><a href="#å­—ä½“æ ¼å¼ï¼š" class="headerlink" title="å­—ä½“æ ¼å¼ï¼š"></a>å­—ä½“æ ¼å¼ï¼š</h1><p><em>æ–œä½“æ–‡æœ¬</em><br><em>æ–œä½“æ–‡æœ¬</em><br><strong>ç²—ä½“æ–‡æœ¬</strong><br><strong>ç²—ä½“æ–‡æœ¬</strong><br><em><strong>ç²—æ–œä½“æ–‡æœ¬</strong></em><br><em><strong>ç²—æ–œä½“æ–‡æœ¬</strong></em></p><h1 id="åˆ†å‰²çº¿ï¼š"><a href="#åˆ†å‰²çº¿ï¼š" class="headerlink" title="åˆ†å‰²çº¿ï¼š"></a>åˆ†å‰²çº¿ï¼š</h1><hr><hr><hr><hr><hr><h1 id="åˆ é™¤çº¿ï¼š"><a href="#åˆ é™¤çº¿ï¼š" class="headerlink" title="åˆ é™¤çº¿ï¼š"></a>åˆ é™¤çº¿ï¼š</h1><p>RUNOOB.COM<br>GOOGLE.COM<br><del>BAIDU.COM</del></p><h1 id="ä¸‹åˆ’çº¿ï¼š"><a href="#ä¸‹åˆ’çº¿ï¼š" class="headerlink" title="ä¸‹åˆ’çº¿ï¼š"></a>ä¸‹åˆ’çº¿ï¼š</h1><p><u>å¸¦ä¸‹åˆ’çº¿æ–‡æœ¬</u></p><h1 id="è„šæ³¨ï¼š"><a href="#è„šæ³¨ï¼š" class="headerlink" title="è„šæ³¨ï¼š"></a>è„šæ³¨ï¼š</h1><p>è„šæ³¨æ ¼å¼ï¼š[^è¦æ³¨æ˜çš„æ–‡æœ¬]<br>åˆ›å»ºè„šæ³¨æ ¼å¼ç±»ä¼¼è¿™æ · [^åˆ›å»º]ã€‚</p><p>[^åˆ›å»º]: èœé¸Ÿæ•™ç¨‹ â€“ å­¦çš„ä¸ä»…æ˜¯æŠ€æœ¯ï¼Œæ›´æ˜¯æ¢¦æƒ³ï¼ï¼ï¼</p><h1 id="æ— åºåˆ—è¡¨ï¼ˆä¸‰ç§å½¢å¼éƒ½å¯ä»¥ï¼‰ï¼š"><a href="#æ— åºåˆ—è¡¨ï¼ˆä¸‰ç§å½¢å¼éƒ½å¯ä»¥ï¼‰ï¼š" class="headerlink" title="æ— åºåˆ—è¡¨ï¼ˆä¸‰ç§å½¢å¼éƒ½å¯ä»¥ï¼‰ï¼š"></a>æ— åºåˆ—è¡¨ï¼ˆä¸‰ç§å½¢å¼éƒ½å¯ä»¥ï¼‰ï¼š</h1><ul><li>ç¬¬ä¸€é¡¹</li><li>ç¬¬äºŒé¡¹</li><li>ç¬¬ä¸‰é¡¹</li></ul><ul><li>ç¬¬ä¸€é¡¹</li><li>ç¬¬äºŒé¡¹</li><li>ç¬¬ä¸‰é¡¹</li></ul><ul><li>ç¬¬ä¸€é¡¹</li><li>ç¬¬äºŒé¡¹</li><li>ç¬¬ä¸‰é¡¹</li></ul><h1 id="æœ‰åºåˆ—è¡¨ï¼š"><a href="#æœ‰åºåˆ—è¡¨ï¼š" class="headerlink" title="æœ‰åºåˆ—è¡¨ï¼š"></a>æœ‰åºåˆ—è¡¨ï¼š</h1><ol><li>ç¬¬ä¸€é¡¹</li><li>ç¬¬äºŒé¡¹</li><li>ç¬¬ä¸‰é¡¹</li></ol><h1 id="åˆ—è¡¨åµŒå¥—ï¼ˆéœ€è¦åœ¨å­åˆ—è¡¨çš„å‰é¢åŠ å››ä¸ªç©ºæ ¼ï¼‰ï¼š"><a href="#åˆ—è¡¨åµŒå¥—ï¼ˆéœ€è¦åœ¨å­åˆ—è¡¨çš„å‰é¢åŠ å››ä¸ªç©ºæ ¼ï¼‰ï¼š" class="headerlink" title="åˆ—è¡¨åµŒå¥—ï¼ˆéœ€è¦åœ¨å­åˆ—è¡¨çš„å‰é¢åŠ å››ä¸ªç©ºæ ¼ï¼‰ï¼š"></a>åˆ—è¡¨åµŒå¥—ï¼ˆéœ€è¦åœ¨å­åˆ—è¡¨çš„å‰é¢åŠ å››ä¸ªç©ºæ ¼ï¼‰ï¼š</h1><ol><li>ç¬¬ä¸€é¡¹ï¼š<ul><li>ç¬¬ä¸€é¡¹åµŒå¥—çš„ç¬¬ä¸€ä¸ªå…ƒç´ </li><li>ç¬¬ä¸€é¡¹åµŒå¥—çš„ç¬¬äºŒä¸ªå…ƒç´ </li></ul></li><li>ç¬¬äºŒé¡¹ï¼š<ul><li>ç¬¬äºŒé¡¹åµŒå¥—çš„ç¬¬ä¸€ä¸ªå…ƒç´ </li><li>ç¬¬äºŒé¡¹åµŒå¥—çš„ç¬¬äºŒä¸ªå…ƒç´ </li></ul></li></ol><h1 id="åŒºå—ï¼ˆ-gt-åé¢éœ€è¦åŠ ä¸€ä¸ªç©ºæ ¼ï¼‰ï¼š"><a href="#åŒºå—ï¼ˆ-gt-åé¢éœ€è¦åŠ ä¸€ä¸ªç©ºæ ¼ï¼‰ï¼š" class="headerlink" title="åŒºå—ï¼ˆ&gt;åé¢éœ€è¦åŠ ä¸€ä¸ªç©ºæ ¼ï¼‰ï¼š"></a>åŒºå—ï¼ˆ&gt;åé¢éœ€è¦åŠ ä¸€ä¸ªç©ºæ ¼ï¼‰ï¼š</h1><blockquote><p>åŒºå—å¼•ç”¨<br>èœé¸Ÿæ•™ç¨‹<br>å­¦çš„ä¸ä»…æ˜¯æŠ€æœ¯æ›´æ˜¯æ¢¦æƒ³</p></blockquote><h2 id="åŒºå—åµŒå¥—ï¼š"><a href="#åŒºå—åµŒå¥—ï¼š" class="headerlink" title="åŒºå—åµŒå¥—ï¼š"></a>åŒºå—åµŒå¥—ï¼š</h2><blockquote><p>æœ€å¤–å±‚</p><blockquote><p>ç¬¬ä¸€å±‚åµŒå¥—<br>111</p><blockquote><p>ç¬¬äºŒå±‚åµŒå¥—<br>222</p></blockquote></blockquote></blockquote><h2 id="åŒºå—ä¸­ä½¿ç”¨åˆ—è¡¨ï¼š"><a href="#åŒºå—ä¸­ä½¿ç”¨åˆ—è¡¨ï¼š" class="headerlink" title="åŒºå—ä¸­ä½¿ç”¨åˆ—è¡¨ï¼š"></a>åŒºå—ä¸­ä½¿ç”¨åˆ—è¡¨ï¼š</h2><blockquote><p>åŒºå—ä¸­ä½¿ç”¨åˆ—è¡¨</p><ol><li>ç¬¬ä¸€é¡¹</li><li>ç¬¬äºŒé¡¹</li></ol><ul><li>ç¬¬ä¸€é¡¹</li><li>ç¬¬äºŒé¡¹</li><li>ç¬¬ä¸‰é¡¹</li></ul></blockquote><h2 id="åˆ—è¡¨ä¸­ä½¿ç”¨åŒºå—ï¼š"><a href="#åˆ—è¡¨ä¸­ä½¿ç”¨åŒºå—ï¼š" class="headerlink" title="åˆ—è¡¨ä¸­ä½¿ç”¨åŒºå—ï¼š"></a>åˆ—è¡¨ä¸­ä½¿ç”¨åŒºå—ï¼š</h2><ul><li>ç¬¬ä¸€é¡¹<blockquote><p>èœé¸Ÿæ•™ç¨‹<br>å­¦çš„ä¸ä»…æ˜¯æŠ€æœ¯æ›´æ˜¯æ¢¦æƒ³</p></blockquote></li><li>ç¬¬äºŒé¡¹</li></ul><h1 id="ä»£ç ï¼š"><a href="#ä»£ç ï¼š" class="headerlink" title="ä»£ç ï¼š"></a>ä»£ç ï¼š</h1><p><code>printf()</code> å‡½æ•°<br><code>System.out.println()</code> å‡½æ•°</p><h2 id="ä»£ç åŒºå—-ä»£ç åŒºå—ä½¿ç”¨-4-ä¸ªç©ºæ ¼æˆ–è€…ä¸€ä¸ªåˆ¶è¡¨ç¬¦ï¼ˆTab-é”®ï¼‰ã€‚-ï¼š"><a href="#ä»£ç åŒºå—-ä»£ç åŒºå—ä½¿ç”¨-4-ä¸ªç©ºæ ¼æˆ–è€…ä¸€ä¸ªåˆ¶è¡¨ç¬¦ï¼ˆTab-é”®ï¼‰ã€‚-ï¼š" class="headerlink" title="ä»£ç åŒºå—(ä»£ç åŒºå—ä½¿ç”¨ 4 ä¸ªç©ºæ ¼æˆ–è€…ä¸€ä¸ªåˆ¶è¡¨ç¬¦ï¼ˆTab é”®ï¼‰ã€‚)ï¼š"></a>ä»£ç åŒºå—(ä»£ç åŒºå—ä½¿ç”¨ 4 ä¸ªç©ºæ ¼æˆ–è€…ä¸€ä¸ªåˆ¶è¡¨ç¬¦ï¼ˆTab é”®ï¼‰ã€‚)ï¼š</h2><pre><code>System.out.println()public classpublic static void main</code></pre><h2 id="ä½ ä¹Ÿå¯ä»¥ç”¨-96-96-96-åŒ…è£¹ä¸€æ®µä»£ç ï¼Œå¹¶æŒ‡å®šä¸€ç§è¯­è¨€ï¼ˆä¹Ÿå¯ä»¥ä¸æŒ‡å®šï¼‰ï¼š"><a href="#ä½ ä¹Ÿå¯ä»¥ç”¨-96-96-96-åŒ…è£¹ä¸€æ®µä»£ç ï¼Œå¹¶æŒ‡å®šä¸€ç§è¯­è¨€ï¼ˆä¹Ÿå¯ä»¥ä¸æŒ‡å®šï¼‰ï¼š" class="headerlink" title="ä½ ä¹Ÿå¯ä»¥ç”¨ &#96;&#96;&#96; åŒ…è£¹ä¸€æ®µä»£ç ï¼Œå¹¶æŒ‡å®šä¸€ç§è¯­è¨€ï¼ˆä¹Ÿå¯ä»¥ä¸æŒ‡å®šï¼‰ï¼š"></a>ä½ ä¹Ÿå¯ä»¥ç”¨ &#96;&#96;&#96; åŒ…è£¹ä¸€æ®µä»£ç ï¼Œå¹¶æŒ‡å®šä¸€ç§è¯­è¨€ï¼ˆä¹Ÿå¯ä»¥ä¸æŒ‡å®šï¼‰ï¼š</h2><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">$(<span class="variable language_">document</span>).<span class="title function_">ready</span>(<span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">    <span class="title function_">alert</span>(<span class="string">&#x27;RUNOOB&#x27;</span>);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><h1 id="é“¾æ¥ï¼š"><a href="#é“¾æ¥ï¼š" class="headerlink" title="é“¾æ¥ï¼š"></a>é“¾æ¥ï¼š</h1><p>ç¬¬ä¸€ç§å½¢å¼ï¼š<a href="https://www.runoob.com/">https://www.runoob.com</a><br>ç¬¬äºŒç§å½¢å¼ï¼šè¿™æ˜¯ä¸€ä¸ªé“¾æ¥ <a href="https://www.runoob.com/">èœé¸Ÿæ•™ç¨‹</a></p><h2 id="é«˜çº§é“¾æ¥ï¼ˆæ„Ÿè§‰æ²¡å¤ªå¤§ç”¨å¤„ï¼‰ï¼š"><a href="#é«˜çº§é“¾æ¥ï¼ˆæ„Ÿè§‰æ²¡å¤ªå¤§ç”¨å¤„ï¼‰ï¼š" class="headerlink" title="é«˜çº§é“¾æ¥ï¼ˆæ„Ÿè§‰æ²¡å¤ªå¤§ç”¨å¤„ï¼‰ï¼š"></a>é«˜çº§é“¾æ¥ï¼ˆæ„Ÿè§‰æ²¡å¤ªå¤§ç”¨å¤„ï¼‰ï¼š</h2><p>è¿™ä¸ªé“¾æ¥ç”¨ 1 ä½œä¸ºç½‘å€å˜é‡ <a href="http://www.google.com/">Google</a><br>è¿™ä¸ªé“¾æ¥ç”¨ runoob ä½œä¸ºç½‘å€å˜é‡ <a href="http://www.runoob.com/">Runoob</a><br>ç„¶ååœ¨æ–‡æ¡£çš„ç»“å°¾ä¸ºå˜é‡èµ‹å€¼ï¼ˆç½‘å€ï¼‰</p><h1 id="å›¾ç‰‡"><a href="#å›¾ç‰‡" class="headerlink" title="å›¾ç‰‡"></a>å›¾ç‰‡</h1><p>è¯­æ³•æ ¼å¼ï¼š<br><img src="/%E5%9B%BE%E7%89%87%E5%9C%B0%E5%9D%80" alt="alt å±æ€§æ–‡æœ¬"></p><p><img src="/%E5%9B%BE%E7%89%87%E5%9C%B0%E5%9D%80" alt="alt å±æ€§æ–‡æœ¬" title="å¯é€‰æ ‡é¢˜"></p><ol><li>å¼€å¤´ä¸€ä¸ªæ„Ÿå¹å· !</li><li>æ¥ç€ä¸€ä¸ªæ–¹æ‹¬å·ï¼Œé‡Œé¢æ”¾ä¸Šå›¾ç‰‡çš„æ›¿ä»£æ–‡å­—</li><li>æ¥ç€ä¸€ä¸ªæ™®é€šæ‹¬å·ï¼Œé‡Œé¢æ”¾ä¸Šå›¾ç‰‡çš„ç½‘å€ï¼Œæœ€åè¿˜å¯ä»¥ç”¨å¼•å·åŒ…ä½å¹¶åŠ ä¸Šé€‰æ‹©æ€§çš„<br>â€˜titleâ€™ å±æ€§çš„æ–‡å­—ã€‚</li></ol><p><img src="http://static.runoob.com/images/runoob-logo.png" alt="RUNOOB å›¾æ ‡"></p><p><img src="http://static.runoob.com/images/runoob-logo.png" alt="RUNOOB å›¾æ ‡" title="RUNOOB"><br>ä¹Ÿå¯ä»¥åƒç½‘å€é‚£æ ·å¯¹å›¾ç‰‡ç½‘å€ä½¿ç”¨å˜é‡:</p><p>è¿™ä¸ªé“¾æ¥ç”¨ 1 ä½œä¸ºç½‘å€å˜é‡ <a href="http://www.google.com/">RUNOOB</a>.<br>ç„¶ååœ¨æ–‡æ¡£çš„ç»“å°¾ä¸ºå˜é‡èµ‹å€¼ï¼ˆç½‘å€ï¼‰</p><p>Markdown è¿˜æ²¡æœ‰åŠæ³•æŒ‡å®šå›¾ç‰‡çš„é«˜åº¦ä¸å®½åº¦ï¼Œå¦‚æœä½ éœ€è¦çš„è¯ï¼Œä½ å¯ä»¥ä½¿ç”¨æ™®é€šçš„ <img> æ ‡ç­¾ã€‚</p><img src="http://static.runoob.com/images/runoob-logo.png" width="50%"><h1 id="è¡¨æ ¼ï¼š"><a href="#è¡¨æ ¼ï¼š" class="headerlink" title="è¡¨æ ¼ï¼š"></a>è¡¨æ ¼ï¼š</h1><p>Markdown åˆ¶ä½œè¡¨æ ¼ä½¿ç”¨ | æ¥åˆ†éš”ä¸åŒçš„å•å…ƒæ ¼ï¼Œä½¿ç”¨ - æ¥åˆ†éš”è¡¨å¤´å’Œå…¶ä»–è¡Œã€‚<br>è¯­æ³•æ ¼å¼å¦‚ä¸‹ï¼š</p><table><thead><tr><th>è¡¨å¤´</th><th>è¡¨å¤´</th></tr></thead><tbody><tr><td>å•å…ƒæ ¼</td><td>å•å…ƒæ ¼</td></tr><tr><td>å•å…ƒæ ¼</td><td>å•å…ƒæ ¼</td></tr></tbody></table><p>å¯¹é½æ–¹å¼ï¼šæˆ‘ä»¬å¯ä»¥è®¾ç½®è¡¨æ ¼çš„å¯¹é½æ–¹å¼ï¼š</p><p>-: è®¾ç½®å†…å®¹å’Œæ ‡é¢˜æ å±…å³å¯¹é½ã€‚<br>:- è®¾ç½®å†…å®¹å’Œæ ‡é¢˜æ å±…å·¦å¯¹é½ã€‚<br>:-: è®¾ç½®å†…å®¹å’Œæ ‡é¢˜æ å±…ä¸­å¯¹é½ã€‚<br>å®ä¾‹å¦‚ä¸‹ï¼š</p><table><thead><tr><th align="left">å·¦å¯¹é½</th><th align="right">å³å¯¹é½</th><th align="center">å±…ä¸­å¯¹é½</th></tr></thead><tbody><tr><td align="left">å•å…ƒæ ¼11111</td><td align="right">å•å…ƒæ ¼11111</td><td align="center">å•å…ƒæ ¼11111111111</td></tr><tr><td align="left">å•å…ƒæ ¼222222</td><td align="right">å•å…ƒæ ¼222222222</td><td align="center">å•å…ƒæ ¼22</td></tr></tbody></table>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>Hello World</title>
      <link href="/post/4a17b156.html"/>
      <url>/post/4a17b156.html</url>
      
        <content type="html"><![CDATA[<p>Welcome to <a href="https://hexo.io/">Hexo</a>! This is your very first post. Check <a href="https://hexo.io/docs/">documentation</a> for more info. If you get any problems when using Hexo, you can find the answer in <a href="https://hexo.io/docs/troubleshooting.html">troubleshooting</a> or you can ask me on <a href="https://github.com/hexojs/hexo/issues">GitHub</a>.</p><h2 id="Hello-World"><a href="#Hello-World" class="headerlink" title="Hello World"></a>Hello World</h2><h2 id="Quick-Start"><a href="#Quick-Start" class="headerlink" title="Quick Start"></a>Quick Start</h2><h3 id="Create-a-new-post"><a href="#Create-a-new-post" class="headerlink" title="Create a new post"></a>Create a new post</h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ hexo new <span class="string">&quot;My New Post&quot;</span></span><br></pre></td></tr></table></figure><p>More info: <a href="https://hexo.io/docs/writing.html">Writing</a></p><h3 id="Run-server"><a href="#Run-server" class="headerlink" title="Run server"></a>Run server</h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ hexo server</span><br></pre></td></tr></table></figure><p>More info: <a href="https://hexo.io/docs/server.html">Server</a></p><h3 id="Generate-static-files"><a href="#Generate-static-files" class="headerlink" title="Generate static files"></a>Generate static files</h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ hexo generate</span><br></pre></td></tr></table></figure><p>More info: <a href="https://hexo.io/docs/generating.html">Generating</a></p><h3 id="Deploy-to-remote-sites"><a href="#Deploy-to-remote-sites" class="headerlink" title="Deploy to remote sites"></a>Deploy to remote sites</h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ hexo deploy</span><br></pre></td></tr></table></figure><p>More info: <a href="https://hexo.io/docs/one-command-deployment.html">Deployment</a></p>]]></content>
      
      
      
    </entry>
    
    
  
  
</search>
